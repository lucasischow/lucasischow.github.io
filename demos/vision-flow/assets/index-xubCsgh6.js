var ne=Object.defineProperty;var ie=(t,e,o)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var d=(t,e,o)=>ie(t,typeof e!="symbol"?e+"":e,o);import{i as re,a as ae,r as p,j as n,c as B,u as R,b as ce,L as de,d as he,e as $,f as ue,g as pe,h as fe,k as be,l as me,m as ge,n as xe,o as ye,p as ve,q as we,s as Ce,t as Me,v as je,w as Ne,P as Fe}from"./vendor-COwhDTQH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Se={label:"File",tooltip:"Open the file menu"},$e={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},Ee={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},Le={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},Te={label:"Save As",tooltip:"Save the current file with a new name"},De={label:"Import File",tooltip:"Import a file into the project"},ke={label:"Export",tooltip:"Export the current file"},Ae={label:"Export as PNG",tooltip:"Export the file as a PNG image"},ze={label:"Export as PDF",tooltip:"Export the file as a PDF document"},Be={label:"Export as CSV",tooltip:"Export the file as a CSV file"},Re={label:"Print",tooltip:"Print the current file"},Pe={label:"Close File",tooltip:"Close the current file"},Oe={label:"Edit",tooltip:"Open the edit menu"},Ie={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},Ue={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},Xe={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},Ye={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},He={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},_e={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},Ve={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},Ze={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},We={label:"View",tooltip:"Open the view menu"},Ge={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},Ke={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},qe={label:"Fit to Screen",tooltip:"Fit the content to the screen"},Qe={label:"Toggle Grid",tooltip:"Show or hide the grid"},Je={label:"Toggle Guides",tooltip:"Show or hide the guides"},et={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},tt={label:"Shape",tooltip:"Open the shape menu"},ot={label:"Add Node",tooltip:"Add a new node to the diagram"},st={label:"Delete Node",tooltip:"Delete the selected node"},lt={label:"Move Node",tooltip:"Move the selected node"},nt={label:"Resize Node",tooltip:"Resize the selected node"},it={label:"Rotate Node",tooltip:"Rotate the selected node"},rt={label:"Change Node Color",tooltip:"Change the color of the selected node"},at={label:"Change Node Border",tooltip:"Change the border of the selected node"},ct={label:"Change Node Text",tooltip:"Edit the text of the selected node"},dt={label:"Group Nodes",tooltip:"Group selected nodes together"},ht={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},ut={label:"Lock Node",tooltip:"Lock the selected node"},pt={label:"Unlock Node",tooltip:"Unlock the selected node"},ft={label:"Connection",tooltip:"Open the connection menu"},bt={label:"Add Edge",tooltip:"Add an edge between nodes"},mt={label:"Delete Edge",tooltip:"Delete the selected edge"},gt={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},xt={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},yt={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},vt={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},wt={label:"Text",tooltip:"Open the text menu"},Ct={label:"Add Text",tooltip:"Add text to the document"},Mt={label:"Edit Text",tooltip:"Edit the selected text"},jt={label:"Change Font",tooltip:"Change the font of the selected text"},Nt={label:"Change Font Size",tooltip:"Change the font size of the selected text"},Ft={label:"Change Font Color",tooltip:"Change the font color of the selected text"},St={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},$t={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},Et={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},Lt={label:"Align Text",tooltip:"Align the selected text"},Tt={label:"Layer",tooltip:"Open the layer menu"},Dt={label:"Send to Back",tooltip:"Send the selected layer to the back"},kt={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},At={label:"Send Backward",tooltip:"Send the selected layer one step backward"},zt={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},Bt={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},Rt={label:"Delete Layer",tooltip:"Delete the selected layer"},Pt={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},Ot={label:"Collaboration",tooltip:"Open the collaboration menu"},It={label:"Add Comment",tooltip:"Add a comment to the document"},Ut={label:"Edit Comment",tooltip:"Edit the selected comment"},Xt={label:"Delete Comment",tooltip:"Delete the selected comment"},Yt={label:"Share Document",tooltip:"Share the document with others"},Ht={file:Se,newFile:$e,openFile:Ee,saveFile:Le,saveAs:Te,importFile:De,exportFile:ke,exportFile_png:Ae,exportFile_pdf:ze,exportFile_csv:Be,print:Re,closeFile:Pe,edit:Oe,undo:Ie,redo:Ue,cut:Xe,copy:Ye,paste:He,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:_e,selectAll:Ve,findReplace:Ze,view:We,zoomIn:Ge,zoomOut:Ke,fitToScreen:qe,toggleGrid:Qe,toggleGuides:Je,fullscreenMode:et,shape:tt,addNode:ot,deleteNode:st,moveNode:lt,resizeNode:nt,rotateNode:it,changeNodeColor:rt,changeNodeBorder:at,changeNodeText:ct,groupNodes:dt,ungroupNodes:ht,lockNode:ut,unlockNode:pt,connection:ft,addEdge:bt,deleteEdge:mt,changeEdgeStyle:gt,changeEdgeColor:xt,changeEdgeLabel:yt,reverseEdge:vt,text:wt,addText:Ct,editText:Mt,changeFont:jt,changeFontSize:Nt,changeFontColor:Ft,boldText:St,italicText:$t,underlineText:Et,alignText:Lt,layer:Tt,sendToBack:Dt,bringToFront:kt,sendBackward:At,bringForward:zt,duplicateLayer:Bt,deleteLayer:Rt,toggleLayerVisibility:Pt,collaboration:Ot,addComment:It,editComment:Ut,deleteComment:Xt,shareDocument:Yt},_t={label:"Init",tooltip:"Initialize the file"},Vt={label:"Add Modules",tooltip:"Add new modules to the file"},Zt={label:"Delete Modules",tooltip:"Remove modules from the file"},Wt={label:"Paste Modules",tooltip:"Paste modules into the file"},Gt={label:"Duplicate Modules",tooltip:"Duplicate selected modules"},Kt={label:"Modify Modules",tooltip:"Modify the properties of modules"},qt={init:_t,addModules:Vt,deleteModules:Zt,pasteModules:Wt,duplicateModules:Gt,modifyModules:Kt},Qt={label:"文件",tooltip:"打开文件菜单"},Jt={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},eo={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},to={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},oo={label:"另存为",tooltip:"以新名称保存当前文件"},so={label:"导入文件",tooltip:"将文件导入到项目中"},lo={label:"导出",tooltip:"导出当前文件"},no={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},io={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},ro={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},ao={label:"打印",tooltip:"打印当前文件"},co={label:"关闭文件",tooltip:"关闭当前文件"},ho={label:"编辑",tooltip:"打开编辑菜单"},uo={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},po={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},fo={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},bo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},mo={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},go={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},xo={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},yo={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},vo={label:"视图",tooltip:"打开视图菜单"},wo={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},Co={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},Mo={label:"适应屏幕",tooltip:"使内容适应屏幕"},jo={label:"切换网格",tooltip:"显示或隐藏网格"},No={label:"切换参考线",tooltip:"显示或隐藏参考线"},Fo={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},So={label:"形状",tooltip:"打开形状菜单"},$o={label:"添加节点",tooltip:"向图表添加新节点"},Eo={label:"删除节点",tooltip:"删除选定的节点"},Lo={label:"移动节点",tooltip:"移动选定的节点"},To={label:"调整节点大小",tooltip:"调整选定节点的大小"},Do={label:"旋转节点",tooltip:"旋转选定的节点"},ko={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},Ao={label:"更改节点边框",tooltip:"更改选定节点的边框"},zo={label:"更改节点文本",tooltip:"编辑选定节点的文本"},Bo={label:"组合节点",tooltip:"将选定的节点组合在一起"},Ro={label:"取消组合节点",tooltip:"取消组合选定的节点"},Po={label:"锁定节点",tooltip:"锁定选定的节点"},Oo={label:"解锁节点",tooltip:"解锁选定的节点"},Io={label:"连接",tooltip:"打开连接菜单"},Uo={label:"添加边",tooltip:"在节点之间添加边"},Xo={label:"删除边",tooltip:"删除选定的边"},Yo={label:"更改边样式",tooltip:"更改选定边的样式"},Ho={label:"更改边颜色",tooltip:"更改选定边的颜色"},_o={label:"更改边标签",tooltip:"更改选定边的标签"},Vo={label:"反转边",tooltip:"反转选定边的方向"},Zo={label:"文本",tooltip:"打开文本菜单"},Wo={label:"添加文本",tooltip:"向文档添加文本"},Go={label:"编辑文本",tooltip:"编辑选定的文本"},Ko={label:"更改字体",tooltip:"更改选定文本的字体"},qo={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},Qo={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},Jo={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},es={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},ts={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},os={label:"对齐文本",tooltip:"对齐选定的文本"},ss={label:"图层",tooltip:"打开图层菜单"},ls={label:"置于底层",tooltip:"将选定的图层置于底层"},ns={label:"置于顶层",tooltip:"将选定的图层置于顶层"},is={label:"下移一层",tooltip:"将选定的图层下移一层"},rs={label:"上移一层",tooltip:"将选定的图层上移一层"},as={label:"复制图层",tooltip:"复制选定的图层"},cs={label:"删除图层",tooltip:"删除选定的图层"},ds={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},hs={label:"协作",tooltip:"打开协作菜单"},us={label:"添加评论",tooltip:"向文档添加评论"},ps={label:"编辑评论",tooltip:"编辑选定的评论"},fs={label:"删除评论",tooltip:"删除选定的评论"},bs={label:"分享文档",tooltip:"与他人分享文档"},ms={file:Qt,newFile:Jt,openFile:eo,saveFile:to,saveAs:oo,importFile:so,exportFile:lo,exportFile_png:no,exportFile_pdf:io,exportFile_csv:ro,print:ao,closeFile:co,edit:ho,undo:uo,redo:po,cut:fo,copy:bo,paste:mo,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:go,selectAll:xo,findReplace:yo,view:vo,zoomIn:wo,zoomOut:Co,fitToScreen:Mo,toggleGrid:jo,toggleGuides:No,fullscreenMode:Fo,shape:So,addNode:$o,deleteNode:Eo,moveNode:Lo,resizeNode:To,rotateNode:Do,changeNodeColor:ko,changeNodeBorder:Ao,changeNodeText:zo,groupNodes:Bo,ungroupNodes:Ro,lockNode:Po,unlockNode:Oo,connection:Io,addEdge:Uo,deleteEdge:Xo,changeEdgeStyle:Yo,changeEdgeColor:Ho,changeEdgeLabel:_o,reverseEdge:Vo,text:Zo,addText:Wo,editText:Go,changeFont:Ko,changeFontSize:qo,changeFontColor:Qo,boldText:Jo,italicText:es,underlineText:ts,alignText:os,layer:ss,sendToBack:ls,bringToFront:ns,sendBackward:is,bringForward:rs,duplicateLayer:as,deleteLayer:cs,toggleLayerVisibility:ds,collaboration:hs,addComment:us,editComment:ps,deleteComment:fs,shareDocument:bs},gs={label:"初始化",tooltip:"初始化文件"},xs={label:"添加模块",tooltip:"向文件添加新模块"},ys={label:"删除模块",tooltip:"从文件中移除模块"},vs={label:"粘贴模块",tooltip:"将模块粘贴到文件中"},ws={label:"复制模块",tooltip:"复制选定的模块"},Cs={label:"修改模块",tooltip:"修改模块的属性"},Ms={init:gs,addModules:xs,deleteModules:ys,pasteModules:vs,duplicateModules:ws,modifyModules:Cs},js={label:"ファイル",tooltip:"ファイルメニューを開く"},Ns={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},Fs={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},Ss={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},$s={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},Es={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},Ls={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Ts={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},Ds={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},ks={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},As={label:"印刷",tooltip:"現在のファイルを印刷"},zs={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Bs={label:"編集",tooltip:"編集メニューを開く"},Rs={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},Ps={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},Os={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},Is={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},Us={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},Xs={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},Ys={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},Hs={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},_s={label:"表示",tooltip:"表示メニューを開く"},Vs={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},Zs={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},Ws={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},Gs={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},Ks={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},qs={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},Qs={label:"図形",tooltip:"図形メニューを開く"},Js={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},el={label:"ノードを削除",tooltip:"選択したノードを削除"},tl={label:"ノードを移動",tooltip:"選択したノードを移動"},ol={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},sl={label:"ノードを回転",tooltip:"選択したノードを回転"},ll={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},nl={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},il={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},rl={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},al={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},cl={label:"ノードをロック",tooltip:"選択したノードをロック"},dl={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},hl={label:"接続",tooltip:"接続メニューを開く"},ul={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},pl={label:"エッジを削除",tooltip:"選択したエッジを削除"},fl={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},bl={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},ml={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},gl={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},xl={label:"テキスト",tooltip:"テキストメニューを開く"},yl={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},vl={label:"テキストを編集",tooltip:"選択したテキストを編集"},wl={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},Cl={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},Ml={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},jl={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},Nl={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},Fl={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},Sl={label:"テキストを配置",tooltip:"選択したテキストを配置"},$l={label:"レイヤー",tooltip:"レイヤーメニューを開く"},El={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},Ll={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Tl={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},Dl={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},kl={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},Al={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},zl={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Bl={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},Rl={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},Pl={label:"コメントを編集",tooltip:"選択したコメントを編集"},Ol={label:"コメントを削除",tooltip:"選択したコメントを削除"},Il={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},Ul={file:js,newFile:Ns,openFile:Fs,saveFile:Ss,saveAs:$s,importFile:Es,exportFile:Ls,exportFile_png:Ts,exportFile_pdf:Ds,exportFile_csv:ks,print:As,closeFile:zs,edit:Bs,undo:Rs,redo:Ps,cut:Os,copy:Is,paste:Us,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:Xs,selectAll:Ys,findReplace:Hs,view:_s,zoomIn:Vs,zoomOut:Zs,fitToScreen:Ws,toggleGrid:Gs,toggleGuides:Ks,fullscreenMode:qs,shape:Qs,addNode:Js,deleteNode:el,moveNode:tl,resizeNode:ol,rotateNode:sl,changeNodeColor:ll,changeNodeBorder:nl,changeNodeText:il,groupNodes:rl,ungroupNodes:al,lockNode:cl,unlockNode:dl,connection:hl,addEdge:ul,deleteEdge:pl,changeEdgeStyle:fl,changeEdgeColor:bl,changeEdgeLabel:ml,reverseEdge:gl,text:xl,addText:yl,editText:vl,changeFont:wl,changeFontSize:Cl,changeFontColor:Ml,boldText:jl,italicText:Nl,underlineText:Fl,alignText:Sl,layer:$l,sendToBack:El,bringToFront:Ll,sendBackward:Tl,bringForward:Dl,duplicateLayer:kl,deleteLayer:Al,toggleLayerVisibility:zl,collaboration:Bl,addComment:Rl,editComment:Pl,deleteComment:Ol,shareDocument:Il},Xl={label:"初期化",tooltip:"ファイルを初期化する"},Yl={label:"モジュールを追加",tooltip:"ファイルに新しいモジュールを追加する"},Hl={label:"モジュールを削除",tooltip:"ファイルからモジュールを削除する"},_l={label:"モジュールを貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},Vl={label:"モジュールを複製",tooltip:"選択したモジュールを複製する"},Zl={label:"モジュールを修正",tooltip:"モジュールのプロパティを修正する"},Wl={init:Xl,addModules:Yl,deleteModules:Hl,pasteModules:_l,duplicateModules:Vl,modifyModules:Zl},Gl={en:{translation:{...Ht,...qt}},cn:{translation:{...ms,...Ms}},jp:{translation:{...Ul,...Wl}}};re.use(ae).init({resources:Gl,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const P=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),O=p.createContext({fileMap:new Map([["fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",{id:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",name:"Untitled 1",config:{},data:{}}]]),fileList:[],currentFileId:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{}}),Kl=({bg:t="#fff",onBgClick:e})=>{const o=p.useRef(null),{createFile:s,handleCreating:l}=p.useContext(O),[i,r]=p.useState(""),c=u=>/^[a-zA-Z0-9-_ ]+$/.test(u),a=u=>{var m;u.preventDefault(),u.stopPropagation();const h=(m=o.current)==null?void 0:m.filename.value.trim();if(!c(h)){r("File name can only including number space and alpha");return}r("");const f={id:P(),name:h,data:{},config:{}};s(f),l(!1)};return n.jsxs("div",{className:"fixed top-0 left-0 z-20 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[n.jsx("div",{style:{backgroundColor:t},onClick:()=>e&&e(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),n.jsxs("form",{ref:o,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:a,children:[n.jsx("h1",{className:"text-xl text-center",children:"New File"}),n.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),n.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),i&&n.jsx("div",{className:"text-red-500 my-2",children:i}),n.jsx("label",{className:"justify-center",children:n.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})},X=50,Y=100;class ql{constructor(e){d(this,"selectedModules",new Set);d(this,"resizeHandleSize",10);d(this,"activeResizeHandle",null);d(this,"isDestroyed",!1);d(this,"editor");d(this,"copiedItems",[]);d(this,"isSelectAll",!1);this.editor=e}getSelected(){return this.isSelectAll?"all":new Set(this.selectedModules.keys())}select(e){var s,l;if(!e)return;let o=null;this.selectedModules.clear(),e==="all"?this.isSelectAll=!0:e.forEach(i=>{e.size===1&&(o=this.editor.moduleMap.get(i).getDetails()),this.selectedModules.add(i)}),this.render(),(l=(s=this.editor.events).onSelectionUpdated)==null||l.call(s,e,o)}update(){var o,s;let e=null;this.selectedModules.size===1&&this.selectedModules.forEach(l=>{e=this.editor.moduleMap.get(l).getDetails()}),this.render(),(s=(o=this.editor.events).onSelectionUpdated)==null||s.call(o,this.selectedModules,e)}selectAll(){var e,o;this.selectedModules.clear(),this.isSelectAll=!0,this.render(),(o=(e=this.editor.events).onSelectionUpdated)==null||o.call(e,"all",null)}clear(){var e,o;this.selectedModules.clear(),this.isSelectAll=!1,this.render(),(o=(e=this.editor.events).onSelectionUpdated)==null||o.call(e,new Set,null)}copy(){this.copiedItems=[],this.copiedItems=this.editor.batchCopy(this.isSelectAll?"all":this.selectedModules,!0),this.updateCopiedItemsDelta()}paste(){const e=this.editor.batchCreate(this.copiedItems);this.editor.batchAdd(e,"pasteModules"),this.select(new Set(e.keys())),this.updateCopiedItemsDelta()}duplicate(){let e;this.isSelectAll?e=this.editor.batchCopy("all",!0):e=this.editor.batchCopy(this.selectedModules,!0),e.forEach(s=>{s.x+=X,s.y+=Y});const o=this.editor.batchCreate(e);this.editor.batchAdd(o,"duplicateModules"),this.isSelectAll=!1,this.select(new Set(o.keys()))}delete(){this.isSelectAll?this.editor.batchDelete("all","deleteModules"):this.editor.batchDelete(this.selectedModules,"deleteModules"),this.editor.selectionManager.clear()}updateCopiedItemsDelta(){this.copiedItems.forEach(e=>{e.x+=X,e.y+=Y})}render(){this.editor.viewport.renderSelectionCanvas()}destroy(){this.isDestroyed||(this.selectedModules.clear(),this.isDestroyed=!0,console.log("SelectionModule destroyed."))}}class Ql{constructor(e){d(this,"canvas");d(this,"ctx");d(this,"editor");d(this,"xAxis",{start:{x:0,y:0},end:{x:0,y:0}});d(this,"yAxis",{start:{x:0,y:0},end:{x:0,y:0}});const o=document.createElement("canvas"),s=o.getContext("2d");this.editor=e,this.canvas=o,this.ctx=s,o.style.position="absolute",o.style.zIndex="10",o.style.pointerEvents="none",o.setAttribute("cross-line","")}setupEventListeners(){}removeEventListeners(){}handleMouseMove(e){e.clientX-this.canvas.offsetLeft,e.clientY-this.canvas.offsetTop}update(){this.render({x:0,y:0})}destroy(){this.removeEventListeners()}render(e){const{dpr:o,size:s}=this.editor,l=s.width,i=s.height,{x:r,y:c}={x:e.x*o,y:e.y*o},{ctx:a}=this;this.xAxis={start:{x:0,y:c},end:{x:l,y:c}},this.yAxis={start:{x:r,y:0},end:{x:r,y:i}},this.ctx.clearRect(0,0,s.width,s.height),a.beginPath(),a.setLineDash([5,3]),a.lineWidth=1,a.moveTo(this.xAxis.start.x,this.xAxis.start.y),a.lineTo(this.xAxis.end.x,this.xAxis.end.y),a.stroke(),a.moveTo(this.yAxis.start.x,this.yAxis.start.y),a.lineTo(this.yAxis.end.x,this.yAxis.end.y),a.stroke()}}class H{constructor(e,o,s,l=-1){d(this,"data");d(this,"prev");d(this,"next");d(this,"id");this.data=s,this.prev=e,this.next=o,this.id=l}}class Jl{constructor(){d(this,"head");d(this,"tail");d(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(e){let o;const{tail:s}=this;return s?(o=new H(s,null,e,s.id+1),s.next=o,this.tail=o):(o=new H(null,null,e,0),this.head=o,this.tail=o),this.current=o,o}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(e){if(e===this.current)return"equal";let o=this.head;for(;o;){if(this.current===o)return"behind";if(e===o)return"front";o=o.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}const en=t=>new Set(t.map(e=>e.id));class tn extends Jl{constructor(o){super();d(this,"editor");this.editor=o,this.init()}init(){var o,s;this.append({type:"init",modules:[],selectModules:new Set}),(s=(o=this.editor.events).onHistoryUpdated)==null||s.call(o,this)}add(o){var s,l;super.detach(),super.append(o),(l=(s=this.editor.events).onHistoryUpdated)==null||l.call(s,this)}undo(o=!1){var c,a;const s=this.current;if(!s)return!1;const{type:l,modules:i=[],selectModules:r=new Set}=s.data;return l==="pasteModules"||l==="addModules"||l==="duplicateModules"?this.editor.batchDelete(en(i)):l==="deleteModules"?this.editor.batchAdd(this.editor.batchCreate(i)):l==="modifyModules"&&(console.log("modify",i),this.editor.batchReplaceModules(i)),o||(this.editor.selectionManager.select(r),(a=(c=this.editor.events).onHistoryUpdated)==null||a.call(c,this)),super.back(),this.current}redo(o=!1){var c,a;const s=super.forward();if(!s)return!1;const{type:l,modules:i=[],selectModules:r=new Set}=s.data;return l==="pasteModules"||l==="addModules"||l==="duplicateModules"?this.editor.batchAdd(this.editor.batchCreate(i)):l==="deleteModules"?this.editor.batchDelete(new Set(i.map(u=>u.id))):l==="modifyModules"&&this.editor.batchReplaceModules(i),o||(this.editor.selectionManager.select(r),(a=(c=this.editor.events).onHistoryUpdated)==null||a.call(c,this)),this.current}moveCurrentById(o){var l,i;const s=super.compareToCurrentPosition(o);if(!(!s||s==="equal")&&(s==="front"||s==="behind")){let c;for(;s==="front"?c=this.undo(!0):s==="behind"&&(c=this.redo(!0)),c!==o;);const{selectModules:a}=o.data;this.editor.selectionManager.select(a),(i=(l=this.editor.events).onHistoryUpdated)==null||i.call(l,this)}}toArray(){const o=[];if(this.head){let s=this.head;for(o.push(s);s.next;)o.push(s.next),s=s.next}return o}}class W{constructor({id:e,type:o,lineColor:s,lineWidth:l=1,opacity:i=100,position:r,layer:c=1,rotation:a=0,shadow:u=!1,enableLine:h=!0}){d(this,"id");d(this,"type");d(this,"enableLine");d(this,"lineWidth");d(this,"lineColor");d(this,"opacity");d(this,"position");d(this,"rotation");d(this,"shadow");d(this,"layer");this.id=e,this.type=o,this.enableLine=h,this.lineColor=s,this.lineWidth=l,this.opacity=i,this.position=r,this.rotation=a,this.shadow=u,this.layer=c}getDetails(){return{id:this.id,type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,position:this.position,layer:this.layer,rotation:this.rotation}}}class on extends W{constructor({x:o,y:s,fillColor:l,enableFill:i=!0,...r}){super(r);d(this,"x");d(this,"y");d(this,"fillColor");d(this,"enableFill");this.x=o,this.y=s,this.fillColor=l,this.enableFill=i}getDetails(){return{...this.getSize(),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y,...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}=this,{width:l,height:i}=this.getSize();return{x:o,y:s,width:l,height:i,top:s,left:o,right:o+l,bottom:s+i,centerX:o+l/2,centerY:s+i/2}}}class sn extends on{constructor({width:o,height:s,radius:l,...i}){super(i);d(this,"width");d(this,"height");d(this,"radius");this.width=o,this.height=s,this.radius=l}getDetails(){return{width:this.width,height:this.height,radius:this.radius,...super.getDetails()}}}function z(t,e={}){if(typeof t!="object"||t===null)return t;if(Array.isArray(t))return t.map(s=>z(s,e));const o=Object.create(e.clonePrototype?Object.getPrototypeOf(t):null);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=z(t[s],e));return o}function F(t){return t===null?"null":t===void 0?"undefined":t instanceof Set?"set":t instanceof Map?"map":Array.isArray(t)?"array":t instanceof Date?"date":t instanceof RegExp?"regexp":t instanceof Error?"error":t instanceof Promise?"promise":t instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(t)?"typedarray":t instanceof WeakSet?"weakset":t instanceof WeakMap?"weakmap":typeof t=="function"?"function":typeof t=="symbol"?"symbol":typeof t=="bigint"?"bigint":typeof t=="object"?"object":typeof t}class ln{constructor(e){d(this,"lock");d(this,"editor");d(this,"eventsMap",new Map([["selectAll",[]],["copy",[]],["paste",[]],["duplicate",[]],["delete",[]],["escape",[]],["modifyModules",[]],["undo",[]],["redo",[]]]));this.editor=e,this.lock=!1}subscribe(e,o){this.eventsMap.has(e)?this.eventsMap.get(e).push(o):this.eventsMap.set(e,[o])}unsubscribe(e,o){if(this.eventsMap.has(e)){const s=this.eventsMap.get(e);for(let l=s.length-1;l>=0;l--)if(s[l]===o)return s.splice(l,1),"deleted";return"Cannot find event or function"}}dispatcher(e,o=null){if(!this.lock){if(this.lock=!0,e==="selectAll"&&this.editor.selectionManager.selectAll(),e==="select"&&this.editor.selectionManager.select(o),e==="copy"&&this.editor.selectionManager.copy(),e==="delete"&&this.editor.selectionManager.delete(),e==="duplicate"&&this.editor.selectionManager.duplicate(),e==="escape"&&this.editor.selectionManager.clear(),e==="paste"&&this.editor.selectionManager.paste(),e==="redo"&&this.editor.history.redo(),e==="undo"&&this.editor.history.undo(),e==="moveUp"||e==="moveRight"||e==="moveDown"||e==="moveLeft"){const s=this.editor.selectionManager.getSelected();this.editor.batchModify(s,{code:e},"modifyModules")}this.eventsMap.has(e)&&this.eventsMap.get(e).forEach(s=>{s()}),this.lock=!1}}destroy(){this.eventsMap.clear(),this.editor=null,this.lock=!1}}class nn extends W{constructor({start:o,end:s,...l}){super(l);d(this,"start");d(this,"end");this.start=o,this.end=s}getDetails(){return{...this.getSize(),...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}={x:0,y:1},{width:l,height:i}=this.getSize();return{x:o,y:s,width:l,height:i,top:s,left:o,right:o+l,bottom:s+i}}}function rn(t){var o,s;this.batchCreate(t).forEach(l=>{console.log(this.moduleMap),this.moduleMap.set(l.id,l)}),this.render(),(s=(o=this.events).onModulesUpdated)==null||s.call(o,this.moduleMap),this.selectionManager.render()}const G=t=>{if(!Array.isArray(t))return[];const e=new Set;return t.filter(o=>{const s=Object.keys(o).sort().map(l=>`${l}:${String(o[l])}`).join(";");return e.has(s)?!1:(e.add(s),!0)})},K=(t,e)=>{const o=G(e);t.save(),o.forEach(({x:s,y:l,width:i,height:r,fillColor:c="",lineColor:a="",lineWidth:u=1,radius:h=0,opacity:f=100,gradient:m,rotation:g=0,dashLine:v=""})=>{const b=i/2,x=r/2;t.save(),t.translate(s,l),g>0&&t.rotate(g*Math.PI/180),f>0&&(t.fillStyle=c,t.globalAlpha=f/100),u>0&&(t.lineWidth=u,t.strokeStyle=a,t.lineJoin="round"),t.beginPath(),v&&t.setLineDash([3,5]),h>0?(t.moveTo(-b+h,-x),t.arcTo(b,-x,b,x,h),t.arcTo(b,x,-b,x,h),t.arcTo(-b,x,-b,-x,h),t.arcTo(-b,-x,b,-x,h)):t.rect(-b,-x,i,r),t.closePath(),f>0&&t.fill(),u>0&&t.stroke(),t.restore()})},an=(t,e)=>{const o=new Set,s=",";t.save(),e.forEach(c=>{const a=Object.values(c).join(s);o.add(a)});let l=NaN,i="";const r=new Path2D;o.forEach(c=>{const a=c.split(s),u=parseFloat(a[0]),h=parseFloat(a[1]),f=parseFloat(a[2]),m=parseFloat(a[3]),g=a[4],v=parseFloat(a[5]);v!==l&&(t.lineWidth=v,l=v),g!==i&&(t.fillStyle=g,i=g),r.moveTo(u,h),r.lineTo(f,m)}),t.stroke(r),t.restore()},cn=({ctx:t,modules:e})=>{const s=[{x:400,y:500,width:800,height:1e3,opacity:100,lineWidth:1,lineColor:"#000000",fillColor:"#dfdfdf66"}],l=[],i=[];e.forEach(r=>{if(r.type==="rectangle"){const{x:c,y:a,width:u,height:h,enableFill:f,enableLine:m,opacity:g,lineWidth:v,fillColor:b,lineColor:x,rotation:y,gradient:C,radius:T,id:D}=r.getDetails();(f&&g>0||m)&&s.push({x:c,y:a,width:u,height:h,fillColor:b,opacity:g,lineWidth:v,lineColor:x,rotation:y,gradient:C,radius:T}),i.push({x:c+10,y:a+10,width:u,height:h,id:D.match(/\d+$/g)[0]})}if(r.type==="connector"){const c=e.get(r.start),a=e.get(r.end),u=c.getBoundingRect(),h=a.getBoundingRect();l.push({startX:u.centerX,startY:u.bottom,endX:h.centerX,endY:h.top,fillStyle:"#5491f8",lineWidth:1})}}),K(t,s),an(t,l),dn(t,i)},dn=(t,e)=>{t.font="sans-serif",t.textBaseline="top",e.forEach(({id:o,x:s,y:l,width:i,height:r})=>{t.fillText(o,s-i/2+5,l-r/2+5,100)})};function hn(){const t="#1FB3FF",e="rgba(31,180,255,0.1)";this.editor.container.innerHTML="",this.mainCanvas.setAttribute("editor-main-canvas",""),this.mainCanvas.style.position="absolute",this.mainCanvas.style.left="0",this.mainCanvas.style.top="0",this.mainCanvas.style.width="100%",this.mainCanvas.style.height="100%",this.mainCanvas.style.pointerEvents="none",this.selectionCanvas.setAttribute("editor-selection-canvas",""),this.selectionCanvas.style.position="absolute",this.selectionCanvas.style.left="0",this.selectionCanvas.style.top="0",this.selectionCanvas.style.width="100%",this.selectionCanvas.style.height="100%",this.selectionCanvas.style.pointerEvents="none",this.wrapper.setAttribute("editor-wrapper",""),this.wrapper.style.userSelect="none",this.wrapper.style.position="relative",this.wrapper.style.scrollbarWidth="thin",this.wrapper.style.scrollbarColor="#787878 transparent",this.wrapper.style.overflow="hidden",this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.selectionBox.setAttribute("editor-selection-box",""),this.selectionBox.style.pointerEvents="none",this.selectionBox.style.position="absolute",this.selectionBox.style.border="1px solid "+t,this.selectionBox.style.backgroundColor=e,q(this.scrollBarX,this.scrollBarY),I(this.selectionBox,{x:0,y:0,width:0,height:0},!1),this.wrapper.append(this.mainCanvas,this.selectionCanvas,this.scrollBarX,this.scrollBarY,this.selectionBox),this.editor.container.appendChild(this.wrapper)}const un=()=>{const t=document.createElement("div"),e=document.createElement("div");return t.setAttribute("scroll-bar-x",""),e.setAttribute("scroll-bar-y",""),t.style.backgroundColor="#787878",e.style.backgroundColor="#787878",t.style.userSelect="none",e.style.userSelect="none",e.style.translate="none",e.style.translate="none",{scrollBarX:t,scrollBarY:e}},q=(t,e)=>{t.style.width="50px",t.style.height="6px",t.style.position="absolute",t.style.bottom="0",t.style.left="0",e.style.width="6px",e.style.height="50px",e.style.position="absolute",e.style.right="0",e.style.top="0"},I=(t,{x:e,y:o,height:s,width:l},i=!0)=>{t.style.transform=`translate(${e}px, ${o}px)`,t.style.width=l+"px",t.style.height=s+"px",t.style.display=i?"block":"none"},pn=(t,e,o,s,l)=>{const i=o/2,r=s/2,c=l*(Math.PI/180),a=Math.cos(c),u=Math.sin(c);return[{x:t-i,y:e-r},{x:t,y:e-r},{x:t+i,y:e-r},{x:t+i,y:e},{x:t+i,y:e+r},{x:t,y:e+r},{x:t-i,y:e+r},{x:t-i,y:e}].map(({x:f,y:m})=>{const g=f-t,v=m-e;return{x:t+g*a-v*u,y:e+g*u+v*a}})},fn=()=>!0;function bn(t){const e=t.target===this.wrapper,o=t.button===0;if(!(!e||!o||this.domResizing))if(this.mouseDownPoint.x=t.clientX-this.rect.x,this.mouseDownPoint.y=t.clientY-this.rect.y,this.mouseDown=!0,this.spaceKeyDown)this.panning=!0;else{const s=fn();this.selecting=s}}function mn(t){if(!this.domResizing){if(this.mouseMovePoint.x=t.clientX-this.rect.x,this.mouseMovePoint.y=t.clientY-this.rect.y,this.panning){this.translateViewport(t.movementX,t.movementY);return}if(this.selecting){I(this.selectionBox,gn(this.mouseDownPoint,this.mouseMovePoint));return}}}const gn=({x:t,y:e},{x:o,y:s})=>{let l=t,i=e,r=o-t,c=s-e;return r<0&&(l=o,r=t-o),c<0&&(i=s,c=e-s),{x:l,y:i,width:r,height:c}};function xn(t){const e=t.clientX-this.rect.x,o=t.clientY-this.rect.y;this.mouseMovePoint.x=e,this.mouseMovePoint.y=o,this.mouseDown=!1,this.selecting=!1,this.panning=!1,I(this.selectionBox,{x:0,y:0,width:0,height:0},!1)}const yn=(t,e)=>{const o=G(e);t.save(),o.forEach(({x:s,y:l,r1:i,r2:r,fillColor:c="",lineColor:a="",lineWidth:u=1,opacity:h=100,gradient:f,rotation:m=0,dashLine:g=""})=>{t.save(),t.translate(s,l),m!==0&&t.rotate(m*Math.PI/180),h>0&&(t.fillStyle=c,t.globalAlpha=h/100),u>0&&(t.lineWidth=u,t.strokeStyle=a,t.lineJoin="round"),t.beginPath(),t.ellipse(0,0,i,r,0,0,Math.PI*2),g?t.setLineDash([3,5]):t.setLineDash([]),t.closePath(),h>0&&t.fill(),u>0&&t.stroke(),f&&(t.fillStyle=f,h>0&&t.fill()),t.restore()})};function vn(){const{selectionCTX:t,editor:e}=this,{selectionManager:o}=e;o.selectedModules.size;const s=l=>{const i=o.resizeHandleSize/2,r=[],c=[],a="#5491f8",u="#5491f8";l.forEach(h=>{const{x:f,y:m,width:g,height:v,rotation:b,lineWidth:x}=h.getDetails(),y=pn(f,m,g,v,b);c.push(...y.map(C=>({...C,r1:i,r2:i,fillColor:a,lineColor:"#fff"}))),r.push({x:f,y:m,width:g,height:v,fillColor:a,lineColor:u,lineWidth:x,rotation:b,opacity:0,dashLine:"dash"})}),K(t,r),yn(t,c)};if(o.isSelectAll)s(o.editor.moduleMap);else{const l=new Map;o.selectedModules.forEach(i=>{o.editor.moduleMap.forEach(r=>{r.id===i&&l.set(r.id,r)})}),s(l)}}function wn(t){if(!this.panning&&!this.selecting&&t.code==="Space"){this.spaceKeyDown=!0,this.wrapper.style.cursor="grabbing";return}}function Cn(t){t.code==="Space"&&(this.spaceKeyDown=!1,this.panning=!1,this.wrapper.style.cursor="default")}function Mn(t){if(t.target!==this.wrapper)return;t.preventDefault();const{zooming:e,panning:o,zoomFactor:s,translateX:l,translateY:i}=jn(t);this.panning=o,this.zooming=e,e?this.zoom(s):this.translateViewport(l,i)}const jn=(()=>{let t;const s=[];let l=!1,i=!1,r=!1,c=0,a=0,u=0;return h=>{s.push(h),s.length>3&&s.shift(),clearTimeout(t);const{deltaX:f,deltaY:m}=h;if(l)c=m>0?-.1:.1;else if(a=-f,u=-m,h.altKey)l=!0,c=m>0?-.1:.1;else if(s.length>=3){const g=s.every(y=>y.deltaX===-0),v=s.every(y=>Q(y.deltaY)),b=s.every(y=>Math.abs(y.deltaY)>4),x=s.every(y=>Math.abs(y.deltaX)>=40&&A(y.deltaX)&&y.deltaY===-0);g&&v?b?(r=!0,u=-m):(c=m>0?-.1:.1,l=!0):x&&(r=!0,a=-f)}else A(f)&&A(m)&&(i=!0,a=-f,u=-m);return t=setTimeout(()=>{l=!1,i=!1,r=!1,c=0,a=-f,u=-m},300),{zooming:l,panning:i,scrolling:r,zoomFactor:c,translateX:a,translateY:u}}})();function A(t){return!Q(t)}function Q(t){return Math.abs(t)%1!==0}function Nn(t){const e="editor-contextmenu-dom",o=document.createElement("div"),s=()=>{window.removeEventListener("mousedown",s),o.remove()};window.addEventListener("mousedown",s),o.dataset.name=e,o.style.position="fixed",o.style.top=t.clientY+"px",o.style.left=t.clientX+"px",o.style.backgroundColor="#dfdfdf",o.style.padding="10px 10px",o.style.width="200px",o.style.height="auto",o.style.boxShadow="rgb(194 194 194) 0px 0px 1px 1px",o.innerHTML=`
    <div>
      <div>Undo</div>
      <div>Redo</div>
      <div>Paste</div>
      <div>Select All</div>
    </div>
  `,this.wrapper.append(o),t.preventDefault(),t.stopPropagation()}const _=(t,e,o)=>{if(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),o){const[s,l,i,r,c,a]=o;t.setTransform(s,l,i,r,c*e,a*e)}};class Fn{constructor(e){d(this,"editor");d(this,"resizeInterval",17);d(this,"resizeObserver");d(this,"wrapper");d(this,"scrollBarX");d(this,"scrollBarY");d(this,"selectionBox");d(this,"selectionCanvas");d(this,"selectionCTX");d(this,"mainCanvas");d(this,"mainCTX");d(this,"handleMouseDown");d(this,"handleMouseUp");d(this,"handleMouseMove");d(this,"handleKeyDown");d(this,"handleKeyUp");d(this,"handleWheel");d(this,"handleContextMenu");d(this,"eventsController");d(this,"dpr",2);d(this,"spaceKeyDown",!1);d(this,"mouseDown",!1);d(this,"panning",!1);d(this,"zooming",!1);d(this,"selecting",!1);d(this,"mouseDownPoint",{x:0,y:0});d(this,"mouseMovePoint",{x:0,y:0});d(this,"rect");d(this,"domResizing",!1);d(this,"resizeTimeout");d(this,"currentZoom",1);d(this,"offsetX",0);d(this,"offsetY",0);const{scrollBarX:o,scrollBarY:s}=un(),l=document.createElement("canvas"),i=document.createElement("canvas"),r=l.getContext("2d"),c=i.getContext("2d");this.selectionCanvas=l,this.mainCanvas=i,this.selectionCTX=r,this.mainCTX=c,this.editor=e,this.scrollBarX=o,this.scrollBarY=s,this.selectionBox=document.createElement("div"),this.wrapper=document.createElement("div"),this.resizeThrottle=this.resizeThrottle.bind(this),this.resizeObserver=new ResizeObserver(this.resizeThrottle),this.updateCanvasSize=this.updateCanvasSize.bind(this),this.handleMouseDown=bn.bind(this),this.handleMouseMove=mn.bind(this),this.handleMouseUp=xn.bind(this),this.handleKeyDown=wn.bind(this),this.handleKeyUp=Cn.bind(this),this.handleWheel=Mn.bind(this),this.handleContextMenu=Nn.bind(this),this.eventsController=new AbortController,this.init()}init(){this.updateCanvasSize(),hn.call(this),this.resizeObserver.observe(this.editor.container),this.setupEvents()}setupEvents(){const{signal:e}=this.eventsController;window.addEventListener("mousedown",this.handleMouseDown,{signal:e}),window.addEventListener("mousemove",this.handleMouseMove,{signal:e}),window.addEventListener("mouseup",this.handleMouseUp,{signal:e}),window.addEventListener("keydown",this.handleKeyDown,{signal:e}),window.addEventListener("keyup",this.handleKeyUp,{signal:e}),window.addEventListener("wheel",this.handleWheel,{signal:e,passive:!1}),this.wrapper.addEventListener("contextmenu",this.handleContextMenu,{signal:e})}zoom(e){this.currentZoom+=e,this.currentZoom<.1&&(this.currentZoom=.1),this.currentZoom>5&&(this.currentZoom=5),this.render()}translateViewport(e,o){this.offsetX+=e,this.offsetY+=o,this.render()}updateScrollBar(){const{scrollBarX:e,scrollBarY:o}=this;q(e,o)}resizeThrottle(){clearTimeout(this.resizeTimeout),this.domResizing=!0,this.resizeTimeout=setTimeout(this.onResize.bind(this),this.resizeInterval)}onResize(){this.domResizing=!1,this.updateCanvasSize(),this.render()}updateCanvasSize(){this.rect=this.editor.container.getBoundingClientRect(),this.mainCanvas.width=this.rect.width*this.dpr,this.mainCanvas.height=this.rect.height*this.dpr,this.selectionCanvas.width=this.rect.width*this.dpr,this.selectionCanvas.height=this.rect.height*this.dpr}render(){_(this.mainCTX,this.dpr,[this.currentZoom,0,0,this.currentZoom,this.offsetX,this.offsetY]),_(this.selectionCTX,this.dpr,[this.currentZoom,0,0,this.currentZoom,this.offsetX,this.offsetY]),this.renderMainCanvas(),this.renderSelectionCanvas()}renderMainCanvas(){requestAnimationFrame(()=>{cn({ctx:this.mainCTX,modules:this.editor.moduleMap})})}renderSelectionCanvas(){requestAnimationFrame(()=>{vn.call(this)})}destroy(){clearTimeout(this.resizeTimeout),this.resizeObserver.disconnect(),this.eventsController.abort(),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.remove(),this.editor.container.innerHTML=""}}class Sn{constructor({container:e,data:o,dpr:s=2,zoom:l=1,events:i={}}){d(this,"moduleCounter",0);d(this,"moduleMap");d(this,"id");d(this,"dpr");d(this,"container");d(this,"events",{});d(this,"action");d(this,"history");d(this,"selectionManager");d(this,"viewport");d(this,"zoom");d(this,"crossLine");d(this,"scale",1);this.moduleMap=o.modules.reduce((r,c)=>(r.set(c.id,c),r),new Map),this.id=o.id,this.scale=s,this.events=i,this.container=e,this.viewport=new Fn(this),this.action=new ln(this),this.selectionManager=new ql(this),this.crossLine=new Ql(this),this.history=new tn(this)}createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(e){const o=z(e),s=new Map,l=i=>{if(i.id||(i.id=this.createModuleId()),i.type==="rectangle")return new sn(i);if(i.type==="connector")return new nn(i)};return o.forEach(i=>{const r=l.call(this,i);s.set(i.id,r)}),s}batchAdd(e,o){var s,l;if(e.forEach(i=>{this.moduleMap.set(i.id,i)}),o){const i=[...e.values()].map(r=>r.getDetails());this.history.add({type:o,modules:i,selectModules:new Set(i.map(r=>r.id))})}(l=(s=this.events).onModulesUpdated)==null||l.call(s,this.moduleMap),this.render()}batchCopy(e,o=!1,s){const l=[];let i=new Map;return e==="all"?i=this.moduleMap:F(e)==="set"&&e.forEach(r=>{const c=this.moduleMap.get(r);c&&i.set(r,c)}),i.forEach(r=>{const c=r.getDetails();o&&delete c.id,F(s)==="object"&&Object.assign(c,s),l.push(c)}),l}batchDelete(e,o){var l,i;let s=[];return e==="all"?(s=this.batchCopy("all"),this.moduleMap.clear()):F(e)==="set"&&(s=this.batchCopy(e),s.forEach(r=>{this.moduleMap.delete(r.id)})),o&&this.history.add({type:o,modules:s,selectModules:this.selectionManager.getSelected()}),this.render(),(i=(l=this.events).onModulesUpdated)==null||i.call(l,this.moduleMap),s}batchModify(e,o,s){var r,c;let l=null;const i=5;if(e==="all")l=this.moduleMap;else if(F(e)==="set")l=this.getModulesByIdSet(e);else return!1;l.forEach(a=>{Object.keys(o).forEach(u=>{const h=o.code,f=o[u];h==="moveUp"?a.y-=i:h==="moveDown"?a.y+=i:h==="moveLeft"?a.x-=i:h==="moveRight"?a.x+=i:(typeof f=="string"||typeof f=="number")&&(a[u]=f)})}),this.render(),(c=(r=this.events).onModulesUpdated)==null||c.call(r,this.moduleMap),this.selectionManager.update(),s&&this.history.add({type:s,modules:[...l.values()].map(a=>a.getDetails()),selectModules:this.selectionManager.getSelected()})}batchReplaceModules(e){rn.bind(this,e)}getModulesByLayerIndex(){}getModulesByIdSet(e){const o=new Map;return e.forEach(s=>{const l=this.moduleMap.get(s);l&&o.set(s,l)}),o}getModuleList(){return[...Object.values(this.moduleMap)]}execute(e,o=null){this.action.dispatcher(e,o)}render(){this.viewport.render()}destroy(){this.action.destroy(),this.selectionManager.destroy(),this.crossLine.destroy(),this.history.destroy(),this.moduleMap.clear(),this.action=null,this.selectionManager=null,this.crossLine=null,this.history=null,this.moduleMap=null,this.canvas=null,this.ctx=null,this.dpr=null,this.zoom=null,this.id=null,this.events=null,this.container=null}}const j=p.createContext({focused:!1,historyArray:[],historyCurrent:{},selectedModules:[],selectedProps:{},editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{}}),$n=()=>{const{executeAction:t,focused:e}=p.useContext(j),o=s=>{let l=null;const{key:i,ctrlKey:r,metaKey:c,shiftKey:a}=s,u={ArrowUp:"moveUp",ArrowDown:"moveDown",ArrowLeft:"moveLeft",ArrowRight:"moveRight"};i==="a"&&(r||c)&&(l="selectAll"),i==="c"&&(r||c)&&!a&&(l="copy"),i==="v"&&(r||c)&&(l="paste"),i==="d"&&(r||c)&&(l="duplicate"),(i==="Delete"||i==="Backspace")&&(l="delete"),i==="Escape"&&(l="escape"),i==="z"&&(r||c)&&(l="undo"),i==="z"&&a&&(r||c)&&(l="redo"),u[i]&&(l=u[i]),l&&(t(l),s.stopPropagation(),s.preventDefault())};return p.useEffect(()=>{if(e)return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),null},En=[{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50}],Ln=()=>{const{editorRef:t}=p.useContext(j);return p.useEffect(()=>{t.current&&console.log("editorRef.current updated:",t.current)},[t]),n.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:En.map((e,o)=>n.jsx("div",{className:"shrink-0 select-none cursor-move",style:{width:e.width,height:e.height,border:"1px solid #dfdfdf"},onMouseEnter:()=>{}},o))})},Tn=({className:t=""})=>{const[e,o]=p.useState(300),s=p.useRef(!1),l=p.useRef(null),i=p.useCallback(a=>{a.preventDefault(),s.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),r=p.useCallback(a=>{if(!s.current)return;const u=window.innerWidth*.9,h=Math.min(Math.max(0,a.clientX),u);a.stopPropagation(),o(h)},[]),c=p.useCallback(a=>{s.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",a.stopPropagation()},[]);return p.useEffect(()=>(window.addEventListener("mousemove",r),window.addEventListener("mouseup",c),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",c)}),[r,c]),n.jsxs("div",{ref:l,style:{width:`${e}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[n.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${t}`,children:[n.jsx("span",{children:"Module List"}),n.jsx(Ln,{})]}),n.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:i})]})},Dn=({className:t=""})=>n.jsx("div",{className:"w-[30%] h-full border-l border-gray-200 "+t}),kn={zoom:1},J=B({name:"statusBar",initialState:kn,reducers:{setZoom:(t,e)=>{t.zoom=e.payload}}}),{setZoom:V}=J.actions,An=J.reducer,zn=()=>{const t=[4,3,2,1.5,1.25,1,.75,.5,.25,"fit window"],{zoom:e}=R(h=>h.statusBar),o=ce(),[s,l]=p.useState(!1),i=p.useRef(null),r=h=>{a(i.current.value),i.current.blur(),h.preventDefault(),h.stopPropagation()},c=h=>{h.key==="Enter"&&(a(i.current.value),i.current.blur(),h.preventDefault(),h.stopPropagation())},a=h=>{const f=h.match(/\d+/);if(f){const m=parseFloat(f[0]);o(V(m)),u(m)}},u=h=>{i.current.value=h*100+"%"};return n.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[n.jsx("input",{type:"text",ref:i,defaultValue:e*100+"%",onBlur:r,onKeyDown:c,className:"w-12 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),n.jsx("button",{onClick:()=>l(!s),className:"text-gray-800 flex trasition items-center cursor-pointer",children:s?n.jsx(de,{className:"w-5 h-5"}):n.jsx(he,{className:"w-5 h-5"})}),s&&n.jsx("div",{className:"fixed w-full h-full",onClick:()=>{l(!1)}}),s&&n.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:t.map(h=>n.jsx("div",{onClick:()=>{let f=h;f==="fit window"&&(f=1),o(V(f)),l(!1),u(f)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:h==="fit window"?h:`${h*100}%`},h))})]})},Bn=({className:t=""})=>n.jsx("footer",{className:t+"w-full h-8 flex items-center border-t border-gray-200",children:n.jsx(zn,{})}),Rn=({data:t,selected:e,handleSelectModule:o})=>{const s=p.useRef(null),l=p.useRef(null);return p.useEffect(()=>{var i;(i=l.current)==null||i.scrollIntoView({block:"nearest",inline:"nearest"})},[e]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Layer"})}),n.jsx("div",{ref:s,className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:t==null?void 0:t.map((i,r)=>n.jsx("div",{ref:e!=null&&e.includes(i.id)?l:null,className:e!=null&&e.includes(i.id)?"bg-gray-400 text-white":"",onClick:()=>o(i.id),id:`layer-module-${i.id}`,children:i.type},r))})]})},ee=({menu:t})=>{const{t:e}=$(),[o,s]=p.useState(!1),{executeAction:l}=p.useContext(j),i=()=>{console.log(t.id),!(t.children||o)&&(l(t.id),s(!1))},r=t.children&&t.children.length>0;return n.jsxs("div",{className:"relative h-8 hover:bg-gray-200 min-w-50",onClick:()=>i(),onMouseOver:c=>{s(!0),c.preventDefault()},onMouseLeave:()=>{s(!1)},children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center whitespace-nowrap",children:[n.jsx("span",{children:e(t.id+".label")}),r&&n.jsx(ue,{size:18})]}),r&&o&&n.jsx("div",{className:"absolute bg-white z-30 left-full top-0 w-auto border border-gray-200 box-border",children:t.children.map(c=>n.jsx(ee,{menu:c},c.id))})]})},Pn=()=>{const[t,e]=p.useState(!1),[o,s]=p.useState(null),{t:l}=$(),i=p.useRef(null),r=R(a=>a.menu.actions),c=p.useMemo(()=>On(r),[r]);return p.useEffect(()=>{const a=u=>{i.current.contains(u.target)||(e(!1),s(null))};return window.addEventListener("click",a),()=>{window.removeEventListener("click",a)}}),n.jsx("div",{className:"h-8 text-sm select-none border-b border-gray-200 box-border",children:n.jsx("div",{ref:i,className:"pl-2 h-full inline-flex",children:c.map(a=>{var u;return n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:`h-full inline-flex items-center px-4 ${a.id===o?"bg-gray-200":""}`,onMouseEnter:()=>t&&s(a.id),onClick:()=>{o!==a.id?(e(!0),s(a.id)):(s(null),e(!1))},title:l(a.id+".tooltip"),children:n.jsx("span",{children:l(a.id+".label")})}),t&&a.id===o&&a.children.length>0&&n.jsx("div",{className:"absolute z-20 bg-white border border-gray-200",children:(u=a.children)==null?void 0:u.map(h=>n.jsx(ee,{menu:h},h.id))})]},a.id)})})})};function On(t){const e=new Map;Object.values(t).forEach(s=>{e.set(s.id,{...s,children:[]})});const o=[];return e.forEach(s=>{const l=e.get(s.parent);l?l.children.push(s):o.push(s)}),o}const E={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},L="#9b9a9a",In=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...E,...e,children:[n.jsx("path",{fill:L,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),n.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),n.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),Un=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...E,...e,children:[n.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),n.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),n.jsx("path",{fill:L,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),Xn=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...E,...e,children:[n.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:L,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),Yn=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...E,...e,children:[n.jsx("path",{fill:L,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),Hn=({iconName:t,size:e})=>{switch(t){case"save":return n.jsx(we,{size:e});case"undo":return n.jsx(ve,{size:e});case"redo":return n.jsx(ye,{size:e});case"trash":return n.jsx(xe,{size:e});case"cross":return n.jsx(ge,{size:e});case"group":return n.jsx(me,{size:e});case"ungroup":return n.jsx(be,{size:e});case"lock":return n.jsx(fe,{size:e});case"unlock":return n.jsx(pe,{size:e});default:return null}},N=20,S="text-black",_n=()=>{const t=R(o=>o.toolbar.actions),{executeAction:e}=p.useContext(j);return n.jsx("div",{className:"border-b border-gray-200 box-border",children:n.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(t).map(o=>{const{id:s,icon:l,disabled:i,divide:r}=o;let c;switch(s){case"layerUp":c=n.jsx(In,{size:N,className:S});break;case"layerDown":c=n.jsx(Un,{size:N,className:S});break;case"layerTop":c=n.jsx(Xn,{size:N,className:S});break;case"layerBottom":c=n.jsx(Yn,{size:N,className:S});break;default:c=n.jsx(Hn,{size:N,iconName:l});break}return n.jsxs(p.Fragment,{children:[n.jsx("button",{type:"button",disabled:i,title:s,onClick:()=>{e(s)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6 opacity-50   hover:bg-gray-200  hover:opacity-100 disabled:text-gray-200 disabled:cursor-default",children:c}),r&&n.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},s)})})})},Vn=()=>n.jsxs("header",{children:[n.jsx(Pn,{}),n.jsx(_n,{})]}),Zn=()=>{const{historyArray:t,historyCurrent:e,applyHistoryNode:o}=p.useContext(j),{t:s}=$(),l=p.useRef(null);return p.useEffect(()=>{if(l.current){const i=l.current,r=setTimeout(()=>{i.scrollIntoView({block:"nearest",inline:"nearest"})},0);return()=>{r&&clearTimeout(r)}}},[t,e]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-600 text-white px-2",children:n.jsx("span",{children:"History"})}),n.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:n.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:t.map((i,r)=>{const c=i===e,{label:a,tooltip:u}=s(i.data.type,{returnObjects:!0});return n.jsx("div",{title:u,ref:c?l:null,onClick:()=>{c||o(i)},className:`border-b border-gray-200 px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${c?"bg-gray-400 text-white":""}`,children:n.jsx("span",{children:a})},r)})})})]})},Wn=()=>{const{selectedProps:t}=p.useContext(j);return p.useEffect(()=>{},[t]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Properties"})}),n.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:t&&n.jsx(Gn,{props:t})})]})},Gn=({props:t})=>{const e=o=>{};return n.jsxs("div",{className:"z-30 text-sm",children:[n.jsxs("div",{className:"mb-4 ",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"X:"}),n.jsx("input",{type:"number",name:"x",value:t.x,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Y:"}),n.jsx("input",{type:"number",name:"y",value:t.y,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Width:"}),n.jsx("input",{type:"number",name:"width",value:t.width,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Height:"}),n.jsx("input",{type:"number",name:"height",value:t.height,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Radius:"}),n.jsx("input",{type:"number",name:"radius",value:t.radius,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Fill"}),n.jsx("input",{type:"checkbox",name:"enableFill",checked:t.enableFill,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Fill Color:"}),n.jsx("input",{type:"color",name:"fillColor",value:t.fillColor,onChange:e,className:"w-10 h-10 p-1 rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Line"}),n.jsx("input",{type:"checkbox",name:"enableLine",checked:t.enableLine,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Line Color:"}),n.jsx("input",{type:"color",name:"lineColor",value:t.lineColor,onChange:e,className:"w-10 h-10 p-1 rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Shadow"}),n.jsx("input",{type:"checkbox",name:"shadow",checked:t.shadow,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Opacity:"}),n.jsx("input",{type:"number",name:"opacity",value:t.opacity,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Layer:"}),n.jsx("input",{type:"number",name:"layer",value:t.layer,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]})]})]})},Kn=({file:t})=>{const e=p.useRef(null),o=p.useRef(null),[s,l]=p.useState([]),[i,r]=p.useState([]),[c,a]=p.useState(null),[u,h]=p.useState([]),[f,m]=p.useState({}),g=p.useRef(null),[v,b]=p.useState(!1);p.useEffect(()=>{let w;if(o.current){const k=P();w=new Sn({container:o.current,data:{id:k,modules:[]},events:{onHistoryUpdated:T,onModulesUpdated:D,onSelectionUpdated:C}}),qn(w),e.current=w}const M=g.current;return M&&(M.addEventListener("focus",x),M.addEventListener("blur",y)),()=>{M&&(M.removeEventListener("focus",x),M.removeEventListener("blur",y)),w&&w.destroy()}},[t]);const x=()=>b(!0),y=()=>b(!1),C=(w,M)=>{h(Array.from(w)),a(M)},T=w=>{l(w.toArray()),w.current&&m(w.current)},D=w=>{const M=Array.from(w.values()).sort((k,le)=>k.layer-le.layer);r(M)},se=w=>{e.current&&e.current.history.moveCurrentById(w)},U=(w,M=null)=>{e.current.execute(w,M)};return n.jsx(j.Provider,{value:{focused:v,historyArray:s,selectedModules:u,selectedProps:c,historyCurrent:f,editorRef:e,applyHistoryNode:se,executeAction:U},children:n.jsxs("div",{ref:g,"data-focused":v,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[n.jsx($n,{}),n.jsx(Vn,{}),n.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[n.jsx(Tn,{}),n.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[n.jsx("div",{ref:o,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),n.jsx(Bn,{})]}),n.jsxs("div",{className:"w-[40%] h-full border-l border-gray-200",children:[n.jsx(Wn,{}),n.jsx(Rn,{data:i,selected:u,handleSelectModule:w=>{U("select",new Set([w]))}}),n.jsx(Zn,{}),n.jsx(Dn,{})]})]})]})})},qn=t=>{const s={type:"rectangle",x:100,y:100,width:100,height:100,enableLine:!0,lineColor:"#000000",lineWidth:2,enableFill:!0,fillColor:"#fff",opacity:100,shadow:!1,radius:0,rotation:0};t.batchAdd(t.batchCreate(Array.from({length:1e3}).map((i,r)=>({...s,fillColor:"#9c4444",x:100+r*30,y:100+r*30,layer:r+1,rotation:r+10}))),"addModules")},Qn=t=>[],Jn=()=>{const t="Untitled 1",e={},o={modules:Qn()};return{id:P(),name:t,config:e,data:o}},ei=t=>new Map(t.reduce((e,o)=>(e.push([o.id,o]),e),[])),ti=Jn(),Z=ei([ti]),oi=()=>{const t=' group py-2 px-6 relative transition flex items-center">',e=" border-b-2 border-black-600",o=" hover:bg-gray-200",{fileList:s,currentFileId:l,closeFile:i,switchFile:r,handleCreating:c}=p.useContext(O);return n.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[s.map(a=>{const u=a.id===l,h=t+(u?e:o),f=(u?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return n.jsxs("div",{className:h,onClick:()=>{r(a.id)},children:[n.jsx("span",{children:a.name}),n.jsx("span",{onClick:m=>{i(a.id),m.preventDefault(),m.stopPropagation()},className:f,children:"×"})]},a.id)}),n.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:n.jsx(Ce,{size:18,onClick:()=>{c(!0)}})})]})},si=({children:t,defaultValue:e})=>{const[o,s]=p.useState(!1);return n.jsxs("div",{className:"relative w-20",children:[n.jsxs("div",{className:"flex items-center",onClick:()=>{s(!o)},children:[n.jsx(Me,{}),e]}),o&&n.jsx("div",{onClick:()=>{s(!1)},className:"absolute top-full right-0 w-full",children:t})]})},li=()=>{const[t,e]=p.useState("en"),o={en:"English",cn:"中文",jp:"日本語"},{i18n:s}=$();return n.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:n.jsx(si,{defaultValue:o[t],children:Object.keys(o).map((l,i)=>n.jsx("div",{onClick:()=>{s.changeLanguage(l),e(l)},children:o[l]},i))})})},ni=()=>{const t=p.useRef(new Map),[e,o]=p.useState(!1),[s,l]=p.useState(""),[i,r]=p.useState([]),c=t.current.size,a=c===0||e;p.useEffect(()=>{Z.size>0&&(t.current=Z,u(),l(h()[0].id))},[]);const u=()=>{const b=h();return r(b),b},h=()=>Array.from(t.current.values()),f=b=>{l(b)},m=b=>{const x=i.findIndex(C=>C.id===b);let y=i.length;if(x!==-1&&(t.current.delete(b),u(),i.splice(x,1),y--,s===b&&y>0)){let C=x+1;x===0&&(C=0),C>y&&(C=y-1),l(i[C].id)}},g=b=>{t.current.set(b.id,b),u(),l(b.id)},v=b=>{o(b)};return n.jsx(O.Provider,{value:{fileMap:t.current,fileList:i,creating:e,currentFileId:s,switchFile:f,closeFile:m,createFile:g,handleCreating:v},children:n.jsxs("div",{className:"w-full h-full flex flex-col",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx(oi,{}),n.jsx(li,{})]}),n.jsx("div",{className:"flex-1 overflow-hidden",children:i.map(b=>b.id===s?n.jsx(Kn,{file:b},b.id):void 0)}),a&&n.jsx(Kl,{bg:c?"#00000080":"#fff",onBgClick:()=>{c&&o(!1)}})]})})};function ii(){return n.jsx(ni,{})}const ri=[{id:"file",parent:null},{id:"newFile",parent:"file",shortcut:"Ctrl+N"},{id:"openFile",parent:"file",shortcut:"Ctrl+O"},{id:"saveFile",parent:"file",shortcut:"Ctrl+S"},{id:"saveAs",parent:"file"},{id:"importFile",parent:"file"},{id:"exportFile",parent:"file"},{id:"print",parent:"file"},{id:"closeFile",parent:"file"},{id:"exportFile_png",parent:"exportFile"},{id:"exportFile_pdf",parent:"exportFile"},{id:"exportFile_csv",parent:"exportFile"},{id:"edit",parent:null},{id:"undo",parent:"edit",shortcut:"Ctrl+Z"},{id:"redo",parent:"edit",shortcut:"Ctrl+Y"},{id:"cut",parent:"edit",shortcut:"Ctrl+X"},{id:"copy",parent:"edit",shortcut:"Ctrl+C"},{id:"paste",parent:"edit",shortcut:"Ctrl+V"},{id:"delete",parent:"edit",shortcut:"Del"},{id:"duplicate",parent:"edit",shortcut:"Ctrl+D"},{id:"selectAll",parent:"edit",shortcut:"Ctrl+A"},{id:"findReplace",parent:"edit",shortcut:"Ctrl+F"},{id:"view",parent:null},{id:"zoomIn",parent:"view",shortcut:"Ctrl++"},{id:"zoomOut",parent:"view",shortcut:"Ctrl+-"},{id:"fitToScreen",parent:"view"},{id:"toggleGrid",parent:"view"},{id:"toggleGuides",parent:"view"},{id:"fullscreenMode",parent:"view",shortcut:"F11"},{id:"shape",parent:null},{id:"addNode",parent:"shape"},{id:"deleteNode",parent:"shape"},{id:"moveNode",parent:"shape"},{id:"resizeNode",parent:"shape"},{id:"rotateNode",parent:"shape"},{id:"changeNodeColor",parent:"shape"},{id:"changeNodeBorder",parent:"shape"},{id:"changeNodeText",parent:"shape"},{id:"groupNodes",parent:"shape"},{id:"ungroupNodes",parent:"shape"},{id:"lockNode",parent:"shape"},{id:"unlockNode",parent:"shape"},{id:"connection",parent:null},{id:"addEdge",parent:"connection"},{id:"deleteEdge",parent:"connection"},{id:"changeEdgeStyle",parent:"connection"},{id:"changeEdgeColor",parent:"connection"},{id:"changeEdgeLabel",parent:"connection"},{id:"reverseEdge",parent:"connection"},{id:"text",parent:null},{id:"addText",parent:"text"},{id:"editText",parent:"text"},{id:"changeFont",parent:"text"},{id:"changeFontSize",parent:"text"},{id:"changeFontColor",parent:"text"},{id:"boldText",parent:"text",shortcut:"Ctrl+B"},{id:"italicText",parent:"text",shortcut:"Ctrl+I"},{id:"underlineText",parent:"text",shortcut:"Ctrl+U"},{id:"alignText",parent:"text"},{id:"layer",parent:null},{id:"sendToBack",parent:"layer"},{id:"bringToFront",parent:"layer"},{id:"sendBackward",parent:"layer"},{id:"bringForward",parent:"layer"},{id:"duplicateLayer",parent:"layer"},{id:"deleteLayer",parent:"layer"},{id:"toggleLayerVisibility",parent:"layer"}],ai={actions:Object.fromEntries(ri.map(t=>[t.id,{...t,disabled:!1}]))},te=B({name:"menu",initialState:ai,reducers:{setDisabled:(t,e)=>{t.actions[e.payload.id]&&(t.actions[e.payload.id].disabled=e.payload.disabled)},triggerAction:(t,e)=>{const o=t.actions[e.payload];o&&o.disabled}}}),{setDisabled:mi,triggerAction:gi}=te.actions,ci=te.reducer,di=[{id:"save",icon:"save",disabled:!0,divide:!0},{id:"undo",icon:"undo",disabled:!0},{id:"redo",icon:"redo",disabled:!0,divide:!0},{id:"delete",icon:"trash",disabled:!1},{id:"add",icon:"cross",disabled:!1,divide:!0},{id:"layerUp",icon:"layers",disabled:!1},{id:"layerDown",icon:"layers",disabled:!1},{id:"layerTop",icon:"layers",disabled:!1},{id:"layerBottom",icon:"layers",disabled:!1,divide:!0},{id:"group",icon:"group",disabled:!0},{id:"ungroup",icon:"ungroup",disabled:!0,divide:!0},{id:"lock",icon:"lock",disabled:!1},{id:"unlock",icon:"unlock",disabled:!0}],hi={actions:Object.fromEntries(di.map(t=>[t.id,{...t,disabled:!1}]))},oe=B({name:"menu",initialState:hi,reducers:{setDisabled:(t,e)=>{t.actions[e.payload.id]&&(t.actions[e.payload.id].disabled=e.payload.disabled)},triggerAction:(t,e)=>{const o=t.actions[e.payload];o&&o.disabled}}}),{setDisabled:xi,triggerAction:yi}=oe.actions,ui=oe.reducer,pi=je({reducer:{menu:ci,toolbar:ui,statusBar:An}});Ne.createRoot(document.getElementById("root")).render(n.jsx(Fe,{store:pi,children:n.jsx(ii,{})}));
