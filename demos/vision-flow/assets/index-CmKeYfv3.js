var re=Object.defineProperty;var ae=(t,e,o)=>e in t?re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var h=(t,e,o)=>ae(t,typeof e!="symbol"?e+"":e,o);import{i as ce,a as de,r as b,j as n,c as P,u as O,b as he,L as ue,d as pe,e as k,f as fe,g as be,h as ge,k as me,l as xe,m as ye,n as ve,o as we,p as Ce,q as Me,s as Se,t as je,v as Ne,w as Fe,P as $e}from"./vendor-COwhDTQH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Ee={label:"File",tooltip:"Open the file menu"},Le={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},ke={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},Te={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},De={label:"Save As",tooltip:"Save the current file with a new name"},ze={label:"Import File",tooltip:"Import a file into the project"},Ae={label:"Export",tooltip:"Export the current file"},Re={label:"Export as PNG",tooltip:"Export the file as a PNG image"},Be={label:"Export as PDF",tooltip:"Export the file as a PDF document"},Pe={label:"Export as CSV",tooltip:"Export the file as a CSV file"},Oe={label:"Print",tooltip:"Print the current file"},Ie={label:"Close File",tooltip:"Close the current file"},Ue={label:"Edit",tooltip:"Open the edit menu"},Xe={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},Ve={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},He={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},Ye={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},_e={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},Ke={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},Ze={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},Ge={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},We={label:"View",tooltip:"Open the view menu"},qe={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},Qe={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},Je={label:"Fit to Screen",tooltip:"Fit the content to the screen"},et={label:"Toggle Grid",tooltip:"Show or hide the grid"},tt={label:"Toggle Guides",tooltip:"Show or hide the guides"},ot={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},st={label:"Shape",tooltip:"Open the shape menu"},lt={label:"Add Node",tooltip:"Add a new node to the diagram"},it={label:"Delete Node",tooltip:"Delete the selected node"},nt={label:"Move Node",tooltip:"Move the selected node"},rt={label:"Resize Node",tooltip:"Resize the selected node"},at={label:"Rotate Node",tooltip:"Rotate the selected node"},ct={label:"Change Node Color",tooltip:"Change the color of the selected node"},dt={label:"Change Node Border",tooltip:"Change the border of the selected node"},ht={label:"Change Node Text",tooltip:"Edit the text of the selected node"},ut={label:"Group Nodes",tooltip:"Group selected nodes together"},pt={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},ft={label:"Lock Node",tooltip:"Lock the selected node"},bt={label:"Unlock Node",tooltip:"Unlock the selected node"},gt={label:"Connection",tooltip:"Open the connection menu"},mt={label:"Add Edge",tooltip:"Add an edge between nodes"},xt={label:"Delete Edge",tooltip:"Delete the selected edge"},yt={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},vt={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},wt={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},Ct={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},Mt={label:"Text",tooltip:"Open the text menu"},St={label:"Add Text",tooltip:"Add text to the document"},jt={label:"Edit Text",tooltip:"Edit the selected text"},Nt={label:"Change Font",tooltip:"Change the font of the selected text"},Ft={label:"Change Font Size",tooltip:"Change the font size of the selected text"},$t={label:"Change Font Color",tooltip:"Change the font color of the selected text"},Et={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},Lt={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},kt={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},Tt={label:"Align Text",tooltip:"Align the selected text"},Dt={label:"Layer",tooltip:"Open the layer menu"},zt={label:"Send to Back",tooltip:"Send the selected layer to the back"},At={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},Rt={label:"Send Backward",tooltip:"Send the selected layer one step backward"},Bt={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},Pt={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},Ot={label:"Delete Layer",tooltip:"Delete the selected layer"},It={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},Ut={label:"Collaboration",tooltip:"Open the collaboration menu"},Xt={label:"Add Comment",tooltip:"Add a comment to the document"},Vt={label:"Edit Comment",tooltip:"Edit the selected comment"},Ht={label:"Delete Comment",tooltip:"Delete the selected comment"},Yt={label:"Share Document",tooltip:"Share the document with others"},_t={file:Ee,newFile:Le,openFile:ke,saveFile:Te,saveAs:De,importFile:ze,exportFile:Ae,exportFile_png:Re,exportFile_pdf:Be,exportFile_csv:Pe,print:Oe,closeFile:Ie,edit:Ue,undo:Xe,redo:Ve,cut:He,copy:Ye,paste:_e,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:Ke,selectAll:Ze,findReplace:Ge,view:We,zoomIn:qe,zoomOut:Qe,fitToScreen:Je,toggleGrid:et,toggleGuides:tt,fullscreenMode:ot,shape:st,addNode:lt,deleteNode:it,moveNode:nt,resizeNode:rt,rotateNode:at,changeNodeColor:ct,changeNodeBorder:dt,changeNodeText:ht,groupNodes:ut,ungroupNodes:pt,lockNode:ft,unlockNode:bt,connection:gt,addEdge:mt,deleteEdge:xt,changeEdgeStyle:yt,changeEdgeColor:vt,changeEdgeLabel:wt,reverseEdge:Ct,text:Mt,addText:St,editText:jt,changeFont:Nt,changeFontSize:Ft,changeFontColor:$t,boldText:Et,italicText:Lt,underlineText:kt,alignText:Tt,layer:Dt,sendToBack:zt,bringToFront:At,sendBackward:Rt,bringForward:Bt,duplicateLayer:Pt,deleteLayer:Ot,toggleLayerVisibility:It,collaboration:Ut,addComment:Xt,editComment:Vt,deleteComment:Ht,shareDocument:Yt},Kt={label:"Init",tooltip:"Initialize the file"},Zt={label:"Add Modules",tooltip:"Add new modules to the file"},Gt={label:"Delete Modules",tooltip:"Remove modules from the file"},Wt={label:"Paste Modules",tooltip:"Paste modules into the file"},qt={label:"Duplicate Modules",tooltip:"Duplicate selected modules"},Qt={label:"Modify Modules",tooltip:"Modify the properties of modules"},Jt={init:Kt,addModules:Zt,deleteModules:Gt,pasteModules:Wt,duplicateModules:qt,modifyModules:Qt},eo={label:"文件",tooltip:"打开文件菜单"},to={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},oo={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},so={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},lo={label:"另存为",tooltip:"以新名称保存当前文件"},io={label:"导入文件",tooltip:"将文件导入到项目中"},no={label:"导出",tooltip:"导出当前文件"},ro={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},ao={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},co={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},ho={label:"打印",tooltip:"打印当前文件"},uo={label:"关闭文件",tooltip:"关闭当前文件"},po={label:"编辑",tooltip:"打开编辑菜单"},fo={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},bo={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},go={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},mo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},xo={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},yo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},vo={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},wo={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},Co={label:"视图",tooltip:"打开视图菜单"},Mo={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},So={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},jo={label:"适应屏幕",tooltip:"使内容适应屏幕"},No={label:"切换网格",tooltip:"显示或隐藏网格"},Fo={label:"切换参考线",tooltip:"显示或隐藏参考线"},$o={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},Eo={label:"形状",tooltip:"打开形状菜单"},Lo={label:"添加节点",tooltip:"向图表添加新节点"},ko={label:"删除节点",tooltip:"删除选定的节点"},To={label:"移动节点",tooltip:"移动选定的节点"},Do={label:"调整节点大小",tooltip:"调整选定节点的大小"},zo={label:"旋转节点",tooltip:"旋转选定的节点"},Ao={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},Ro={label:"更改节点边框",tooltip:"更改选定节点的边框"},Bo={label:"更改节点文本",tooltip:"编辑选定节点的文本"},Po={label:"组合节点",tooltip:"将选定的节点组合在一起"},Oo={label:"取消组合节点",tooltip:"取消组合选定的节点"},Io={label:"锁定节点",tooltip:"锁定选定的节点"},Uo={label:"解锁节点",tooltip:"解锁选定的节点"},Xo={label:"连接",tooltip:"打开连接菜单"},Vo={label:"添加边",tooltip:"在节点之间添加边"},Ho={label:"删除边",tooltip:"删除选定的边"},Yo={label:"更改边样式",tooltip:"更改选定边的样式"},_o={label:"更改边颜色",tooltip:"更改选定边的颜色"},Ko={label:"更改边标签",tooltip:"更改选定边的标签"},Zo={label:"反转边",tooltip:"反转选定边的方向"},Go={label:"文本",tooltip:"打开文本菜单"},Wo={label:"添加文本",tooltip:"向文档添加文本"},qo={label:"编辑文本",tooltip:"编辑选定的文本"},Qo={label:"更改字体",tooltip:"更改选定文本的字体"},Jo={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},es={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},ts={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},os={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},ss={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},ls={label:"对齐文本",tooltip:"对齐选定的文本"},is={label:"图层",tooltip:"打开图层菜单"},ns={label:"置于底层",tooltip:"将选定的图层置于底层"},rs={label:"置于顶层",tooltip:"将选定的图层置于顶层"},as={label:"下移一层",tooltip:"将选定的图层下移一层"},cs={label:"上移一层",tooltip:"将选定的图层上移一层"},ds={label:"复制图层",tooltip:"复制选定的图层"},hs={label:"删除图层",tooltip:"删除选定的图层"},us={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},ps={label:"协作",tooltip:"打开协作菜单"},fs={label:"添加评论",tooltip:"向文档添加评论"},bs={label:"编辑评论",tooltip:"编辑选定的评论"},gs={label:"删除评论",tooltip:"删除选定的评论"},ms={label:"分享文档",tooltip:"与他人分享文档"},xs={file:eo,newFile:to,openFile:oo,saveFile:so,saveAs:lo,importFile:io,exportFile:no,exportFile_png:ro,exportFile_pdf:ao,exportFile_csv:co,print:ho,closeFile:uo,edit:po,undo:fo,redo:bo,cut:go,copy:mo,paste:xo,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:yo,selectAll:vo,findReplace:wo,view:Co,zoomIn:Mo,zoomOut:So,fitToScreen:jo,toggleGrid:No,toggleGuides:Fo,fullscreenMode:$o,shape:Eo,addNode:Lo,deleteNode:ko,moveNode:To,resizeNode:Do,rotateNode:zo,changeNodeColor:Ao,changeNodeBorder:Ro,changeNodeText:Bo,groupNodes:Po,ungroupNodes:Oo,lockNode:Io,unlockNode:Uo,connection:Xo,addEdge:Vo,deleteEdge:Ho,changeEdgeStyle:Yo,changeEdgeColor:_o,changeEdgeLabel:Ko,reverseEdge:Zo,text:Go,addText:Wo,editText:qo,changeFont:Qo,changeFontSize:Jo,changeFontColor:es,boldText:ts,italicText:os,underlineText:ss,alignText:ls,layer:is,sendToBack:ns,bringToFront:rs,sendBackward:as,bringForward:cs,duplicateLayer:ds,deleteLayer:hs,toggleLayerVisibility:us,collaboration:ps,addComment:fs,editComment:bs,deleteComment:gs,shareDocument:ms},ys={label:"初始化",tooltip:"初始化文件"},vs={label:"添加模块",tooltip:"向文件添加新模块"},ws={label:"删除模块",tooltip:"从文件中移除模块"},Cs={label:"粘贴模块",tooltip:"将模块粘贴到文件中"},Ms={label:"复制模块",tooltip:"复制选定的模块"},Ss={label:"修改模块",tooltip:"修改模块的属性"},js={init:ys,addModules:vs,deleteModules:ws,pasteModules:Cs,duplicateModules:Ms,modifyModules:Ss},Ns={label:"ファイル",tooltip:"ファイルメニューを開く"},Fs={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},$s={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},Es={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},Ls={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},ks={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},Ts={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Ds={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},zs={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},As={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},Rs={label:"印刷",tooltip:"現在のファイルを印刷"},Bs={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Ps={label:"編集",tooltip:"編集メニューを開く"},Os={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},Is={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},Us={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},Xs={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},Vs={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},Hs={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},Ys={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},_s={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},Ks={label:"表示",tooltip:"表示メニューを開く"},Zs={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},Gs={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},Ws={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},qs={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},Qs={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},Js={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},el={label:"図形",tooltip:"図形メニューを開く"},tl={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},ol={label:"ノードを削除",tooltip:"選択したノードを削除"},sl={label:"ノードを移動",tooltip:"選択したノードを移動"},ll={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},il={label:"ノードを回転",tooltip:"選択したノードを回転"},nl={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},rl={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},al={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},cl={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},dl={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},hl={label:"ノードをロック",tooltip:"選択したノードをロック"},ul={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},pl={label:"接続",tooltip:"接続メニューを開く"},fl={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},bl={label:"エッジを削除",tooltip:"選択したエッジを削除"},gl={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},ml={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},xl={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},yl={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},vl={label:"テキスト",tooltip:"テキストメニューを開く"},wl={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},Cl={label:"テキストを編集",tooltip:"選択したテキストを編集"},Ml={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},Sl={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},jl={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},Nl={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},Fl={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},$l={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},El={label:"テキストを配置",tooltip:"選択したテキストを配置"},Ll={label:"レイヤー",tooltip:"レイヤーメニューを開く"},kl={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},Tl={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Dl={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},zl={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},Al={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},Rl={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},Bl={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Pl={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},Ol={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},Il={label:"コメントを編集",tooltip:"選択したコメントを編集"},Ul={label:"コメントを削除",tooltip:"選択したコメントを削除"},Xl={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},Vl={file:Ns,newFile:Fs,openFile:$s,saveFile:Es,saveAs:Ls,importFile:ks,exportFile:Ts,exportFile_png:Ds,exportFile_pdf:zs,exportFile_csv:As,print:Rs,closeFile:Bs,edit:Ps,undo:Os,redo:Is,cut:Us,copy:Xs,paste:Vs,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:Hs,selectAll:Ys,findReplace:_s,view:Ks,zoomIn:Zs,zoomOut:Gs,fitToScreen:Ws,toggleGrid:qs,toggleGuides:Qs,fullscreenMode:Js,shape:el,addNode:tl,deleteNode:ol,moveNode:sl,resizeNode:ll,rotateNode:il,changeNodeColor:nl,changeNodeBorder:rl,changeNodeText:al,groupNodes:cl,ungroupNodes:dl,lockNode:hl,unlockNode:ul,connection:pl,addEdge:fl,deleteEdge:bl,changeEdgeStyle:gl,changeEdgeColor:ml,changeEdgeLabel:xl,reverseEdge:yl,text:vl,addText:wl,editText:Cl,changeFont:Ml,changeFontSize:Sl,changeFontColor:jl,boldText:Nl,italicText:Fl,underlineText:$l,alignText:El,layer:Ll,sendToBack:kl,bringToFront:Tl,sendBackward:Dl,bringForward:zl,duplicateLayer:Al,deleteLayer:Rl,toggleLayerVisibility:Bl,collaboration:Pl,addComment:Ol,editComment:Il,deleteComment:Ul,shareDocument:Xl},Hl={label:"初期化",tooltip:"ファイルを初期化する"},Yl={label:"モジュールを追加",tooltip:"ファイルに新しいモジュールを追加する"},_l={label:"モジュールを削除",tooltip:"ファイルからモジュールを削除する"},Kl={label:"モジュールを貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},Zl={label:"モジュールを複製",tooltip:"選択したモジュールを複製する"},Gl={label:"モジュールを修正",tooltip:"モジュールのプロパティを修正する"},Wl={init:Hl,addModules:Yl,deleteModules:_l,pasteModules:Kl,duplicateModules:Zl,modifyModules:Gl},ql={en:{translation:{..._t,...Jt}},cn:{translation:{...xs,...js}},jp:{translation:{...Vl,...Wl}}};ce.use(de).init({resources:ql,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const I=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),U=b.createContext({fileMap:new Map([["fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",{id:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",name:"Untitled 1",config:{},data:{}}]]),fileList:[],currentFileId:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{}}),Ql=({bg:t="#fff",onBgClick:e})=>{const o=b.useRef(null),{createFile:s,handleCreating:l}=b.useContext(U),[i,r]=b.useState(""),a=u=>/^[a-zA-Z0-9-_ ]+$/.test(u),c=u=>{var f;u.preventDefault(),u.stopPropagation();const d=(f=o.current)==null?void 0:f.filename.value.trim();if(!a(d)){r("File name can only including number space and alpha");return}r("");const p={id:I(),name:d,data:{},config:{}};s(p),l(!1)};return n.jsxs("div",{className:"fixed top-0 left-0 z-20 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[n.jsx("div",{style:{backgroundColor:t},onClick:()=>e&&e(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),n.jsxs("form",{ref:o,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:c,children:[n.jsx("h1",{className:"text-xl text-center",children:"New File"}),n.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),n.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),i&&n.jsx("div",{className:"text-red-500 my-2",children:i}),n.jsx("label",{className:"justify-center",children:n.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})};function $(t){return t===null?"null":t===void 0?"undefined":t instanceof Set?"set":t instanceof Map?"map":Array.isArray(t)?"array":t instanceof Date?"date":t instanceof RegExp?"regexp":t instanceof Error?"error":t instanceof Promise?"promise":t instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(t)?"typedarray":t instanceof WeakSet?"weakset":t instanceof WeakMap?"weakmap":typeof t=="function"?"function":typeof t=="symbol"?"symbol":typeof t=="bigint"?"bigint":typeof t=="object"?"object":typeof t}const V=50,H=100;class Jl{constructor(e){h(this,"selectedModules",new Set);h(this,"resizeHandleSize",10);h(this,"activeResizeHandle",null);h(this,"isDestroyed",!1);h(this,"editor");h(this,"copiedItems",[]);h(this,"isSelectAll",!1);this.editor=e}getSelected(){return this.isSelectAll?"all":new Set(this.selectedModules.keys())}modifySelection(e,o){var l,i;if($(e)!=="set"||e.size<=0)return;let s=e.size===1?this.editor.moduleMap.get([...e.values()][0]).getDetails():null;o==="replace"&&this.selectedModules.clear(),e.forEach(r=>{switch(o){case"add":this.selectedModules.add(r);break;case"delete":this.selectedModules.delete(r);break;case"toggle":this.selectedModules.has(r)?this.selectedModules.delete(r):this.selectedModules.add(r);break;case"replace":this.selectedModules.add(r);break}}),this.render(),(i=(l=this.editor.events).onSelectionUpdated)==null||i.call(l,e,s)}add(e){this.modifySelection(e,"add")}delete(e){this.modifySelection(e,"delete")}toggle(e){this.modifySelection(e,"toggle")}replace(e){this.modifySelection(e,"replace")}selectAll(){var e,o;this.selectedModules.clear(),this.isSelectAll=!0,this.render(),(o=(e=this.editor.events).onSelectionUpdated)==null||o.call(e,"all",null)}clear(){var e,o;this.selectedModules.clear(),this.isSelectAll=!1,this.render(),(o=(e=this.editor.events).onSelectionUpdated)==null||o.call(e,new Set,null)}copySelected(){this.copiedItems=[],this.copiedItems=this.editor.batchCopy(this.isSelectAll?"all":this.selectedModules,!0),this.updateCopiedItemsDelta()}pasteCopied(){const e=this.editor.batchCreate(this.copiedItems);this.editor.batchAdd(e,"pasteModules"),this.replace(new Set(e.keys())),this.updateCopiedItemsDelta()}duplicateSelected(){let e;this.isSelectAll?e=this.editor.batchCopy("all",!0):e=this.editor.batchCopy(this.selectedModules,!0),e.forEach(s=>{s.x+=V,s.y+=H});const o=this.editor.batchCreate(e);this.editor.batchAdd(o,"duplicateModules"),this.isSelectAll=!1,this.replace(new Set(o.keys()))}removeSelected(){this.isSelectAll?this.editor.batchDelete("all","deleteModules"):this.editor.batchDelete(this.selectedModules,"deleteModules"),this.editor.selectionManager.clear()}updateCopiedItemsDelta(){this.copiedItems.forEach(e=>{e.x+=V,e.y+=H})}getIfUnique(){return this.selectedModules.size===1?[...this.selectedModules.values()][0]:null}update(){var o,s;let e=null;this.selectedModules.size===1&&this.selectedModules.forEach(l=>{e=this.editor.moduleMap.get(l).getDetails()}),this.render(),(s=(o=this.editor.events).onSelectionUpdated)==null||s.call(o,this.selectedModules,e)}render(){this.editor.viewport.resetSelectionCanvas(),this.editor.viewport.renderSelectionCanvas()}destroy(){this.isDestroyed||(this.selectedModules.clear(),this.isDestroyed=!0,console.log("SelectionModule destroyed."))}}class Y{constructor(e,o,s,l=-1){h(this,"data");h(this,"prev");h(this,"next");h(this,"id");this.data=s,this.prev=e,this.next=o,this.id=l}}class ei{constructor(){h(this,"head");h(this,"tail");h(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(e){let o;const{tail:s}=this;return s?(o=new Y(s,null,e,s.id+1),s.next=o,this.tail=o):(o=new Y(null,null,e,0),this.head=o,this.tail=o),this.current=o,o}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(e){if(e===this.current)return"equal";let o=this.head;for(;o;){if(this.current===o)return"behind";if(e===o)return"front";o=o.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}const ti=t=>new Set(t.map(e=>e.id));class oi extends ei{constructor(o){super();h(this,"editor");this.editor=o,this.init()}init(){var o,s;this.append({type:"init",modules:[],selectModules:new Set}),(s=(o=this.editor.events).onHistoryUpdated)==null||s.call(o,this)}add(o){var s,l;super.detach(),super.append(o),(l=(s=this.editor.events).onHistoryUpdated)==null||l.call(s,this)}undo(o=!1){var a,c;const s=this.current;if(!s)return!1;const{type:l,modules:i=[],selectModules:r=new Set}=s.data;return l==="pasteModules"||l==="addModules"||l==="duplicateModules"?this.editor.batchDelete(ti(i)):l==="deleteModules"?this.editor.batchAdd(this.editor.batchCreate(i)):l==="modifyModules"&&(console.log("modify",i),this.editor.batchReplaceModules(i)),o||(this.editor.selectionManager.replace(r),(c=(a=this.editor.events).onHistoryUpdated)==null||c.call(a,this)),super.back(),this.current}redo(o=!1){var a,c;const s=super.forward();if(!s)return!1;const{type:l,modules:i=[],selectModules:r=new Set}=s.data;return l==="pasteModules"||l==="addModules"||l==="duplicateModules"?this.editor.batchAdd(this.editor.batchCreate(i)):l==="deleteModules"?this.editor.batchDelete(new Set(i.map(u=>u.id))):l==="modifyModules"&&this.editor.batchReplaceModules(i),o||(this.editor.selectionManager.replace(r),(c=(a=this.editor.events).onHistoryUpdated)==null||c.call(a,this)),this.current}moveCurrentById(o){var l,i;const s=super.compareToCurrentPosition(o);if(!(!s||s==="equal")&&(s==="front"||s==="behind")){let a;for(;s==="front"?a=this.undo(!0):s==="behind"&&(a=this.redo(!0)),a!==o;);const{selectModules:c}=o.data;this.editor.selectionManager.replace(c),(i=(l=this.editor.events).onHistoryUpdated)==null||i.call(l,this)}}toArray(){const o=[];if(this.head){let s=this.head;for(o.push(s);s.next;)o.push(s.next),s=s.next}return o}}class W{constructor({id:e,type:o,lineColor:s,lineWidth:l=1,opacity:i=100,position:r,layer:a=1,rotation:c=0,shadow:u=!1,enableLine:d=!0}){h(this,"id");h(this,"type");h(this,"enableLine");h(this,"lineWidth");h(this,"lineColor");h(this,"opacity");h(this,"position");h(this,"rotation");h(this,"shadow");h(this,"layer");this.id=e,this.type=o,this.enableLine=d,this.lineColor=s,this.lineWidth=l,this.opacity=i,this.position=r,this.rotation=c,this.shadow=u,this.layer=a}getDetails(){return{id:this.id,type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,position:this.position,layer:this.layer,rotation:this.rotation}}getBoundingRect(){return{x:0,y:0,width:0,height:0,top:0,left:0,right:0,bottom:0,centerX:0,centerY:0}}}class si extends W{constructor({x:o,y:s,fillColor:l,enableFill:i=!0,...r}){super(r);h(this,"x");h(this,"y");h(this,"fillColor");h(this,"enableFill");this.x=o,this.y=s,this.fillColor=l,this.enableFill=i}getDetails(){return{...this.getSize(),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y,...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}=this,{width:l,height:i}=this.getSize();return{x:o,y:s,width:l,height:i,top:s,left:o,right:o+l,bottom:s+i,centerX:o+l/2,centerY:s+i/2}}}class li extends si{constructor({width:o,height:s,radius:l,...i}){super(i);h(this,"width");h(this,"height");h(this,"radius");this.width=o,this.height=s,this.radius=l}getDetails(){return{width:this.width,height:this.height,radius:this.radius,...super.getDetails()}}getBoundingRect(){const{x:o,y:s,width:l,height:i,rotation:r}=this,a=r*Math.PI/180,c=Math.cos(a),u=Math.sin(a),d=Math.abs(l*c)+Math.abs(i*u),p=Math.abs(l*u)+Math.abs(i*c),f=o-d/2,g=s-p/2;return{x:f,y:g,width:d,height:p,top:g,bottom:g+p,left:f,right:f+d,centerX:o,centerY:s}}}function B(t,e={}){if(typeof t!="object"||t===null)return t;if(Array.isArray(t))return t.map(s=>B(s,e));const o=Object.create(e.clonePrototype?Object.getPrototypeOf(t):null);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(o[s]=B(t[s],e));return o}class ii{constructor(e){h(this,"lock");h(this,"editor");h(this,"eventsMap",new Map([["selectAll",[]],["copy",[]],["paste",[]],["duplicate",[]],["delete",[]],["escape",[]],["modifyModules",[]],["undo",[]],["redo",[]]]));this.editor=e,this.lock=!1}subscribe(e,o){this.eventsMap.has(e)?this.eventsMap.get(e).push(o):this.eventsMap.set(e,[o])}unsubscribe(e,o){if(this.eventsMap.has(e)){const s=this.eventsMap.get(e);for(let l=s.length-1;l>=0;l--)if(s[l]===o)return s.splice(l,1),"deleted";return"Cannot find event or function"}}dispatcher(e,o=null){if(!this.lock){if(this.lock=!0,e==="selectAll"&&this.editor.selectionManager.selectAll(),e==="select"&&this.editor.selectionManager.replace(o),e==="copy"&&this.editor.selectionManager.copySelected(),e==="delete"&&this.editor.selectionManager.removeSelected(),e==="duplicate"&&this.editor.selectionManager.duplicateSelected(),e==="escape"&&this.editor.selectionManager.clear(),e==="paste"&&this.editor.selectionManager.pasteCopied(),e==="redo"&&this.editor.history.redo(),e==="undo"&&this.editor.history.undo(),e==="moveUp"||e==="moveRight"||e==="moveDown"||e==="moveLeft"){const s=this.editor.selectionManager.getSelected();this.editor.batchModify(s,{code:e},"modifyModules")}this.eventsMap.has(e)&&this.eventsMap.get(e).forEach(s=>{s()}),this.lock=!1}}destroy(){this.eventsMap.clear(),this.editor=null,this.lock=!1}}class ni extends W{constructor({start:o,end:s,...l}){super(l);h(this,"start");h(this,"end");this.start=o,this.end=s}getDetails(){return{...this.getSize(),...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}={x:0,y:1},{width:l,height:i}=this.getSize();return{x:o,y:s,width:l,height:i,top:s,left:o,right:o+l,bottom:s+i}}}function ri(t){var o,s;this.batchCreate(t).forEach(l=>{console.log(this.moduleMap),this.moduleMap.set(l.id,l)}),this.render(),(s=(o=this.events).onModulesUpdated)==null||s.call(o,this.moduleMap),this.selectionManager.render()}const q=t=>{if(!Array.isArray(t))return[];const e=new Set;return t.filter(o=>{const s=Object.keys(o).sort().map(l=>`${l}:${String(o[l])}`).join(";");return e.has(s)?!1:(e.add(s),!0)})},Q=(t,e)=>{let o=e;o.length>1e3&&(o=e.map(l=>({...l,x:Math.floor(l.x),y:Math.floor(l.y)})));const s=q(o);t.save(),s.forEach(({x:l,y:i,width:r,height:a,fillColor:c="",lineColor:u="",lineWidth:d=1,radius:p=0,opacity:f=100,gradient:g,rotation:v=0,dashLine:x=""})=>{const y=r/2,m=a/2;t.save(),t.translate(l,i),v>0&&t.rotate(v*Math.PI/180),f>0&&(t.fillStyle=c,t.globalAlpha=f/100),d>0&&(t.lineWidth=d,t.strokeStyle=u,t.lineJoin="round"),t.beginPath(),x&&t.setLineDash([3,5]),p>0?(t.moveTo(-y+p,-m),t.arcTo(y,-m,y,m,p),t.arcTo(y,m,-y,m,p),t.arcTo(-y,m,-y,-m,p),t.arcTo(-y,-m,y,-m,p)):t.rect(-y,-m,r,a),t.closePath(),f>0&&t.fill(),d>0&&t.stroke(),t.restore()})},ai=(t,e)=>{const o=new Set,s=",";t.save(),e.forEach(a=>{const c=Object.values(a).join(s);o.add(c)});let l=NaN,i="";const r=new Path2D;o.forEach(a=>{const c=a.split(s),u=parseFloat(c[0]),d=parseFloat(c[1]),p=parseFloat(c[2]),f=parseFloat(c[3]),g=c[4],v=parseFloat(c[5]);v!==l&&(t.lineWidth=v,l=v),g!==i&&(t.fillStyle=g,i=g),r.moveTo(u,d),r.lineTo(p,f)}),t.stroke(r),t.restore()},ci=({ctx:t,modules:e})=>{const s=[{x:400,y:500,width:800,height:1e3,opacity:100,lineWidth:1,lineColor:"#000000",fillColor:"#fff"}],l=[],i=[];e.forEach(r=>{if(r.type==="rectangle"){const{x:a,y:c,width:u,height:d,enableFill:p,enableLine:f,opacity:g,lineWidth:v,fillColor:x,lineColor:y,rotation:m,gradient:C,radius:j,id:N}=r.getDetails();(p&&g>0||f)&&s.push({x:a,y:c,width:u,height:d,fillColor:x,opacity:g,lineWidth:v,lineColor:y,rotation:m,gradient:C,radius:j}),i.push({x:a+10,y:c+10,width:u,height:d,id:N.match(/\d+$/g)[0]})}if(r.type==="connector"){const a=e.get(r.start),c=e.get(r.end),u=a.getBoundingRect(),d=c.getBoundingRect();l.push({startX:u.centerX,startY:u.bottom,endX:d.centerX,endY:d.top,fillStyle:"#5491f8",lineWidth:1})}}),Q(t,s),ai(t,l),di(t,i)},di=(t,e)=>{t.font="sans-serif",t.textBaseline="top",e.forEach(({id:o,x:s,y:l,width:i,height:r})=>{t.fillText(o,s-i/2+5,l-r/2+5,100)})};function hi(){const t="#1FB3FF",e="rgba(31,180,255,0.1)";this.editor.container.innerHTML="",this.mainCanvas.setAttribute("editor-main-canvas",""),this.mainCanvas.style.backgroundColor="#f0f0f0",this.mainCanvas.style.position="absolute",this.mainCanvas.style.left="0",this.mainCanvas.style.top="0",this.mainCanvas.style.width="100%",this.mainCanvas.style.height="100%",this.mainCanvas.style.pointerEvents="none",this.selectionCanvas.setAttribute("editor-selection-canvas",""),this.selectionCanvas.style.position="absolute",this.selectionCanvas.style.left="0",this.selectionCanvas.style.top="0",this.selectionCanvas.style.width="100%",this.selectionCanvas.style.height="100%",this.selectionCanvas.style.pointerEvents="none",this.wrapper.setAttribute("editor-wrapper",""),this.wrapper.style.userSelect="none",this.wrapper.style.position="relative",this.wrapper.style.scrollbarWidth="thin",this.wrapper.style.scrollbarColor="#787878 transparent",this.wrapper.style.overflow="hidden",this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.selectionBox.setAttribute("editor-selection-box",""),this.selectionBox.style.pointerEvents="none",this.selectionBox.style.position="absolute",this.selectionBox.style.border="1px solid "+t,this.selectionBox.style.backgroundColor=e,J(this.scrollBarX,this.scrollBarY),X(this.selectionBox,{x:0,y:0,width:0,height:0},!1),this.wrapper.append(this.mainCanvas,this.selectionCanvas,this.scrollBarX,this.scrollBarY,this.selectionBox),this.editor.container.appendChild(this.wrapper)}const ui=()=>{const t=document.createElement("div"),e=document.createElement("div");return t.setAttribute("scroll-bar-x",""),e.setAttribute("scroll-bar-y",""),t.style.backgroundColor="#787878",e.style.backgroundColor="#787878",t.style.userSelect="none",e.style.userSelect="none",e.style.translate="none",e.style.translate="none",{scrollBarX:t,scrollBarY:e}},J=(t,e)=>{t.style.width="50px",t.style.height="6px",t.style.position="absolute",t.style.bottom="0",t.style.left="0",e.style.width="6px",e.style.height="50px",e.style.position="absolute",e.style.right="0",e.style.top="0"},X=(t,{x:e,y:o,height:s,width:l},i=!0)=>{t.style.transform=`translate(${e}px, ${o}px)`,t.style.width=l+"px",t.style.height=s+"px",t.style.display=i?"block":"none"};function pi(t){const e=t.target===this.wrapper,o=t.button===0;if(!(!e||!o||this.domResizing))if(this.mouseDownPoint.x=t.clientX-this.rect.x,this.mouseDownPoint.y=t.clientY-this.rect.y,this.spaceKeyDown)this.manipulationStatus="panning";else if(this.hoveredModules.size>0){const s=[...this.hoveredModules][this.hoveredModules.size-1];this.editor.selectionManager.isSelectAll?this.editor.moduleMap.forEach(l=>{this.handlingModules.add(l.id)}):this.editor.selectionManager.selectedModules.has(s)?this.editor.selectionManager.selectedModules.forEach(l=>{this.handlingModules.add(l)}):this.handlingModules.add(s)}else this.manipulationStatus="selecting",t.ctrlKey||t.shiftKey||t.metaKey||this.editor.selectionManager.clear()}function fi(t,e){return!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}function bi(t,e){return t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom}const gi=(t,e,o,s,l)=>{const i=o/2,r=s/2,a=l*(Math.PI/180),c=Math.cos(a),u=Math.sin(a);return[{x:t-i,y:e-r},{x:t,y:e-r},{x:t+i,y:e-r},{x:t+i,y:e},{x:t+i,y:e+r},{x:t,y:e+r},{x:t-i,y:e+r},{x:t-i,y:e}].map(({x:p,y:f})=>{const g=p-t,v=f-e;return{x:t+g*c-v*u,y:e+g*u+v*c}})};function ee(t,e,o,s,l){return{x:(s-e)/t,y:(l-o)/t}}const mi=({ctx:t,mousePoint:e,scale:o,dpr:s,offset:{x:l,y:i},virtualRect:{left:r,top:a,right:c,bottom:u}})=>{const d=10/(s*o),p=10/(s*o),{x:f,y:g}=ee(o,l*s,i*s,e.x*s,e.y*s),v="#ff0000",x="#ff0000",y="#000";t.save(),t.textBaseline="alphabetic",t.font=`${24/o}px sans-serif`,t.fillStyle=x,t.shadowColor=v,t.shadowBlur=1,t.fillText(`${Math.floor(f)}, ${Math.floor(g)}`,f+d,g-p,200/o),t.lineWidth=2/(s*o),t.strokeStyle=v,t.shadowColor=y,t.shadowBlur=0,t.beginPath(),t.moveTo(r,g),t.lineTo(c,g),t.moveTo(f,a),t.lineTo(f,u),t.stroke(),t.restore()},xi=({x:t,y:e},{x:o,y:s,width:l,height:i},r)=>{if(l<=0||i<=0)return!1;if(r===0){const y=l/2,m=i/2;return t>=o-y&&t<=o+y&&e>=s-m&&e<=s+m}const a=r*(Math.PI/180),c=Math.cos(a),u=Math.sin(a),d=t-o,p=e-s,f=d*c+p*u,g=-d*u+p*c,v=l/2,x=i/2;return f>=-v&&f<=v&&g>=-x&&g<=x},yi=t=>{const{x:e,y:o,width:s,height:l}=t;return{x:e,y:o,width:s,height:l,top:o,bottom:o+l,left:e,right:e+s,centerX:e+s/2,centerY:o+l/2}},_=(t,e)=>{const o=Math.min(t.x,e.x),s=Math.max(t.x,e.x),l=Math.min(t.y,e.y),i=Math.max(t.y,e.y);return yi({x:o,y:l,width:s-o,height:i-l})};function vi(t){if(!this.domResizing)switch(this.mouseMovePoint.x=t.clientX-this.rect.x,this.mouseMovePoint.y=t.clientY-this.rect.y,this.hoveredModules.clear(),this.drawCrossLine=!1,this.manipulationStatus){case"selecting":this.wrapper.setPointerCapture(t.pointerId);const e=_(this.mouseDownPoint,this.mouseMovePoint),o=this.screenToCanvas(e.x,e.y),s=this.screenToCanvas(e.x+e.width,e.y+e.height),l=_(o,s);let i=new Set;this.editor.visibleModuleMap.forEach(d=>{if(d.type==="rectangle"){const p=d.getBoundingRect();bi(p,l)&&i.add(d.id)}}),t.ctrlKey||t.shiftKey||t.metaKey?this.editor.selectionManager.toggle(i):this.editor.selectionManager.replace(i),X(this.selectionBox,e),this.resetSelectionCanvas(),this.renderSelectionCanvas();break;case"panning":this.translateViewport(t.movementX,t.movementY);break;case"dragging":this.wrapper.setPointerCapture(t.pointerId);const r=t.movementX*this.dpr/this.zoom,a=t.movementY*this.dpr/this.zoom;this.handlingModules.forEach(d=>{this.editor.moduleMap.get(d).x+=r,this.editor.moduleMap.get(d).y+=a}),this.updateVirtualRect(),this.render();break;case"resizing":break;case"rotating":break;case"static":const c=10,u=Math.abs(this.mouseMovePoint.x-this.mouseDownPoint.x)>c||Math.abs(this.mouseMovePoint.y-this.mouseDownPoint.y)>c;if(this.handlingModules.size>0&&u)this.manipulationStatus="dragging";else{const d=this.screenToCanvas(this.mouseMovePoint.x,this.mouseMovePoint.y);this.editor.visibleModuleMap.forEach(p=>{if(p.type==="rectangle"){const{x:f,y:g,width:v,height:x,rotation:y}=p;xi(d,{x:f,y:g,width:v,height:x},y)&&this.hoveredModules.add(p.id)}}),this.wrapper.releasePointerCapture(t.pointerId),this.drawCrossLine=!0,this.updateVirtualRect(),this.resetSelectionCanvas(),this.renderSelectionCanvas()}break}}function wi(t){const e=t.clientX-this.rect.x,o=t.clientY-this.rect.y;switch(this.mouseMovePoint.x=e,this.mouseMovePoint.y=o,this.manipulationStatus){case"selecting":this.resetSelectionCanvas(),this.renderSelectionCanvas();break;case"panning":break;case"dragging":this.editor.selectionManager.replace(this.handlingModules);break;case"resizing":break;case"rotating":break;case"static":t.ctrlKey||t.metaKey||t.shiftKey?this.editor.selectionManager.toggle(this.handlingModules):this.editor.selectionManager.replace(this.handlingModules);break}this.handlingModules.clear(),this.manipulationStatus="static",X(this.selectionBox,{x:0,y:0,width:0,height:0},!1)}function Ci(t){if(!(this.manipulationStatus==="panning"||this.manipulationStatus==="selecting")&&t.code==="Space"){this.spaceKeyDown=!0,this.wrapper.style.cursor="grabbing";return}}function Mi(t){t.code==="Space"&&(this.spaceKeyDown=!1,this.wrapper.style.cursor="default")}function Si(t){if(t.target!==this.wrapper)return;t.preventDefault(),t.stopPropagation();const{zooming:e,panning:o,zoomFactor:s,translateX:l,translateY:i}=ji(t);console.log(e,o),this.zooming=e,e?this.scale(s):o&&this.translateViewport(l,i),this.updateVirtualRect()}const ji=(()=>{let t;const s=[];let l=!1,i=!1,r=!1,a=0,c=0,u=0;return d=>{s.push(d),s.length>3&&s.shift(),clearTimeout(t);const{deltaX:p,deltaY:f}=d;if(l)a=f>0?-.1:.1;else if(c=-p,u=-f,d.altKey)l=!0,a=f>0?-.1:.1;else if(s.length>=3){const g=s.every(m=>m.deltaX===-0),v=s.every(m=>te(m.deltaY)),x=s.every(m=>Math.abs(m.deltaY)>4),y=s.every(m=>Math.abs(m.deltaX)>=40&&R(m.deltaX)&&m.deltaY===-0);g&&v?x?(r=!0,u=-f):(a=f>0?-.1:.1,l=!0):y&&(r=!0,c=-p)}else R(p)&&R(f)&&(i=!0,c=-p,u=-f);return t=setTimeout(()=>{l=!1,i=!1,r=!1,a=0,c=-p,u=-f,s.length=0},200),{zooming:l,panning:i,scrolling:r,zoomFactor:a,translateX:c,translateY:u}}})();function R(t){return!te(t)}function te(t){return Math.abs(t)%1!==0}function Ni(t){const e="editor-contextmenu-dom",o=document.createElement("div"),s=()=>{window.removeEventListener("mousedown",s),o.remove()};window.addEventListener("mousedown",s),o.dataset.name=e,o.style.position="fixed",o.style.top=t.clientY+"px",o.style.left=t.clientX+"px",o.style.backgroundColor="#dfdfdf",o.style.padding="10px 10px",o.style.width="200px",o.style.height="auto",o.style.boxShadow="rgb(194 194 194) 0px 0px 1px 1px",o.innerHTML=`
    <div>
      <div>Undo</div>
      <div>Redo</div>
      <div>Paste</div>
      <div>Select All</div>
    </div>
  `,this.wrapper.append(o),t.preventDefault(),t.stopPropagation()}const K=(t,e,o,{x:s,y:l})=>{const i=[o,0,0,o,s*e,l*e];t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width*2,t.canvas.height*2),t.setTransform(...i)},Fi=(t,e)=>{let o=e;o.length>1e3&&(o=e.map(l=>({...l,x:Math.floor(l.x),y:Math.floor(l.y)})));const s=q(o);t.save(),s.forEach(({x:l,y:i,r1:r,r2:a,fillColor:c="",lineColor:u="",lineWidth:d=1,opacity:p=100,gradient:f,rotation:g=0,dashLine:v=""})=>{t.save(),t.translate(l,i),g!==0&&t.rotate(g*Math.PI/180),p>0&&(t.fillStyle=c,t.globalAlpha=p/100),d>0&&(t.lineWidth=d,t.strokeStyle=u,t.lineJoin="round"),t.beginPath(),t.ellipse(0,0,r,a,0,0,Math.PI*2),v?t.setLineDash([3,5]):t.setLineDash([]),t.closePath(),p>0&&t.fill(),d>0&&t.stroke(),f&&(t.fillStyle=f,p>0&&t.fill()),t.restore()})};function $i(){const{selectionCTX:t,editor:e,dpr:o,offset:s,virtualRect:l,zoom:i,mouseMovePoint:r}=this,{selectionManager:a}=e;a.selectedModules.size;const c=u=>{const d=a.resizeHandleSize/2,p=[],f=[],g="#5491f8",v="#5491f8";u.forEach(x=>{const{x:y,y:m,width:C,height:j,rotation:N,lineWidth:z}=x.getDetails(),E=gi(y,m,C,j,N);f.push(...E.map(w=>({...w,r1:d,r2:d,fillColor:g,lineColor:"#fff"}))),p.push({x:y,y:m,width:C,height:j,fillColor:g,lineColor:v,lineWidth:z,rotation:N,opacity:0,dashLine:"dash"})}),Q(t,p),Fi(t,f),this.enableCrossLine&&this.drawCrossLine&&mi({ctx:t,mousePoint:r,scale:i,dpr:o,offset:s,virtualRect:l})};if(a.isSelectAll)c(a.editor.visibleModuleMap);else{const u=new Map;a.selectedModules.forEach(d=>{a.editor.visibleModuleMap.forEach(p=>{p.id===d&&u.set(p.id,p)})}),c(u)}}class Ei{constructor(e){h(this,"editor");h(this,"resizeInterval",17);h(this,"resizeObserver");h(this,"wrapper");h(this,"scrollBarX");h(this,"scrollBarY");h(this,"selectionBox");h(this,"selectionCanvas");h(this,"selectionCTX");h(this,"mainCanvas");h(this,"mainCTX");h(this,"eventsController");h(this,"dpr",2);h(this,"spaceKeyDown",!1);h(this,"hoveredModules",new Set);h(this,"handlingModules",new Set);h(this,"zooming",!1);h(this,"manipulationStatus","static");h(this,"mouseDownPoint",{x:0,y:0});h(this,"mouseMovePoint",{x:0,y:0});h(this,"offset",{x:0,y:0});h(this,"rect");h(this,"virtualRect",{x:0,y:0,width:0,height:0,top:0,right:0,bottom:0,left:0,centerX:0,centerY:0});h(this,"domResizing",!1);h(this,"resizeTimeout");h(this,"zoom",1);h(this,"enableCrossLine",!0);h(this,"drawCrossLine",!1);const{scrollBarX:o,scrollBarY:s}=ui(),l=document.createElement("canvas"),i=document.createElement("canvas"),r=l.getContext("2d"),a=i.getContext("2d");this.selectionCanvas=l,this.mainCanvas=i,this.selectionCTX=r,this.mainCTX=a,this.editor=e,this.scrollBarX=o,this.scrollBarY=s,this.selectionBox=document.createElement("div"),this.wrapper=document.createElement("div"),this.resizeThrottle=this.resizeThrottle.bind(this),this.resizeObserver=new ResizeObserver(this.resizeThrottle),this.updateCanvasSize=this.updateCanvasSize.bind(this),this.eventsController=new AbortController,this.init()}init(){this.updateCanvasSize(),hi.call(this),this.resizeObserver.observe(this.editor.container),this.setupEvents()}setupEvents(){const{signal:e}=this.eventsController;window.addEventListener("mousedown",pi.bind(this),{signal:e}),window.addEventListener("mouseup",wi.bind(this),{signal:e}),window.addEventListener("keydown",Ci.bind(this),{signal:e}),window.addEventListener("keyup",Mi.bind(this),{signal:e}),window.addEventListener("wheel",Si.bind(this),{signal:e,passive:!1}),this.wrapper.addEventListener("pointermove",vi.bind(this),{signal:e}),this.wrapper.addEventListener("contextmenu",Ni.bind(this),{signal:e})}updateVirtualRect(){const{x:e,y:o}=this.screenToCanvas(0,0),{x:s,y:l}=this.screenToCanvas(this.rect.width,this.rect.height),i=s-e,r=l-o;this.virtualRect={x:e,y:o,width:i,height:r,centerX:e+i/2,centerY:o+r/2,top:o,right:s,bottom:l,left:e},this.editor.updateVisibleModuleMap(this.virtualRect)}scale(e){this.zoom+=e,this.zoom<.1&&(this.zoom=.1),this.zoom>10&&(this.zoom=10),this.updateVirtualRect(),this.render()}translateViewport(e,o){this.offset.x+=e,this.offset.y+=o,this.updateVirtualRect(),this.render()}updateScrollBar(){const{scrollBarX:e,scrollBarY:o}=this;J(e,o)}resizeThrottle(){clearTimeout(this.resizeTimeout),this.domResizing=!0,this.resizeTimeout=setTimeout(this.onResize.bind(this),this.resizeInterval)}onResize(){this.domResizing=!1,this.updateCanvasSize(),this.updateVirtualRect(),this.render()}updateCanvasSize(){this.rect=this.editor.container.getBoundingClientRect(),this.mainCanvas.width=this.rect.width*this.dpr,this.mainCanvas.height=this.rect.height*this.dpr,this.selectionCanvas.width=this.rect.width*this.dpr,this.selectionCanvas.height=this.rect.height*this.dpr}screenToCanvas(e,o){const{dpr:s,offset:l,zoom:i}=this;return ee(i,l.x*s,l.y*s,e*s,o*s)}resetMainCanvas(){K(this.mainCTX,this.dpr,this.zoom,this.offset)}resetSelectionCanvas(){K(this.selectionCTX,this.dpr,this.zoom,this.offset)}renderMainCanvas(){requestAnimationFrame(()=>{ci({ctx:this.mainCTX,modules:this.editor.visibleModuleMap})})}renderSelectionCanvas(){requestAnimationFrame(()=>{$i.call(this)})}render(){this.resetMainCanvas(),this.resetSelectionCanvas(),this.renderMainCanvas(),this.renderSelectionCanvas()}destroy(){clearTimeout(this.resizeTimeout),this.resizeObserver.disconnect(),this.eventsController.abort(),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.remove(),this.editor.container.innerHTML=""}}class Li{constructor({container:e,data:o,dpr:s=2,zoom:l=1,events:i={}}){h(this,"moduleCounter",0);h(this,"moduleMap");h(this,"visibleModuleMap");h(this,"id");h(this,"dpr");h(this,"container");h(this,"events",{});h(this,"action");h(this,"history");h(this,"selectionManager");h(this,"viewport");h(this,"zoom");h(this,"scale",1);this.moduleMap=o.modules.reduce((r,a)=>(r.set(a.id,a),r),new Map),this.visibleModuleMap=new Map,this.id=o.id,this.scale=s,this.events=i,this.container=e,this.viewport=new Ei(this),this.action=new ii(this),this.selectionManager=new Jl(this),this.history=new oi(this)}createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(e){const o=B(e),s=new Map,l=i=>{if(i.id||(i.id=this.createModuleId()),i.type==="rectangle")return new li(i);if(i.type==="connector")return new ni(i)};return o.forEach(i=>{const r=l.call(this,i);s.set(i.id,r)}),s}batchAdd(e,o){var s,l;if(e.forEach(i=>{this.moduleMap.set(i.id,i)}),o){const i=[...e.values()].map(r=>r.getDetails());this.history.add({type:o,modules:i,selectModules:new Set(i.map(r=>r.id))})}this.updateVisibleModuleMap(this.viewport.virtualRect),(l=(s=this.events).onModulesUpdated)==null||l.call(s,this.moduleMap),this.render()}batchCopy(e,o=!1,s){const l=[];let i=new Map;return e==="all"?i=this.moduleMap:$(e)==="set"&&e.forEach(r=>{const a=this.moduleMap.get(r);a&&i.set(r,a)}),i.forEach(r=>{const a=r.getDetails();o&&delete a.id,$(s)==="object"&&Object.assign(a,s),l.push(a)}),l}batchDelete(e,o){var l,i;let s=[];return e==="all"?(s=this.batchCopy("all"),this.moduleMap.clear()):$(e)==="set"&&(s=this.batchCopy(e),s.forEach(r=>{this.moduleMap.delete(r.id)})),o&&this.history.add({type:o,modules:s,selectModules:this.selectionManager.getSelected()}),this.updateVisibleModuleMap(this.viewport.virtualRect),this.render(),(i=(l=this.events).onModulesUpdated)==null||i.call(l,this.moduleMap),s}batchModify(e,o,s){var r,a,c,u;let l=null;const i=5;if(e==="all")l=this.moduleMap;else if($(e)==="set")l=this.getModulesByIdSet(e);else return!1;l.forEach(d=>{Object.keys(o).forEach(p=>{const f=o.code,g=o[p];f==="moveUp"?d.y-=i:f==="moveDown"?d.y+=i:f==="moveLeft"?d.x-=i:f==="moveRight"?d.x+=i:(typeof g=="string"||typeof g=="number")&&(d[p]=g)})}),this.selectionManager.render(),this.render(),(a=(r=this.events).onModulesUpdated)==null||a.call(r,this.moduleMap),(u=(c=this.events).onSelectionUpdated)==null||u.call(c,this.selectionManager.selectedModules,this.selectionManager.getIfUnique()),s&&this.history.add({type:s,modules:[...l.values()].map(d=>d.getDetails()),selectModules:this.selectionManager.getSelected()})}batchReplaceModules(e){ri.bind(this,e)}getModulesByLayerIndex(){}getModulesByIdSet(e){const o=new Map;return e.forEach(s=>{const l=this.moduleMap.get(s);l&&o.set(s,l)}),o}getModuleList(){return[...Object.values(this.moduleMap)]}updateVisibleModuleMap(e){this.visibleModuleMap.clear(),this.moduleMap.forEach(o=>{const s=o.getBoundingRect();fi(s,e)&&this.visibleModuleMap.set(o.id,o)})}execute(e,o=null){this.action.dispatcher(e,o)}render(){this.viewport.render()}destroy(){this.action.destroy(),this.selectionManager.destroy(),this.history.destroy(),this.moduleMap.clear(),this.action=null,this.selectionManager=null,this.crossLine=null,this.history=null,this.moduleMap=null,this.canvas=null,this.ctx=null,this.dpr=null,this.zoom=null,this.id=null,this.events=null,this.container=null}}const S=b.createContext({focused:!1,historyArray:[],historyCurrent:{},selectedModules:[],selectedProps:{},editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{}}),ki=()=>{const{executeAction:t,focused:e}=b.useContext(S),o=s=>{let l=null;const{key:i,ctrlKey:r,metaKey:a,shiftKey:c}=s,u={ArrowUp:"moveUp",ArrowDown:"moveDown",ArrowLeft:"moveLeft",ArrowRight:"moveRight"};i==="a"&&(r||a)&&(l="selectAll"),i==="c"&&(r||a)&&!c&&(l="copy"),i==="v"&&(r||a)&&(l="paste"),i==="d"&&(r||a)&&(l="duplicate"),(i==="Delete"||i==="Backspace")&&(l="delete"),i==="Escape"&&(l="escape"),i==="z"&&(r||a)&&(l="undo"),i==="z"&&c&&(r||a)&&(l="redo"),u[i]&&(l=u[i]),l&&(t(l),s.stopPropagation(),s.preventDefault())};return b.useEffect(()=>{if(e)return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),null},Ti=[{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50}],Di=()=>{const{editorRef:t}=b.useContext(S);return b.useEffect(()=>{t.current&&console.log("editorRef.current updated:",t.current)},[t]),n.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:Ti.map((e,o)=>n.jsx("div",{className:"shrink-0 select-none cursor-move",style:{width:e.width,height:e.height,border:"1px solid #dfdfdf"},onMouseEnter:()=>{}},o))})},zi=({className:t=""})=>{const[e,o]=b.useState(300),s=b.useRef(!1),l=b.useRef(null),i=b.useCallback(c=>{c.preventDefault(),s.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),r=b.useCallback(c=>{if(!s.current)return;const u=window.innerWidth*.9,d=Math.min(Math.max(0,c.clientX),u);c.stopPropagation(),o(d)},[]),a=b.useCallback(c=>{s.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",c.stopPropagation()},[]);return b.useEffect(()=>(window.addEventListener("mousemove",r),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a)}),[r,a]),n.jsxs("div",{ref:l,style:{width:`${e}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[n.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${t}`,children:[n.jsx("span",{children:"Module List"}),n.jsx(Di,{})]}),n.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:i})]})},Ai={zoom:1},oe=P({name:"statusBar",initialState:Ai,reducers:{setZoom:(t,e)=>{t.zoom=e.payload}}}),{setZoom:Z}=oe.actions,Ri=oe.reducer,Bi=()=>{const t=[4,3,2,1.5,1.25,1,.75,.5,.25,"fit window"],{zoom:e}=O(d=>d.statusBar),o=he(),[s,l]=b.useState(!1),i=b.useRef(null),r=d=>{c(i.current.value),i.current.blur(),d.preventDefault(),d.stopPropagation()},a=d=>{d.key==="Enter"&&(c(i.current.value),i.current.blur(),d.preventDefault(),d.stopPropagation())},c=d=>{const p=d.match(/\d+/);if(p){const f=parseFloat(p[0]);o(Z(f)),u(f)}},u=d=>{i.current.value=d*100+"%"};return n.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[n.jsx("input",{type:"text",ref:i,defaultValue:e*100+"%",onBlur:r,onKeyDown:a,className:"w-12 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),n.jsx("button",{onClick:()=>l(!s),className:"text-gray-800 flex trasition items-center cursor-pointer",children:s?n.jsx(ue,{className:"w-5 h-5"}):n.jsx(pe,{className:"w-5 h-5"})}),s&&n.jsx("div",{className:"fixed w-full h-full",onClick:()=>{l(!1)}}),s&&n.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:t.map(d=>n.jsx("div",{onClick:()=>{let p=d;p==="fit window"&&(p=1),o(Z(p)),l(!1),u(p)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:d==="fit window"?d:`${d*100}%`},d))})]})},Pi=({className:t=""})=>n.jsx("footer",{className:t+"w-full h-8 flex items-center border-t border-gray-200",children:n.jsx(Bi,{})}),Oi=({data:t,selected:e,handleSelectModule:o})=>{const s=b.useRef(null),l=b.useRef(null);return b.useEffect(()=>{var i;(i=l.current)==null||i.scrollIntoView({block:"nearest",inline:"nearest"})},[e]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Layer"})}),n.jsx("div",{ref:s,className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:t==null?void 0:t.map((i,r)=>n.jsx("div",{ref:e!=null&&e.includes(i.id)?l:null,className:e!=null&&e.includes(i.id)?"bg-gray-400 text-white":"",onClick:()=>o(i.id),id:`layer-module-${i.id}`,children:i.type},r))})]})},se=({menu:t})=>{const{t:e}=k(),[o,s]=b.useState(!1),{executeAction:l}=b.useContext(S),i=()=>{console.log(t.id),!(t.children||o)&&(l(t.id),s(!1))},r=t.children&&t.children.length>0;return n.jsxs("div",{className:"relative h-8 hover:bg-gray-200 min-w-50",onClick:()=>i(),onMouseOver:a=>{s(!0),a.preventDefault()},onMouseLeave:()=>{s(!1)},children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center whitespace-nowrap",children:[n.jsx("span",{children:e(t.id+".label")}),r&&n.jsx(fe,{size:18})]}),r&&o&&n.jsx("div",{className:"absolute bg-white z-30 left-full top-0 w-auto border border-gray-200 box-border",children:t.children.map(a=>n.jsx(se,{menu:a},a.id))})]})},Ii=()=>{const[t,e]=b.useState(!1),[o,s]=b.useState(null),{t:l}=k(),i=b.useRef(null),r=O(c=>c.menu.actions),a=b.useMemo(()=>Ui(r),[r]);return b.useEffect(()=>{const c=u=>{i.current.contains(u.target)||(e(!1),s(null))};return window.addEventListener("click",c),()=>{window.removeEventListener("click",c)}}),n.jsx("div",{className:"h-8 text-sm select-none border-b border-gray-200 box-border",children:n.jsx("div",{ref:i,className:"pl-2 h-full inline-flex",children:a.map(c=>{var u;return n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:`h-full inline-flex items-center px-4 ${c.id===o?"bg-gray-200":""}`,onMouseEnter:()=>t&&s(c.id),onClick:()=>{o!==c.id?(e(!0),s(c.id)):(s(null),e(!1))},title:l(c.id+".tooltip"),children:n.jsx("span",{children:l(c.id+".label")})}),t&&c.id===o&&c.children.length>0&&n.jsx("div",{className:"absolute z-20 bg-white border border-gray-200",children:(u=c.children)==null?void 0:u.map(d=>n.jsx(se,{menu:d},d.id))})]},c.id)})})})};function Ui(t){const e=new Map;Object.values(t).forEach(s=>{e.set(s.id,{...s,children:[]})});const o=[];return e.forEach(s=>{const l=e.get(s.parent);l?l.children.push(s):o.push(s)}),o}const T={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},D="#9b9a9a",Xi=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...T,...e,children:[n.jsx("path",{fill:D,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),n.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),n.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),Vi=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...T,...e,children:[n.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),n.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),n.jsx("path",{fill:D,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),Hi=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...T,...e,children:[n.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:D,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),Yi=({size:t=24,...e})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",...T,...e,children:[n.jsx("path",{fill:D,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),_i=({iconName:t,size:e})=>{switch(t){case"save":return n.jsx(Me,{size:e});case"undo":return n.jsx(Ce,{size:e});case"redo":return n.jsx(we,{size:e});case"trash":return n.jsx(ve,{size:e});case"cross":return n.jsx(ye,{size:e});case"group":return n.jsx(xe,{size:e});case"ungroup":return n.jsx(me,{size:e});case"lock":return n.jsx(ge,{size:e});case"unlock":return n.jsx(be,{size:e});default:return null}},F=20,L="text-black",Ki=()=>{const t=O(o=>o.toolbar.actions),{executeAction:e}=b.useContext(S);return n.jsx("div",{className:"border-b border-gray-200 box-border",children:n.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(t).map(o=>{const{id:s,icon:l,disabled:i,divide:r}=o;let a;switch(s){case"layerUp":a=n.jsx(Xi,{size:F,className:L});break;case"layerDown":a=n.jsx(Vi,{size:F,className:L});break;case"layerTop":a=n.jsx(Hi,{size:F,className:L});break;case"layerBottom":a=n.jsx(Yi,{size:F,className:L});break;default:a=n.jsx(_i,{size:F,iconName:l});break}return n.jsxs(b.Fragment,{children:[n.jsx("button",{type:"button",disabled:i,title:s,onClick:()=>{e(s)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6 opacity-50   hover:bg-gray-200  hover:opacity-100 disabled:text-gray-200 disabled:cursor-default",children:a}),r&&n.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},s)})})})},Zi=()=>n.jsxs("header",{children:[n.jsx(Ii,{}),n.jsx(Ki,{})]}),Gi=()=>{const{historyArray:t,historyCurrent:e,applyHistoryNode:o}=b.useContext(S),{t:s}=k(),l=b.useRef(null);return b.useEffect(()=>{if(l.current){const i=l.current,r=setTimeout(()=>{i.scrollIntoView({block:"nearest",inline:"nearest"})},0);return()=>{r&&clearTimeout(r)}}},[t,e]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-600 text-white px-2",children:n.jsx("span",{children:"History"})}),n.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:n.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:t.map((i,r)=>{const a=i===e,{label:c,tooltip:u}=s(i.data.type,{returnObjects:!0});return n.jsx("div",{title:u,ref:a?l:null,onClick:()=>{a||o(i)},className:`border-b border-gray-200 px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${a?"bg-gray-400 text-white":""}`,children:n.jsx("span",{children:c})},r)})})})]})},Wi=()=>{const{selectedProps:t}=b.useContext(S);return b.useEffect(()=>{},[t]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Properties"})}),n.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:t&&n.jsx(qi,{props:t})})]})},qi=({props:t})=>{const e=o=>{};return n.jsxs("div",{className:"z-30 text-sm",children:[n.jsxs("div",{className:"mb-4 ",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"X:"}),n.jsx("input",{type:"number",name:"x",value:t.x,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Y:"}),n.jsx("input",{type:"number",name:"y",value:t.y,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Width:"}),n.jsx("input",{type:"number",name:"width",value:t.width,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Height:"}),n.jsx("input",{type:"number",name:"height",value:t.height,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Radius:"}),n.jsx("input",{type:"number",name:"radius",value:t.radius,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Fill"}),n.jsx("input",{type:"checkbox",name:"enableFill",checked:t.enableFill,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Fill Color:"}),n.jsx("input",{type:"color",name:"fillColor",value:t.fillColor,onChange:e,className:"w-10 h-10 p-1 rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Line"}),n.jsx("input",{type:"checkbox",name:"enableLine",checked:t.enableLine,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Line Color:"}),n.jsx("input",{type:"color",name:"lineColor",value:t.lineColor,onChange:e,className:"w-10 h-10 p-1 rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Shadow"}),n.jsx("input",{type:"checkbox",name:"shadow",checked:t.shadow,onChange:e,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Opacity:"}),n.jsx("input",{type:"number",name:"opacity",value:t.opacity,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Layer:"}),n.jsx("input",{type:"number",name:"layer",value:t.layer,onChange:e,className:"w-16 px-2 py-1 text-black rounded"})]})]})]})},Qi=({file:t})=>{const e=b.useRef(null),o=b.useRef(null),[s,l]=b.useState([]),[i,r]=b.useState([]),[a,c]=b.useState(null),[u,d]=b.useState([]),[p,f]=b.useState({}),g=b.useRef(null),[v,x]=b.useState(!0);b.useEffect(()=>{let w;if(o.current){const A=I();w=new Li({container:o.current,data:{id:A,modules:[]},events:{onHistoryUpdated:j,onModulesUpdated:N,onSelectionUpdated:C}}),Ji(w),e.current=w}const M=g.current;return M&&(M.addEventListener("focus",y),M.addEventListener("blur",m)),()=>{M&&(M.removeEventListener("focus",y),M.removeEventListener("blur",m)),w&&w.destroy()}},[t]);const y=()=>x(!0),m=()=>x(!1),C=(w,M)=>{d(Array.from(w)),c(M)},j=w=>{l(w.toArray()),w.current&&f(w.current)},N=w=>{const M=Array.from(w.values()).sort((A,ne)=>A.layer-ne.layer);r(M)},z=w=>{e.current&&e.current.history.moveCurrentById(w)},E=(w,M=null)=>{e.current.execute(w,M)};return n.jsx(S.Provider,{value:{focused:v,historyArray:s,selectedModules:u,selectedProps:a,historyCurrent:p,editorRef:e,applyHistoryNode:z,executeAction:E},children:n.jsxs("div",{ref:g,"data-focused":v,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[n.jsx(ki,{}),n.jsx(Zi,{}),n.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[n.jsx(zi,{}),n.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[n.jsx("div",{ref:o,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),n.jsx(Pi,{})]}),n.jsxs("div",{className:"w-[40%] h-full border-l border-gray-200",children:[n.jsx(Wi,{}),n.jsx(Oi,{data:i,selected:u,handleSelectModule:w=>{E("select",new Set([w]))}}),n.jsx(Gi,{})]})]})]})})},Ji=t=>{const s={type:"rectangle",x:100,y:100,width:100,height:100,enableLine:!0,lineColor:"#000000",lineWidth:2,enableFill:!0,fillColor:"#fff",opacity:100,shadow:!1,radius:0,rotation:0},l=1e3,i=30;t.batchAdd(t.batchCreate(Array.from({length:l}).map((r,a)=>({...s,fillColor:"#9c4444",x:100+a*i,y:100+a*i,layer:a+1,rotation:a+10}))),"addModules")},en=t=>[],tn=()=>{const t="Untitled 1",e={},o={modules:en()};return{id:I(),name:t,config:e,data:o}},on=t=>new Map(t.reduce((e,o)=>(e.push([o.id,o]),e),[])),sn=tn(),G=on([sn]),ln=()=>{const t=' group py-2 px-6 relative transition flex items-center">',e=" border-b-2 border-black-600",o=" hover:bg-gray-200",{fileList:s,currentFileId:l,closeFile:i,switchFile:r,handleCreating:a}=b.useContext(U);return n.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[s.map(c=>{const u=c.id===l,d=t+(u?e:o),p=(u?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return n.jsxs("div",{className:d,onClick:()=>{r(c.id)},children:[n.jsx("span",{children:c.name}),n.jsx("span",{onClick:f=>{i(c.id),f.preventDefault(),f.stopPropagation()},className:p,children:"×"})]},c.id)}),n.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:n.jsx(Se,{size:18,onClick:()=>{a(!0)}})})]})},nn=({children:t,defaultValue:e})=>{const[o,s]=b.useState(!1);return n.jsxs("div",{className:"relative w-20",children:[n.jsxs("div",{className:"flex items-center",onClick:()=>{s(!o)},children:[n.jsx(je,{}),e]}),o&&n.jsx("div",{onClick:()=>{s(!1)},className:"absolute top-full right-0 w-full",children:t})]})},rn=()=>{const[t,e]=b.useState("en"),o={en:"English",cn:"中文",jp:"日本語"},{i18n:s}=k();return n.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:n.jsx(nn,{defaultValue:o[t],children:Object.keys(o).map((l,i)=>n.jsx("div",{onClick:()=>{s.changeLanguage(l),e(l)},children:o[l]},i))})})},an=()=>{const t=b.useRef(new Map),[e,o]=b.useState(!1),[s,l]=b.useState(""),[i,r]=b.useState([]),a=t.current.size,c=a===0||e;b.useEffect(()=>{G.size>0&&(t.current=G,u(),l(d()[0].id))},[]);const u=()=>{const x=d();return r(x),x},d=()=>Array.from(t.current.values()),p=x=>{l(x)},f=x=>{const y=i.findIndex(C=>C.id===x);let m=i.length;if(y!==-1&&(t.current.delete(x),u(),i.splice(y,1),m--,s===x&&m>0)){let C=y+1;y===0&&(C=0),C>m&&(C=m-1),l(i[C].id)}},g=x=>{t.current.set(x.id,x),u(),l(x.id)},v=x=>{o(x)};return n.jsx(U.Provider,{value:{fileMap:t.current,fileList:i,creating:e,currentFileId:s,switchFile:p,closeFile:f,createFile:g,handleCreating:v},children:n.jsxs("div",{className:"w-full h-full flex flex-col",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx(ln,{}),n.jsx(rn,{})]}),n.jsx("div",{className:"flex-1 overflow-hidden",children:i.map(x=>x.id===s?n.jsx(Qi,{file:x},x.id):void 0)}),c&&n.jsx(Ql,{bg:a?"#00000080":"#fff",onBgClick:()=>{a&&o(!1)}})]})})};function cn(){return n.jsx(an,{})}const dn=[{id:"file",parent:null},{id:"newFile",parent:"file",shortcut:"Ctrl+N"},{id:"openFile",parent:"file",shortcut:"Ctrl+O"},{id:"saveFile",parent:"file",shortcut:"Ctrl+S"},{id:"saveAs",parent:"file"},{id:"importFile",parent:"file"},{id:"exportFile",parent:"file"},{id:"print",parent:"file"},{id:"closeFile",parent:"file"},{id:"exportFile_png",parent:"exportFile"},{id:"exportFile_pdf",parent:"exportFile"},{id:"exportFile_csv",parent:"exportFile"},{id:"edit",parent:null},{id:"undo",parent:"edit",shortcut:"Ctrl+Z"},{id:"redo",parent:"edit",shortcut:"Ctrl+Y"},{id:"cut",parent:"edit",shortcut:"Ctrl+X"},{id:"copy",parent:"edit",shortcut:"Ctrl+C"},{id:"paste",parent:"edit",shortcut:"Ctrl+V"},{id:"delete",parent:"edit",shortcut:"Del"},{id:"duplicate",parent:"edit",shortcut:"Ctrl+D"},{id:"selectAll",parent:"edit",shortcut:"Ctrl+A"},{id:"findReplace",parent:"edit",shortcut:"Ctrl+F"},{id:"view",parent:null},{id:"zoomIn",parent:"view",shortcut:"Ctrl++"},{id:"zoomOut",parent:"view",shortcut:"Ctrl+-"},{id:"fitToScreen",parent:"view"},{id:"toggleGrid",parent:"view"},{id:"toggleGuides",parent:"view"},{id:"fullscreenMode",parent:"view",shortcut:"F11"},{id:"shape",parent:null},{id:"addNode",parent:"shape"},{id:"deleteNode",parent:"shape"},{id:"moveNode",parent:"shape"},{id:"resizeNode",parent:"shape"},{id:"rotateNode",parent:"shape"},{id:"changeNodeColor",parent:"shape"},{id:"changeNodeBorder",parent:"shape"},{id:"changeNodeText",parent:"shape"},{id:"groupNodes",parent:"shape"},{id:"ungroupNodes",parent:"shape"},{id:"lockNode",parent:"shape"},{id:"unlockNode",parent:"shape"},{id:"connection",parent:null},{id:"addEdge",parent:"connection"},{id:"deleteEdge",parent:"connection"},{id:"changeEdgeStyle",parent:"connection"},{id:"changeEdgeColor",parent:"connection"},{id:"changeEdgeLabel",parent:"connection"},{id:"reverseEdge",parent:"connection"},{id:"text",parent:null},{id:"addText",parent:"text"},{id:"editText",parent:"text"},{id:"changeFont",parent:"text"},{id:"changeFontSize",parent:"text"},{id:"changeFontColor",parent:"text"},{id:"boldText",parent:"text",shortcut:"Ctrl+B"},{id:"italicText",parent:"text",shortcut:"Ctrl+I"},{id:"underlineText",parent:"text",shortcut:"Ctrl+U"},{id:"alignText",parent:"text"},{id:"layer",parent:null},{id:"sendToBack",parent:"layer"},{id:"bringToFront",parent:"layer"},{id:"sendBackward",parent:"layer"},{id:"bringForward",parent:"layer"},{id:"duplicateLayer",parent:"layer"},{id:"deleteLayer",parent:"layer"},{id:"toggleLayerVisibility",parent:"layer"}],hn={actions:Object.fromEntries(dn.map(t=>[t.id,{...t,disabled:!1}]))},le=P({name:"menu",initialState:hn,reducers:{setDisabled:(t,e)=>{t.actions[e.payload.id]&&(t.actions[e.payload.id].disabled=e.payload.disabled)},triggerAction:(t,e)=>{const o=t.actions[e.payload];o&&o.disabled}}}),{setDisabled:yn,triggerAction:vn}=le.actions,un=le.reducer,pn=[{id:"save",icon:"save",disabled:!0,divide:!0},{id:"undo",icon:"undo",disabled:!0},{id:"redo",icon:"redo",disabled:!0,divide:!0},{id:"delete",icon:"trash",disabled:!1},{id:"add",icon:"cross",disabled:!1,divide:!0},{id:"layerUp",icon:"layers",disabled:!1},{id:"layerDown",icon:"layers",disabled:!1},{id:"layerTop",icon:"layers",disabled:!1},{id:"layerBottom",icon:"layers",disabled:!1,divide:!0},{id:"group",icon:"group",disabled:!0},{id:"ungroup",icon:"ungroup",disabled:!0,divide:!0},{id:"lock",icon:"lock",disabled:!1},{id:"unlock",icon:"unlock",disabled:!0}],fn={actions:Object.fromEntries(pn.map(t=>[t.id,{...t,disabled:!1}]))},ie=P({name:"menu",initialState:fn,reducers:{setDisabled:(t,e)=>{t.actions[e.payload.id]&&(t.actions[e.payload.id].disabled=e.payload.disabled)},triggerAction:(t,e)=>{const o=t.actions[e.payload];o&&o.disabled}}}),{setDisabled:wn,triggerAction:Cn}=ie.actions,bn=ie.reducer,gn=Ne({reducer:{menu:un,toolbar:bn,statusBar:Ri}});Fe.createRoot(document.getElementById("root")).render(n.jsx($e,{store:gn,children:n.jsx(cn,{})}));
