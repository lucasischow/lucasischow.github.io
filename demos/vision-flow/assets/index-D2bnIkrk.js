var Ae=Object.defineProperty;var Te=(s,o,e)=>o in s?Ae(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var x=(s,o,e)=>Te(s,typeof o!="symbol"?o+"":o,e);import{i as Re,a as Ie,r as y,j as a,L as Oe,b as Be,u as Q,c as Se,d as We,e as Xe,f as Ve,g as Ye,h as Ue,k as He,l as _e,m as Ke,n as Ge,t as Ze,o as qe,p as Je,q as Qe}from"./vendor-C3purDYN.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();const et={label:"File",tooltip:"Open the file menu"},tt={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},ot={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},st={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},it={label:"Save As",tooltip:"Save the current file with a new name"},lt={label:"Import File",tooltip:"Import a file into the project"},nt={label:"Export",tooltip:"Export the current file"},rt={label:"Export as PNG",tooltip:"Export the file as a PNG image"},at={label:"Export as PDF",tooltip:"Export the file as a PDF document"},ct={label:"Export as CSV",tooltip:"Export the file as a CSV file"},dt={label:"Print",tooltip:"Print the current file"},ht={label:"Close File",tooltip:"Close the current file"},ut={label:"Edit",tooltip:"Open the edit menu"},pt={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},ft={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},mt={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},yt={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},bt={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},gt={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},xt={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},wt={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},vt={label:"View",tooltip:"Open the view menu"},Ct={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},Mt={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},St={label:"Fit to Screen",tooltip:"Fit the content to the screen"},jt={label:"Toggle Grid",tooltip:"Show or hide the grid"},Nt={label:"Toggle Guides",tooltip:"Show or hide the guides"},Ft={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},Pt={label:"Shape",tooltip:"Open the shape menu"},kt={label:"Add Node",tooltip:"Add a new node to the diagram"},$t={label:"Delete Node",tooltip:"Delete the selected node"},Dt={label:"Move Node",tooltip:"Move the selected node"},zt={label:"Resize Node",tooltip:"Resize the selected node"},Lt={label:"Rotate Node",tooltip:"Rotate the selected node"},Et={label:"Change Node Color",tooltip:"Change the color of the selected node"},At={label:"Change Node Border",tooltip:"Change the border of the selected node"},Tt={label:"Change Node Text",tooltip:"Edit the text of the selected node"},Rt={label:"Group Nodes",tooltip:"Group selected nodes together"},It={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},Ot={label:"Lock Node",tooltip:"Lock the selected node"},Bt={label:"Unlock Node",tooltip:"Unlock the selected node"},Wt={label:"Connection",tooltip:"Open the connection menu"},Xt={label:"Add Edge",tooltip:"Add an edge between nodes"},Vt={label:"Delete Edge",tooltip:"Delete the selected edge"},Yt={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},Ut={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},Ht={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},_t={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},Kt={label:"Text",tooltip:"Open the text menu"},Gt={label:"Add Text",tooltip:"Add text to the document"},Zt={label:"Edit Text",tooltip:"Edit the selected text"},qt={label:"Change Font",tooltip:"Change the font of the selected text"},Jt={label:"Change Font Size",tooltip:"Change the font size of the selected text"},Qt={label:"Change Font Color",tooltip:"Change the font color of the selected text"},eo={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},to={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},oo={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},so={label:"Align Text",tooltip:"Align the selected text"},io={label:"Layer",tooltip:"Open the layer menu"},lo={label:"Send to Back",tooltip:"Send the selected layer to the back"},no={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},ro={label:"Send Backward",tooltip:"Send the selected layer one step backward"},ao={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},co={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},ho={label:"Delete Layer",tooltip:"Delete the selected layer"},uo={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},po={label:"Collaboration",tooltip:"Open the collaboration menu"},fo={label:"Add Comment",tooltip:"Add a comment to the document"},mo={label:"Edit Comment",tooltip:"Edit the selected comment"},yo={label:"Delete Comment",tooltip:"Delete the selected comment"},bo={label:"Share Document",tooltip:"Share the document with others"},go={file:et,newFile:tt,openFile:ot,saveFile:st,saveAs:it,importFile:lt,exportFile:nt,exportFile_png:rt,exportFile_pdf:at,exportFile_csv:ct,print:dt,closeFile:ht,edit:ut,undo:pt,redo:ft,cut:mt,copy:yt,paste:bt,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:gt,selectAll:xt,findReplace:wt,view:vt,zoomIn:Ct,zoomOut:Mt,fitToScreen:St,toggleGrid:jt,toggleGuides:Nt,fullscreenMode:Ft,shape:Pt,addNode:kt,deleteNode:$t,moveNode:Dt,resizeNode:zt,rotateNode:Lt,changeNodeColor:Et,changeNodeBorder:At,changeNodeText:Tt,groupNodes:Rt,ungroupNodes:It,lockNode:Ot,unlockNode:Bt,connection:Wt,addEdge:Xt,deleteEdge:Vt,changeEdgeStyle:Yt,changeEdgeColor:Ut,changeEdgeLabel:Ht,reverseEdge:_t,text:Kt,addText:Gt,editText:Zt,changeFont:qt,changeFontSize:Jt,changeFontColor:Qt,boldText:eo,italicText:to,underlineText:oo,alignText:so,layer:io,sendToBack:lo,bringToFront:no,sendBackward:ro,bringForward:ao,duplicateLayer:co,deleteLayer:ho,toggleLayerVisibility:uo,collaboration:po,addComment:fo,editComment:mo,deleteComment:yo,shareDocument:bo},xo={"history-init":{label:"Init",tooltip:"Initialize the file"},"history-add":{label:"Add",tooltip:"Add modules to the file"},"history-delete":{label:"Delete",tooltip:"Delete modules from the file"},"history-paste":{label:"Paste",tooltip:"Paste modules into the file"},"history-duplicate":{label:"Duplicate",tooltip:"Duplicate selected modules"},"history-modify":{label:"Modify",tooltip:"Modify the properties of modules"},"history-move":{label:"Move",tooltip:"Move modules"},"history-reorder":{label:"Reorder",tooltip:"Reorder modules"},"history-select":{label:"Select",tooltip:"Select modules"},"history-group":{label:"Group",tooltip:"Group modules"},"history-ungroup":{label:"Ungroup",tooltip:"Ungroup modules"},"history-composite":{label:"Composite",tooltip:"Composite operation"}},wo={history:xo},vo={label:"文件",tooltip:"打开文件菜单"},Co={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},Mo={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},So={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},jo={label:"另存为",tooltip:"以新名称保存当前文件"},No={label:"导入文件",tooltip:"将文件导入到项目中"},Fo={label:"导出",tooltip:"导出当前文件"},Po={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},ko={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},$o={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},Do={label:"打印",tooltip:"打印当前文件"},zo={label:"关闭文件",tooltip:"关闭当前文件"},Lo={label:"编辑",tooltip:"打开编辑菜单"},Eo={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},Ao={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},To={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},Ro={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},Io={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},Oo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},Bo={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},Wo={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},Xo={label:"视图",tooltip:"打开视图菜单"},Vo={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},Yo={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},Uo={label:"适应屏幕",tooltip:"使内容适应屏幕"},Ho={label:"切换网格",tooltip:"显示或隐藏网格"},_o={label:"切换参考线",tooltip:"显示或隐藏参考线"},Ko={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},Go={label:"形状",tooltip:"打开形状菜单"},Zo={label:"添加节点",tooltip:"向图表添加新节点"},qo={label:"删除节点",tooltip:"删除选定的节点"},Jo={label:"移动节点",tooltip:"移动选定的节点"},Qo={label:"调整节点大小",tooltip:"调整选定节点的大小"},es={label:"旋转节点",tooltip:"旋转选定的节点"},ts={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},os={label:"更改节点边框",tooltip:"更改选定节点的边框"},ss={label:"更改节点文本",tooltip:"编辑选定节点的文本"},is={label:"组合节点",tooltip:"将选定的节点组合在一起"},ls={label:"取消组合节点",tooltip:"取消组合选定的节点"},ns={label:"锁定节点",tooltip:"锁定选定的节点"},rs={label:"解锁节点",tooltip:"解锁选定的节点"},as={label:"连接",tooltip:"打开连接菜单"},cs={label:"添加边",tooltip:"在节点之间添加边"},ds={label:"删除边",tooltip:"删除选定的边"},hs={label:"更改边样式",tooltip:"更改选定边的样式"},us={label:"更改边颜色",tooltip:"更改选定边的颜色"},ps={label:"更改边标签",tooltip:"更改选定边的标签"},fs={label:"反转边",tooltip:"反转选定边的方向"},ms={label:"文本",tooltip:"打开文本菜单"},ys={label:"添加文本",tooltip:"向文档添加文本"},bs={label:"编辑文本",tooltip:"编辑选定的文本"},gs={label:"更改字体",tooltip:"更改选定文本的字体"},xs={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},ws={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},vs={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},Cs={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},Ms={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},Ss={label:"对齐文本",tooltip:"对齐选定的文本"},js={label:"图层",tooltip:"打开图层菜单"},Ns={label:"置于底层",tooltip:"将选定的图层置于底层"},Fs={label:"置于顶层",tooltip:"将选定的图层置于顶层"},Ps={label:"下移一层",tooltip:"将选定的图层下移一层"},ks={label:"上移一层",tooltip:"将选定的图层上移一层"},$s={label:"复制图层",tooltip:"复制选定的图层"},Ds={label:"删除图层",tooltip:"删除选定的图层"},zs={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},Ls={label:"协作",tooltip:"打开协作菜单"},Es={label:"添加评论",tooltip:"向文档添加评论"},As={label:"编辑评论",tooltip:"编辑选定的评论"},Ts={label:"删除评论",tooltip:"删除选定的评论"},Rs={label:"分享文档",tooltip:"与他人分享文档"},Is={file:vo,newFile:Co,openFile:Mo,saveFile:So,saveAs:jo,importFile:No,exportFile:Fo,exportFile_png:Po,exportFile_pdf:ko,exportFile_csv:$o,print:Do,closeFile:zo,edit:Lo,undo:Eo,redo:Ao,cut:To,copy:Ro,paste:Io,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:Oo,selectAll:Bo,findReplace:Wo,view:Xo,zoomIn:Vo,zoomOut:Yo,fitToScreen:Uo,toggleGrid:Ho,toggleGuides:_o,fullscreenMode:Ko,shape:Go,addNode:Zo,deleteNode:qo,moveNode:Jo,resizeNode:Qo,rotateNode:es,changeNodeColor:ts,changeNodeBorder:os,changeNodeText:ss,groupNodes:is,ungroupNodes:ls,lockNode:ns,unlockNode:rs,connection:as,addEdge:cs,deleteEdge:ds,changeEdgeStyle:hs,changeEdgeColor:us,changeEdgeLabel:ps,reverseEdge:fs,text:ms,addText:ys,editText:bs,changeFont:gs,changeFontSize:xs,changeFontColor:ws,boldText:vs,italicText:Cs,underlineText:Ms,alignText:Ss,layer:js,sendToBack:Ns,bringToFront:Fs,sendBackward:Ps,bringForward:ks,duplicateLayer:$s,deleteLayer:Ds,toggleLayerVisibility:zs,collaboration:Ls,addComment:Es,editComment:As,deleteComment:Ts,shareDocument:Rs},Os={"history-init":{label:"初始化",tooltip:"初始化文件"},"history-add":{label:"添加",tooltip:"向文件添加模块"},"history-delete":{label:"删除",tooltip:"从文件中删除模块"},"history-paste":{label:"粘贴",tooltip:"将模块粘贴到文件中"},"history-duplicate":{label:"复制",tooltip:"复制选定的模块"},"history-modify":{label:"修改",tooltip:"修改模块的属性"},"history-move":{label:"移动",tooltip:"移动模块"},"history-reorder":{label:"重新排序",tooltip:"重新排序模块"},"history-select":{label:"选择",tooltip:"选择模块"},"history-group":{label:"组合",tooltip:"组合模块"},"history-ungroup":{label:"取消组合",tooltip:"取消模块组合"},"history-composite":{label:"复合操作",tooltip:"复合操作"}},Bs={history:Os},Ws={label:"ファイル",tooltip:"ファイルメニューを開く"},Xs={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},Vs={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},Ys={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},Us={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},Hs={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},_s={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Ks={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},Gs={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},Zs={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},qs={label:"印刷",tooltip:"現在のファイルを印刷"},Js={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Qs={label:"編集",tooltip:"編集メニューを開く"},ei={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},ti={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},oi={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},si={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},ii={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},li={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},ni={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},ri={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},ai={label:"表示",tooltip:"表示メニューを開く"},ci={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},di={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},hi={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},ui={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},pi={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},fi={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},mi={label:"図形",tooltip:"図形メニューを開く"},yi={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},bi={label:"ノードを削除",tooltip:"選択したノードを削除"},gi={label:"ノードを移動",tooltip:"選択したノードを移動"},xi={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},wi={label:"ノードを回転",tooltip:"選択したノードを回転"},vi={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},Ci={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},Mi={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},Si={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},ji={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},Ni={label:"ノードをロック",tooltip:"選択したノードをロック"},Fi={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},Pi={label:"接続",tooltip:"接続メニューを開く"},ki={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},$i={label:"エッジを削除",tooltip:"選択したエッジを削除"},Di={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},zi={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},Li={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},Ei={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},Ai={label:"テキスト",tooltip:"テキストメニューを開く"},Ti={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},Ri={label:"テキストを編集",tooltip:"選択したテキストを編集"},Ii={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},Oi={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},Bi={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},Wi={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},Xi={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},Vi={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},Yi={label:"テキストを配置",tooltip:"選択したテキストを配置"},Ui={label:"レイヤー",tooltip:"レイヤーメニューを開く"},Hi={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},_i={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Ki={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},Gi={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},Zi={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},qi={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},Ji={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Qi={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},el={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},tl={label:"コメントを編集",tooltip:"選択したコメントを編集"},ol={label:"コメントを削除",tooltip:"選択したコメントを削除"},sl={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},il={file:Ws,newFile:Xs,openFile:Vs,saveFile:Ys,saveAs:Us,importFile:Hs,exportFile:_s,exportFile_png:Ks,exportFile_pdf:Gs,exportFile_csv:Zs,print:qs,closeFile:Js,edit:Qs,undo:ei,redo:ti,cut:oi,copy:si,paste:ii,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:li,selectAll:ni,findReplace:ri,view:ai,zoomIn:ci,zoomOut:di,fitToScreen:hi,toggleGrid:ui,toggleGuides:pi,fullscreenMode:fi,shape:mi,addNode:yi,deleteNode:bi,moveNode:gi,resizeNode:xi,rotateNode:wi,changeNodeColor:vi,changeNodeBorder:Ci,changeNodeText:Mi,groupNodes:Si,ungroupNodes:ji,lockNode:Ni,unlockNode:Fi,connection:Pi,addEdge:ki,deleteEdge:$i,changeEdgeStyle:Di,changeEdgeColor:zi,changeEdgeLabel:Li,reverseEdge:Ei,text:Ai,addText:Ti,editText:Ri,changeFont:Ii,changeFontSize:Oi,changeFontColor:Bi,boldText:Wi,italicText:Xi,underlineText:Vi,alignText:Yi,layer:Ui,sendToBack:Hi,bringToFront:_i,sendBackward:Ki,bringForward:Gi,duplicateLayer:Zi,deleteLayer:qi,toggleLayerVisibility:Ji,collaboration:Qi,addComment:el,editComment:tl,deleteComment:ol,shareDocument:sl},ll={"history-init":{label:"初期化",tooltip:"ファイルを初期化する"},"history-add":{label:"追加",tooltip:"ファイルにモジュールを追加する"},"history-delete":{label:"削除",tooltip:"ファイルからモジュールを削除する"},"history-paste":{label:"貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},"history-duplicate":{label:"複製",tooltip:"選択したモジュールを複製する"},"history-modify":{label:"修正",tooltip:"モジュールのプロパティを修正する"},"history-move":{label:"移動",tooltip:"モジュールを移動する"},"history-reorder":{label:"並べ替え",tooltip:"モジュールを並べ替える"},"history-select":{label:"選択",tooltip:"モジュールを選択する"},"history-group":{label:"グループ化",tooltip:"モジュールをグループ化する"},"history-ungroup":{label:"グループ化解除",tooltip:"モジュールのグループ化を解除する"},"history-composite":{label:"複合操作",tooltip:"複合操作"}},nl={history:ll},rl={en:{translation:{...go,...wo}},cn:{translation:{...Is,...Bs}},jp:{translation:{...il,...nl}}};Re.use(Ie).init({resources:rl,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const oe=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=Math.random()*16|0;return(s==="x"?o:o&3|8).toString(16)}),se=y.createContext({fileMap:new Map([["fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",{id:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",name:"Untitled 1",config:{},data:{}}]]),fileList:[],currentFileId:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{},startCreateFile:()=>{}}),al=({bg:s="#fff",onBgClick:o})=>{const e=y.useRef(null),{createFile:t,handleCreating:i}=y.useContext(se),[l,n]=y.useState(""),r=c=>/^[a-zA-Z0-9-_ ]+$/.test(c),d=c=>{var p;c.preventDefault(),c.stopPropagation();const h=(p=e.current)==null?void 0:p.filename.value.trim();if(!r(h)){n("File name can only including number space and alpha");return}n("");const u={id:oe(),name:h,data:{},config:{}};t(u),i(!1)};return a.jsxs("div",{className:"fixed top-0 left-0 z-20 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[a.jsx("div",{style:{backgroundColor:s},onClick:()=>o&&o(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),a.jsxs("form",{ref:e,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:d,children:[a.jsx("h1",{className:"text-xl text-center",children:"New File"}),a.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),a.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),l&&a.jsx("div",{className:"text-red-500 my-2",children:l}),a.jsx("label",{className:"justify-center",children:a.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})};class ye{constructor(o,e,t,i=-1){x(this,"data");x(this,"prev");x(this,"next");x(this,"id");this.data=t,this.prev=o,this.next=e,this.id=i}}class cl{constructor(){x(this,"head");x(this,"tail");x(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(o){let e;const{tail:t}=this;return t?(e=new ye(t,null,o,t.id+1),t.next=e,this.tail=e):(e=new ye(null,null,o,0),this.head=e,this.tail=e),this.current=e,e}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(o){if(o===this.current)return"equal";let e=this.head;for(;e;){if(this.current===e)return"behind";if(o===e)return"front";e=e.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}class dl extends cl{constructor(e){super();x(this,"editor");this.editor=e,this.init()}init(){var e,t;this.append({type:"history-init",payload:{state:null,selectedModules:new Set}}),(t=(e=this.editor.events).onHistoryUpdated)==null||t.call(e,this)}add(e){this.detach(),this.append(e)}toArray(){const e=[];if(this.head){let t=this.head;for(e.push(t);t.next;)e.push(t.next),t=t.next}return e}compareToCurrentPosition(e){return super.compareToCurrentPosition(e)}forward(){return super.forward()}back(){return super.back()}}class hl{constructor(){x(this,"eventsMap",new Map)}on(o,e){this.eventsMap.has(o)?this.eventsMap.get(o).push(e):this.eventsMap.set(o,[e])}off(o,e){if(this.eventsMap.has(o)){const t=this.eventsMap.get(o);for(let i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),"deleted";return"Cannot find event or function"}}dispatch(o,e){this.eventsMap.has(o)&&this.eventsMap.get(o).forEach(t=>{t(e)})}execute(o,e){this.dispatch(o,e)}destroy(){this.eventsMap.clear()}}const je=({x:s,y:o,width:e,height:t},i)=>{const l=s+e/2,n=o+t/2,r=i*Math.PI/180,d=Math.cos(r),c=Math.sin(r),h=Math.abs(e*d)+Math.abs(t*c),u=Math.abs(e*c)+Math.abs(t*d),p=l-h/2,m=n-u/2;return Ne({x:p,y:m,width:h,height:u})},Ne=s=>{const{x:o,y:e,width:t,height:i}=s;return{x:o,y:e,width:t,height:i,top:e,bottom:e+i,left:o,right:o+t,cx:o+t/2,cy:e+i/2}},V=(s,o)=>{const e=Math.min(s.x,o.x),t=Math.max(s.x,o.x),i=Math.min(s.y,o.y),l=Math.max(s.y,o.y);return Ne({x:e,y:i,width:t-e,height:l-i})};function ul(s,o){return!(s.right<o.left||s.left>o.right||s.bottom<o.top||s.top>o.bottom)}const ae=s=>s===0&&1/s===-1/0;function pl(s,o){let e=0,t;return(...i)=>{const l=Date.now(),n=()=>{e=l,s(...i)};l-e>=o?n():(t!==void 0&&clearTimeout(t),t=setTimeout(n,o-(l-e)))}}function de(s,o={}){if(typeof s!="object"||s===null)return s;if(Array.isArray(s))return s.map(t=>de(t,o));const e=Object.create(o.clonePrototype?Object.getPrototypeOf(s):null);for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=de(s[t],o));return e}class fe{constructor({id:o,lineColor:e,lineWidth:t=1,opacity:i=100,type:l,layer:n=1,rotation:r=0,shadow:d=!1,enableLine:c=!0}){x(this,"id");x(this,"type");x(this,"enableLine");x(this,"lineWidth");x(this,"lineColor");x(this,"opacity");x(this,"rotation");x(this,"shadow");x(this,"layer");this.id=o,this.layer=n,this.enableLine=c,this.lineColor=e,this.lineWidth=t,this.opacity=i,this.rotation=r,this.shadow=d,this.type=l}getDetails(o=!0){const e={type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,rotation:this.rotation};return o?{...e,id:this.id,layer:this.layer}:e}getBoundingRect(){return{bottom:0,cx:0,cy:0,left:0,right:0,top:0,x:0,y:0,width:0,height:0}}render(o){}static applyRotating(o){const{mouseDownPoint:e,mouseMovePoint:t,scale:i,dpr:l,offset:n}=this.viewport,{module:{rotation:r},moduleOrigin:d}=this._rotatingOperator,{x:c,y:h}=d,u=(e.x-n.x/l)/i*l,p=(e.y-n.y/l)/i*l,m=(t.x-n.x/l)/i*l,f=(t.y-n.y/l)/i*l,g=Math.atan2(p-h,u-c);let w=(Math.atan2(f-h,m-c)-g)*(180/Math.PI);o&&(w=Math.round(w/15)*15);let v=(r+w)%360;return v<0&&(v+=360),v}}const fl=[{type:"rotate",name:"rotate-tl",x:0,y:0,offsetX:-5,offsetY:-5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-tr",x:1,y:0,offsetX:5,offsetY:-5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-br",x:1,y:1,offsetX:5,offsetY:5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-bl",x:0,y:1,offsetX:-5,offsetY:5,originCursor:"rotate",cursor:"rotate"},{type:"resize",name:"tl",x:0,y:0,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"t",x:.5,y:0,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"tr",x:1,y:0,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"r",x:1,y:.5,originCursor:"ew-resize",cursor:"ew-resize"},{type:"resize",name:"br",x:1,y:1,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"b",x:.5,y:1,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"bl",x:0,y:1,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"l",x:0,y:.5,originCursor:"ew-resize",cursor:"ew-resize"}];function ml(s,o,e,t){return{x:(s.x*t-o.x)/e,y:(s.y*t-o.y)/e}}function yl(s,o,e,t){return{x:(s.x*e+o.x)/t,y:(s.y*e+o.y)/t}}const bl=(s,o)=>{if(s.size!==o.size)return!1;for(const e of s)if(!o.has(e))return!1;return!0},gl=(s,o)=>{const e=new Set;for(const t of s)o.has(t)||e.add(t);for(const t of o)s.has(t)||e.add(t);return e};function be(s,o,e,t,i){const l=s-e,n=o-t,r=i*(Math.PI/180),d=Math.cos(r),c=Math.sin(r);return{x:e+l*d-n*c,y:t+l*c+n*d}}function Fe(s,o=!1){const e=(()=>{switch(s){case"tl":return{dx:-1,dy:-1,cx:.5,cy:.5};case"t":return{dx:0,dy:-1,cx:0,cy:.5};case"tr":return{dx:1,dy:-1,cx:-.5,cy:.5};case"r":return{dx:1,dy:0,cx:-.5,cy:0};case"br":return{dx:1,dy:1,cx:-.5,cy:-.5};case"b":return{dx:0,dy:1,cx:0,cy:-.5};case"bl":return{dx:-1,dy:1,cx:.5,cy:-.5};case"l":return{dx:-1,dy:0,cx:.5,cy:0};default:throw new Error(`Unsupported resize handle: ${s}`)}})();return o?{...e,cx:0,cy:0}:e}class Pe extends fe{constructor({x:e,y:t,fillColor:i,enableFill:l=!0,...n}){super(n);x(this,"x");x(this,"y");x(this,"fillColor");x(this,"enableFill");this.x=e,this.y=t,this.fillColor=i,this.enableFill=l}getDetails(e=!0){return{...super.getDetails(e),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y}}move(e,t){this.x+=e,this.y+=t}getOperators(e,t,i,l){const{x:n,y:r,width:d,height:c}=i,{id:h,rotation:u}=this;return fl.map(m=>{const f=n-d/2+m.x*d,g=r-c/2+m.y*c,b={id:h,width:0,height:0,x:f,y:g,lineColor:"",lineWidth:0,rotation:u,layer:this.layer,opacity:100};if(m.type==="resize"){const w=be(f,g,n,r,u);b.id+="resize",b.x=w.x,b.y=w.y,b.width=e.size,b.height=e.size,b.lineWidth=e.lineWidth,b.lineColor=e.lineColor,b.fillColor=e.fillColor}else if(m.type==="rotate"){const w=f+m.offsetX*e.lineWidth,v=g+m.offsetY*e.lineWidth,M=be(w,v,n,r,u);b.id+="rotate",b.x=M.x,b.y=M.y,b.width=t.size,b.height=t.size,b.lineWidth=t.lineWidth,b.lineColor=t.lineColor,b.fillColor=t.fillColor}return{id:`${h}`,type:m.type,name:m.name,moduleOrigin:l,module:new Y(b)}})}isInsideRect(e){const t=this.getBoundingRect();return t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom}}const J=class J extends Pe{constructor({width:e,height:t,radius:i=0,...l}){super({type:"rectangle",...l});x(this,"width");x(this,"height");x(this,"radius");this.width=e,this.height=t,this.radius=i}hitTest(e,t=5){const{x:i,y:l,width:n,height:r,rotation:d=0}=this,c=Math.cos(-d),h=Math.sin(-d),u=e.x-i,p=e.y-l,m=u*c+p*h,f=-u*h+p*c,g=n/2,b=r/2,w=m>=-g&&m<=g,v=f>=-b&&f<=b;if(w&&v){const M=Math.abs(m+g)<=t,j=Math.abs(m-g)<=t,z=Math.abs(f+b)<=t,E=Math.abs(f-b)<=t;return M||j||z||E?"border":"inside"}return null}getDetails(e=!0){return{width:this.width,height:this.height,...super.getDetails(e)}}getRect(){const{x:e,y:t,width:i,height:l}=this;return{x:e,y:t,width:i,height:l}}getBoundingRect(){const{x:e,y:t,width:i,height:l,rotation:n}=this,r=e-i/2,d=t-l/2;return n===0?{x:r,y:d,width:i,height:l,left:r,top:d,right:r+i,bottom:d+l,cx:e,cy:t}:je({x:r,y:d,width:i,height:l},n)}getSelectedBoxModule(e,t){const{id:i,rotation:l,layer:n}=this,r={...this.getRect(),lineColor:t,lineWidth:e,rotation:l,layer:n,id:i+"-selected-box",opacity:0};return new J(r)}getHighlightModule(e,t){const{x:i,y:l,width:n,height:r,rotation:d,layer:c,id:h}=this;return new J({x:i,y:l,width:n,height:r,lineColor:t,lineWidth:e,rotation:d,layer:c,id:h+"highlight",opacity:0})}getOperators(e,t){return super.getOperators(e,t,this.getRect(),this.getDetails(!0))}getSnapPoints(){const{x:e,y:t,width:i,height:l,id:n}=this,r=i/2,d=l/2;return[{id:n,x:e,y:t,type:"center"},{id:n,x:e-r,y:t-d,type:"corner-tl"},{id:n,x:e+r,y:t-d,type:"corner-tr"},{id:n,x:e+r,y:t+d,type:"corner-br"},{id:n,x:e-r,y:t+d,type:"corner-bl"},{id:n,x:e,y:t-d,type:"edge-top"},{id:n,x:e+r,y:t,type:"edge-right"},{id:n,x:e,y:t+d,type:"edge-bottom"},{id:n,x:e-r,y:t,type:"edge-left"}]}render(e){const{radius:t}=this,{x:i,y:l,width:n,height:r,rotation:d,opacity:c,fillColor:h,lineWidth:u,lineColor:p,dashLine:m}=this.getDetails(),f=n/2,g=r/2;e.save(),e.translate(i,l),d>0&&e.rotate(d*Math.PI/180),c>0&&(e.fillStyle=h,e.globalAlpha=c/100),u>0&&(e.lineWidth=u,e.strokeStyle=p,e.lineJoin="miter"),e.beginPath(),m&&e.setLineDash([3,5]),t>0?(e.moveTo(-f+t,-g),e.arcTo(f,-g,f,g,t),e.arcTo(f,g,-f,g,t),e.arcTo(-f,g,-f,-g,t),e.arcTo(-f,-g,f,-g,t)):e.rect(-f,-g,n,r),e.closePath(),c>0&&e.fill(),u>0&&e.stroke(),e.restore()}};x(J,"applyResizeTransform",({downPoint:e,movePoint:t,moduleOrigin:i,rotation:l,handleName:n,scale:r,dpr:d,altKey:c=!1,shiftKey:h=!1})=>{const{width:u,height:p,x:m,y:f}=i,g=t.x-e.x,b=t.y-e.y,w=g/r*d,v=b/r*d,M=-l*(Math.PI/180),j=Math.cos(M),z=Math.sin(M),E=w*j-v*z,T=w*z+v*j,$=Fe(n,c);let D=E*$.dx,S=T*$.dy;if(h){const F=u/p,K=Math.abs(D),C=Math.abs(S);$.dx!==0&&$.dy!==0?K>C?S=D/F:D=S*F:$.dx!==0?S=D/F:$.dy!==0&&(D=S*F)}const P=c?2:1,L=Math.abs(u+D*P),R=Math.abs(p+S*P),O=-D*$.cx*P,B=-S*$.cy*P,W=O*j+B*z,U=-O*z+B*j,_=m+W,N=f+U;return{x:_,y:N,width:L,height:R}});let Y=J;const te=class te extends Pe{constructor({fillColor:e,enableFill:t=!0,r1:i,r2:l,...n}){super({type:"rectangle",...n});x(this,"r1");x(this,"r2");x(this,"fillColor");x(this,"enableFill");this.r1=i,this.r2=l,this.fillColor=e,this.enableFill=t}hitTest(e,t=5){const{x:i,y:l,r1:n,r2:r,rotation:d=0}=this,c=Math.cos(-d),h=Math.sin(-d),u=e.x-i,p=e.y-l,m=u*c-p*h,f=u*h+p*c,g=m*m/(n*n)+f*f/(r*r),b=t/Math.min(n,r);return g<=1+b?g>=1-b?"border":"inside":null}getDetails(e=!0){return{...super.getDetails(e),fillColor:this.fillColor,enableFill:this.enableFill,r1:this.r1,r2:this.r2}}getBoundingRect(){const{x:e,y:t,r1:i,r2:l,rotation:n}=this;return je({x:e-i,y:t-l,width:i*2,height:l*2},n)}getRect(){const{x:e,y:t,r1:i,r2:l}=this;return{x:e,y:t,width:i*2,height:l*2}}getSelectedBoxModule(e,t){const{id:i,rotation:l,layer:n}=this,r={...this.getRect(),lineColor:t,lineWidth:e,rotation:l,layer:n,id:i+"-selected-box",opacity:0};return new Y(r)}getHighlightModule(e,t){const{x:i,y:l,r1:n,r2:r,rotation:d,layer:c,id:h}=this;return new te({x:i,y:l,r1:n,r2:r,lineColor:t,lineWidth:e,rotation:d,layer:c,id:h+"highlight",opacity:0})}getOperators(e,t){return super.getOperators(e,t,this.getRect(),this.getDetails(!0))}getSnapPoints(){const{x:e,y:t,r1:i,r2:l,id:n}=this;return[{id:n,x:e,y:t,type:"center"},{id:n,x:e,y:t-l,type:"edge-top"},{id:n,x:e+i,y:t,type:"edge-right"},{id:n,x:e,y:t+l,type:"edge-bottom"},{id:n,x:e-i,y:t,type:"edge-left"}]}render(e){const{x:t,y:i,r1:l,r2:n,opacity:r,fillColor:d,rotation:c,dashLine:h,gradient:u}=this.getDetails(),{lineWidth:p,lineColor:m}=super.getDetails();e.save(),e.translate(t,i),c!==0&&e.rotate(c*Math.PI/180),r>0&&(e.fillStyle=d,e.globalAlpha=r/100),p>0&&(e.lineWidth=p,e.strokeStyle=m,e.lineJoin="round"),e.beginPath(),e.ellipse(0,0,l,n,0,0,Math.PI*2),h?e.setLineDash([3,5]):e.setLineDash([]),e.closePath(),r>0&&e.fill(),p>0&&e.stroke(),u&&(e.fillStyle=u,r>0&&e.fill()),e.restore()}};x(te,"applyResizeTransform",({downPoint:e,movePoint:t,moduleOrigin:i,rotation:l,handleName:n,scale:r,dpr:d,altKey:c=!1,shiftKey:h=!1})=>{const{r1:u,r2:p,x:m,y:f}=i,g=u*2,b=p*2,w=t.x-e.x,v=t.y-e.y,M=w/r*d,j=v/r*d,z=-l*(Math.PI/180),E=Math.cos(z),T=Math.sin(z),$=M*E-j*T,D=M*T+j*E,S=Fe(n,c);let P=$*S.dx,L=D*S.dy;if(h){const C=g/b,G=Math.abs(P),re=Math.abs(L);S.dx!==0&&S.dy!==0?G>re?L=P/C:P=L*C:S.dx!==0?L=P/C:S.dy!==0&&(P=L*C)}const R=c?2:1,O=Math.abs(g+P*R),B=Math.abs(b+L*R),W=-P*S.cx*R,U=-L*S.cy*R,_=W*E+U*T,N=-W*T+U*E,F=m+_,K=f+N;return console.log(),{x:F,y:K,r1:O/2,r2:B/2}});let he=te;function xl(s){const o=de(s),e=new Map;let t=0;const i=l=>{if(l.id||(l.id=this.createModuleId),isNaN(l.layer)){const n=this.getMaxLayerIndex;t=Math.max(t,n),t++,l.layer=t}if(l.type==="rectangle")return new Y(l);if(l.type==="ellipse")return new he(l)};return o.forEach(l=>{const n=i.call(this,l);e.set(l.id,n)}),e}function wl(s){var o,e;return s.forEach(t=>{this.moduleMap.set(t.id,t)}),(e=(o=this.events).onModulesUpdated)==null||e.call(o,this.moduleMap),s}const vl=function(s,o){const e=new Map,t=[];return s.forEach(i=>{const l=this.moduleMap.get(i);l&&(t.push(l),e.set(i,l))}),t.sort((i,l)=>i.layer-l.layer),t.map(i=>i.getDetails(o))};function Cl(s){var e,t;const o=this.batchCopy(s);return o.forEach(i=>{this.moduleMap.delete(i.id)}),(t=(e=this.events).onModulesUpdated)==null||t.call(e,this.moduleMap),o}function Ml(s,o){this.getModulesByIdSet(s).forEach(t=>{t.x+=o.x,t.y+=o.y})}function Sl(s,o){this.getModulesByIdSet(s).forEach(t=>{Object.keys(o).forEach(i=>{const l=i;t[l]=o[i]})})}function jl(s){return s===null?"null":s===void 0?"undefined":s instanceof Set?"set":s instanceof Map?"map":Array.isArray(s)?"array":s instanceof Date?"date":s instanceof RegExp?"regexp":s instanceof Error?"error":s instanceof Promise?"promise":s instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(s)?"typedarray":s instanceof WeakSet?"weakset":s instanceof WeakMap?"weakmap":typeof s=="function"?"function":typeof s=="symbol"?"symbol":typeof s=="bigint"?"bigint":typeof s=="object"?"object":typeof s}function Z(s,o){if(jl(s)!=="set")return;if(s.size===1){const t=[...s.values()][0];this.moduleMap.has(t)&&this.moduleMap.get(t).getDetails()}const e=this.getSelected;this.selectedModules.clear(),o==="replace"&&e.clear(),s.forEach(t=>{switch(o){case"add":e.add(t);break;case"delete":e.delete(t);break;case"toggle":e.has(t)?e.delete(t):e.add(t);break;case"replace":e.add(t);break}}),e.forEach(t=>this.selectedModules.add(t))}function Nl(){this.getSelectedPropsIfUnique}const I=(s,o,e)=>{const t=document.createElement(s);return t.setAttribute(o,""),t.id=o+"-"+e,t};function Fl(s){const o="#1FB3FF",e="rgba(31,180,255,0.1)",t=I("div","editor-wrapper",s),i=I("canvas","editor-main-canvas",s),l=I("canvas","editor-selection-canvas",s),n=I("div","scroll-bar-x",s),r=I("div","scroll-bar-x",s),d=I("div","editor-selection-box",s),c=I("div","editor-cursor",s),h=I("style","editor-style",s);return h.textContent=`
    #${i.id} {
      background-color: #f0f0f0;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${l.id} {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${t.id} {
      user-select: none;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: #787878 transparent;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    #${d.id} {
      display: none;
      pointer-events: none;
      position: absolute;
      border: 1px solid ${o};
      background-color: ${e};
    }
    
    #${n.id},
    #${r.id}{
      background-color: #787878;
      user-select:none;
      translate:none;
    }
    
    #${c.id}{
      display: none;
      pointer-events: none;
      width:20px;
      height:20px;
    }
    
    #${c.id} svg{
      width:18px;
      height:18px;
    }
  `,t.append(i,l,n,r,d,c,h),{wrapper:t,selectionBox:d,selectionCanvas:l,mainCanvas:i,scrollBarX:n,scrollBarY:r,cursor:c}}const Pl=(s,o)=>{s.style.width="50px",s.style.height="6px",s.style.position="absolute",s.style.bottom="0",s.style.left="0",o.style.width="6px",o.style.height="50px",o.style.position="absolute",o.style.right="0",o.style.top="0"},ke=(s,{x:o,y:e,height:t,width:i},l=!0)=>{s.style.transform=`translate(${o}px, ${e}px)`,s.style.width=i+"px",s.style.height=t+"px",s.style.display=l?"block":"none"};function X(s,o,e){const{wrapper:t,cursor:i}=this.viewport;if(s==="default"){t.style.cursor="default",i.style.display="none";return}if(s==="resize"){t.style.cursor=`${o}-resize`,i.style.display="none";return}if(s==="grabbing"){t.style.cursor="grabbing",i.style.display="none";return}if(t.style.cursor="none",s==="rotate"){const{x:r,y:d}=o;i.innerHTML=`
       <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.99 18.93">
  <path d="M15.57,16.04c.48-.57,1-1.1,1.5-1.65.35-.38.54-.85,1.15-.82.72.04,1.01.78.55,1.34-1.07,1.3-2.37,2.5-3.44,3.82-.69.48-1.09,0-1.56-.48-.91-.95-1.92-2.07-2.78-3.07-.3-.35-.58-.72-.33-1.19.39-.73,1.08-.39,1.53.07.52.55,1.01,1.17,1.51,1.74.07.08.17.19.26.22,0-.81.02-1.64-.08-2.44-.51-4.07-3.48-7.36-7.47-8.32-1.12-.27-2.22-.25-3.37-.24.15.2.34.39.52.56.51.47,1.2.95,1.66,1.44.69.73-.3,1.84-1.1,1.19-.91-.74-1.83-1.68-2.7-2.48-.38-.35-1.06-.81-1.29-1.26-.21-.4-.1-.54.14-.89C1.59,2.57,2.79,1.18,4.11.18c.76-.58,1.72.38,1.13,1.14l-2.3,2.09c.76.04,1.52-.01,2.28.06,5.2.47,9.42,4.43,10.22,9.59.15.99.1,1.98.14,2.98Z"/>
</svg>
  `,e+=45,i.style.display="block",i.style.transformOrigin="center center",i.style.transform=`translate(${r-12}px, ${d-12}px) rotate(${e}deg)`}}function kl(){if(this.moduleMap.size===0)return;const{selectionCTX:s}=this.viewport,o="#5491f8",e="#5491f8",t=this.getVisibleSelected,i=2/this.viewport.scale*this.viewport.dpr,l=1/this.viewport.scale*this.viewport.dpr,n=new Set(t);this.hoveredModule&&n.add(this.hoveredModule),t.forEach(r=>{const d=this.moduleMap.get(r);d&&d.getSelectedBoxModule(l,e).render(s)}),n.forEach(r=>{const d=this.moduleMap.get(r),{x:c,y:h,rotation:u,layer:p}=d.getDetails(),m=1/this.viewport.scale*this.viewport.dpr,f=d.getHighlightModule(m,o),g=new Y({x:c,y:h,layer:p,id:r+"hover-center",width:i*2,height:i*2,fillColor:o,lineColor:"transparent",lineWidth:m,rotation:u,opacity:100,radius:r===this.hoveredModule?i:0});f.render(s),g.render(s)}),this.operationHandlers.forEach(r=>{r.module.render(s)})}const $l=(s,o)=>{let e=0,t=0,i=0,l=0;return e=1e3,t=1.414142857*e,i=e/2,l=t/2,new Y({id:o,x:i,y:l,width:e,height:t,opacity:100,lineWidth:1,lineColor:"#000000",fillColor:"#fff",layer:-1})},Dl=(s,o,e=.02)=>{const{width:t,height:i}=o,{width:l,height:n}=s,r=t/l,d=i/n,c=Math.min(r,d)-Math.min(r,d)*e,h=s.width*c,u=s.height*c,p=s.x*c,m=s.y*c,f=(t-h)/2-p,g=(i-u)/2-m;return{scale:c,offsetX:f,offsetY:g}};function zl(s,o){const{dpr:e,scale:t,rect:i,offset:l,viewportRect:n}=this.viewport,r=(s.x-i.width/2)*e,d=(s.y-i.height/2)*e,c=i.width/8,h=i.height/8,u=o/t,p=o<t?-.2:.2;if(u===0)return l;const m=n.cx,f=n.cy;let g=m-(m-l.x)*u,b=f-(f-l.y)*u;return Math.abs(r)>c&&(g=g-r*u*p),Math.abs(d)>h&&(b=b-d*u*p),{x:g,y:b}}function me(){const{viewport:s}=this,o=this.getWorldPointByViewportPoint(s.mouseMovePoint.x,s.mouseMovePoint.y);let e=null,t=null;const i=[...this.operationHandlers];for(let n=i.length-1;n>=0;n--)if(i[n].module.hitTest(o)){t=i[n];break}if(t)return this.action.dispatch("module-hover-enter",t.id),t;const l=[...this.getVisibleModuleMap.values()];for(let n=l.length-1;n>=0;n--){const r=l[n];if(r.hitTest(o)){e=r.id;break}}this.hoveredModule!==e&&(this.hoveredModule&&this.action.dispatch("module-hover-leave",this.hoveredModule),e&&this.action.dispatch("module-hover-enter",e))}function ie(s,o){const{mouseDownPoint:e,mouseMovePoint:t,scale:i,dpr:l}=this.viewport,{name:n,module:{rotation:r},moduleOrigin:d}=this._resizingOperator,{id:c}=d,h={downPoint:e,movePoint:t,dpr:l,scale:i,rotation:r,handleName:n,altKey:s,shiftKey:o,moduleOrigin:d},u=this.moduleMap.get(c);if(u)return u.constructor.applyResizeTransform(h)}function ue(s,o){const e=o.x-s.x,t=o.y-s.y;let n=Math.atan2(t,e)*(180/Math.PI);return n<0&&(n+=360),n}function Ll(s,o){const e=ue(o,s);return e>=337.5&&e<=360||e>=0&&e<22.5?"e":e>=22.5&&e<67.5?"se":e>=67.5&&e<112.5?"s":e>=112.5&&e<157.5?"sw":e>=157.5&&e<202.5?"w":e>=202.5&&e<247.5?"nw":e>=247.5&&e<292.5?"n":e>=292.5&&e<337.5?"ne":"e"}function El(s){const{shiftKey:o,clientY:e,target:t,button:i,clientX:l,metaKey:n,ctrlKey:r}=s;if(t!==this.viewport.wrapper)return;const d=r||n||o,c=l-this.viewport.rect.x,h=e-this.viewport.rect.y;this.viewport.mouseDownPoint.x=c,this.viewport.mouseDownPoint.y=h,this.viewport.mouseMovePoint.x=c,this.viewport.mouseMovePoint.y=h;const u=me.call(this);if(s.preventDefault(),i!==0)return;if(this.viewport.spaceKeyDown)return this.manipulationStatus="panning";if(u){if(u.type==="resize")return this._resizingOperator=u,this.manipulationStatus="resizing";if(u.type==="rotate")return this._rotatingOperator=u,this.manipulationStatus="rotating"}const p=this.hoveredModule;if(!p)return d||this.action.dispatch("selection-clear"),this.selectedShadow=this.getSelected,this.manipulationStatus="selecting";this.manipulationStatus="dragging";const m=this.getSelected,f=m.has(p);m.size===0||!f&&!d?(this.action.dispatch("selection-modify",{mode:"replace",idSet:new Set([p])}),this.draggingModules=new Set([p])):d?(this.draggingModules=new Set(m),f?(console.log("isSelected",f),this._deselection=p,this.draggingModules.add(p)):this.action.dispatch("selection-modify",{mode:"add",idSet:new Set([p])}),this.draggingModules.add(p)):this.draggingModules=new Set(m)}function Al(s){var e,t;if(s.button===0){const{draggingModules:i,manipulationStatus:l,moduleMap:n,_selectingModules:r,selectedShadow:d,viewport:c}=this,h=s.clientX-c.rect.x,u=s.clientY-c.rect.y,p=s.ctrlKey||s.metaKey||s.shiftKey;switch(c.mouseMovePoint.x=h,c.mouseMovePoint.y=u,l){case"selecting":break;case"panning":X.call(this,"grabbing");break;case"dragging":{const m=(c.mouseMovePoint.x-c.mouseDownPoint.x)*c.dpr/c.scale,f=(c.mouseMovePoint.y-c.mouseDownPoint.y)*c.dpr/c.scale;if(!(m===0&&f===0)){const b=[];this.action.dispatch("module-modifying",{type:"move",data:{x:-m,y:-f}}),i.forEach(w=>{const v=n.get(w);if(v){const M={id:w,props:{x:v.x+m,y:v.y+f}};b.push(M)}}),this.action.dispatch("module-modify",b)}else{const b=this.hoveredModule;b&&p&&b===this._deselection&&this.action.dispatch("selection-modify",{mode:"toggle",idSet:new Set([b])})}}break;case"resizing":{const{altKey:m,shiftKey:f}=s,g=ie.call(this,m,f),b=(e=this._resizingOperator)==null?void 0:e.moduleOrigin,w={};Object.keys(g).forEach(v=>{w[v]=b[v]}),this.action.dispatch("module-modifying",{type:"resize",data:w}),this.action.dispatch("module-modify",[{id:this._resizingOperator.id,props:g}])}break;case"rotating":{const{shiftKey:m}=s,f=fe.applyRotating.call(this,m),{rotation:g}=(t=this._rotatingOperator)==null?void 0:t.moduleOrigin,b={rotation:g};this.action.dispatch("module-modifying",{type:"resize",data:b}),this.action.dispatch("module-modify",[{id:this._rotatingOperator.id,props:{rotation:f}}])}break;case"waiting":this.action.dispatch("selection-clear");break;case"static":s.ctrlKey||s.metaKey||s.shiftKey?this.toggleSelected(i):this.replaceSelected(i);break}i.clear(),d.clear(),r.clear(),r.clear(),this.manipulationStatus="static",this._deselection=null,this._resizingOperator=null,ke(c.selectionBox,{x:0,y:0,width:0,height:0},!1)}}function Tl(s){if(!(this.manipulationStatus==="panning"||this.manipulationStatus==="selecting")){if(s.code==="Space"){this.viewport.spaceKeyDown=!0,X.call(this,"grabbing"),s.preventDefault();return}if(this.manipulationStatus==="resizing"){const{altKey:o,shiftKey:e}=s,t=ie.call(this,o,e);this.action.dispatch("module-modifying",{type:"resize",data:t})}}}function Rl(s){if(s.code==="Space"&&(this.viewport.spaceKeyDown=!1,this.viewport.wrapper.style.cursor="default"),this.manipulationStatus==="resizing"){const{altKey:o,shiftKey:e}=s,t=ie.call(this,o,e);this.action.dispatch("module-modifying",{type:"resize",data:t})}}function Il(s){if(s.target!==this.viewport.wrapper||(s.preventDefault(),s.stopPropagation(),this.manipulationStatus!=="static"))return;const{zooming:o,panning:e,scrolling:t,zoomFactor:i,translateX:l,translateY:n}=Ol(s);this.viewport.zooming=o,o?this.action.dispatch("world-zoom",{zoomBy:!0,zoomFactor:i,physicalPoint:this.viewport.mouseMovePoint}):(e||t)&&this.action.dispatch("world-shift",{x:l,y:n}),this.updateWorldRect()}const Ol=(()=>{let s;const t=[];let i=!1,l=!1,n=!1,r=0,d=0,c=0,h=!1;const u=.01,p=.1;return m=>{const{deltaX:f,deltaY:g,altKey:b}=m;if(s&&clearTimeout(s),h?t.length=0:t.push(m),d=0,c=0,i=!1,n=!1,l=!1,b&&(i=!0),t.length>=3){const w=t.every(j=>ae(j.deltaX)),v=t.every(j=>pe(j.deltaY)),M=t.every(j=>Math.abs(j.deltaY)>4);w&&v&&!M&&(h=!0,console.log("touchpadZoomingLock"))}return h?(r=g>0?-.01:u,i=!0):Math.abs(f)>=40&&ae(g)?b?r=f<0?p:-.1:(n=!0,d=-f):ae(f)&&pe(g)&&Math.abs(g)>4?b?r=g<0?u:-.01:(n=!0,c=-g):ge(f)&&ge(g)&&(b?r=(Math.abs(f)>Math.abs(g)?f:g)<0?u:-.01:(l=!0,d=-f,c=-g)),i&&b&&(r=r<0?-.1:p),s=setTimeout(()=>{h=!1,i=!1,l=!1,n=!1,r=0,d=0,c=0,t.length=0},200),{zooming:i,panning:l,scrolling:n,zoomFactor:r,translateX:d,translateY:c}}})();function ge(s){return!pe(s)}function pe(s){return Math.abs(s)%1!==0}function Bl(s){const{action:o,draggingModules:e,viewport:t,selectedShadow:i,_selectingModules:l}=this;switch(t.mouseMovePoint.x=s.clientX-t.rect.x,t.mouseMovePoint.y=s.clientY-t.rect.y,t.drawCrossLine=!1,o.dispatch("world-mouse-move"),this.manipulationStatus){case"selecting":{t.wrapper.setPointerCapture(s.pointerId);const n=V(t.mouseDownPoint,t.mouseMovePoint),r=this.getWorldPointByViewportPoint(n.x,n.y),d=this.getWorldPointByViewportPoint(n.right,n.bottom),c=V(r,d),h=new Set,u=s.ctrlKey||s.metaKey||s.shiftKey;this.moduleMap.forEach(f=>{f.isInsideRect(c)&&h.add(f.id)});const p=!bl(l,h);if(ke(t.selectionBox,n),!p)return;this._selectingModules=h;const m=gl(i,h);if(u)o.dispatch("selection-modify",{mode:"replace",idSet:m});else{if(h.size===0&&i.size===0)return o.dispatch("selection-clear");const f=new Set([...i,...h]);o.dispatch("selection-modify",{mode:"replace",idSet:f})}}break;case"panning":t.wrapper.setPointerCapture(s.pointerId),X.call(this,"grabbing"),o.dispatch("world-shift",{x:s.movementX,y:s.movementY});break;case"dragging":{t.wrapper.setPointerCapture(s.pointerId);const n=s.movementX*t.dpr/t.scale,r=s.movementY*t.dpr/t.scale;this.action.dispatch("module-modifying",{type:"move",data:{x:n,y:r}})}break;case"resizing":{t.wrapper.setPointerCapture(s.pointerId);const{altKey:n,shiftKey:r}=s,d=ie.call(this,n,r);this.action.dispatch("module-modifying",{type:"resize",data:d})}break;case"rotating":{t.wrapper.setPointerCapture(s.pointerId);const{shiftKey:n}=s,{x:r,y:d}=this._rotatingOperator.moduleOrigin,c=this.getViewPointByWorldPoint(r,d),h=fe.applyRotating.call(this,n),u=ue(c,t.mouseMovePoint);X.call(this,"rotate",t.mouseMovePoint,u),this.action.dispatch("module-modifying",{type:"rotate",data:{rotation:h}})}break;case"waiting":{console.log("mousedown");const n=1;(Math.abs(t.mouseMovePoint.x-t.mouseDownPoint.x)>n||Math.abs(t.mouseMovePoint.y-t.mouseDownPoint.y)>n)&&(e.size>0?this.manipulationStatus="dragging":this.manipulationStatus="selecting")}break;case"static":{const n=me.call(this),{viewport:r}=this;if(n){if(n.type==="rotate"){const d=this.getViewPointByWorldPoint(n.moduleOrigin.x,n.moduleOrigin.y),c=ue(d,r.mouseMovePoint);X.call(this,"rotate",r.mouseMovePoint,c)}else if(n.type==="resize"){const{x:d,y:c}=n.moduleOrigin,h=this.getViewPointByWorldPoint(d,c),u=Ll(r.mouseMovePoint,h);X.call(this,"resize",u)}}else X.call(this,"default");r.wrapper.releasePointerCapture(s.pointerId),r.drawCrossLine=r.drawCrossLineDefault}break}}function Wl(s){s.preventDefault(),s.stopPropagation(),me.call(this);const o=this.hoveredModule,e=this.getSelected,t={...this.viewport.mouseMovePoint};let i=new Set;return o&&(e.has(o)?i=e:(i.add(o),this.addSelected(i),console.log(this.selectedModules),this.action.dispatch("selection-updated"))),this.action.dispatch("context-menu",{idSet:i,position:t,copiedItems:this.copiedItems.length>0}),!1}function Xl(){const{wrapper:s,mainCanvas:o,selectionCanvas:e,selectionBox:t,scrollBarX:i,scrollBarY:l,cursor:n}=Fl(this.id),r=e.getContext("2d"),d=o.getContext("2d"),c=new AbortController,h=new ResizeObserver(pl(()=>{this.action.dispatch("world-resized")},200)),{signal:u}=c,p={x:0,y:0},m={x:0,y:0},f=V(p,m),g=V(p,m),b=V(p,m);return s.addEventListener("mousedown",El.bind(this),{signal:u,passive:!1}),s.addEventListener("mouseup",Al.bind(this),{signal:u}),window.addEventListener("keydown",Tl.bind(this),{signal:u}),window.addEventListener("keyup",Rl.bind(this),{signal:u}),window.addEventListener("wheel",Il.bind(this),{signal:u,passive:!1}),s.addEventListener("pointermove",Bl.bind(this),{signal:u}),s.addEventListener("contextmenu",Wl.bind(this),{signal:u}),{drawCrossLine:!1,drawCrossLineDefault:!1,enableCrossLine:!1,initialized:!1,scale:1,spaceKeyDown:!1,zooming:!1,dpr:this.config.dpr,frame:$l("A4",this.id),offset:{x:0,y:0},viewportRect:g,worldRect:b,mouseDownPoint:p,mouseMovePoint:m,rect:f,wrapper:s,mainCanvas:o,selectionCanvas:e,selectionCTX:r,mainCTX:d,scrollBarX:i,scrollBarY:l,selectionBox:t,cursor:n,resizeObserver:h,eventsController:c}}function Vl(){this.viewport&&(this.viewport.resizeObserver.disconnect(),this.viewport.eventsController.abort(),this.viewport.wrapper.style.width="100%",this.viewport.wrapper.style.height="100%",this.viewport.wrapper.remove(),this.viewport=null)}const xe=(s,o,e)=>{const t=[o,0,0,o,e.x,e.y];s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,s.canvas.width*2,s.canvas.height*2),s.setTransform(...t)},$e=s=>new Set(s.map(o=>o.id));function De(s=!1){if(this.history.current===this.history.tail)return!1;this.history.forward();const{type:o,payload:e}=this.history.current.data,{selectedModules:t}=e;switch(o){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchAdd(this.batchCreate(e.modules));break;case"history-modify":e.changes.map(({id:i,props:l})=>{const n={};Object.keys(l).forEach(r=>{n[r]=l[r].to,this.batchModify(new Set([i]),n)})});break;case"history-move":this.batchMove(e.selectedModules,{x:e.delta.x,y:e.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":this.batchDelete($e(e.modules));break}return s||(this.replaceSelected(t),this.action.dispatch("selection-updated")),this.history.current}function ze(s=!1){if(this.history.current===this.history.head)return!1;const{type:o,payload:e}=this.history.current.data;let t=null;switch(o){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchDelete($e(e.modules));break;case"history-modify":e.changes.map(({id:i,props:l})=>{const n={};Object.keys(l).forEach(r=>{n[r]=l[r].from,this.batchModify(new Set([i]),n)})});break;case"history-move":this.batchMove(e.selectedModules,{x:-e.delta.x,y:-e.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":t=e.modules,this.batchAdd(this.batchCreate(t));break}if(this.history.back(),!s){const i=this.history.current.data.payload.selectedModules;this.replaceSelected(i),this.action.dispatch("selection-updated")}return this.history.current}function Yl(s){const o=this.history.compareToCurrentPosition(s);if(!(!o||o==="equal")&&(o==="front"||o==="behind")){let t;for(;o==="front"?t=ze.call(this,!0):o==="behind"&&(t=De.call(this,!0)),t!==s;);const{selectedModules:i}=s.data.payload;this.replaceSelected(i)}}function Ul(){const{container:s,viewport:o,action:e}=this,t=e.dispatch.bind(e),i=e.on.bind(e);s.appendChild(o.wrapper),o.resizeObserver.observe(s),i("world-resized",()=>{var l,n;this.updateViewport(),this.initialized?t("world-updated"):(this.initialized=!0,t("world-zoom","fit"),(n=(l=this.events).onInitialized)==null||n.call(l))}),i("world-updated",()=>{var l,n;this.updateWorldRect(),(n=(l=this.events).onViewportUpdated)==null||n.call(l,{width:this.viewport.viewportRect.width,height:this.viewport.viewportRect.height,scale:this.viewport.scale,offsetX:this.viewport.offset.x,offsetY:this.viewport.offset.y,status:this.manipulationStatus}),t("visible-module-updated")}),i("world-zoom",l=>{if(l==="fit"){const{frame:n,viewportRect:r}=this.viewport,d=n.getBoundingRect(),{scale:c,offsetX:h,offsetY:u}=Dl(d,r,.02);this.viewport.scale=c,this.viewport.offset.x=h,this.viewport.offset.y=u,t("world-updated")}else{const{scale:n,dpr:r}=this.viewport;let d=null,c=1;const h=.01*r,u=500*r;let p=l.physicalPoint;l.zoomTo?c=l.zoomFactor:l.zoomBy&&(c=n+l.zoomFactor),c=Math.max(h,Math.min(c,u)),d=this.zoom(c,p),this.viewport.scale=c,this.viewport.offset.x=d.x,this.viewport.offset.y=d.y,t("world-updated")}}),i("world-shift",l=>{const{x:n,y:r}=l,{dpr:d}=this.viewport;this.viewport.offset.x+=n*d,this.viewport.offset.y+=r*d,t("world-updated")}),i("visible-module-updated",()=>{this.updateVisibleModuleMap(),t("render-modules"),t("visible-selection-updated")}),i("visible-selection-updated",()=>{this.updateVisibleSelected(),t("render-selection")}),i("selection-all",()=>{this.selectAll(),t("selection-updated")}),i("selection-clear",()=>{this.selectedModules.clear(),t("selection-updated")}),i("selection-modify",l=>{const{mode:n,idSet:r}=l;this.modifySelected(r,n),t("selection-updated")}),i("module-updated",l=>{var n,r;t("visible-module-updated"),t("selection-updated"),l&&(this.history.add(l),(r=(n=this.events).onHistoryUpdated)==null||r.call(n,this.history))}),i("selection-updated",()=>{var l,n;this.hoveredModule=null,Nl.call(this),(n=(l=this.events).onSelectionUpdated)==null||n.call(l,this.selectedModules,this.getSelectedPropsIfUnique),t("visible-selection-updated")}),i("world-mouse-move",()=>{var n,r;const l=this.getWorldPointByViewportPoint(this.viewport.mouseMovePoint.x,this.viewport.mouseMovePoint.y);(r=(n=this.events).onWorldMouseMove)==null||r.call(n,l)}),i("module-delete",()=>{const l=this.getSelected,n=this.batchDelete(l);this.selectedModules.clear(),t("module-updated",{type:"history-delete",payload:{modules:n,selectedModules:l}})}),i("module-copy",()=>{var l,n;this.copiedItems=this.batchCopy(this.getSelected,!1),this.updateCopiedItemsDelta(),(n=(l=this.events).onModuleCopied)==null||n.call(l,this.copiedItems)}),i("module-paste",l=>{if(this.copiedItems.length===0)return;let n;if(l){const{x:d,y:c}=this.getWorldPointByViewportPoint(l.x,l.y),h=this.copiedItems.reduce((f,g)=>g.x<f.x&&g.y<f.y?g:f),u=d-h.x,p=c-h.y,m=this.copiedItems.map(f=>({...f,x:f.x+u,y:f.y+p}));n=this.batchCreate(m)}else n=this.batchCreate(this.copiedItems);const r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r),this.updateCopiedItemsDelta(),t("module-updated",{type:"history-paste",payload:{modules:[...n.values()].map(d=>d.getDetails()),selectedModules:r}})}),i("module-duplicate",()=>{const l=this.batchCopy(this.selectedModules,!1);l.forEach(c=>{c.x+=this.CopyDeltaX,c.y+=this.CopyDeltaY});const n=this.batchCreate(l),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const d=[...n.values()].map(c=>c.getDetails());t("module-updated",{type:"history-duplicate",payload:{modules:d,selectedModules:r}})}),i("module-layer",l=>{console.log(l)}),i("module-move",({delta:l={x:0,y:0}})=>{const n=this.getSelected;if(n.size===0)return;const r=[];n.forEach(d=>{const c=this.moduleMap.get(d);c&&r.push({id:d,props:{x:c.x+l.x,y:c.y+l.y}})}),t("module-modify",r)}),i("module-add",l=>{const n=this.batchAdd(this.batchCreate(l)),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const d=[...n.values()].map(c=>c.getDetails());t("module-updated",{type:"history-add",payload:{modules:d,selectedModules:r}})}),i("module-modifying",({type:l,data:n})=>{const r=this.getSelected;r.size!==0&&(l==="move"?this.batchMove(r,n):(l==="resize"||l==="rotate")&&this.batchModify(r,n),t("module-updated"))}),i("module-modify",l=>{var r,d;const n=[];l.map(({id:c,props:h})=>{const u={},p={id:c,props:u},m=this.moduleMap.get(c);m&&(Object.keys(h).map(f=>{const g=m[f],b=h[f];return u[f]={from:g,to:b}}),this.batchModify(new Set([c]),h),n.push(p))}),console.log(n),this.history.add({type:"history-modify",payload:{selectedModules:this.getSelected,changes:n}}),(d=(r=this.events).onHistoryUpdated)==null||d.call(r,this.history),t("module-updated")}),i("render-modules",()=>{xe(this.viewport.mainCTX,this.viewport.scale,this.viewport.offset),this.renderModules()}),i("render-selection",()=>{xe(this.viewport.selectionCTX,this.viewport.scale,this.viewport.offset),this.renderSelections()}),i("module-hover-enter",l=>{this.hoveredModule&&l&&this.hoveredModule===l||(this.hoveredModule=l,t("visible-selection-updated"))}),i("module-hover-leave",()=>{this.hoveredModule=null,t("visible-selection-updated")}),i("history-undo",()=>{var l,n;ze.call(this),t("module-updated"),(n=(l=this.events).onHistoryUpdated)==null||n.call(l,this.history)}),i("history-redo",()=>{var l,n;De.call(this),t("module-updated"),(n=(l=this.events).onHistoryUpdated)==null||n.call(l,this.history)}),i("history-pick",l=>{var n,r;Yl.call(this,l),t("module-updated"),(r=(n=this.events).onHistoryUpdated)==null||r.call(n,this.history)}),i("context-menu",({position:l})=>{var n,r;(r=(n=this.events).onContextMenu)==null||r.call(n,l)})}class Hl{constructor({container:o,data:e,events:t={},config:i={dpr:4}}){x(this,"id");x(this,"config");x(this,"moduleCounter",0);x(this,"moduleMap");x(this,"visibleModuleMap");x(this,"action");x(this,"container");x(this,"events",{});x(this,"history");x(this,"viewport");x(this,"selectedModules",new Set);x(this,"visibleSelected",new Set);x(this,"operationHandlers",[]);x(this,"copiedItems",[]);x(this,"hoveredModule",null);x(this,"draggingModules",new Set);x(this,"_selectingModules",new Set);x(this,"_deselection",null);x(this,"_resizingOperator",null);x(this,"_rotatingOperator",null);x(this,"selectedShadow",new Set);x(this,"manipulationStatus","static");x(this,"CopyDeltaX",50);x(this,"CopyDeltaY",100);x(this,"initialized",!1);this.visibleModuleMap=new Map,this.id=e.id||oe(),this.config=i,this.events=t,this.action=new hl,this.container=o,this.history=new dl(this),this.viewport=Xl.call(this),this.moduleMap=e.modules.reduce((l,n)=>(l.set(n.id,n),l),new Map),this.init()}init(){Ul.call(this)}get createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(o){return xl.call(this,o)}batchAdd(o){return wl.call(this,o)}batchCopy(o,e=!0){return vl.call(this,o,e)}batchDelete(o){return Cl.call(this,o)}batchMove(o,e){Ml.call(this,o,e)}batchModify(o,e){Sl.call(this,o,e)}getModulesByIdSet(o){const e=new Map;return o.forEach(t=>{const i=this.moduleMap.get(t);i&&e.set(t,i)}),e}getModuleList(){return[...Object.values(this.moduleMap)]}updateVisibleModuleMap(){this.visibleModuleMap.clear(),[...this.moduleMap.values()].filter(e=>{const t=e.getBoundingRect();return ul(t,this.viewport.worldRect)}).sort((e,t)=>e.layer-t.layer).forEach(e=>{this.visibleModuleMap.set(e.id,e)})}updateVisibleSelected(){this.visibleSelected.clear(),this.operationHandlers.length=0,this.getVisibleModuleMap.forEach(e=>{this.selectedModules.has(e.id)&&this.visibleSelected.add(e.id)});const o=this.getSelectedPropsIfUnique;if(o){const e=this.moduleMap.get(o.id),{scale:t,dpr:i}=this.viewport,l=1/t*i,n=10/t*i,r=15/t*i,c=e.getOperators({size:n,lineColor:"#5491f8",lineWidth:l,fillColor:"#fff"},{size:r,lineColor:"transparent",lineWidth:0,fillColor:"transparent"});this.operationHandlers.push(...c)}}get getVisibleModuleMap(){return new Map(this.visibleModuleMap)}get getVisibleSelected(){return new Set(this.visibleSelected)}get getVisibleSelectedModuleMap(){return this.getModulesByIdSet(this.getVisibleSelected)}get getSelected(){return new Set(this.selectedModules)}get getMaxLayerIndex(){let o=0;return this.moduleMap.forEach(e=>{e.layer>o&&(o=e.layer)}),o}modifySelected(o,e){Z.call(this,o,e)}addSelected(o){Z.call(this,o,"add")}deleteSelected(o){Z.call(this,o,"delete")}toggleSelected(o){Z.call(this,o,"toggle")}replaceSelected(o){Z.call(this,o,"replace")}selectAll(){this.selectedModules.clear(),this.moduleMap.forEach(o=>{this.selectedModules.add(o.id)})}updateCopiedItemsDelta(){this.copiedItems.forEach(o=>{o.x+=this.CopyDeltaX,o.y+=this.CopyDeltaY})}get getSelectedPropsIfUnique(){if(this.selectedModules.size===1){const o=[...this.selectedModules.values()][0],e=this.moduleMap.get(o);return e?e.getDetails():null}return null}execute(o,e=null){this.action.execute(o,e)}renderModules(){requestAnimationFrame(()=>{const{frame:e,mainCTX:t}=this.viewport;e.render(t),this.visibleModuleMap.forEach(i=>{i.render(t)})})}printOut(o){this.moduleMap.forEach(e=>{e.render(o)})}renderSelections(){requestAnimationFrame(()=>{kl.call(this)})}updateWorldRect(){const{dpr:o}=this.viewport,{width:e,height:t}=this.viewport.viewportRect,i=this.getWorldPointByViewportPoint(0,0),l=this.getWorldPointByViewportPoint(e/o,t/o);this.viewport.worldRect=V(i,l)}zoom(o,e){const{rect:t}=this.viewport;return e=e||{x:t.width/2,y:t.height/2},zl.call(this,e,o)}updateScrollBar(){const{scrollBarX:o,scrollBarY:e}=this.viewport;Pl(o,e)}updateViewport(){const{dpr:o,mainCanvas:e,selectionCanvas:t}=this.viewport,i=this.container.getBoundingClientRect().toJSON(),{x:l,y:n,width:r,height:d}=i,c=r*o,h=d*o;this.viewport.rect={...i,cx:l+r/2,cy:n+d/2},this.viewport.viewportRect=V({x:0,y:0},{x:c,y:h}),e.width=t.width=c,e.height=t.height=h}getWorldPointByViewportPoint(o,e){const{dpr:t,offset:i,scale:l}=this.viewport;return ml({x:o,y:e},i,l,t)}getViewPointByWorldPoint(o,e){const{dpr:t,offset:i,scale:l}=this.viewport;return yl({x:o,y:e},i,l,t)}destroy(){Vl.call(this),this.action.destroy(),this.history.destroy(),this.moduleMap.clear()}}const A=y.createContext({focused:!1,historyArray:[],historyStatus:{id:0,hasPrev:!1,hasNext:!1},selectedModules:[],selectedProps:{},copiedItems:[],editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{},viewport:{width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}}),_l=y.memo(()=>{const{executeAction:s,focused:o}=y.useContext(A),e=t=>{let i=null;const{key:l,ctrlKey:n,metaKey:r,shiftKey:d}=t,h={ArrowUp:"module-move-up",ArrowDown:"module-move-down",ArrowLeft:"module-move-left",ArrowRight:"module-move-right"}[l],u={x:0,y:0},p=5,m={zoomBy:!0,zoomFactor:.5};if(l==="="&&r&&(i="world-zoom"),l==="-"&&r&&(i="world-zoom",m.zoomFactor=-.5),l==="a"&&(n||r)&&(i="selection-all"),l==="c"&&(n||r)&&!d&&(i="module-copy"),l==="v"&&(n||r)&&(i="module-paste"),l==="d"&&(n||r)&&(i="module-duplicate"),(l==="Delete"||l==="Backspace")&&(i="module-delete"),l==="Escape"&&(i="selection-clear"),l==="z"&&(n||r)&&(i="history-undo"),l==="z"&&d&&(n||r)&&(i="history-redo"),h)switch(i="module-move",h){case"module-move-down":u.y=p;break;case"module-move-up":u.y=-5;break;case"module-move-left":u.x=-5;break;case"module-move-right":u.x=p;break}i&&(h?s(i,{delta:u}):i==="world-zoom"?s(i,m):s(i),t.stopPropagation(),t.preventDefault())};return y.useEffect(()=>(window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}),[o]),null}),Kl=[{className:"w-20 h-10",props:{type:"rectangle",x:200,y:200,width:100,height:50}},{className:"w-10 h-10 rounded-3xl",props:{type:"ellipse",x:200,y:200,r1:100,r2:100}}],Gl=()=>{const{editorRef:s,executeAction:o}=y.useContext(A);return y.useEffect(()=>{s.current},[s]),a.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:Kl.map((e,t)=>a.jsx("div",{className:"shrink-0 select-none cursor-pointer",onClick:()=>{const i=e.props;i.x=H(1e3),i.y=H(2e3),i.lineWidth=10,i.lineColor=we(),i.fillColor=we(),i.type==="rectangle"&&(i.width=H(200),i.height=H(200)),i.type==="ellipse"&&(i.r1=H(200),i.r1=H(200)),o("module-add",[i])},children:a.jsx("div",{style:{border:"1px solid #dfdfdf"},className:e.className})},t))})},we=()=>`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`,H=s=>Math.floor(Math.random()*s),Zl=y.memo(({className:s=""})=>{const[o,e]=y.useState(300),t=y.useRef(!1),i=y.useRef(null),l=y.useCallback(d=>{d.preventDefault(),t.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),n=y.useCallback(d=>{if(!t.current)return;const c=window.innerWidth*.9,h=Math.min(Math.max(0,d.clientX),c);d.stopPropagation(),e(h)},[]),r=y.useCallback(d=>{t.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",d.stopPropagation()},[]);return y.useEffect(()=>(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}),[n,r]),a.jsxs("div",{ref:i,style:{width:`${o}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[a.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${s}`,children:[a.jsx("span",{children:"Module List"}),a.jsx(Gl,{})]}),a.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:l})]})}),ve=s=>(s*100).toFixed(2)+"%",ql=s=>{const o=s.replace("%","").trim(),e=Number(o);return isNaN(e)?!1:Number(e.toFixed(2))},Jl=({scale:s,onChange:o})=>{const e=[{label:"400%",value:4},{label:"300%",value:3},{label:"200%",value:2},{label:"150%",value:1.5},{label:"125%",value:1.25},{label:"100%",value:1},{label:"75%",value:.75},{label:"50%",value:.5},{label:"25%",value:.25},{label:"Fit window",value:"fit"}],[t,i]=y.useState(ve(1)),[l,n]=y.useState(!1),r=y.useRef(null);y.useEffect(()=>{const c=ve(s);r.current&&(r.current.value=c),i(c)},[s]);const d=c=>{if(c.key==="Enter"){const h=ql(c.target.value);h!==!1&&o(h),r.current.blur()}c.stopPropagation()};return a.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[a.jsx("input",{type:"text",ref:r,onChange:void 0,defaultValue:t,onKeyDown:d,className:"w-20 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),a.jsx("button",{onClick:()=>n(!l),className:"text-gray-800 flex trasition items-center cursor-pointer",children:l?a.jsx(Oe,{className:"w-5 h-5"}):a.jsx(Be,{className:"w-5 h-5"})}),l&&a.jsx("div",{className:"fixed w-full h-full",onClick:()=>{n(!1)}}),l&&a.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:e.map(({label:c,value:h})=>a.jsx("div",{onClick:()=>{n(!1),o(h)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:h==="fit"?c:`${h*100}%`},h))})]})},Ql=({className:s="",worldPoint:o})=>{const{viewport:e,executeAction:t}=y.useContext(A);return e?a.jsx("footer",{className:s+"w-full h-8 flex justify-between pr-1 items-center border-t border-gray-200",children:e&&a.jsxs(a.Fragment,{children:[a.jsx(Jl,{scale:e.scale,onChange:i=>{i==="fit"?t("world-zoom","fit"):t("world-zoom",{zoomTo:!0,zoomFactor:i})}},e.scale),a.jsx("div",{className:"text-xs line-clamp-1",children:`dx:${o.x.toFixed(2)} dy:${o.y.toFixed(2)}`})]})}):null},ce=28,en=y.memo(({data:s,selected:o})=>{const e=y.useRef(null),t=y.useRef(null),[i,l]=y.useState(0),[n,r]=y.useState([0,10]),{executeAction:d}=y.useContext(A);y.useEffect(()=>{},[o]);const c=()=>{if(!e.current)return;const u=e.current.scrollTop,p=u<i,m=Math.round(u/ce),f=m+10;if(p){if(n[0]>=s.length-1)return}else if(n[1]>=s.length-1)return;l(u),r([m,f])},h=[];for(let u=n[0];u<n[1];u++){const p=s[u];p&&h.push(a.jsx("div",{ref:o!=null&&o.includes(p.id)?t:null,style:{height:ce},className:o!=null&&o.includes(p.id)?"bg-gray-400 text-white":"",onClick:()=>{d("selection-modify",{mode:"replace",idSet:new Set([p.id])})},id:`layer-module-${p.id}`,children:p.type},p.id))}return a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Layer"})}),a.jsx("div",{className:"p-2 relative overflow-hidden",children:a.jsxs("div",{ref:e,onScroll:c,className:"relative scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:[a.jsx("div",{className:"absolute w-full top-0 left-0",style:{height:s.length*ce}}),a.jsx("div",{className:"w-full sticky top-0 left-0",children:h})]})})]})}),Le=({menu:s})=>{const{t:o}=Q(),[e,t]=y.useState(!1),{executeAction:i}=y.useContext(A),l=()=>{console.log(s),i(s.id),t(!1)},n=s.children&&s.children.length>0;return a.jsxs("div",{className:"relative h-8 hover:bg-gray-200 min-w-50",onClick:()=>l(),onMouseOver:r=>{t(!0),r.preventDefault()},onMouseLeave:()=>{t(!1)},children:[a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center whitespace-nowrap",children:[a.jsx("span",{children:o(s.id+".label")}),n&&a.jsx(Se,{size:18})]}),n&&e&&a.jsx("div",{className:"absolute bg-white z-30 left-full top-0 w-auto border border-gray-200 box-border",children:s.children.map(r=>a.jsx(Le,{menu:r},r.id))})]})},tn={id:"file",disabled:!1,children:[{id:"newFile",disabled:!1},{id:"openFile",disabled:!1},{id:"saveFile",disabled:!1},{id:"saveAs",disabled:!1},{id:"exportFile",disabled:!1,children:[{id:"exportFile_png",disabled:!1},{id:"exportFile_pdf",disabled:!1},{id:"exportFile_csv",disabled:!1}]},{id:"print",disabled:!1},{id:"closeFile",disabled:!1}]},on={id:"edit",disabled:!1,children:[{id:"undo",disabled:!1},{id:"redo",disabled:!1},{id:"cut",disabled:!1},{id:"copy",disabled:!1},{id:"paste",disabled:!1},{id:"delete",disabled:!1},{id:"duplicate",disabled:!1},{id:"selectAll",disabled:!1},{id:"findReplace",disabled:!1}]},sn={id:"view",disabled:!1,children:[{id:"zoomIn",disabled:!1},{id:"zoomOut",disabled:!1},{id:"fitToScreen",disabled:!1},{id:"toggleGrid",disabled:!1},{id:"toggleGuides",disabled:!1},{id:"fullscreenMode",disabled:!1}]},ln=[tn,on,sn],nn=y.memo(()=>{const[s,o]=y.useState(!1),[e,t]=y.useState(null),{t:i}=Q(),l=y.useRef(null),n=ln;return y.useEffect(()=>{const r=d=>{l.current.contains(d.target)||(o(!1),t(null))};return window.addEventListener("click",r),()=>{window.removeEventListener("click",r)}}),a.jsx("div",{className:"h-8 text-sm select-none border-gray-200 box-border",children:a.jsx("div",{ref:l,className:"pl-2 h-full inline-flex",children:n.map(r=>{var d;return a.jsxs("div",{className:"relative h-full",children:[a.jsx("div",{className:`h-full inline-flex items-center px-4 ${r.id===e?"bg-gray-200":""}`,onMouseEnter:()=>s&&t(r.id),onClick:()=>{e!==r.id?(o(!0),t(r.id)):(t(null),o(!1))},title:i(r.id+".tooltip"),children:a.jsx("span",{children:i(r.id+".label")})}),s&&r.id===e&&r.children.length>0&&a.jsx("div",{className:"absolute z-20 bg-white border border-gray-200",children:(d=r.children)==null?void 0:d.map(c=>a.jsx(Le,{menu:c},c.id))})]},r.id)})})})}),le={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},ne="#9b9a9a",rn=({size:s=24,...o})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",...le,...o,children:[a.jsx("path",{fill:ne,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),a.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),a.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),an=({size:s=24,...o})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",...le,...o,children:[a.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),a.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),a.jsx("path",{fill:ne,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),cn=({size:s=24,...o})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",...le,...o,children:[a.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:ne,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),dn=({size:s=24,...o})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:s,height:s,viewBox:"0 0 24 24",fill:"none",...le,...o,children:[a.jsx("path",{fill:ne,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),hn=({iconName:s,size:o})=>{switch(s){case"save":return a.jsx(Ge,{size:o});case"undo":return a.jsx(Ke,{size:o});case"redo":return a.jsx(_e,{size:o});case"trash":return a.jsx(He,{size:o});case"cross":return a.jsx(Ue,{size:o});case"group":return a.jsx(Ye,{size:o});case"ungroup":return a.jsx(Ve,{size:o});case"lock":return a.jsx(Xe,{size:o});case"unlock":return a.jsx(We,{size:o});default:return null}},q=20,ee="text-black",un=y.memo(()=>{const{executeAction:s,historyStatus:o,selectedModules:e}=y.useContext(A),t=[{id:"save",icon:"save",disabled:!0,divide:!0},{id:"undo",editorActionCode:"history-undo",icon:"undo",disabled:!o.hasPrev},{id:"redo",editorActionCode:"history-redo",icon:"redo",disabled:!o.hasNext,divide:!0},{id:"delete",editorActionCode:"module-delete",icon:"trash",disabled:e.length===0,divide:!0},{id:"layerUp",editorActionCode:"module-layer",editorActionData:"up",icon:"layers",disabled:!1},{id:"layerDown",editorActionCode:"module-layer",editorActionData:"down",icon:"layers",disabled:!1},{id:"layerTop",editorActionCode:"module-layer",editorActionData:"top",icon:"layers",disabled:!1},{id:"layerBottom",editorActionCode:"module-layer",editorActionData:"bottom",icon:"layers",disabled:!1,divide:!0}];return a.jsx("div",{className:"border-b border-gray-200 box-border",children:a.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(t).map(i=>{const{id:l,icon:n,disabled:r,divide:d}=i;let c;switch(l){case"layerUp":c=a.jsx(rn,{size:q,className:ee});break;case"layerDown":c=a.jsx(an,{size:q,className:ee});break;case"layerTop":c=a.jsx(cn,{size:q,className:ee});break;case"layerBottom":c=a.jsx(dn,{size:q,className:ee});break;default:c=a.jsx(hn,{size:q,iconName:n});break}const{tooltip:h}=Ze(l,{returnObjects:!0});return a.jsxs(y.Fragment,{children:[a.jsx("button",{type:"button",disabled:r,title:h,onClick:()=>{i.editorActionCode&&s(i.editorActionCode)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6   hover:bg-gray-200  hover:opacity-100  disabled:hover:bg-transparent disabled:text-gray-200 disabled:cursor-default",children:c}),d&&a.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},l)})})})}),pn=y.memo(()=>a.jsxs("header",{children:[a.jsx(nn,{}),a.jsx(un,{})]})),fn=y.memo(()=>{const{historyArray:s,historyStatus:o,applyHistoryNode:e}=y.useContext(A),{t}=Q(),i=y.useRef(null);return y.useEffect(()=>{if(i.current)return()=>{}},[s,o]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-600 text-white px-2",children:a.jsx("span",{children:"History"})}),a.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:a.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:s.map((l,n)=>{const r=l.id===o.id,d="history."+l.data.type,{label:c,tooltip:h}=t(d,{returnObjects:!0});return a.jsx("div",{title:h,ref:r?i:null,onClick:()=>{r||e(l)},className:` px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${r?"bg-gray-400 text-white":""}`,children:a.jsx("span",{children:c})},n)})})})]})}),k=s=>a.jsx("input",{...s,onKeyDown:o=>{o.stopPropagation()},onPaste:o=>{o.stopPropagation()},onKeyUp:o=>{console.log(9),o.stopPropagation()}}),mn=y.memo(({props:s})=>{const[o,e]=y.useState(s);return y.useEffect(()=>{e(s)},[s]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Properties"})}),a.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:o&&a.jsx(yn,{props:o})})]})}),yn=({props:s})=>{const{executeAction:o,focused:e}=y.useContext(A),t=i=>{const l=i.target.name;let n=i.target.value;["x","y","width","height"].includes(l)&&(n=Number(n)),o("module-modify",[{id:s.id,props:{[l]:n}}]),i.preventDefault(),i.stopPropagation()};return a.jsxs("div",{className:"z-30 text-sm",children:[a.jsxs("div",{className:"mb-1 ",children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"X:"}),a.jsx(k,{type:"number",name:"x",value:s.x,onChange:t,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Y:"}),a.jsx(k,{type:"number",name:"y",value:s.y,onChange:t,className:"w-16  py-1 text-black rounded"})]}),s.type==="ellipse"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"r1:"}),a.jsx(k,{type:"number",name:"r1",value:s.r1,onChange:t,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"r2:"}),a.jsx(k,{type:"number",name:"r2",value:s.r2,onChange:t,className:"w-16  py-1 text-black rounded"})]})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Width:"}),a.jsx(k,{type:"number",name:"width",value:s.width,onChange:t,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Height:"}),a.jsx(k,{type:"number",name:"height",value:s.height,onChange:t,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Rotation:"}),a.jsx(k,{type:"number",name:"rotation",value:s.rotation,onChange:t,className:"w-16  py-1 text-black rounded"})]})]}),a.jsxs("div",{className:"mb-1",children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Fill"}),a.jsx(k,{type:"checkbox",name:"enableFill",value:s.enableFill,onChange:t,className:"ml-2"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Fill Color:"}),a.jsx(k,{type:"color",name:"fillColor",value:s.fillColor,onInput:i=>{console.log(i)},onChange:t,className:"w-10 h-10 p-1 rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Line"}),a.jsx(k,{type:"checkbox",name:"enableLine",defaultChecked:s.enableLine,onChange:t,className:"ml-2"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Line Color:"}),a.jsx(k,{type:"color",name:"lineColor",value:s.lineColor,onChange:t,className:"w-10 h-10 p-1 rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Line Width:"}),a.jsx(k,{type:"number",name:"lineWidth",value:s.lineWidth,onChange:t,className:"w-16  py-1 text-black rounded"})]})]}),a.jsx("div",{className:"mb-1",children:a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Opacity:"}),a.jsx(k,{type:"number",name:"opacity",value:s.opacity,onChange:t,className:"w-16  py-1 text-black rounded"})]})})]})},Ce=(s="rectangle",o=300,e=300)=>s==="ellipse"?{type:"ellipse",x:o,y:e,r1:o/1.2,r2:o/1.2,enableLine:!0,lineColor:"#000",lineWidth:1,enableFill:!0,fillColor:"#f89f9f",opacity:100,shadow:!1,radius:0,rotation:0}:s==="rectangle"?{type:"rectangle",x:o,y:e,width:o/1.5,height:e/1.5,enableLine:!0,lineColor:"#000000",lineWidth:1,enableFill:!0,fillColor:"#fff",opacity:100,shadow:!1,radius:0,rotation:0}:null,bn=s=>{const o=[];for(let e=0;e<1;e++)o.push(Ce("ellipse",300,700));o.push(Ce("ellipse",300,700)),s.action.dispatch("module-add",o)},gn=y.memo(({position:s,onClose:o})=>{const{t:e}=Q(),{selectedModules:t,copiedItems:i,historyStatus:l,executeAction:n}=y.useContext(A),[r,d]=y.useState([]),c="absolute bg-white shadow-lg rounded-md border border-gray-200 py-1 z-50";y.useEffect(()=>{const p=t.length===0,m=[{id:"copy",editorActionCode:"module-copy",disabled:p},{id:"paste",editorActionCode:"module-paste",disabled:i.length===0},{id:"duplicate",editorActionCode:"module-duplicate",disabled:p},{id:"delete",editorActionCode:"module-delete",disabled:p,divide:!0},{id:"undo",editorActionCode:"history-undo",disabled:!l.hasPrev},{id:"redo",editorActionCode:"history-redo",disabled:!l.hasNext},{id:"layer",disabled:p,children:[{id:"bringForward",editorActionCode:"module-layer",editorActionData:"up",disabled:p},{id:"sendBackward",editorActionCode:"module-layer",editorActionData:"down",disabled:p},{id:"bringToFront",editorActionCode:"module-layer",editorActionData:"top",disabled:p},{id:"sendToBack",editorActionCode:"module-layer",editorActionData:"bottom",disabled:p}]}];d(m);const f=()=>{o()};return window.addEventListener("click",f),()=>{window.removeEventListener("click",f)}},[t,s,i]);const h=p=>{const{editorActionCode:m}=p;m==="module-paste"?n("module-paste",s):n(m)},u=({item:p,onMouseUp:m})=>{const f=e(p.id,{returnObjects:!0}),g=p.children&&p.children.length>0;return a.jsxs("div",{className:"min-w-40 relative group",title:f.tooltip,children:[a.jsxs("button",{type:"button",disabled:p.disabled,onMouseUp:m,className:"flex justify-between px-4 text-nowrap items-center py-1.5 w-full text-left text-sm  hover:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-transparent disabled:cursor-not-allowed",children:[f.label,g&&a.jsx(Se,{})]}),g&&a.jsx("div",{className:c+" z-60 group-hover:block hidden left-full top-0 border-l-0 rounded-none ",children:p.children.map((b,w)=>a.jsx(u,{item:b,onMouseUp:()=>h(b)},w))})]})};return a.jsx("div",{className:c,onClick:p=>{p.preventDefault(),p.stopPropagation()},style:{top:s.y,left:s.x},children:r.map((p,m)=>a.jsx(u,{item:p,onMouseUp:()=>{h(p),o()}},m))})}),xn=y.memo(({onClose:s,editorRef:o})=>{const e=y.useRef(null),[t,i]=y.useState(2);y.useEffect(()=>{l()},[o]);const l=()=>{if(!o||!o.current||!e)return;const{frame:n}=o.current.viewport,r=n.getBoundingRect(),d=e.current,c=d.getContext("2d");d.width=r.width*t,d.height=r.height*t,c.setTransform(t,0,0,t,0,0),o.current.printOut(c);const h=u=>{s(),u.preventDefault(),u.stopPropagation(),window.removeEventListener("keydown",h,{capture:!0})};return window.addEventListener("keydown",h,{capture:!0}),()=>{window.removeEventListener("keydown",h,{capture:!0})}};return a.jsxs("div",{className:"fixed top-0 left-0 w-full h-full z-100 flex items-center justify-center",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-400 opacity-70",onClick:s}),a.jsxs("div",{className:"flex w-[90%] h-[90%] bg-white rounded z-10 px-2 py-4",children:[a.jsx("div",{className:"w-[50%] flex items-center justify-center overflow-hidden",children:a.jsx("canvas",{ref:e,className:"max-w-full max-h-full border"})}),a.jsxs("div",{className:"w-[50%] flex flex-col justify-between",children:[a.jsx("div",{}),a.jsx("div",{className:"w-full flex items-end",children:a.jsx("button",{type:"button",className:"border cursor-pointer",onClick:()=>{const n=window.open("","","width=600,height=600"),r=document.createElement("canvas"),d=r.getContext("2d");r.style.size="a4",r.width=e.current.width,r.height=e.current.height,d.drawImage(e.current,0,0),n.document.body.append(r),n.document.close(),n.focus(),n.print(),n.close()},children:"Print"})})]})]})]})}),wn=({file:s})=>{const o=y.useRef(null),e=y.useRef(null),[t,i]=y.useState([]),[l,n]=y.useState({x:0,y:0}),[r,d]=y.useState([]),[c,h]=y.useState(null),[u,p]=y.useState([]),[m,f]=y.useState(!1),[g,b]=y.useState([]),[w,v]=y.useState({x:0,y:0}),[M,j]=y.useState(!1),[z,E]=y.useState({id:0,hasPrev:!1,hasNext:!1}),[T,$]=y.useState({width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}),D=y.useRef(null),[S,P]=y.useState(!0),{currentFileId:L,startCreateFile:R}=y.useContext(se);y.useEffect(()=>{let N;if(e.current){const K=oe();N=new Hl({container:e.current,data:{id:K,modules:[]},config:{dpr:2},events:{onInitialized:()=>{bn(N)},onHistoryUpdated:C=>{i(C.toArray()),C.current&&E({id:C.current.id,hasPrev:!!C.current.prev,hasNext:!!C.current.next})},onModulesUpdated:C=>{const G=Array.from(C.values()).sort((re,Ee)=>re.layer-Ee.layer);d(G)},onSelectionUpdated:(C,G)=>{p(Array.from(C)),h(G)},onViewportUpdated:C=>{$(C)},onWorldMouseMove:C=>{n(C)},onContextMenu:C=>{f(!0),v(C)},onModuleCopied:C=>{b(C)}}}),o.current=N}const F=D.current;return F&&(window.addEventListener("mousedown",O),F.addEventListener("focus",B),F.addEventListener("blur",W)),()=>{F&&(window.removeEventListener("mousedown",O),F.removeEventListener("focus",B),F.removeEventListener("blur",W)),N&&N.destroy()}},[s]);const O=N=>{var F;e.current&&P((F=e.current)==null?void 0:F.contains(N.target))},B=()=>P(!0),W=()=>P(!1),U=N=>{o.current&&o.current.execute("history-pick",N)},_=(N,F)=>{if(console.log(N),N==="print"){j(!0);return}if(N==="newFile"){R();return}o.current.execute(N,F)};return a.jsx(A.Provider,{value:{focused:S,historyArray:t,selectedModules:u,selectedProps:c,historyStatus:z,copiedItems:g,viewport:T,editorRef:o,applyHistoryNode:U,executeAction:_},children:a.jsxs("div",{ref:D,"data-focused":S,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[L===s.id&&a.jsx(_l,{}),a.jsx(pn,{}),a.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[a.jsx(Zl,{}),a.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden relative",children:[a.jsx("div",{ref:e,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),a.jsx(Ql,{worldPoint:l}),m&&a.jsx(gn,{position:w,onClose:()=>{f(!1)}})]}),a.jsxs("div",{style:{width:200},className:"h-full flex-shrink-0 border-l border-gray-200",children:[a.jsx(mn,{props:c}),a.jsx(en,{data:r,selected:u}),a.jsx(fn,{})]})]}),M&&a.jsx(xn,{editorRef:o,onClose:()=>{j(!1)}})]})})},vn=s=>[],Cn=()=>{const s="Untitled 1",o={},e={modules:vn()};return{id:oe(),name:s,config:o,data:e}},Mn=s=>new Map(s.reduce((o,e)=>(o.push([e.id,e]),o),[])),Sn=Cn(),Me=Mn([Sn]),jn=()=>{const s=' group py-2 px-6 relative transition flex items-center">',o=" bg-gray-200",e=" hover:bg-gray-200",{fileList:t,currentFileId:i,closeFile:l,switchFile:n,handleCreating:r}=y.useContext(se);return a.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[t.map(d=>{const c=d.id===i,h=s+(c?o:e),u=(c?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return a.jsxs("div",{className:h,onClick:()=>{n(d.id)},children:[a.jsx("span",{children:d.name}),a.jsx("span",{onClick:p=>{l(d.id),p.preventDefault(),p.stopPropagation()},className:u,children:"×"})]},d.id)}),a.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:a.jsx(qe,{size:18,onClick:()=>{r(!0)}})})]})},Nn=({children:s,defaultValue:o})=>{const[e,t]=y.useState(!1);return a.jsxs("div",{className:"relative w-20",children:[a.jsxs("div",{className:"flex items-center",onClick:()=>{t(!e)},children:[a.jsx(Je,{}),o]}),e&&a.jsx("div",{onClick:()=>{t(!1)},className:"absolute top-full right-0 w-full",children:s})]})},Fn=()=>{const[s,o]=y.useState("en"),e={en:"English",cn:"中文",jp:"日本語"},{i18n:t}=Q();return a.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:a.jsx(Nn,{defaultValue:e[s],children:Object.keys(e).map((i,l)=>a.jsx("div",{onClick:()=>{t.changeLanguage(i),o(i)},children:e[i]},l))})})},Pn=()=>{const s=y.useRef(new Map),[o,e]=y.useState(!1),[t,i]=y.useState(""),[l,n]=y.useState([]),r=s.current.size,d=r===0||o;y.useEffect(()=>{Me.size>0&&(s.current=Me,c(),i(h()[0].id))},[]);const c=()=>{const b=h();return n(b),b},h=()=>Array.from(s.current.values()),u=b=>{console.log(l),i(b)},p=b=>{const w=l.findIndex(M=>M.id===b);let v=l.length;if(w!==-1&&(s.current.delete(b),c(),l.splice(w,1),v--,t===b&&v>0)){let M=w+1;w===0&&(M=0),M>v&&(M=v-1),i(l[M].id)}},m=b=>{s.current.set(b.id,b),c(),i(b.id)},f=()=>{e(!0)},g=b=>{e(b)};return a.jsx(se.Provider,{value:{fileMap:s.current,fileList:l,creating:o,currentFileId:t,switchFile:u,closeFile:p,createFile:m,startCreateFile:f,handleCreating:g},children:a.jsxs("div",{className:"w-full h-full flex flex-col select-none",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx(jn,{}),a.jsx(Fn,{})]}),a.jsx("div",{className:"flex-1 overflow-hidden min-h-[600px]",children:l.map(b=>a.jsx("div",{className:"outline-0 w-full h-full flex flex-col",style:{display:b.id===t?"flex":"none"},children:a.jsx(wn,{file:b})},b.id))}),d&&a.jsx(al,{bg:r?"#00000080":"#fff",onBgClick:()=>{r&&e(!1)}})]})})};function kn(){return a.jsx(Pn,{})}Qe.createRoot(document.getElementById("root")).render(a.jsx(kn,{}));
