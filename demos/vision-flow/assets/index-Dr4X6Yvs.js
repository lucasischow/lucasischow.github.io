var ke=Object.defineProperty;var $e=(e,t,o)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var m=(e,t,o)=>$e(e,typeof t!="symbol"?t+"":t,o);import{i as Ee,a as Le,r as g,j as a,L as Pe,b as ze,u as V,c as De,d as he,e as Te,f as Re,g as Ae,h as Oe,k as Ie,l as Be,m as Ve,n as Xe,o as _e,t as He,p as We,q as Ye,s as ee,v as Ue,w as Ke,P as Ge}from"./vendor-D6UkCkPc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const Ze={label:"File",tooltip:"Open the file menu"},qe={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},Je={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},Qe={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},et={label:"Save As",tooltip:"Save the current file with a new name"},tt={label:"Import File",tooltip:"Import a file into the project"},ot={label:"Export",tooltip:"Export the current file"},st={label:"Export as PNG",tooltip:"Export the file as a PNG image"},it={label:"Export as PDF",tooltip:"Export the file as a PDF document"},lt={label:"Export as CSV",tooltip:"Export the file as a CSV file"},nt={label:"Print",tooltip:"Print the current file"},rt={label:"Close File",tooltip:"Close the current file"},at={label:"Edit",tooltip:"Open the edit menu"},ct={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},dt={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},ht={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},ut={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},pt={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},ft={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},yt={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},gt={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},bt={label:"View",tooltip:"Open the view menu"},mt={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},xt={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},wt={label:"Fit to Screen",tooltip:"Fit the content to the screen"},vt={label:"Toggle Grid",tooltip:"Show or hide the grid"},Ct={label:"Toggle Guides",tooltip:"Show or hide the guides"},Mt={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},St={label:"Shape",tooltip:"Open the shape menu"},Nt={label:"Add Node",tooltip:"Add a new node to the diagram"},jt={label:"Delete Node",tooltip:"Delete the selected node"},Ft={label:"Move Node",tooltip:"Move the selected node"},kt={label:"Resize Node",tooltip:"Resize the selected node"},$t={label:"Rotate Node",tooltip:"Rotate the selected node"},Et={label:"Change Node Color",tooltip:"Change the color of the selected node"},Lt={label:"Change Node Border",tooltip:"Change the border of the selected node"},Pt={label:"Change Node Text",tooltip:"Edit the text of the selected node"},zt={label:"Group Nodes",tooltip:"Group selected nodes together"},Dt={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},Tt={label:"Lock Node",tooltip:"Lock the selected node"},Rt={label:"Unlock Node",tooltip:"Unlock the selected node"},At={label:"Connection",tooltip:"Open the connection menu"},Ot={label:"Add Edge",tooltip:"Add an edge between nodes"},It={label:"Delete Edge",tooltip:"Delete the selected edge"},Bt={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},Vt={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},Xt={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},_t={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},Ht={label:"Text",tooltip:"Open the text menu"},Wt={label:"Add Text",tooltip:"Add text to the document"},Yt={label:"Edit Text",tooltip:"Edit the selected text"},Ut={label:"Change Font",tooltip:"Change the font of the selected text"},Kt={label:"Change Font Size",tooltip:"Change the font size of the selected text"},Gt={label:"Change Font Color",tooltip:"Change the font color of the selected text"},Zt={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},qt={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},Jt={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},Qt={label:"Align Text",tooltip:"Align the selected text"},eo={label:"Layer",tooltip:"Open the layer menu"},to={label:"Send to Back",tooltip:"Send the selected layer to the back"},oo={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},so={label:"Send Backward",tooltip:"Send the selected layer one step backward"},io={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},lo={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},no={label:"Delete Layer",tooltip:"Delete the selected layer"},ro={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},ao={label:"Collaboration",tooltip:"Open the collaboration menu"},co={label:"Add Comment",tooltip:"Add a comment to the document"},ho={label:"Edit Comment",tooltip:"Edit the selected comment"},uo={label:"Delete Comment",tooltip:"Delete the selected comment"},po={label:"Share Document",tooltip:"Share the document with others"},fo={file:Ze,newFile:qe,openFile:Je,saveFile:Qe,saveAs:et,importFile:tt,exportFile:ot,exportFile_png:st,exportFile_pdf:it,exportFile_csv:lt,print:nt,closeFile:rt,edit:at,undo:ct,redo:dt,cut:ht,copy:ut,paste:pt,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:ft,selectAll:yt,findReplace:gt,view:bt,zoomIn:mt,zoomOut:xt,fitToScreen:wt,toggleGrid:vt,toggleGuides:Ct,fullscreenMode:Mt,shape:St,addNode:Nt,deleteNode:jt,moveNode:Ft,resizeNode:kt,rotateNode:$t,changeNodeColor:Et,changeNodeBorder:Lt,changeNodeText:Pt,groupNodes:zt,ungroupNodes:Dt,lockNode:Tt,unlockNode:Rt,connection:At,addEdge:Ot,deleteEdge:It,changeEdgeStyle:Bt,changeEdgeColor:Vt,changeEdgeLabel:Xt,reverseEdge:_t,text:Ht,addText:Wt,editText:Yt,changeFont:Ut,changeFontSize:Kt,changeFontColor:Gt,boldText:Zt,italicText:qt,underlineText:Jt,alignText:Qt,layer:eo,sendToBack:to,bringToFront:oo,sendBackward:so,bringForward:io,duplicateLayer:lo,deleteLayer:no,toggleLayerVisibility:ro,collaboration:ao,addComment:co,editComment:ho,deleteComment:uo,shareDocument:po},yo={"history-init":{label:"Init",tooltip:"Initialize the file"},"history-add":{label:"Add",tooltip:"Add modules to the file"},"history-delete":{label:"Delete",tooltip:"Delete modules from the file"},"history-paste":{label:"Paste",tooltip:"Paste modules into the file"},"history-duplicate":{label:"Duplicate",tooltip:"Duplicate selected modules"},"history-modify":{label:"Modify",tooltip:"Modify the properties of modules"},"history-move":{label:"Move",tooltip:"Move modules"},"history-reorder":{label:"Reorder",tooltip:"Reorder modules"},"history-select":{label:"Select",tooltip:"Select modules"},"history-group":{label:"Group",tooltip:"Group modules"},"history-ungroup":{label:"Ungroup",tooltip:"Ungroup modules"},"history-composite":{label:"Composite",tooltip:"Composite operation"}},go={history:yo},bo={label:"文件",tooltip:"打开文件菜单"},mo={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},xo={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},wo={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},vo={label:"另存为",tooltip:"以新名称保存当前文件"},Co={label:"导入文件",tooltip:"将文件导入到项目中"},Mo={label:"导出",tooltip:"导出当前文件"},So={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},No={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},jo={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},Fo={label:"打印",tooltip:"打印当前文件"},ko={label:"关闭文件",tooltip:"关闭当前文件"},$o={label:"编辑",tooltip:"打开编辑菜单"},Eo={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},Lo={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},Po={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},zo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},Do={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},To={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},Ro={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},Ao={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},Oo={label:"视图",tooltip:"打开视图菜单"},Io={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},Bo={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},Vo={label:"适应屏幕",tooltip:"使内容适应屏幕"},Xo={label:"切换网格",tooltip:"显示或隐藏网格"},_o={label:"切换参考线",tooltip:"显示或隐藏参考线"},Ho={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},Wo={label:"形状",tooltip:"打开形状菜单"},Yo={label:"添加节点",tooltip:"向图表添加新节点"},Uo={label:"删除节点",tooltip:"删除选定的节点"},Ko={label:"移动节点",tooltip:"移动选定的节点"},Go={label:"调整节点大小",tooltip:"调整选定节点的大小"},Zo={label:"旋转节点",tooltip:"旋转选定的节点"},qo={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},Jo={label:"更改节点边框",tooltip:"更改选定节点的边框"},Qo={label:"更改节点文本",tooltip:"编辑选定节点的文本"},es={label:"组合节点",tooltip:"将选定的节点组合在一起"},ts={label:"取消组合节点",tooltip:"取消组合选定的节点"},os={label:"锁定节点",tooltip:"锁定选定的节点"},ss={label:"解锁节点",tooltip:"解锁选定的节点"},is={label:"连接",tooltip:"打开连接菜单"},ls={label:"添加边",tooltip:"在节点之间添加边"},ns={label:"删除边",tooltip:"删除选定的边"},rs={label:"更改边样式",tooltip:"更改选定边的样式"},as={label:"更改边颜色",tooltip:"更改选定边的颜色"},cs={label:"更改边标签",tooltip:"更改选定边的标签"},ds={label:"反转边",tooltip:"反转选定边的方向"},hs={label:"文本",tooltip:"打开文本菜单"},us={label:"添加文本",tooltip:"向文档添加文本"},ps={label:"编辑文本",tooltip:"编辑选定的文本"},fs={label:"更改字体",tooltip:"更改选定文本的字体"},ys={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},gs={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},bs={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},ms={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},xs={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},ws={label:"对齐文本",tooltip:"对齐选定的文本"},vs={label:"图层",tooltip:"打开图层菜单"},Cs={label:"置于底层",tooltip:"将选定的图层置于底层"},Ms={label:"置于顶层",tooltip:"将选定的图层置于顶层"},Ss={label:"下移一层",tooltip:"将选定的图层下移一层"},Ns={label:"上移一层",tooltip:"将选定的图层上移一层"},js={label:"复制图层",tooltip:"复制选定的图层"},Fs={label:"删除图层",tooltip:"删除选定的图层"},ks={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},$s={label:"协作",tooltip:"打开协作菜单"},Es={label:"添加评论",tooltip:"向文档添加评论"},Ls={label:"编辑评论",tooltip:"编辑选定的评论"},Ps={label:"删除评论",tooltip:"删除选定的评论"},zs={label:"分享文档",tooltip:"与他人分享文档"},Ds={file:bo,newFile:mo,openFile:xo,saveFile:wo,saveAs:vo,importFile:Co,exportFile:Mo,exportFile_png:So,exportFile_pdf:No,exportFile_csv:jo,print:Fo,closeFile:ko,edit:$o,undo:Eo,redo:Lo,cut:Po,copy:zo,paste:Do,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:To,selectAll:Ro,findReplace:Ao,view:Oo,zoomIn:Io,zoomOut:Bo,fitToScreen:Vo,toggleGrid:Xo,toggleGuides:_o,fullscreenMode:Ho,shape:Wo,addNode:Yo,deleteNode:Uo,moveNode:Ko,resizeNode:Go,rotateNode:Zo,changeNodeColor:qo,changeNodeBorder:Jo,changeNodeText:Qo,groupNodes:es,ungroupNodes:ts,lockNode:os,unlockNode:ss,connection:is,addEdge:ls,deleteEdge:ns,changeEdgeStyle:rs,changeEdgeColor:as,changeEdgeLabel:cs,reverseEdge:ds,text:hs,addText:us,editText:ps,changeFont:fs,changeFontSize:ys,changeFontColor:gs,boldText:bs,italicText:ms,underlineText:xs,alignText:ws,layer:vs,sendToBack:Cs,bringToFront:Ms,sendBackward:Ss,bringForward:Ns,duplicateLayer:js,deleteLayer:Fs,toggleLayerVisibility:ks,collaboration:$s,addComment:Es,editComment:Ls,deleteComment:Ps,shareDocument:zs},Ts={"history-init":{label:"初始化",tooltip:"初始化文件"},"history-add":{label:"添加",tooltip:"向文件添加模块"},"history-delete":{label:"删除",tooltip:"从文件中删除模块"},"history-paste":{label:"粘贴",tooltip:"将模块粘贴到文件中"},"history-duplicate":{label:"复制",tooltip:"复制选定的模块"},"history-modify":{label:"修改",tooltip:"修改模块的属性"},"history-move":{label:"移动",tooltip:"移动模块"},"history-reorder":{label:"重新排序",tooltip:"重新排序模块"},"history-select":{label:"选择",tooltip:"选择模块"},"history-group":{label:"组合",tooltip:"组合模块"},"history-ungroup":{label:"取消组合",tooltip:"取消模块组合"},"history-composite":{label:"复合操作",tooltip:"复合操作"}},Rs={history:Ts},As={label:"ファイル",tooltip:"ファイルメニューを開く"},Os={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},Is={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},Bs={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},Vs={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},Xs={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},_s={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Hs={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},Ws={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},Ys={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},Us={label:"印刷",tooltip:"現在のファイルを印刷"},Ks={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Gs={label:"編集",tooltip:"編集メニューを開く"},Zs={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},qs={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},Js={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},Qs={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},ei={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},ti={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},oi={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},si={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},ii={label:"表示",tooltip:"表示メニューを開く"},li={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},ni={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},ri={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},ai={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},ci={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},di={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},hi={label:"図形",tooltip:"図形メニューを開く"},ui={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},pi={label:"ノードを削除",tooltip:"選択したノードを削除"},fi={label:"ノードを移動",tooltip:"選択したノードを移動"},yi={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},gi={label:"ノードを回転",tooltip:"選択したノードを回転"},bi={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},mi={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},xi={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},wi={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},vi={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},Ci={label:"ノードをロック",tooltip:"選択したノードをロック"},Mi={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},Si={label:"接続",tooltip:"接続メニューを開く"},Ni={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},ji={label:"エッジを削除",tooltip:"選択したエッジを削除"},Fi={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},ki={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},$i={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},Ei={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},Li={label:"テキスト",tooltip:"テキストメニューを開く"},Pi={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},zi={label:"テキストを編集",tooltip:"選択したテキストを編集"},Di={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},Ti={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},Ri={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},Ai={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},Oi={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},Ii={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},Bi={label:"テキストを配置",tooltip:"選択したテキストを配置"},Vi={label:"レイヤー",tooltip:"レイヤーメニューを開く"},Xi={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},_i={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Hi={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},Wi={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},Yi={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},Ui={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},Ki={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Gi={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},Zi={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},qi={label:"コメントを編集",tooltip:"選択したコメントを編集"},Ji={label:"コメントを削除",tooltip:"選択したコメントを削除"},Qi={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},el={file:As,newFile:Os,openFile:Is,saveFile:Bs,saveAs:Vs,importFile:Xs,exportFile:_s,exportFile_png:Hs,exportFile_pdf:Ws,exportFile_csv:Ys,print:Us,closeFile:Ks,edit:Gs,undo:Zs,redo:qs,cut:Js,copy:Qs,paste:ei,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:ti,selectAll:oi,findReplace:si,view:ii,zoomIn:li,zoomOut:ni,fitToScreen:ri,toggleGrid:ai,toggleGuides:ci,fullscreenMode:di,shape:hi,addNode:ui,deleteNode:pi,moveNode:fi,resizeNode:yi,rotateNode:gi,changeNodeColor:bi,changeNodeBorder:mi,changeNodeText:xi,groupNodes:wi,ungroupNodes:vi,lockNode:Ci,unlockNode:Mi,connection:Si,addEdge:Ni,deleteEdge:ji,changeEdgeStyle:Fi,changeEdgeColor:ki,changeEdgeLabel:$i,reverseEdge:Ei,text:Li,addText:Pi,editText:zi,changeFont:Di,changeFontSize:Ti,changeFontColor:Ri,boldText:Ai,italicText:Oi,underlineText:Ii,alignText:Bi,layer:Vi,sendToBack:Xi,bringToFront:_i,sendBackward:Hi,bringForward:Wi,duplicateLayer:Yi,deleteLayer:Ui,toggleLayerVisibility:Ki,collaboration:Gi,addComment:Zi,editComment:qi,deleteComment:Ji,shareDocument:Qi},tl={"history-init":{label:"初期化",tooltip:"ファイルを初期化する"},"history-add":{label:"追加",tooltip:"ファイルにモジュールを追加する"},"history-delete":{label:"削除",tooltip:"ファイルからモジュールを削除する"},"history-paste":{label:"貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},"history-duplicate":{label:"複製",tooltip:"選択したモジュールを複製する"},"history-modify":{label:"修正",tooltip:"モジュールのプロパティを修正する"},"history-move":{label:"移動",tooltip:"モジュールを移動する"},"history-reorder":{label:"並べ替え",tooltip:"モジュールを並べ替える"},"history-select":{label:"選択",tooltip:"モジュールを選択する"},"history-group":{label:"グループ化",tooltip:"モジュールをグループ化する"},"history-ungroup":{label:"グループ化解除",tooltip:"モジュールのグループ化を解除する"},"history-composite":{label:"複合操作",tooltip:"複合操作"}},ol={history:tl},sl={en:{translation:{...fo,...go}},cn:{translation:{...Ds,...Rs}},jp:{translation:{...el,...ol}}};Ee.use(Le).init({resources:sl,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const W=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),te=g.createContext({fileMap:new Map([["fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",{id:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",name:"Untitled 1",config:{},data:{}}]]),fileList:[],currentFileId:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{}}),il=({bg:e="#fff",onBgClick:t})=>{const o=g.useRef(null),{createFile:s,handleCreating:i}=g.useContext(te),[l,n]=g.useState(""),r=d=>/^[a-zA-Z0-9-_ ]+$/.test(d),c=d=>{var p;d.preventDefault(),d.stopPropagation();const h=(p=o.current)==null?void 0:p.filename.value.trim();if(!r(h)){n("File name can only including number space and alpha");return}n("");const u={id:W(),name:h,data:{},config:{}};s(u),i(!1)};return a.jsxs("div",{className:"fixed top-0 left-0 z-20 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[a.jsx("div",{style:{backgroundColor:e},onClick:()=>t&&t(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),a.jsxs("form",{ref:o,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:c,children:[a.jsx("h1",{className:"text-xl text-center",children:"New File"}),a.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),a.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),l&&a.jsx("div",{className:"text-red-500 my-2",children:l}),a.jsx("label",{className:"justify-center",children:a.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})};class ie{constructor(t,o,s,i=-1){m(this,"data");m(this,"prev");m(this,"next");m(this,"id");this.data=s,this.prev=t,this.next=o,this.id=i}}class ll{constructor(){m(this,"head");m(this,"tail");m(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(t){let o;const{tail:s}=this;return s?(o=new ie(s,null,t,s.id+1),s.next=o,this.tail=o):(o=new ie(null,null,t,0),this.head=o,this.tail=o),this.current=o,o}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(t){if(t===this.current)return"equal";let o=this.head;for(;o;){if(this.current===o)return"behind";if(t===o)return"front";o=o.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}class nl extends ll{constructor(o){super();m(this,"editor");this.editor=o,this.init()}init(){var o,s;this.append({type:"history-init",payload:{state:null,selectedModules:new Set}}),(s=(o=this.editor.events).onHistoryUpdated)==null||s.call(o,this)}add(o){var s,i;this.detach(),this.append(o),(i=(s=this.editor.events).onHistoryUpdated)==null||i.call(s,this)}toArray(){const o=[];if(this.head){let s=this.head;for(o.push(s);s.next;)o.push(s.next),s=s.next}return o}compareToCurrentPosition(o){return super.compareToCurrentPosition(o)}forward(){return super.forward()}back(){return super.back()}}class rl{constructor(){m(this,"eventsMap",new Map)}on(t,o){this.eventsMap.has(t)?this.eventsMap.get(t).push(o):this.eventsMap.set(t,[o])}off(t,o){if(this.eventsMap.has(t)){const s=this.eventsMap.get(t);for(let i=s.length-1;i>=0;i--)if(s[i]===o)return s.splice(i,1),"deleted";return"Cannot find event or function"}}dispatch(t,o){console.info("action: ",t),this.eventsMap.has(t)&&this.eventsMap.get(t).forEach(s=>{s(o)})}execute(t,o){this.dispatch(t,o)}destroy(){this.eventsMap.clear()}}const al=({x:e,y:t,width:o,height:s},i)=>{const l=e+o/2,n=t+s/2,r=i*Math.PI/180,c=Math.cos(r),d=Math.sin(r),h=Math.abs(o*c)+Math.abs(s*d),u=Math.abs(o*d)+Math.abs(s*c),p=l-h/2,y=n-u/2;return oe({x:p,y,width:h,height:u})},oe=e=>{const{x:t,y:o,width:s,height:i}=e;return{x:t,y:o,width:s,height:i,top:o,bottom:o+i,left:t,right:t+s,cx:t+s/2,cy:o+i/2}},A=(e,t)=>{const o=Math.min(e.x,t.x),s=Math.max(e.x,t.x),i=Math.min(e.y,t.y),l=Math.max(e.y,t.y);return oe({x:o,y:i,width:s-o,height:l-i})};function cl(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}function dl(e,t){return e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom}const le=({x:e,y:t},o,s)=>{const{x:i,y:l,width:n,height:r}=o;if(n<=0||r<=0)return!1;if(s===0){const w=n/2,v=r/2;return e>=i-w&&e<=i+w&&t>=l-v&&t<=l+v}const c=s*(Math.PI/180),d=Math.cos(c),h=Math.sin(c),u=e-i,p=t-l,y=u*d+p*h,b=-u*h+p*d,f=n/2,x=r/2;return y>=-f&&y<=f&&b>=-x&&b<=x},Z=e=>e===0&&1/e===-1/0;function hl(e,t){let o=0,s;return(...i)=>{const l=Date.now(),n=()=>{o=l,e(...i)};l-o>=t?n():(s!==void 0&&clearTimeout(s),s=setTimeout(n,t-(l-o)))}}function ue(e){return e===null?"null":e===void 0?"undefined":e instanceof Set?"set":e instanceof Map?"map":Array.isArray(e)?"array":e instanceof Date?"date":e instanceof RegExp?"regexp":e instanceof Error?"error":e instanceof Promise?"promise":e instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(e)?"typedarray":e instanceof WeakSet?"weakset":e instanceof WeakMap?"weakmap":typeof e=="function"?"function":typeof e=="symbol"?"symbol":typeof e=="bigint"?"bigint":typeof e=="object"?"object":typeof e}function J(e,t={}){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(s=>J(s,t));const o=Object.create(t.clonePrototype?Object.getPrototypeOf(e):null);for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=J(e[s],t));return o}class pe{constructor({id:t,type:o,lineColor:s,lineWidth:i=1,opacity:l=100,layer:n=1,rotation:r=0,shadow:c=!1,enableLine:d=!0}){m(this,"id");m(this,"type");m(this,"enableLine");m(this,"lineWidth");m(this,"lineColor");m(this,"opacity");m(this,"rotation");m(this,"shadow");m(this,"layer");this.id=t,this.type=o,this.enableLine=d,this.lineColor=s,this.lineWidth=i,this.opacity=l,this.rotation=r,this.shadow=c,this.layer=n}getDetails(){return{id:this.id,type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,layer:this.layer,rotation:this.rotation}}getBoundingRect(){return{x:0,y:0,width:0,height:0,top:0,left:0,right:0,bottom:0,cx:0,cy:0}}}class ul extends pe{constructor({x:o,y:s,fillColor:i,enableFill:l=!0,width:n,height:r,...c}){super(c);m(this,"x");m(this,"y");m(this,"width");m(this,"height");m(this,"fillColor");m(this,"enableFill");this.x=o,this.y=s,this.width=n,this.height=r,this.fillColor=i,this.enableFill=l}getDetails(){return{...this.getSize(),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y,width:this.width,height:this.height,...super.getDetails()}}getSize(){return{width:0,height:0}}getBoundingRect(){const{x:o,y:s,width:i,height:l,rotation:n}=this,r=o-i/2,c=s-l/2;return n===0?{x:r,y:c,width:i,height:l,left:r,top:c,right:r+i,bottom:c+l,cx:o,cy:s}:al({x:r,y:c,width:i,height:l},n)}move(o,s){this.x+=o,this.y+=s}}class pl extends ul{constructor({...t}){super(t)}getDetails(){return super.getDetails()}getBoundingRect(){return super.getBoundingRect()}}class fl extends pe{constructor({start:o,end:s,...i}){super(i);m(this,"start");m(this,"end");this.start=o,this.end=s}getDetails(){return{...this.getSize(),...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}={x:0,y:1},{width:i,height:l}=this.getSize();return{x:o,y:s,width:i,height:l,top:s,left:o,right:o+i,bottom:s+l}}}function yl(e){const t=J(e),o=new Map,s=i=>{if(i.id||(i.id=this.createModuleId),i.type==="rectangle")return new pl(i);if(i.type==="connector")return new fl(i)};return t.forEach(i=>{const l=s.call(this,i);o.set(i.id,l)}),o}function gl(e){var t,o;return e.forEach(s=>{this.moduleMap.set(s.id,s)}),(o=(t=this.events).onModulesUpdated)==null||o.call(t,this.moduleMap),e}function bl(e,t=!1,o){const s=[],i=new Map;return e.forEach(l=>{const n=this.moduleMap.get(l);n&&i.set(l,n)}),i.forEach(l=>{const n=l.getDetails();t&&delete n.id,ue(o)==="object"&&Object.assign(n,o),s.push(n)}),s}function ml(e){const t=this.batchCopy(e);return t.forEach(o=>{this.moduleMap.delete(o.id)}),t}function xl(e,t){this.getModulesByIdSet(e).forEach(s=>{s.x+=t.x,s.y+=t.y})}function wl(e,t,o){this.getModulesByIdSet(e).forEach(i=>{Object.keys(t).forEach(l=>{i[l]=t[l]})})}function vl(e,t,o,s){return{x:(e.x*s-t.x*s)/o,y:(e.y*s-t.y*s)/o}}function Cl(e,t,o,s){return{x:(e.x*o+t.x*s)/s,y:(e.y*o+t.y*s)/s}}const Ml=(e,t)=>{if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0},Sl=(e,t)=>{const o=new Set;for(const s of e)t.has(s)||o.add(s);for(const s of t)e.has(s)||o.add(s);return o};function Nl(e,t,o){const{x:s,y:i,id:l,width:n,height:r,rotation:c}=e,d=[{type:"rotate",name:"rotate-tl",x:0,y:0,offsetX:-.5,offsetY:-.5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-tr",x:1,y:0,offsetX:.5,offsetY:-.5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-br",x:1,y:1,offsetX:.5,offsetY:.5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-bl",x:0,y:1,offsetX:-.5,offsetY:.5,originCursor:"rotate",cursor:"rotate"},{type:"resize",name:"tl",x:0,y:0,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"t",x:.5,y:0,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"tr",x:1,y:0,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"r",x:1,y:.5,originCursor:"ew-resize",cursor:"ew-resize"},{type:"resize",name:"br",x:1,y:1,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"b",x:.5,y:1,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"bl",x:0,y:1,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"l",x:0,y:.5,originCursor:"ew-resize",cursor:"ew-resize"}],h=10,u=1,p=h/t*o,y=u/t*o;return d.map(f=>{const x=s-n/2+f.x*n,w=i-r/2+f.y*r;let v=f.cursor,N,M=0,C;if(f.type==="resize")C=ne(x,w,s,i,c),v=jl(C.x,C.y,s,i,c),N=p,M=y;else{const S=x+f.offsetX*p,F=w+f.offsetY*p;C=ne(S,F,s,i,c),N=p*2}return{id:`${l}`,type:f.type,name:f.name,cursor:v,moduleOrigin:{cx:s,cy:i,width:n,height:r},data:{x:C.x,y:C.y,size:N,lineWidth:M,rotation:c}}})}function ne(e,t,o,s,i){const l=e-o,n=t-s,r=i*(Math.PI/180),c=Math.cos(r),d=Math.sin(r);return{x:o+l*c-n*d,y:s+l*d+n*c}}function jl(e,t,o,s,i=4){const l=e-o,n=t-s,r=Math.abs(l),c=Math.abs(n);if(r>i&&c>i){if(l<0&&n<0)return"nwse-resize";if(l>0&&n<0)return"nesw-resize";if(l>0&&n>0)return"nwse-resize";if(l<0&&n>0)return"nesw-resize"}return r<=i&&c>i?"ns-resize":c<=i&&r>i?"ew-resize":"default"}function Fl(e,t=!1){const o=(()=>{switch(e){case"tl":return{dx:-1,dy:-1,cx:.5,cy:.5};case"t":return{dx:0,dy:-1,cx:0,cy:.5};case"tr":return{dx:1,dy:-1,cx:-.5,cy:.5};case"r":return{dx:1,dy:0,cx:-.5,cy:0};case"br":return{dx:1,dy:1,cx:-.5,cy:-.5};case"b":return{dx:0,dy:1,cx:0,cy:-.5};case"bl":return{dx:-1,dy:1,cx:.5,cy:-.5};case"l":return{dx:-1,dy:0,cx:.5,cy:0};default:throw new Error(`Unsupported resize handle: ${e}`)}})();return t?{...o,cx:0,cy:0}:o}function fe({downPoint:e,movePoint:t,initialWidth:o,initialHeight:s,initialCX:i,initialCY:l,rotation:n,handleName:r,scale:c,dpr:d,altKey:h=!1,shiftKey:u=!1}){const p=t.x-e.x,y=t.y-e.y,b=p/c*d,f=y/c*d,x=-n*(Math.PI/180),w=Math.cos(x),v=Math.sin(x),N=b*w-f*v,M=b*v+f*w,C=Fl(r,h);let S=N*C.dx,F=M*C.dy;if(u){const D=o/s,G=Math.abs(S),Fe=Math.abs(F);C.dx!==0&&C.dy!==0?G>Fe?F=S/D:S=F*D:C.dx!==0?F=S/D:C.dy!==0&&(S=F*D)}const $=h?2:1,R=Math.abs(o+S*$),O=Math.abs(s+F*$),P=-S*C.cx*$,k=-F*C.cy*$,E=P*w+k*v,K=-P*v+k*w,j=i+E,z=l+K;return{x:j,y:z,width:R,height:O}}function I(e,t){if(ue(e)!=="set")return;if(e.size===1){const s=[...e.values()][0];this.moduleMap.has(s)&&this.moduleMap.get(s).getDetails()}const o=this.getSelected;this.selectedModules.clear(),t==="replace"&&o.clear(),e.forEach(s=>{switch(t){case"add":o.add(s);break;case"delete":o.delete(s);break;case"toggle":o.has(s)?o.delete(s):o.add(s);break;case"replace":o.add(s);break}}),o.forEach(s=>this.selectedModules.add(s))}function X(){this.visibleSelected.clear(),this.operationHandlers.clear(),this.getVisibleModuleMap.forEach(t=>{this.selectedModules.has(t.id)&&this.visibleSelected.add(t.id)});const e=this.getSelectedPropsIfUnique();if(e){const{scale:t,dpr:o}=this.viewport;Nl(e,t,o).forEach(s=>{this.operationHandlers.add(s)})}}const T=(e,t,o)=>{const s=document.createElement(e);return s.setAttribute(t,""),s.id=t+"-"+o,s};function kl(e){const t="#1FB3FF",o="rgba(31,180,255,0.1)",s=T("div","editor-wrapper",e),i=T("canvas","editor-main-canvas",e),l=T("canvas","editor-selection-canvas",e),n=T("div","scroll-bar-x",e),r=T("div","scroll-bar-x",e),c=T("div","editor-selection-box",e),d=T("div","editor-cursor",e),h=T("style","editor-style",e);return h.textContent=`
    #${i.id} {
      background-color: #f0f0f0;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${l.id} {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${s.id} {
      user-select: none;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: #787878 transparent;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    #${c.id} {
      display: none;
      pointer-events: none;
      position: absolute;
      border: 1px solid ${t};
      background-color: ${o};
    }
    
    #${n.id},
    #${r.id}{
      background-color: #787878;
      user-select:none;
      translate:none;
    }
    
    #${d.id}{
      display: none;
      pointer-events: none;
      width:20px;
      height:20px;
    }
    
    #${d.id} svg{
      width:18px;
      height:18px;
    }
  `,s.append(i,l,n,r,c,d,h),{wrapper:s,selectionBox:c,selectionCanvas:l,mainCanvas:i,scrollBarX:n,scrollBarY:r,cursor:d}}const $l=(e,t)=>{e.style.width="50px",e.style.height="6px",e.style.position="absolute",e.style.bottom="0",e.style.left="0",t.style.width="6px",t.style.height="50px",t.style.position="absolute",t.style.right="0",t.style.top="0"},ye=(e,{x:t,y:o,height:s,width:i},l=!0)=>{e.style.transform=`translate(${t}px, ${o}px)`,e.style.width=i+"px",e.style.height=s+"px",e.style.display=l?"block":"none"},_=(e,t,o,s)=>{if(o==="hide"){t.style.display="none",e.style.cursor="default";return}t.innerHTML=`
       <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.99 18.93">
  <path d="M15.57,16.04c.48-.57,1-1.1,1.5-1.65.35-.38.54-.85,1.15-.82.72.04,1.01.78.55,1.34-1.07,1.3-2.37,2.5-3.44,3.82-.69.48-1.09,0-1.56-.48-.91-.95-1.92-2.07-2.78-3.07-.3-.35-.58-.72-.33-1.19.39-.73,1.08-.39,1.53.07.52.55,1.01,1.17,1.51,1.74.07.08.17.19.26.22,0-.81.02-1.64-.08-2.44-.51-4.07-3.48-7.36-7.47-8.32-1.12-.27-2.22-.25-3.37-.24.15.2.34.39.52.56.51.47,1.2.95,1.66,1.44.69.73-.3,1.84-1.1,1.19-.91-.74-1.83-1.68-2.7-2.48-.38-.35-1.06-.81-1.29-1.26-.21-.4-.1-.54.14-.89C1.59,2.57,2.79,1.18,4.11.18c.76-.58,1.72.38,1.13,1.14l-2.3,2.09c.76.04,1.52-.01,2.28.06,5.2.47,9.42,4.43,10.22,9.59.15.99.1,1.98.14,2.98Z"/>
</svg>
  `,t.style.display="block",e.style.cursor="none";const l=24/2,n=s.x-o.x,r=s.y-o.y;let h=Math.atan2(r,n)*(180/Math.PI);h<0&&(h+=360),h+=45,t.style.transformOrigin="center center",t.style.transform=`translate(${s.x-l}px, ${s.y-l}px) rotate(${h}deg)`},ge=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.filter(o=>{const s=Object.keys(o).sort().map(i=>`${i}:${String(o[i])}`).join(";");return t.has(s)?!1:(t.add(s),!0)})},be=(e,t)=>{let o=t;o.length>1e3&&(o=t.map(i=>({...i,x:Math.floor(i.x),y:Math.floor(i.y),width:Math.floor(i.width),height:Math.floor(i.height)})));const s=ge(o);e.save(),s.forEach(({x:i,y:l,width:n,height:r,fillColor:c="",lineColor:d="",lineWidth:h=1,radius:u=0,opacity:p=100,gradient:y,rotation:b=0,dashLine:f=""})=>{const x=n/2,w=r/2;e.save(),e.translate(i,l),b>0&&e.rotate(b*Math.PI/180),p>0&&(e.fillStyle=c,e.globalAlpha=p/100),h>0&&(e.lineWidth=h,e.strokeStyle=d,e.lineJoin="round"),e.beginPath(),f&&e.setLineDash([3,5]),u>0?(e.moveTo(-x+u,-w),e.arcTo(x,-w,x,w,u),e.arcTo(x,w,-x,w,u),e.arcTo(-x,w,-x,-w,u),e.arcTo(-x,-w,x,-w,u)):e.rect(-x,-w,n,r),e.closePath(),p>0&&e.fill(),h>0&&e.stroke(),e.restore()})},El=(e,t)=>{const o=new Set,s=",";e.save(),t.forEach(r=>{const c=Object.values(r).join(s);o.add(c)});let i=NaN,l="";const n=new Path2D;o.forEach(r=>{const c=r.split(s),d=parseFloat(c[0]),h=parseFloat(c[1]),u=parseFloat(c[2]),p=parseFloat(c[3]),y=c[4],b=parseFloat(c[5]);b!==i&&(e.lineWidth=b,i=b),y!==l&&(e.fillStyle=y,l=y),n.moveTo(d,h),n.lineTo(u,p)}),e.stroke(n),e.restore()},Ll=({ctx:e,modules:t,frame:o})=>{const i=[{...o,x:o.cx,y:o.cy}],l=[],n=[];t.forEach(r=>{if(r.type==="rectangle"){const{x:c,y:d,width:h,height:u,enableFill:p,enableLine:y,opacity:b,lineWidth:f,fillColor:x,lineColor:w,rotation:v,gradient:N,radius:M,layer:C}=r.getDetails();(p&&b>0||y)&&i.push({x:c,y:d,width:h,height:u,fillColor:x,opacity:b,lineWidth:f,lineColor:w,rotation:v,gradient:N,radius:M})}if(r.type==="connector"){const c=t.get(r.start),d=t.get(r.end),h=c.getBoundingRect(),u=d.getBoundingRect();l.push({startX:h.centerX,startY:h.bottom,endX:u.centerX,endY:u.top,fillStyle:"#5491f8",lineWidth:1})}}),be(e,i),El(e,l),Pl(e,n)},Pl=(e,t)=>{e.font="100px sans-serif",e.textBaseline="middle",t.forEach(({id:o,x:s,y:i,width:l,height:n})=>{e.save(),e.translate(s,i),e.fillText(o,s-l/2,i-n/2,100),e.restore()})},zl=(e,t)=>{let o=t;o.length>1e3&&(o=t.map(i=>({...i,x:Math.floor(i.x),y:Math.floor(i.y)})));const s=ge(o);e.save(),s.forEach(({x:i,y:l,r1:n,r2:r,fillColor:c="",lineColor:d="",lineWidth:h=1,opacity:u=100,gradient:p,rotation:y=0,dashLine:b=""})=>{e.save(),e.translate(i,l),y!==0&&e.rotate(y*Math.PI/180),u>0&&(e.fillStyle=c,e.globalAlpha=u/100),h>0&&(e.lineWidth=h,e.strokeStyle=d,e.lineJoin="round"),e.beginPath(),e.ellipse(0,0,n,r,0,0,Math.PI*2),b?e.setLineDash([3,5]):e.setLineDash([]),e.closePath(),u>0&&e.fill(),h>0&&e.stroke(),p&&(e.fillStyle=p,u>0&&e.fill()),e.restore()})};function Dl(){if(this.moduleMap.size===0)return;const{selectionCTX:e,dpr:t,offset:o,worldRect:s,scale:i,mouseMovePoint:l}=this.viewport,n=[],r=[],c="#5491f8",d="#5491f8",h=this.getVisibleSelected,u=new Set(h),p=2/this.viewport.scale*this.viewport.dpr;if(this.hoveredModule&&u.add(this.hoveredModule),u.forEach(y=>{const b=this.moduleMap.get(y),{x:f,y:x,width:w,height:v,rotation:N,lineWidth:M}=b.getDetails(),C={x:f,y:x,width:p*2,height:p*2,fillColor:c,lineColor:"transparent",lineWidth:M/this.viewport.scale*this.viewport.dpr,rotation:N,opacity:100},S={x:f,y:x,width:w,height:v,fillColor:c,lineColor:d,lineWidth:M/this.viewport.scale*this.viewport.dpr,rotation:N,opacity:0,dashLine:"[3, 5]"};n.push(S),y!==this.hoveredModule&&n.push(C)}),this.operationHandlers.forEach(y=>{switch(y.type){case"resize":{const b={...y.data,width:y.data.size,height:y.data.size,opacity:100,fillColor:"#fff",lineColor:d};n.push(b)}break}}),this.hoveredModule){const{x:y,y:b}=this.getVisibleModuleMap.get(this.hoveredModule);r.push({x:y,y:b,lineColor:"transparent",fillColor:c,r1:p,r2:p})}be(e,n),zl(e,r)}const Tl=(e,t,o=.98)=>{const{width:s,height:i}=t,{width:l,height:n}=e,r=s/l,c=i/n,d=Math.min(r,c)*o,h=(s-l*d)/2-e.x*d,u=(i-n*d)/2-e.y*d;return{scale:d,offsetX:h,offsetY:u}},Rl=(e="A4")=>{let t=0,o=0;const s=0,i=0;if(e==="A4"||e==="A4L"){const n=1.414142857;e==="A4L"?(o=1e3,t=n*o):(t=1e3,o=n*t)}else e==="photo1"&&(t=35,o=55);return{...oe({x:s,y:i,width:t,height:o}),opacity:100,lineWidth:1,lineColor:"#000000",fillColor:"#fff"}};function me(){const{viewport:e}=this,t=this.getWorldPointByViewportPoint(e.mouseMovePoint.x,e.mouseMovePoint.y);let o=Number.MIN_SAFE_INTEGER,s=null;const i=[...this.operationHandlers].filter(n=>{const{x:r,y:c,size:d,rotation:h}=n.data;return le(t,{x:r,y:c,width:d,height:d},h)}),l=i[i.length-1];if(l)return console.log(l),this.action.dispatch("module-hover-enter",l.id),l;this.getVisibleModuleMap.forEach(n=>{if(n.type==="rectangle"){const{id:r,layer:c,x:d,y:h,width:u,height:p,rotation:y}=n;le(t,{x:d,y:h,width:u,height:p},y)&&c>o&&(o=c,s=r)}}),this.hoveredModule!==s&&(this.hoveredModule&&this.action.dispatch("module-hover-leave",this.hoveredModule),s&&this.action.dispatch("module-hover-enter",s))}function se(e,t){const{mouseDownPoint:o,mouseMovePoint:s,scale:i,dpr:l}=this.viewport,{name:n,data:{rotation:r},moduleOrigin:c,id:d}=this._resizingOperator,{cx:h,cy:u,width:p,height:y}=c,b=this.moduleMap.get(d),f=fe({downPoint:o,movePoint:s,dpr:l,scale:i,initialWidth:p,initialHeight:y,rotation:r,handleName:n,altKey:e,shiftKey:t,initialCX:h,initialCY:u});return b.x=f.x,b.y=f.y,b.width=f.width,b.height=f.height,f}function xe(e){const{mouseDownPoint:t,mouseMovePoint:o,scale:s,dpr:i}=this.viewport,{data:{rotation:l},moduleOrigin:n,id:r}=this._rotatingOperator,{cx:c,cy:d}=n,h=this.moduleMap.get(r),u=(t.x-this.viewport.offset.x)/s*i,p=(t.y-this.viewport.offset.y)/s*i,y=(o.x-this.viewport.offset.x)/s*i,b=(o.y-this.viewport.offset.y)/s*i,f=Math.atan2(p-d,u-c);let w=(Math.atan2(b-d,y-c)-f)*(180/Math.PI);e&&(w=Math.round(w/15)*15);let v=(l+w)%360;return v<0&&(v+=360),h.rotation=v,{rotation:h.rotation}}function Al(e){const{shiftKey:t,clientY:o,target:s,clientX:i,metaKey:l,ctrlKey:n}=e;if(s!==this.viewport.wrapper)return;const r=n||l||t,c=i-this.viewport.rect.x,d=o-this.viewport.rect.y;this.viewport.mouseDownPoint.x=c,this.viewport.mouseDownPoint.y=d,this.viewport.mouseMovePoint.x=c,this.viewport.mouseMovePoint.y=d;const h=me.call(this);if(e.preventDefault(),this.viewport.spaceKeyDown)return this.manipulationStatus="panning";if(h){if(h.type==="resize")return this._resizingOperator=h,this.manipulationStatus="resizing";if(h.type==="rotate")return this._rotatingOperator=h,this.manipulationStatus="rotating"}const u=this.hoveredModule;if(!u)return r||this.action.dispatch("selection-clear"),this.selectedShadow=this.getSelected,this.manipulationStatus="selecting";this.manipulationStatus="dragging";const p=this.getSelected,y=p.has(u);console.log(y),p.size===0||!y&&!r?(this.action.dispatch("modify-selection",{mode:"replace",idSet:new Set([u])}),this.draggingModules=new Set([u])):r?(this.draggingModules=new Set(p),y?(console.log("isSelected",y),this._deselection=u,this.draggingModules.add(u)):this.action.dispatch("modify-selection",{mode:"add",idSet:new Set([u])}),this.draggingModules.add(u)):this.draggingModules=new Set(p)}function Ol(e){const{draggingModules:t,manipulationStatus:o,moduleMap:s,_selectingModules:i,selectedShadow:l,viewport:n}=this,r=e.clientX-n.rect.x,c=e.clientY-n.rect.y,d=e.ctrlKey||e.metaKey||e.shiftKey;switch(n.mouseMovePoint.x=r,n.mouseMovePoint.y=c,o){case"selecting":break;case"panning":break;case"dragging":{const h=(n.mouseMovePoint.x-n.mouseDownPoint.x)*n.dpr/n.scale,u=(n.mouseMovePoint.y-n.mouseDownPoint.y)*n.dpr/n.scale;if(!(h===0&&u===0))t.forEach(y=>{s.get(y).x-=h,s.get(y).y-=u}),this.action.dispatch("selection-move",{direction:"module-move-shift",delta:{x:h,y:u}});else{const y=this.hoveredModule;y&&d&&y===this._deselection&&this.action.dispatch("modify-selection",{mode:"toggle",idSet:new Set([y])})}}break;case"resizing":{const{altKey:h,shiftKey:u}=e,{mouseDownPoint:p,mouseMovePoint:y,scale:b,dpr:f}=this.viewport,{name:x,data:{rotation:w},moduleOrigin:v,id:N}=this._resizingOperator,{cx:M,cy:C,width:S,height:F}=v,$={x:M,y:C,width:S,height:F},R=fe({downPoint:p,movePoint:y,dpr:f,scale:b,initialWidth:S,initialHeight:F,rotation:w,handleName:x,altKey:h,shiftKey:u,initialCX:M,initialCY:C}),O={};console.log(R);for(const P in $)O[P]={from:$[P],to:R[P]};this.action.dispatch("module-modify",{id:N,props:O})}break;case"rotating":{const{shiftKey:h}=e,{id:u,data:{rotation:p}}=this._rotatingOperator,{rotation:y}=xe.call(this,h);this.action.dispatch("module-modify",{id:u,props:{rotation:{from:p,to:y}}})}break;case"mousedown":console.log(this.draggingModules),this.action.dispatch("selection-clear");break;case"static":e.ctrlKey||e.metaKey||e.shiftKey?this.toggleSelected(t):this.replaceSelected(t);break}t.clear(),l.clear(),i.clear(),i.clear(),this.manipulationStatus="static",this._deselection=null,this._resizingOperator=null,ye(n.selectionBox,{x:0,y:0,width:0,height:0},!1)}function Il(e){if(!(this.manipulationStatus==="panning"||this.manipulationStatus==="selecting")){if(e.code==="Space"){this.viewport.spaceKeyDown=!0,this.viewport.wrapper.style.cursor="grabbing",e.preventDefault();return}this.manipulationStatus==="resizing"&&(se.call(this,e.altKey,e.shiftKey),this.action.dispatch("visible-module-update"))}}function Bl(e){e.code==="Space"&&(this.viewport.spaceKeyDown=!1,this.viewport.wrapper.style.cursor="default"),this.manipulationStatus==="resizing"&&(se.call(this,e.altKey,e.shiftKey),this.action.dispatch("visible-module-update"))}function Vl(e){if(e.target!==this.viewport.wrapper||(e.preventDefault(),e.stopPropagation(),this.manipulationStatus!=="static"))return;const{zooming:t,panning:o,scrolling:s,zoomFactor:i,translateX:l,translateY:n}=Xl(e);this.viewport.zooming=t,t?(console.log(i),this.action.dispatch("world-zoom",{zoomFactor:i,physicalPoint:this.viewport.mouseMovePoint})):(o||s)&&this.action.dispatch("world-shift",{x:l,y:n}),this.updateWorldRect()}const Xl=(()=>{let e;const s=[];let i=!1,l=!1,n=!1,r=0,c=0,d=0,h=!1;const u=.01,p=.1;return y=>{const{deltaX:b,deltaY:f,altKey:x}=y;if(e&&clearTimeout(e),h?s.length=0:s.push(y),c=0,d=0,i=!1,n=!1,l=!1,x&&(i=!0),s.length>=3){const w=s.every(M=>Z(M.deltaX)),v=s.every(M=>Q(M.deltaY)),N=s.every(M=>Math.abs(M.deltaY)>4);w&&v&&!N&&(h=!0,console.log("touchpadZoomingLock"))}return h?(r=f>0?-.01:u,i=!0):Math.abs(b)>=40&&Z(f)?x?r=b<0?p:-.1:(n=!0,c=-b):Z(b)&&Q(f)&&Math.abs(f)>4?x?r=f<0?u:-.01:(n=!0,d=-f):re(b)&&re(f)&&(x?r=(Math.abs(b)>Math.abs(f)?b:f)<0?u:-.01:(l=!0,c=-b,d=-f)),i&&x&&(r=r<0?-.1:p),e=setTimeout(()=>{h=!1,i=!1,l=!1,n=!1,r=0,c=0,d=0,s.length=0},200),{zooming:i,panning:l,scrolling:n,zoomFactor:r,translateX:c,translateY:d}}})();function re(e){return!Q(e)}function Q(e){return Math.abs(e)%1!==0}function _l(e){const{action:t,draggingModules:o,moduleMap:s,viewport:i,selectedShadow:l,_selectingModules:n}=this;switch(i.mouseMovePoint.x=e.clientX-i.rect.x,i.mouseMovePoint.y=e.clientY-i.rect.y,i.drawCrossLine=!1,t.dispatch("world-mouse-move"),this.manipulationStatus){case"selecting":{i.wrapper.setPointerCapture(e.pointerId);const r=A(i.mouseDownPoint,i.mouseMovePoint),c=this.getWorldPointByViewportPoint(r.x,r.y),d=this.getWorldPointByViewportPoint(r.right,r.bottom),h=A(c,d),u=new Set,p=e.ctrlKey||e.metaKey||e.shiftKey;this.getVisibleModuleMap.forEach(f=>{if(f.type==="rectangle"){const x=f.getBoundingRect();dl(x,h)&&u.add(f.id)}});const y=!Ml(n,u);if(ye(i.selectionBox,r),!y)return;this._selectingModules=u;const b=Sl(l,u);if(p)t.dispatch("modify-selection",{mode:"replace",idSet:b});else{if(u.size===0&&l.size===0)return t.dispatch("selection-clear");const f=new Set([...l,...u]);t.dispatch("modify-selection",{mode:"replace",idSet:f})}}break;case"panning":t.dispatch("world-shift",{x:e.movementX,y:e.movementY});break;case"dragging":{i.wrapper.setPointerCapture(e.pointerId);const r=e.movementX*i.dpr/i.scale,c=e.movementY*i.dpr/i.scale;o.forEach(d=>{s.get(d).move(r,c)}),this.action.dispatch("visible-module-update")}break;case"resizing":{i.wrapper.setPointerCapture(e.pointerId);const{altKey:r,shiftKey:c}=e;se.call(this,r,c),this.action.dispatch("module-operating")}break;case"rotating":{i.wrapper.setPointerCapture(e.pointerId);const{shiftKey:r}=e,c=this.getViewPointByWorldPoint(this._rotatingOperator.moduleOrigin.cx,this._rotatingOperator.moduleOrigin.cy);xe.call(this,r),_(i.wrapper,i.cursor,c,i.mouseMovePoint),this.action.dispatch("module-operating")}break;case"mousedown":(Math.abs(i.mouseMovePoint.x-i.mouseDownPoint.x)>1||Math.abs(i.mouseMovePoint.y-i.mouseDownPoint.y)>1)&&(o.size>0?this.manipulationStatus="dragging":this.manipulationStatus="selecting");break;case"static":{const r=me.call(this),{viewport:c}=this;if(r)if(r.type==="rotate"){const d=this.getViewPointByWorldPoint(r.moduleOrigin.cx,r.moduleOrigin.cy);_(c.wrapper,c.cursor,d,c.mouseMovePoint)}else _(c.wrapper,c.cursor,"hide"),c.wrapper.style.cursor=r.cursor;else _(c.wrapper,c.cursor,"hide");c.wrapper.releasePointerCapture(e.pointerId),c.drawCrossLine=c.drawCrossLineDefault}break}}function Hl(e){if(e.preventDefault(),e.stopPropagation(),e.ctrlKey)return!1;const t=this.hoveredModule,o=this.getSelected,s={...this.viewport.mouseMovePoint};let i=new Set;t&&(o.has(t)?i=o:i.add(t)),this.action.dispatch("context-menu",{idSet:i,position:s,copiedItems:this.copiedItems.length>0})}function Wl(){const{wrapper:e,mainCanvas:t,selectionCanvas:o,selectionBox:s,scrollBarX:i,scrollBarY:l,cursor:n}=kl(this.id),r=o.getContext("2d"),c=t.getContext("2d"),d=new AbortController,h=new ResizeObserver(hl(()=>{this.action.dispatch("viewport-resize")},200)),{signal:u}=d,p={x:0,y:0},y={x:0,y:0},b=A(p,y),f=A(p,y),x=A(p,y);return window.addEventListener("mousedown",Al.bind(this),{signal:u}),window.addEventListener("mouseup",Ol.bind(this),{signal:u}),window.addEventListener("keydown",Il.bind(this),{signal:u}),window.addEventListener("keyup",Bl.bind(this),{signal:u}),window.addEventListener("wheel",Vl.bind(this),{signal:u,passive:!1}),e.addEventListener("pointermove",_l.bind(this),{signal:u}),e.addEventListener("contextmenu",Hl.bind(this),{signal:u}),{drawCrossLine:!1,drawCrossLineDefault:!1,enableCrossLine:!1,initialized:!1,scale:1,spaceKeyDown:!1,zooming:!1,dpr:this.config.dpr,frame:Rl("A4"),offset:{x:0,y:0},viewportRect:f,worldRect:x,mouseDownPoint:p,mouseMovePoint:y,rect:b,wrapper:e,mainCanvas:t,selectionCanvas:o,selectionCTX:r,mainCTX:c,scrollBarX:i,scrollBarY:l,selectionBox:s,cursor:n,resizeObserver:h,eventsController:d}}function Yl(){this.viewport&&(this.viewport.resizeObserver.disconnect(),this.viewport.eventsController.abort(),this.viewport.wrapper.style.width="100%",this.viewport.wrapper.style.height="100%",this.viewport.wrapper.remove(),this.viewport=null)}const ae=(e,t,o,{x:s,y:i})=>{const l=[o,0,0,o,s*t,i*t];e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width*2,e.canvas.height*2),e.setTransform(...l)},we=e=>new Set(e.map(t=>t.id));function ve(e=!1){if(this.history.current===this.history.tail)return!1;this.history.forward();const{type:t,payload:o}=this.history.current.data,{selectedModules:s}=o;switch(t){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchAdd(this.batchCreate(o.modules));break;case"history-modify":o.changes.map(({id:i,props:l})=>{const n={};Object.keys(l).forEach(r=>{n[r]=l[r].to,this.batchModify(new Set([i]),n)})});break;case"history-move":this.batchMove(o.selectedModules,{x:o.delta.x,y:o.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":this.batchDelete(we(o.modules));break}return e||(this.replaceSelected(s),this.action.dispatch("editor-selection-update")),this.history.current}function Ce(e=!1){if(this.history.current===this.history.head)return!1;const{type:t,payload:o}=this.history.current.data;let s=null;switch(t){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchDelete(we(o.modules));break;case"history-modify":o.changes.map(({id:i,props:l})=>{const n={};Object.keys(l).forEach(r=>{console.log(l[r].from),n[r]=l[r].from,this.batchModify(new Set([i]),n)})});break;case"history-move":this.batchMove(o.selectedModules,{x:-o.delta.x,y:-o.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":s=o.modules,this.batchAdd(this.batchCreate(s));break}if(this.history.back(),!e){const i=this.history.current.data.payload.selectedModules;this.replaceSelected(i),this.action.dispatch("editor-selection-update")}return this.history.current}function Ul(e){var o,s;const t=this.history.compareToCurrentPosition(e);if(!(!t||t==="equal")&&(t==="front"||t==="behind")){let l;for(;t==="front"?l=Ce.call(this,!0):t==="behind"&&(l=ve.call(this,!0)),l!==e;);const{selectedModules:n}=e.data.payload;this.replaceSelected(n),(s=(o=this.events).onHistoryUpdated)==null||s.call(o,this.history)}}function Kl(){const{container:e,viewport:t,action:o}=this,s=o.dispatch.bind(o),i=o.on.bind(o);e.appendChild(t.wrapper),t.resizeObserver.observe(e),i("viewport-resize",()=>{this.updateViewport(),this.initialized?s("world-update"):s("editor-initialized")}),i("editor-initialized",()=>{var l,n;s("world-update"),this.initialized=!0,this.fitFrame(),(n=(l=this.events).onInitialized)==null||n.call(l)}),i("editor-module-map-update",l=>{this.updateVisibleModuleMap(),s("visible-module-update",!0),this.history.add(l)}),i("editor-selection-update",()=>{var l,n;X.call(this),(n=(l=this.events).onSelectionUpdated)==null||n.call(l,this.selectedModules,this.getSelectedPropsIfUnique()),s("visible-selected-update")}),i("world-mouse-move",()=>{var n,r;const l=this.getWorldPointByViewportPoint(this.viewport.mouseMovePoint.x,this.viewport.mouseMovePoint.y);(r=(n=this.events).onWorldMouseMove)==null||r.call(n,l)}),i("world-update",()=>{var l,n;this.updateWorldRect(),this.updateVisibleModuleMap(),(n=(l=this.events).onViewportUpdated)==null||n.call(l,this.viewport.worldRect),s("visible-module-update")}),i("world-zoom",l=>{if(l==="fit")this.fitFrame(),s("world-update");else{const n=this.zoomAtPoint(l.physicalPoint,l.zoomFactor);if(n){const{scale:r,offset:c}=n;this.viewport.scale=r,this.viewport.offset.x=c.x,this.viewport.offset.y=c.y,s("world-update")}}}),i("world-shift",l=>{const{x:n,y:r}=l;this.viewport.offset.x+=n,this.viewport.offset.y+=r,s("world-update")}),i("select-all",()=>{this.selectAll(),s("editor-selection-update")}),i("selection-clear",()=>{this.selectedModules.clear(),s("editor-selection-update")}),i("modify-selection",l=>{const{mode:n,idSet:r}=l;this.modifySelected(r,n),s("editor-selection-update")}),i("selection-delete",()=>{const l=this.getSelected,n=this.batchDelete(l);this.selectedModules.clear(),s("editor-module-map-update",{type:"history-delete",payload:{modules:n,selectedModules:l}}),s("editor-selection-update")}),i("selection-copy",()=>{this.copiedItems=this.batchCopy(this.getSelected,!0),this.updateCopiedItemsDelta()}),i("selection-paste",l=>{if(this.copiedItems.length===0)return;let n;if(l){const{x:c,y:d}=this.getWorldPointByViewportPoint(l.x,l.y),h=this.copiedItems.reduce((b,f)=>f.x<b.x&&f.y<b.y?f:b),u=c-h.x,p=d-h.y,y=this.copiedItems.map(b=>({...b,x:b.x+u,y:b.y+p}));n=this.batchCreate(y)}else n=this.batchCreate(this.copiedItems);const r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r),this.updateCopiedItemsDelta(),s("editor-module-map-update",{type:"history-paste",payload:{modules:[...n.values()].map(c=>c.getDetails()),selectedModules:r}}),s("editor-selection-update")}),i("selection-duplicate",()=>{const l=this.batchCopy(this.selectedModules,!0);l.forEach(d=>{d.x+=this.CopyDeltaX,d.y+=this.CopyDeltaY});const n=this.batchCreate(l),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const c=[...n.values()].map(d=>d.getDetails());s("editor-module-map-update",{type:"history-duplicate",payload:{modules:c,selectedModules:r}}),s("editor-selection-update")}),i("selection-move",({direction:l,delta:n={x:0,y:0}})=>{if(this.getSelected.size===0)return;const r=5,c=this.getSelected;switch(l){case"module-move-down":n.y=r;break;case"module-move-up":n.y=-5;break;case"module-move-left":n.x=-5;break;case"module-move-right":n.x=r;break}this.batchMove(this.selectedModules,n),s("editor-selection-update"),s("visible-module-update"),this.history.add({type:"history-move",payload:{delta:n,selectedModules:c}})}),i("module-add",l=>{const n=this.batchAdd(this.batchCreate(l)),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const c=[...n.values()].map(d=>d.getDetails());s("editor-module-map-update",{type:"history-add",payload:{modules:c,selectedModules:r}}),s("editor-selection-update")}),i("module-operating",()=>{s("visible-module-update"),s("editor-selection-update")}),i("module-modify",l=>{console.warn(l),this.history.add({type:"history-modify",payload:{selectedModules:this.getSelected,changes:[l]}}),s("visible-module-update"),s("editor-selection-update")}),i("visible-module-update",(l=!1)=>{l||(X.call(this),s("visible-selected-update")),ae(this.viewport.mainCTX,this.viewport.dpr,this.viewport.scale,this.viewport.offset),this.renderModules()}),i("visible-selected-update",()=>{ae(this.viewport.selectionCTX,this.viewport.dpr,this.viewport.scale,this.viewport.offset),this.renderSelections()}),i("module-hover-enter",l=>{this.hoveredModule=l,X.call(this),s("visible-selected-update")}),i("module-hover-leave",()=>{this.hoveredModule=null,X.call(this),s("visible-selected-update")}),i("history-undo",()=>{var l,n;Ce.call(this),this.updateVisibleModuleMap(),s("visible-module-update"),(n=(l=this.events).onHistoryUpdated)==null||n.call(l,this.history)}),i("history-redo",()=>{var l,n;ve.call(this),this.updateVisibleModuleMap(),s("visible-module-update"),(n=(l=this.events).onHistoryUpdated)==null||n.call(l,this.history)}),i("history-pick",l=>{var n,r;Ul.call(this,l),this.updateVisibleModuleMap(),s("visible-module-update"),(r=(n=this.events).onHistoryUpdated)==null||r.call(n,this.history)}),i("context-menu",({idSet:l,position:n,copiedItems:r})=>{var c,d;(d=(c=this.events).onContextMenu)==null||d.call(c,l,n,r)})}class Gl{constructor({container:t,data:o,events:s={},config:i={dpr:2}}){m(this,"id");m(this,"config");m(this,"moduleCounter",0);m(this,"moduleMap");m(this,"visibleModuleMap");m(this,"action");m(this,"container");m(this,"events",{});m(this,"history");m(this,"viewport");m(this,"selectedModules",new Set);m(this,"visibleSelected",new Set);m(this,"operationHandlers",new Set);m(this,"copiedItems",[]);m(this,"hoveredModule",null);m(this,"draggingModules",new Set);m(this,"_selectingModules",new Set);m(this,"_deselection",null);m(this,"_resizingOperator",null);m(this,"_rotatingOperator",null);m(this,"selectedShadow",new Set);m(this,"manipulationStatus","static");m(this,"CopyDeltaX",50);m(this,"CopyDeltaY",100);m(this,"initialized",!1);this.visibleModuleMap=new Map,this.id=o.id||W(),this.config=i,this.events=s,this.action=new rl,this.container=t,this.history=new nl(this),this.viewport=Wl.call(this),this.moduleMap=o.modules.reduce((l,n)=>(l.set(n.id,n),l),new Map),this.init()}init(){Kl.call(this)}get createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(t){return yl.call(this,t)}batchAdd(t){return gl.call(this,t)}batchCopy(t,o=!1,s){return bl.call(this,t,o,s)}batchDelete(t){return ml.call(this,t)}batchMove(t,o){xl.call(this,t,o)}batchModify(t,o,s){wl.call(this,t,o,s)}getModulesByLayerIndex(){}getModulesByIdSet(t){const o=new Map;return t.forEach(s=>{const i=this.moduleMap.get(s);i&&o.set(s,i)}),o}getModuleList(){return[...Object.values(this.moduleMap)]}updateVisibleModuleMap(){this.visibleModuleMap.clear(),this.moduleMap.forEach(t=>{const o=t.getBoundingRect();cl(o,this.viewport.worldRect)&&this.visibleModuleMap.set(t.id,t)})}get getVisibleModuleMap(){return new Map(this.visibleModuleMap)}execute(t,o=null){this.action.execute(t,o)}get getVisibleSelected(){return new Set(this.visibleSelected)}get getVisibleSelectedModuleMap(){return this.getModulesByIdSet(this.getVisibleSelected)}get getSelected(){return new Set(this.selectedModules)}modifySelected(t,o){I.call(this,t,o)}addSelected(t){I.call(this,t,"add")}deleteSelected(t){I.call(this,t,"delete")}toggleSelected(t){I.call(this,t,"toggle")}replaceSelected(t){I.call(this,t,"replace")}selectAll(){this.selectedModules.clear(),this.moduleMap.forEach(t=>{this.selectedModules.add(t.id)})}updateCopiedItemsDelta(){this.copiedItems.forEach(t=>{t.x+=this.CopyDeltaX,t.y+=this.CopyDeltaY})}getSelectedPropsIfUnique(){if(this.selectedModules.size===1){const t=[...this.selectedModules.values()][0];return this.moduleMap.get(t).getDetails()}return null}renderModules(){requestAnimationFrame(()=>{Ll({ctx:this.viewport.mainCTX,frame:this.viewport.frame,modules:this.visibleModuleMap})})}renderSelections(){requestAnimationFrame(()=>{Dl.call(this)})}updateWorldRect(){const{width:t,height:o}=this.viewport.viewportRect,s=this.getWorldPointByViewportPoint(0,0),i=this.getWorldPointByViewportPoint(t,o);this.viewport.worldRect=A(s,i)}zoomAtPoint(t,o,s=!1){const{offset:i,scale:l,dpr:n}=this.viewport,r=.1*n,c=5*n;let d=l+o;if(s&&(d=o),d<r||d>c)return!1;const h=Math.max(r,Math.min(c,d)),u=h/l,p=this.getWorldPointByViewportPoint(t.x,t.y),y=p.x-(p.x-i.x)*u,b=p.y-(p.y-i.y)*u;return{scale:h,offset:{x:y,y:b}}}zoomTo(t){console.log(t),t==="fit"?this.fitFrame():this.zoomAtPoint({x:this.viewport.rect.width/2,y:this.viewport.viewportRect.height/2},t,!0)}setTranslateViewport(t,o){this.viewport.offset.x=0,this.viewport.offset.y=0,this.translateViewport(t,o)}translateViewport(t,o){this.viewport.offset.x+=t,this.viewport.offset.y+=o}updateScrollBar(){const{scrollBarX:t,scrollBarY:o}=this.viewport;$l(t,o)}updateViewport(){const{dpr:t,mainCanvas:o,selectionCanvas:s}=this.viewport,i=this.container.getBoundingClientRect().toJSON(),{x:l,y:n,width:r,height:c}=i,d=r*t,h=c*t;this.viewport.rect={...i,cx:l+r/2,cy:n+c/2},this.viewport.viewportRect=A({x:0,y:0},{x:d,y:h}),o.width=s.width=d,o.height=s.height=h}getWorldPointByViewportPoint(t,o){const{dpr:s,offset:i,scale:l}=this.viewport;return vl({x:t,y:o},i,l,s)}getViewPointByWorldPoint(t,o){const{dpr:s,offset:i,scale:l}=this.viewport;return Cl({x:t,y:o},i,l,s)}fitFrame(){const{frame:t,viewportRect:o,dpr:s}=this.viewport,{scale:i,offsetX:l,offsetY:n}=Tl(t,o,.95);this.viewport.scale=i,this.viewport.offset.x=l/s,this.viewport.offset.y=n/s}destroy(){Yl.call(this),this.action.destroy(),this.history.destroy(),this.moduleMap.clear()}}const L=g.createContext({focused:!1,historyArray:[],historyCurrent:0,selectedModules:[],selectedProps:{},editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{},viewport:{width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}}),Zl=()=>{const{executeAction:e,focused:t}=g.useContext(L),o=s=>{let i=null;const{key:l,ctrlKey:n,metaKey:r,shiftKey:c}=s,h={ArrowUp:"module-move-up",ArrowDown:"module-move-down",ArrowLeft:"module-move-left",ArrowRight:"module-move-right"}[l];l==="a"&&(n||r)&&(i="select-all"),l==="c"&&(n||r)&&!c&&(i="selection-copy"),l==="v"&&(n||r)&&(i="selection-paste"),l==="d"&&(n||r)&&(i="selection-duplicate"),(l==="Delete"||l==="Backspace")&&(i="selection-delete"),l==="Escape"&&(i="selection-clear"),l==="z"&&(n||r)&&(i="history-undo"),l==="z"&&c&&(n||r)&&(i="history-redo"),h&&(i="selection-move"),i&&(h?e(i,{direction:h}):e(i),s.stopPropagation(),s.preventDefault())};return g.useEffect(()=>(window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}),[t]),null},ql=[{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50}],Jl=()=>{const{editorRef:e}=g.useContext(L);return g.useEffect(()=>{e.current&&console.log("editorRef.current updated:",e.current)},[e]),a.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:ql.map((t,o)=>a.jsx("div",{className:"shrink-0 select-none cursor-move",style:{width:t.width,height:t.height,border:"1px solid #dfdfdf"},onMouseEnter:()=>{}},o))})},Ql=({className:e=""})=>{const[t,o]=g.useState(300),s=g.useRef(!1),i=g.useRef(null),l=g.useCallback(c=>{c.preventDefault(),s.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),n=g.useCallback(c=>{if(!s.current)return;const d=window.innerWidth*.9,h=Math.min(Math.max(0,c.clientX),d);c.stopPropagation(),o(h)},[]),r=g.useCallback(c=>{s.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",c.stopPropagation()},[]);return g.useEffect(()=>(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}),[n,r]),a.jsxs("div",{ref:i,style:{width:`${t}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[a.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${e}`,children:[a.jsx("span",{children:"Module List"}),a.jsx(Jl,{})]}),a.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:l})]})},ce=e=>(e*100).toFixed(2)+"%",en=e=>{const t=e.replace("%","").trim(),o=Number(t);return isNaN(o)?!1:Number(o.toFixed(2))},tn=({scale:e,onChange:t})=>{const o=[{label:"400%",value:4},{label:"300%",value:3},{label:"200%",value:2},{label:"150%",value:1.5},{label:"125%",value:1.25},{label:"100%",value:1},{label:"75%",value:.75},{label:"50%",value:.5},{label:"25%",value:.25},{label:"Fit window",value:"fit"}],[s,i]=g.useState(ce(1)),[l,n]=g.useState(!1),r=g.useRef(null);g.useEffect(()=>{const d=ce(e);r.current&&(r.current.value=d),i(d)},[e]);const c=d=>{if(d.key==="Enter"){const h=en(d.target.value);h!==!1&&t(h),r.current.blur()}d.stopPropagation()};return a.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[a.jsx("input",{type:"text",ref:r,onChange:void 0,defaultValue:s,onKeyDown:c,className:"w-20 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),a.jsx("button",{onClick:()=>n(!l),className:"text-gray-800 flex trasition items-center cursor-pointer",children:l?a.jsx(Pe,{className:"w-5 h-5"}):a.jsx(ze,{className:"w-5 h-5"})}),l&&a.jsx("div",{className:"fixed w-full h-full",onClick:()=>{n(!1)}}),l&&a.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:o.map(({label:d,value:h})=>a.jsx("div",{onClick:()=>{n(!1),t(h)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:h==="fit"?d:`${h*100}%`},h))})]})},on=({className:e="",worldPoint:t})=>{const{viewport:o,executeAction:s}=g.useContext(L);return o?a.jsx("footer",{className:e+"w-full h-8 flex justify-between pr-1 items-center border-t border-gray-200",children:o&&a.jsxs(a.Fragment,{children:[a.jsx(tn,{scale:o.scale,onChange:i=>{s("world-zoom",i)}},o.scale),a.jsx("div",{className:"text-xs line-clamp-1",children:`dx:${t.x.toFixed(2)} dx:${t.y.toFixed(2)}`})]})}):null},q=28,sn=({data:e,selected:t})=>{const o=g.useRef(null),s=g.useRef(null),[i,l]=g.useState(0),[n,r]=g.useState([0,10]),{executeAction:c}=g.useContext(L);g.useEffect(()=>{},[t]);const d=()=>{if(!o.current)return;const u=o.current.scrollTop,p=u<i,y=Math.round(u/q),b=y+10;if(p){if(n[0]>=e.length-1)return}else if(n[1]>=e.length-1)return;l(u),r([y,b])},h=[];for(let u=n[0];u<n[1];u++){const p=e[u];p&&h.push(a.jsx("div",{ref:t!=null&&t.includes(p.id)?s:null,style:{height:q},className:t!=null&&t.includes(p.id)?"bg-gray-400 text-white":"",onClick:()=>{c("modify-selection",{mode:"replace",idSet:new Set([p.id])})},id:`layer-module-${p.id}`,children:p.type},p.id))}return a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Layer"})}),a.jsx("div",{className:"p-2 relative overflow-hidden",children:a.jsxs("div",{ref:o,onScroll:d,className:"relative scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:[a.jsx("div",{className:"absolute w-full top-0 left-0",style:{height:e.length*q}}),a.jsx("div",{className:"w-full sticky top-0 left-0",children:h})]})})]})},Me=({menu:e})=>{const{t}=V(),[o,s]=g.useState(!1),{executeAction:i}=g.useContext(L),l=()=>{console.log(e.id),!(e.children||o)&&(i(e.id),s(!1))},n=e.children&&e.children.length>0;return a.jsxs("div",{className:"relative h-8 hover:bg-gray-200 min-w-50",onClick:()=>l(),onMouseOver:r=>{s(!0),r.preventDefault()},onMouseLeave:()=>{s(!1)},children:[a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center whitespace-nowrap",children:[a.jsx("span",{children:t(e.id+".label")}),n&&a.jsx(De,{size:18})]}),n&&o&&a.jsx("div",{className:"absolute bg-white z-30 left-full top-0 w-auto border border-gray-200 box-border",children:e.children.map(r=>a.jsx(Me,{menu:r},r.id))})]})},ln=()=>{const[e,t]=g.useState(!1),[o,s]=g.useState(null),{t:i}=V(),l=g.useRef(null),n=he(c=>c.menu.actions),r=g.useMemo(()=>nn(n),[n]);return g.useEffect(()=>{const c=d=>{l.current.contains(d.target)||(t(!1),s(null))};return window.addEventListener("click",c),()=>{window.removeEventListener("click",c)}}),a.jsx("div",{className:"h-8 text-sm select-none border-gray-200 box-border",children:a.jsx("div",{ref:l,className:"pl-2 h-full inline-flex",children:r.map(c=>{var d;return a.jsxs("div",{className:"relative h-full",children:[a.jsx("div",{className:`h-full inline-flex items-center px-4 ${c.id===o?"bg-gray-200":""}`,onMouseEnter:()=>e&&s(c.id),onClick:()=>{o!==c.id?(t(!0),s(c.id)):(s(null),t(!1))},title:i(c.id+".tooltip"),children:a.jsx("span",{children:i(c.id+".label")})}),e&&c.id===o&&c.children.length>0&&a.jsx("div",{className:"absolute z-20 bg-white border border-gray-200",children:(d=c.children)==null?void 0:d.map(h=>a.jsx(Me,{menu:h},h.id))})]},c.id)})})})};function nn(e){const t=new Map;Object.values(e).forEach(s=>{t.set(s.id,{...s,children:[]})});const o=[];return t.forEach(s=>{const i=t.get(s.parent);i?i.children.push(s):o.push(s)}),o}const Y={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},U="#9b9a9a",rn=({size:e=24,...t})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...Y,...t,children:[a.jsx("path",{fill:U,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),a.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),a.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),an=({size:e=24,...t})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...Y,...t,children:[a.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),a.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),a.jsx("path",{fill:U,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),cn=({size:e=24,...t})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...Y,...t,children:[a.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:U,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),dn=({size:e=24,...t})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...Y,...t,children:[a.jsx("path",{fill:U,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),hn=({iconName:e,size:t})=>{switch(e){case"save":return a.jsx(_e,{size:t});case"undo":return a.jsx(Xe,{size:t});case"redo":return a.jsx(Ve,{size:t});case"trash":return a.jsx(Be,{size:t});case"cross":return a.jsx(Ie,{size:t});case"group":return a.jsx(Oe,{size:t});case"ungroup":return a.jsx(Ae,{size:t});case"lock":return a.jsx(Re,{size:t});case"unlock":return a.jsx(Te,{size:t});default:return null}},B=20,H="text-black",un=()=>{const e=he(o=>o.toolbar.actions),{executeAction:t}=g.useContext(L);return a.jsx("div",{className:"border-b border-gray-200 box-border",children:a.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(e).map(o=>{const{id:s,icon:i,disabled:l,divide:n}=o;let r;switch(s){case"layerUp":r=a.jsx(rn,{size:B,className:H});break;case"layerDown":r=a.jsx(an,{size:B,className:H});break;case"layerTop":r=a.jsx(cn,{size:B,className:H});break;case"layerBottom":r=a.jsx(dn,{size:B,className:H});break;default:r=a.jsx(hn,{size:B,iconName:i});break}const{tooltip:c}=He(s,{returnObjects:!0});return a.jsxs(g.Fragment,{children:[a.jsx("button",{type:"button",disabled:l,title:c,onClick:()=>{s==="undo"||s==="redo"?t("history-"+s):s==="delete"&&t("selection-"+s)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6 opacity-50   hover:bg-gray-200  hover:opacity-100 disabled:text-gray-200 disabled:cursor-default",children:r}),n&&a.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},s)})})})},pn=()=>a.jsxs("header",{children:[a.jsx(ln,{}),a.jsx(un,{})]}),fn=()=>{const{historyArray:e,historyCurrent:t,applyHistoryNode:o}=g.useContext(L),{t:s}=V(),i=g.useRef(null);return g.useEffect(()=>{if(i.current)return()=>{}},[e,t]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-600 text-white px-2",children:a.jsx("span",{children:"History"})}),a.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:a.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:e.map((l,n)=>{const r=l.id===t,c="history."+l.data.type,{label:d,tooltip:h}=s(c,{returnObjects:!0});return a.jsx("div",{title:h,ref:r?i:null,onClick:()=>{r||o(l)},className:` px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${r?"bg-gray-400 text-white":""}`,children:a.jsx("span",{children:d})},n)})})})]})},yn=()=>{const{selectedProps:e}=g.useContext(L);return g.useEffect(()=>{},[e]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Properties"})}),a.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:e&&a.jsx(gn,{props:e})})]})},gn=({props:e})=>{const t=o=>{console.log(o)};return a.jsxs("div",{className:"z-30 text-sm",children:[a.jsxs("div",{className:"mb-4 ",children:[a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"X:"}),a.jsx("input",{type:"number",name:"x",defaultValue:e.x,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Y:"}),a.jsx("input",{type:"number",name:"y",defaultValue:e.y,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Width:"}),a.jsx("input",{type:"number",name:"width",defaultValue:e.width,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Height:"}),a.jsx("input",{type:"number",name:"height",defaultValue:e.height,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Radius:"}),a.jsx("input",{type:"number",name:"radius",defaultValue:e.radius,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Fill"}),a.jsx("input",{type:"checkbox",name:"enableFill",defaultChecked:e.enableFill,onChange:t,className:"ml-2"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Fill Color:"}),a.jsx("input",{type:"color",name:"fillColor",defaultValue:e.fillColor,onChange:t,className:"w-10 h-10 p-1 rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Line"}),a.jsx("input",{type:"checkbox",name:"enableLine",defaultChecked:e.enableLine,onChange:t,className:"ml-2"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Line Color:"}),a.jsx("input",{type:"color",name:"lineColor",defaultValue:e.lineColor,onChange:t,className:"w-10 h-10 p-1 rounded"})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Shadow"}),a.jsx("input",{type:"checkbox",name:"shadow",defaultChecked:e.shadow,onChange:t,className:"ml-2"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Opacity:"}),a.jsx("input",{type:"number",name:"opacity",defaultValue:e.opacity,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),a.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Layer:"}),a.jsx("input",{type:"number",name:"layer",defaultValue:e.layer,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]})]})]})},bn=e=>{const s={type:"rectangle",width:416.6666666666667,height:416.6666666666667,enableLine:!0,lineColor:"#000000",lineWidth:1,enableFill:!0,fillColor:"#fff",opacity:100,shadow:!1,radius:0,rotation:0},i=10,l=r=>Math.floor(Math.random()*r),n=[];for(let r=0;r<i;r++){const c=l(1e3),d=l(1414);n.push({...s,fillColor:"#fff",x:c,y:d,layer:r+1,rotation:0})}e.action.dispatch("module-add",n)},mn=({data:{idSet:e,position:t,copiedItems:o},onClose:s})=>{const{t:i}=V(),{executeAction:l}=g.useContext(L);g.useEffect(()=>{const c=()=>{s()};return window.addEventListener("click",c),()=>{window.removeEventListener("click",c)}},[e,t]);const n=[{id:"copy",disabled:e.size===0},{id:"paste",disabled:!o},{id:"delete",disabled:e.size===0},{id:"duplicate",disabled:e.size===0},{id:"bringToFront",disabled:e.size===0},{id:"sendToBack",disabled:e.size===0}],r=c=>{switch(c){case"copy":l("selection-copy");break;case"paste":l("selection-paste",t);break;case"delete":l("selection-delete");break;case"duplicate":l("selection-duplicate");break}};return a.jsx("div",{className:"absolute bg-white shadow-lg rounded-md border border-gray-200 py-1 z-50",style:{top:t.y,left:t.x},children:n.map((c,d)=>{const h=i(c.id,{returnObjects:!0}),u=d===2||d===4||d===7;return a.jsxs("div",{children:[u&&a.jsx("div",{className:"border-t border-gray-200 my-1"}),a.jsx("button",{className:"w-full px-4 py-1.5 text-left text-sm hover:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-transparent disabled:cursor-not-allowed",disabled:c.disabled,onClick:()=>r(c.id),title:h.tooltip,children:h.label})]},c.id)})})},xn=({file:e})=>{const t=g.useRef(null),o=g.useRef(null),[s,i]=g.useState([]),[l,n]=g.useState({x:0,y:0}),[r,c]=g.useState([]),[d,h]=g.useState(null),[u,p]=g.useState([]),[y,b]=g.useState(!1),[f,x]=g.useState({idSet:new Set,position:{x:0,y:0},copiedItems:!1}),[w,v]=g.useState(0),[N,M]=g.useState({width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}),C=g.useRef(null),[S,F]=g.useState(!0);g.useEffect(()=>{let k;if(o.current){const K=W();k=new Gl({container:o.current,data:{id:K,modules:[]},config:{dpr:2},events:{onInitialized:()=>{bn(k)},onHistoryUpdated:j=>{i(j.toArray()),j.current&&v(j.current.id)},onModulesUpdated:j=>{const z=Array.from(j.values()).sort((D,G)=>D.layer-G.layer);c(z)},onSelectionUpdated:(j,z)=>{p(Array.from(j)),h({...z})},onViewportUpdated:j=>{M(j)},onWorldMouseMove:j=>{n(j)},onContextMenu:(j,z,D)=>{console.log(j,z),b(!0),x({idSet:j,position:z,copiedItems:D})}}}),t.current=k}const E=C.current;return E&&(E.addEventListener("focus",$),E.addEventListener("blur",R)),()=>{E&&(E.removeEventListener("focus",$),E.removeEventListener("blur",R)),k&&k.destroy()}},[e]);const $=()=>F(!0),R=()=>F(!1),O=k=>{t.current&&t.current.execute("history-pick",k)},P=(k,E)=>{t.current.execute(k,E)};return a.jsx(L.Provider,{value:{focused:S,historyArray:s,selectedModules:u,selectedProps:d,historyCurrent:w,viewport:N,editorRef:t,applyHistoryNode:O,executeAction:P},children:a.jsxs("div",{ref:C,"data-focused":S,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[a.jsx(Zl,{}),a.jsx(pn,{}),a.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[a.jsx(Ql,{}),a.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden relative",children:[a.jsx("div",{ref:o,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),a.jsx(on,{worldPoint:l}),y&&a.jsx(mn,{data:f,onClose:()=>{b(!1)}})]}),a.jsxs("div",{style:{width:200},className:"h-full flex-shrink-0 border-l border-gray-200",children:[a.jsx(yn,{}),a.jsx(sn,{data:r,selected:u}),a.jsx(fn,{})]})]})]})})},wn=e=>[],vn=()=>{const e="Untitled 1",t={},o={modules:wn()};return{id:W(),name:e,config:t,data:o}},Cn=e=>new Map(e.reduce((t,o)=>(t.push([o.id,o]),t),[])),Mn=vn(),de=Cn([Mn]),Sn=()=>{const e=' group py-2 px-6 relative transition flex items-center">',t=" bg-gray-200",o=" hover:bg-gray-200",{fileList:s,currentFileId:i,closeFile:l,switchFile:n,handleCreating:r}=g.useContext(te);return a.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[s.map(c=>{const d=c.id===i,h=e+(d?t:o),u=(d?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return a.jsxs("div",{className:h,onClick:()=>{n(c.id)},children:[a.jsx("span",{children:c.name}),a.jsx("span",{onClick:p=>{l(c.id),p.preventDefault(),p.stopPropagation()},className:u,children:"×"})]},c.id)}),a.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:a.jsx(We,{size:18,onClick:()=>{r(!0)}})})]})},Nn=({children:e,defaultValue:t})=>{const[o,s]=g.useState(!1);return a.jsxs("div",{className:"relative w-20",children:[a.jsxs("div",{className:"flex items-center",onClick:()=>{s(!o)},children:[a.jsx(Ye,{}),t]}),o&&a.jsx("div",{onClick:()=>{s(!1)},className:"absolute top-full right-0 w-full",children:e})]})},jn=()=>{const[e,t]=g.useState("en"),o={en:"English",cn:"中文",jp:"日本語"},{i18n:s}=V();return a.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:a.jsx(Nn,{defaultValue:o[e],children:Object.keys(o).map((i,l)=>a.jsx("div",{onClick:()=>{s.changeLanguage(i),t(i)},children:o[i]},l))})})},Fn=()=>{const e=g.useRef(new Map),[t,o]=g.useState(!1),[s,i]=g.useState(""),[l,n]=g.useState([]),r=e.current.size,c=r===0||t;g.useEffect(()=>{de.size>0&&(e.current=de,d(),i(h()[0].id))},[]);const d=()=>{const f=h();return n(f),f},h=()=>Array.from(e.current.values()),u=f=>{console.log(l),i(f)},p=f=>{const x=l.findIndex(v=>v.id===f);let w=l.length;if(x!==-1&&(e.current.delete(f),d(),l.splice(x,1),w--,s===f&&w>0)){let v=x+1;x===0&&(v=0),v>w&&(v=w-1),i(l[v].id)}},y=f=>{e.current.set(f.id,f),d(),i(f.id)},b=f=>{o(f)};return a.jsx(te.Provider,{value:{fileMap:e.current,fileList:l,creating:t,currentFileId:s,switchFile:u,closeFile:p,createFile:y,handleCreating:b},children:a.jsxs("div",{className:"w-full h-full flex flex-col select-none",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx(Sn,{}),a.jsx(jn,{})]}),a.jsx("div",{className:"flex-1 overflow-hidden min-h-[600px]",children:l.map(f=>a.jsx("div",{className:"outline-0 w-full h-full flex flex-col",style:{display:f.id===s?"flex":"none"},children:a.jsx(xn,{file:f})},f.id))}),c&&a.jsx(il,{bg:r?"#00000080":"#fff",onBgClick:()=>{r&&o(!1)}})]})})};function kn(){return a.jsx(Fn,{})}const $n=[{id:"file",parent:null},{id:"newFile",parent:"file",shortcut:"Ctrl+N"},{id:"openFile",parent:"file",shortcut:"Ctrl+O"},{id:"saveFile",parent:"file",shortcut:"Ctrl+S"},{id:"saveAs",parent:"file"},{id:"importFile",parent:"file"},{id:"exportFile",parent:"file"},{id:"print",parent:"file"},{id:"closeFile",parent:"file"},{id:"exportFile_png",parent:"exportFile"},{id:"exportFile_pdf",parent:"exportFile"},{id:"exportFile_csv",parent:"exportFile"},{id:"edit",parent:null},{id:"undo",parent:"edit",shortcut:"Ctrl+Z"},{id:"redo",parent:"edit",shortcut:"Ctrl+Y"},{id:"cut",parent:"edit",shortcut:"Ctrl+X"},{id:"copy",parent:"edit",shortcut:"Ctrl+C"},{id:"paste",parent:"edit",shortcut:"Ctrl+V"},{id:"delete",parent:"edit",shortcut:"Del"},{id:"duplicate",parent:"edit",shortcut:"Ctrl+D"},{id:"selectAll",parent:"edit",shortcut:"Ctrl+A"},{id:"findReplace",parent:"edit",shortcut:"Ctrl+F"},{id:"view",parent:null},{id:"zoomIn",parent:"view",shortcut:"Ctrl++"},{id:"zoomOut",parent:"view",shortcut:"Ctrl+-"},{id:"fitToScreen",parent:"view"},{id:"toggleGrid",parent:"view"},{id:"toggleGuides",parent:"view"},{id:"fullscreenMode",parent:"view",shortcut:"F11"},{id:"shape",parent:null},{id:"addNode",parent:"shape"},{id:"deleteNode",parent:"shape"},{id:"moveNode",parent:"shape"},{id:"resizeNode",parent:"shape"},{id:"rotateNode",parent:"shape"},{id:"changeNodeColor",parent:"shape"},{id:"changeNodeBorder",parent:"shape"},{id:"changeNodeText",parent:"shape"},{id:"groupNodes",parent:"shape"},{id:"ungroupNodes",parent:"shape"},{id:"lockNode",parent:"shape"},{id:"unlockNode",parent:"shape"},{id:"connection",parent:null},{id:"addEdge",parent:"connection"},{id:"deleteEdge",parent:"connection"},{id:"changeEdgeStyle",parent:"connection"},{id:"changeEdgeColor",parent:"connection"},{id:"changeEdgeLabel",parent:"connection"},{id:"reverseEdge",parent:"connection"},{id:"text",parent:null},{id:"addText",parent:"text"},{id:"editText",parent:"text"},{id:"changeFont",parent:"text"},{id:"changeFontSize",parent:"text"},{id:"changeFontColor",parent:"text"},{id:"boldText",parent:"text",shortcut:"Ctrl+B"},{id:"italicText",parent:"text",shortcut:"Ctrl+I"},{id:"underlineText",parent:"text",shortcut:"Ctrl+U"},{id:"alignText",parent:"text"},{id:"layer",parent:null},{id:"sendToBack",parent:"layer"},{id:"bringToFront",parent:"layer"},{id:"sendBackward",parent:"layer"},{id:"bringForward",parent:"layer"},{id:"duplicateLayer",parent:"layer"},{id:"deleteLayer",parent:"layer"},{id:"toggleLayerVisibility",parent:"layer"}],En={actions:Object.fromEntries($n.map(e=>[e.id,{...e,disabled:!1}]))},Se=ee({name:"menu",initialState:En,reducers:{setDisabled:(e,t)=>{e.actions[t.payload.id]&&(e.actions[t.payload.id].disabled=t.payload.disabled)},triggerAction:(e,t)=>{const o=e.actions[t.payload];o&&o.disabled}}}),{setDisabled:Bn,triggerAction:Vn}=Se.actions,Ln=Se.reducer,Pn=[{id:"save",icon:"save",disabled:!0,divide:!0},{id:"undo",icon:"undo",disabled:!0},{id:"redo",icon:"redo",disabled:!0,divide:!0},{id:"delete",icon:"trash",disabled:!1},{id:"add",icon:"cross",disabled:!1,divide:!0},{id:"layerUp",icon:"layers",disabled:!1},{id:"layerDown",icon:"layers",disabled:!1},{id:"layerTop",icon:"layers",disabled:!1},{id:"layerBottom",icon:"layers",disabled:!1,divide:!0},{id:"group",icon:"group",disabled:!0},{id:"ungroup",icon:"ungroup",disabled:!0,divide:!0},{id:"lock",icon:"lock",disabled:!1},{id:"unlock",icon:"unlock",disabled:!0}],zn={actions:Object.fromEntries(Pn.map(e=>[e.id,{...e,disabled:!1}]))},Ne=ee({name:"menu",initialState:zn,reducers:{setDisabled:(e,t)=>{e.actions[t.payload.id]&&(e.actions[t.payload.id].disabled=t.payload.disabled)},triggerAction:(e,t)=>{const o=e.actions[t.payload];o&&o.disabled}}}),{setDisabled:Xn,triggerAction:_n}=Ne.actions,Dn=Ne.reducer,Tn={zoom:1},je=ee({name:"statusBar",initialState:Tn,reducers:{setZoom:(e,t)=>{e.zoom=t.payload}}}),{setZoom:Hn}=je.actions,Rn=je.reducer,An=Ue({reducer:{menu:Ln,toolbar:Dn,statusBar:Rn}});Ke.createRoot(document.getElementById("root")).render(a.jsx(Ge,{store:An,children:a.jsx(kn,{})}));
