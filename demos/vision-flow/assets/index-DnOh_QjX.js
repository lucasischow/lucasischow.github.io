var De=Object.defineProperty;var Te=(o,s,e)=>s in o?De(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var x=(o,s,e)=>Te(o,typeof s!="symbol"?s+"":s,e);import{i as ke,a as $e,r as b,j as a,L as Le,b as ze,c as Re,d as Ie,e as Ae,f as Oe,g as _e,h as Be,k as Ve,l as We,m as Ye,t as He,u as ce,n as Xe,o as Ue,p as Ke,q as Ge}from"./vendor-CVhjYk4D.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function e(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(l){if(l.ep)return;l.ep=!0;const i=e(l);fetch(l.href,i)}})();const Ze={label:"File",tooltip:"Open the file menu"},qe={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},Je={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},Qe={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},et={label:"Save As",tooltip:"Save the current file with a new name"},tt={label:"Import File",tooltip:"Import a file into the project"},ot={label:"Export",tooltip:"Export the current file"},st={label:"Export as PNG",tooltip:"Export the file as a PNG image"},it={label:"Export as PDF",tooltip:"Export the file as a PDF document"},lt={label:"Export as CSV",tooltip:"Export the file as a CSV file"},nt={label:"Print",tooltip:"Print the current file"},rt={label:"Close File",tooltip:"Close the current file"},at={label:"Edit",tooltip:"Open the edit menu"},ct={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},dt={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},ht={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},ut={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},pt={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},ft={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},yt={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},mt={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},gt={label:"View",tooltip:"Open the view menu"},bt={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},xt={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},wt={label:"Fit to Screen",tooltip:"Fit the content to the screen"},vt={label:"Toggle Grid",tooltip:"Show or hide the grid"},Ct={label:"Toggle Guides",tooltip:"Show or hide the guides"},Mt={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},St={label:"Shape",tooltip:"Open the shape menu"},Nt={label:"Add Node",tooltip:"Add a new node to the diagram"},jt={label:"Delete Node",tooltip:"Delete the selected node"},Et={label:"Move Node",tooltip:"Move the selected node"},Pt={label:"Resize Node",tooltip:"Resize the selected node"},Ft={label:"Rotate Node",tooltip:"Rotate the selected node"},Dt={label:"Change Node Color",tooltip:"Change the color of the selected node"},Tt={label:"Change Node Border",tooltip:"Change the border of the selected node"},kt={label:"Change Node Text",tooltip:"Edit the text of the selected node"},$t={label:"Group Nodes",tooltip:"Group selected nodes together"},Lt={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},zt={label:"Lock Node",tooltip:"Lock the selected node"},Rt={label:"Unlock Node",tooltip:"Unlock the selected node"},It={label:"Connection",tooltip:"Open the connection menu"},At={label:"Add Edge",tooltip:"Add an edge between nodes"},Ot={label:"Delete Edge",tooltip:"Delete the selected edge"},_t={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},Bt={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},Vt={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},Wt={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},Yt={label:"Text",tooltip:"Open the text menu"},Ht={label:"Add Text",tooltip:"Add text to the document"},Xt={label:"Edit Text",tooltip:"Edit the selected text"},Ut={label:"Change Font",tooltip:"Change the font of the selected text"},Kt={label:"Change Font Size",tooltip:"Change the font size of the selected text"},Gt={label:"Change Font Color",tooltip:"Change the font color of the selected text"},Zt={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},qt={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},Jt={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},Qt={label:"Align Text",tooltip:"Align the selected text"},eo={label:"Layer",tooltip:"Open the layer menu"},to={label:"Send to Back",tooltip:"Send the selected layer to the back"},oo={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},so={label:"Send Backward",tooltip:"Send the selected layer one step backward"},io={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},lo={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},no={label:"Delete Layer",tooltip:"Delete the selected layer"},ro={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},ao={label:"Collaboration",tooltip:"Open the collaboration menu"},co={label:"Add Comment",tooltip:"Add a comment to the document"},ho={label:"Edit Comment",tooltip:"Edit the selected comment"},uo={label:"Delete Comment",tooltip:"Delete the selected comment"},po={label:"Share Document",tooltip:"Share the document with others"},fo={file:Ze,newFile:qe,openFile:Je,saveFile:Qe,saveAs:et,importFile:tt,exportFile:ot,exportFile_png:st,exportFile_pdf:it,exportFile_csv:lt,print:nt,closeFile:rt,edit:at,undo:ct,redo:dt,cut:ht,copy:ut,paste:pt,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:ft,selectAll:yt,findReplace:mt,view:gt,zoomIn:bt,zoomOut:xt,fitToScreen:wt,toggleGrid:vt,toggleGuides:Ct,fullscreenMode:Mt,shape:St,addNode:Nt,deleteNode:jt,moveNode:Et,resizeNode:Pt,rotateNode:Ft,changeNodeColor:Dt,changeNodeBorder:Tt,changeNodeText:kt,groupNodes:$t,ungroupNodes:Lt,lockNode:zt,unlockNode:Rt,connection:It,addEdge:At,deleteEdge:Ot,changeEdgeStyle:_t,changeEdgeColor:Bt,changeEdgeLabel:Vt,reverseEdge:Wt,text:Yt,addText:Ht,editText:Xt,changeFont:Ut,changeFontSize:Kt,changeFontColor:Gt,boldText:Zt,italicText:qt,underlineText:Jt,alignText:Qt,layer:eo,sendToBack:to,bringToFront:oo,sendBackward:so,bringForward:io,duplicateLayer:lo,deleteLayer:no,toggleLayerVisibility:ro,collaboration:ao,addComment:co,editComment:ho,deleteComment:uo,shareDocument:po},yo={"history-init":{label:"Init",tooltip:"Initialize the file"},"history-add":{label:"Add",tooltip:"Add modules to the file"},"history-delete":{label:"Delete",tooltip:"Delete modules from the file"},"history-paste":{label:"Paste",tooltip:"Paste modules into the file"},"history-duplicate":{label:"Duplicate",tooltip:"Duplicate selected modules"},"history-modify":{label:"Modify",tooltip:"Modify the properties of modules"},"history-move":{label:"Move",tooltip:"Move modules"},"history-reorder":{label:"Reorder",tooltip:"Reorder modules"},"history-select":{label:"Select",tooltip:"Select modules"},"history-group":{label:"Group",tooltip:"Group modules"},"history-ungroup":{label:"Ungroup",tooltip:"Ungroup modules"},"history-composite":{label:"Composite",tooltip:"Composite operation"}},mo={history:yo},go={label:"文件",tooltip:"打开文件菜单"},bo={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},xo={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},wo={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},vo={label:"另存为",tooltip:"以新名称保存当前文件"},Co={label:"导入文件",tooltip:"将文件导入到项目中"},Mo={label:"导出",tooltip:"导出当前文件"},So={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},No={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},jo={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},Eo={label:"打印",tooltip:"打印当前文件"},Po={label:"关闭文件",tooltip:"关闭当前文件"},Fo={label:"编辑",tooltip:"打开编辑菜单"},Do={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},To={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},ko={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},$o={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},Lo={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},zo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},Ro={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},Io={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},Ao={label:"视图",tooltip:"打开视图菜单"},Oo={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},_o={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},Bo={label:"适应屏幕",tooltip:"使内容适应屏幕"},Vo={label:"切换网格",tooltip:"显示或隐藏网格"},Wo={label:"切换参考线",tooltip:"显示或隐藏参考线"},Yo={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},Ho={label:"形状",tooltip:"打开形状菜单"},Xo={label:"添加节点",tooltip:"向图表添加新节点"},Uo={label:"删除节点",tooltip:"删除选定的节点"},Ko={label:"移动节点",tooltip:"移动选定的节点"},Go={label:"调整节点大小",tooltip:"调整选定节点的大小"},Zo={label:"旋转节点",tooltip:"旋转选定的节点"},qo={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},Jo={label:"更改节点边框",tooltip:"更改选定节点的边框"},Qo={label:"更改节点文本",tooltip:"编辑选定节点的文本"},es={label:"组合节点",tooltip:"将选定的节点组合在一起"},ts={label:"取消组合节点",tooltip:"取消组合选定的节点"},os={label:"锁定节点",tooltip:"锁定选定的节点"},ss={label:"解锁节点",tooltip:"解锁选定的节点"},is={label:"连接",tooltip:"打开连接菜单"},ls={label:"添加边",tooltip:"在节点之间添加边"},ns={label:"删除边",tooltip:"删除选定的边"},rs={label:"更改边样式",tooltip:"更改选定边的样式"},as={label:"更改边颜色",tooltip:"更改选定边的颜色"},cs={label:"更改边标签",tooltip:"更改选定边的标签"},ds={label:"反转边",tooltip:"反转选定边的方向"},hs={label:"文本",tooltip:"打开文本菜单"},us={label:"添加文本",tooltip:"向文档添加文本"},ps={label:"编辑文本",tooltip:"编辑选定的文本"},fs={label:"更改字体",tooltip:"更改选定文本的字体"},ys={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},ms={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},gs={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},bs={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},xs={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},ws={label:"对齐文本",tooltip:"对齐选定的文本"},vs={label:"图层",tooltip:"打开图层菜单"},Cs={label:"置于底层",tooltip:"将选定的图层置于底层"},Ms={label:"置于顶层",tooltip:"将选定的图层置于顶层"},Ss={label:"下移一层",tooltip:"将选定的图层下移一层"},Ns={label:"上移一层",tooltip:"将选定的图层上移一层"},js={label:"复制图层",tooltip:"复制选定的图层"},Es={label:"删除图层",tooltip:"删除选定的图层"},Ps={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},Fs={label:"协作",tooltip:"打开协作菜单"},Ds={label:"添加评论",tooltip:"向文档添加评论"},Ts={label:"编辑评论",tooltip:"编辑选定的评论"},ks={label:"删除评论",tooltip:"删除选定的评论"},$s={label:"分享文档",tooltip:"与他人分享文档"},Ls={file:go,newFile:bo,openFile:xo,saveFile:wo,saveAs:vo,importFile:Co,exportFile:Mo,exportFile_png:So,exportFile_pdf:No,exportFile_csv:jo,print:Eo,closeFile:Po,edit:Fo,undo:Do,redo:To,cut:ko,copy:$o,paste:Lo,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:zo,selectAll:Ro,findReplace:Io,view:Ao,zoomIn:Oo,zoomOut:_o,fitToScreen:Bo,toggleGrid:Vo,toggleGuides:Wo,fullscreenMode:Yo,shape:Ho,addNode:Xo,deleteNode:Uo,moveNode:Ko,resizeNode:Go,rotateNode:Zo,changeNodeColor:qo,changeNodeBorder:Jo,changeNodeText:Qo,groupNodes:es,ungroupNodes:ts,lockNode:os,unlockNode:ss,connection:is,addEdge:ls,deleteEdge:ns,changeEdgeStyle:rs,changeEdgeColor:as,changeEdgeLabel:cs,reverseEdge:ds,text:hs,addText:us,editText:ps,changeFont:fs,changeFontSize:ys,changeFontColor:ms,boldText:gs,italicText:bs,underlineText:xs,alignText:ws,layer:vs,sendToBack:Cs,bringToFront:Ms,sendBackward:Ss,bringForward:Ns,duplicateLayer:js,deleteLayer:Es,toggleLayerVisibility:Ps,collaboration:Fs,addComment:Ds,editComment:Ts,deleteComment:ks,shareDocument:$s},zs={"history-init":{label:"初始化",tooltip:"初始化文件"},"history-add":{label:"添加",tooltip:"向文件添加模块"},"history-delete":{label:"删除",tooltip:"从文件中删除模块"},"history-paste":{label:"粘贴",tooltip:"将模块粘贴到文件中"},"history-duplicate":{label:"复制",tooltip:"复制选定的模块"},"history-modify":{label:"修改",tooltip:"修改模块的属性"},"history-move":{label:"移动",tooltip:"移动模块"},"history-reorder":{label:"重新排序",tooltip:"重新排序模块"},"history-select":{label:"选择",tooltip:"选择模块"},"history-group":{label:"组合",tooltip:"组合模块"},"history-ungroup":{label:"取消组合",tooltip:"取消模块组合"},"history-composite":{label:"复合操作",tooltip:"复合操作"}},Rs={history:zs},Is={label:"ファイル",tooltip:"ファイルメニューを開く"},As={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},Os={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},_s={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},Bs={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},Vs={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},Ws={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Ys={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},Hs={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},Xs={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},Us={label:"印刷",tooltip:"現在のファイルを印刷"},Ks={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Gs={label:"編集",tooltip:"編集メニューを開く"},Zs={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},qs={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},Js={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},Qs={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},ei={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},ti={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},oi={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},si={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},ii={label:"表示",tooltip:"表示メニューを開く"},li={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},ni={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},ri={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},ai={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},ci={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},di={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},hi={label:"図形",tooltip:"図形メニューを開く"},ui={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},pi={label:"ノードを削除",tooltip:"選択したノードを削除"},fi={label:"ノードを移動",tooltip:"選択したノードを移動"},yi={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},mi={label:"ノードを回転",tooltip:"選択したノードを回転"},gi={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},bi={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},xi={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},wi={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},vi={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},Ci={label:"ノードをロック",tooltip:"選択したノードをロック"},Mi={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},Si={label:"接続",tooltip:"接続メニューを開く"},Ni={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},ji={label:"エッジを削除",tooltip:"選択したエッジを削除"},Ei={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},Pi={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},Fi={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},Di={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},Ti={label:"テキスト",tooltip:"テキストメニューを開く"},ki={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},$i={label:"テキストを編集",tooltip:"選択したテキストを編集"},Li={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},zi={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},Ri={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},Ii={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},Ai={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},Oi={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},_i={label:"テキストを配置",tooltip:"選択したテキストを配置"},Bi={label:"レイヤー",tooltip:"レイヤーメニューを開く"},Vi={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},Wi={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Yi={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},Hi={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},Xi={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},Ui={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},Ki={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Gi={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},Zi={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},qi={label:"コメントを編集",tooltip:"選択したコメントを編集"},Ji={label:"コメントを削除",tooltip:"選択したコメントを削除"},Qi={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},el={file:Is,newFile:As,openFile:Os,saveFile:_s,saveAs:Bs,importFile:Vs,exportFile:Ws,exportFile_png:Ys,exportFile_pdf:Hs,exportFile_csv:Xs,print:Us,closeFile:Ks,edit:Gs,undo:Zs,redo:qs,cut:Js,copy:Qs,paste:ei,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:ti,selectAll:oi,findReplace:si,view:ii,zoomIn:li,zoomOut:ni,fitToScreen:ri,toggleGrid:ai,toggleGuides:ci,fullscreenMode:di,shape:hi,addNode:ui,deleteNode:pi,moveNode:fi,resizeNode:yi,rotateNode:mi,changeNodeColor:gi,changeNodeBorder:bi,changeNodeText:xi,groupNodes:wi,ungroupNodes:vi,lockNode:Ci,unlockNode:Mi,connection:Si,addEdge:Ni,deleteEdge:ji,changeEdgeStyle:Ei,changeEdgeColor:Pi,changeEdgeLabel:Fi,reverseEdge:Di,text:Ti,addText:ki,editText:$i,changeFont:Li,changeFontSize:zi,changeFontColor:Ri,boldText:Ii,italicText:Ai,underlineText:Oi,alignText:_i,layer:Bi,sendToBack:Vi,bringToFront:Wi,sendBackward:Yi,bringForward:Hi,duplicateLayer:Xi,deleteLayer:Ui,toggleLayerVisibility:Ki,collaboration:Gi,addComment:Zi,editComment:qi,deleteComment:Ji,shareDocument:Qi},tl={"history-init":{label:"初期化",tooltip:"ファイルを初期化する"},"history-add":{label:"追加",tooltip:"ファイルにモジュールを追加する"},"history-delete":{label:"削除",tooltip:"ファイルからモジュールを削除する"},"history-paste":{label:"貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},"history-duplicate":{label:"複製",tooltip:"選択したモジュールを複製する"},"history-modify":{label:"修正",tooltip:"モジュールのプロパティを修正する"},"history-move":{label:"移動",tooltip:"モジュールを移動する"},"history-reorder":{label:"並べ替え",tooltip:"モジュールを並べ替える"},"history-select":{label:"選択",tooltip:"モジュールを選択する"},"history-group":{label:"グループ化",tooltip:"モジュールをグループ化する"},"history-ungroup":{label:"グループ化解除",tooltip:"モジュールのグループ化を解除する"},"history-composite":{label:"複合操作",tooltip:"複合操作"}},ol={history:tl},sl={en:{translation:{...fo,...mo}},cn:{translation:{...Ls,...Rs}},jp:{translation:{...el,...ol}}};ke.use($e).init({resources:sl,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const be=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,o=>{const s=Math.random()*16|0;return(o==="x"?s:s&3|8).toString(16)}),Q=b.createContext({fileMap:new Map,fileList:[],currentFileId:"",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{},setFileInitialized:()=>{},startCreateFile:()=>{},saveFileToLocal:()=>{}}),il=({bg:o="#fff",onBgClick:s})=>{const e=b.useRef(null),{createFile:t,handleCreating:l}=b.useContext(Q),[i,n]=b.useState(""),r=c=>/^[a-zA-Z0-9-_ ]+$/.test(c),d=c=>{var f;c.preventDefault(),c.stopPropagation();const u=(f=e.current)==null?void 0:f.filename.value.trim();if(!r(u)){n("File name can only including number space and alpha");return}n("");const h=be(),p={id:h,name:u,config:{dpr:2,scale:0,offset:{x:0,y:0},moduleIdCounter:0,frame:{id:h+"-frame",width:1e3,height:1414.142857,type:"rectangle",enableLine:!0,lineColor:"#000000",lineWidth:1,opacity:100,shadow:!1,rotation:0,layer:-1,fillColor:"#fff",enableFill:!0,x:500,y:707.0714285}},data:[]};t(p),l(!1)};return a.jsxs("div",{className:"fixed top-0 left-0 z-300 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[a.jsx("div",{style:{backgroundColor:o},onClick:()=>s&&s(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),a.jsxs("form",{ref:e,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:d,children:[a.jsx("h1",{className:"text-xl text-center",children:"New File"}),a.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),a.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),i&&a.jsx("div",{className:"text-red-500 my-2",children:i}),a.jsx("label",{className:"justify-center",children:a.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})};class ue{constructor(s,e,t,l=-1){x(this,"data");x(this,"prev");x(this,"next");x(this,"id");this.data=t,this.prev=s,this.next=e,this.id=l}}class ll{constructor(){x(this,"head");x(this,"tail");x(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(s){let e;const{tail:t}=this;return t?(e=new ue(t,null,s,t.id+1),t.next=e,this.tail=e):(e=new ue(null,null,s,0),this.head=e,this.tail=e),this.current=e,e}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(s){if(s===this.current)return"equal";let e=this.head;for(;e;){if(this.current===e)return"behind";if(s===e)return"front";e=e.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}class nl extends ll{constructor(e){super();x(this,"editor");this.editor=e,this.init()}init(){var e,t;this.append({type:"history-init",payload:{state:null,selectedModules:new Set}}),(t=(e=this.editor.events).onHistoryUpdated)==null||t.call(e,this)}add(e){this.detach(),this.append(e)}toArray(){const e=[];if(this.head){let t=this.head;for(e.push(t);t.next;)e.push(t.next),t=t.next}return e}compareToCurrentPosition(e){return super.compareToCurrentPosition(e)}forward(){return super.forward()}back(){return super.back()}}class rl{constructor(){x(this,"eventsMap",new Map)}on(s,e){this.eventsMap.has(s)?this.eventsMap.get(s).push(e):this.eventsMap.set(s,[e])}off(s,e){if(this.eventsMap.has(s)){const t=this.eventsMap.get(s);for(let l=t.length-1;l>=0;l--)if(t[l]===e)return t.splice(l,1),"deleted";return"Cannot find event or function"}}dispatch(s,e){this.eventsMap.has(s)&&this.eventsMap.get(s).forEach(t=>{t(e)})}execute(s,e){this.dispatch(s,e)}destroy(){this.eventsMap.clear()}}const xe=({x:o,y:s,width:e,height:t},l)=>{const i=o+e/2,n=s+t/2,r=l*Math.PI/180,d=Math.cos(r),c=Math.sin(r),u=Math.abs(e*d)+Math.abs(t*c),h=Math.abs(e*c)+Math.abs(t*d),p=i-u/2,f=n-h/2;return we({x:p,y:f,width:u,height:h})},we=o=>{const{x:s,y:e,width:t,height:l}=o;return{x:s,y:e,width:t,height:l,top:e,bottom:e+l,left:s,right:s+t,cx:s+t/2,cy:e+l/2}},V=(o,s)=>{const e=Math.min(o.x,s.x),t=Math.max(o.x,s.x),l=Math.min(o.y,s.y),i=Math.max(o.y,s.y);return we({x:e,y:l,width:t-e,height:i-l})};function al(o,s){return!(o.right<s.left||o.left>s.right||o.bottom<s.top||o.top>s.bottom)}const se=o=>o===0&&1/o===-1/0;function cl(o,s){let e=0,t;return(...l)=>{const i=Date.now(),n=()=>{e=i,o(...l)};i-e>=s?n():(t!==void 0&&clearTimeout(t),t=setTimeout(n,s-(i-e)))}}function le(o,s={}){if(typeof o!="object"||o===null)return o;if(Array.isArray(o))return o.map(t=>le(t,s));const e=Object.create(s.clonePrototype?Object.getPrototypeOf(o):null);for(const t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=le(o[t],s));return e}class de{constructor({id:s,lineColor:e,lineWidth:t=1,opacity:l=100,type:i,layer:n=1,rotation:r=0,shadow:d=!1,enableLine:c=!0}){x(this,"id");x(this,"type");x(this,"enableLine");x(this,"lineWidth");x(this,"lineColor");x(this,"opacity");x(this,"rotation");x(this,"shadow");x(this,"layer");this.id=s,this.layer=n,this.enableLine=c,this.lineColor=e,this.lineWidth=t,this.opacity=l,this.rotation=r,this.shadow=d,this.type=i}getDetails(s=!0){const e={type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,rotation:this.rotation};return s?{...e,id:this.id,layer:this.layer}:e}getBoundingRect(){return{bottom:0,cx:0,cy:0,left:0,right:0,top:0,x:0,y:0,width:0,height:0}}render(s){}static applyRotating(s){const{mouseDownPoint:e,mouseMovePoint:t,scale:l,dpr:i,offset:n}=this.viewport,{module:{rotation:r},moduleOrigin:d}=this._rotatingOperator,{x:c,y:u}=d,h=(e.x-n.x/i)/l*i,p=(e.y-n.y/i)/l*i,f=(t.x-n.x/i)/l*i,y=(t.y-n.y/i)/l*i,g=Math.atan2(p-u,h-c);let C=(Math.atan2(y-u,f-c)-g)*(180/Math.PI);s&&(C=Math.round(C/15)*15);let S=(r+C)%360;return S<0&&(S+=360),S}}const dl=[{type:"rotate",name:"rotate-tl",x:0,y:0,offsetX:-5,offsetY:-5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-tr",x:1,y:0,offsetX:5,offsetY:-5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-br",x:1,y:1,offsetX:5,offsetY:5,originCursor:"rotate",cursor:"rotate"},{type:"rotate",name:"rotate-bl",x:0,y:1,offsetX:-5,offsetY:5,originCursor:"rotate",cursor:"rotate"},{type:"resize",name:"tl",x:0,y:0,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"t",x:.5,y:0,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"tr",x:1,y:0,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"r",x:1,y:.5,originCursor:"ew-resize",cursor:"ew-resize"},{type:"resize",name:"br",x:1,y:1,originCursor:"nwse-resize",cursor:"nwse-resize"},{type:"resize",name:"b",x:.5,y:1,originCursor:"ns-resize",cursor:"ns-resize"},{type:"resize",name:"bl",x:0,y:1,originCursor:"nesw-resize",cursor:"nesw-resize"},{type:"resize",name:"l",x:0,y:.5,originCursor:"ew-resize",cursor:"ew-resize"}];function hl(o,s,e,t){return{x:(o.x*t-s.x)/e,y:(o.y*t-s.y)/e}}function ul(o,s,e,t){return{x:(o.x*e+s.x)/t,y:(o.y*e+s.y)/t}}const pl=(o,s)=>{if(o.size!==s.size)return!1;for(const e of o)if(!s.has(e))return!1;return!0},fl=(o,s)=>{const e=new Set;for(const t of o)s.has(t)||e.add(t);for(const t of s)o.has(t)||e.add(t);return e};function pe(o,s,e,t,l){const i=o-e,n=s-t,r=l*(Math.PI/180),d=Math.cos(r),c=Math.sin(r);return{x:e+i*d-n*c,y:t+i*c+n*d}}function ve(o,s=!1){const e=(()=>{switch(o){case"tl":return{dx:-1,dy:-1,cx:.5,cy:.5};case"t":return{dx:0,dy:-1,cx:0,cy:.5};case"tr":return{dx:1,dy:-1,cx:-.5,cy:.5};case"r":return{dx:1,dy:0,cx:-.5,cy:0};case"br":return{dx:1,dy:1,cx:-.5,cy:-.5};case"b":return{dx:0,dy:1,cx:0,cy:-.5};case"bl":return{dx:-1,dy:1,cx:.5,cy:-.5};case"l":return{dx:-1,dy:0,cx:.5,cy:0};default:throw new Error(`Unsupported resize handle: ${o}`)}})();return s?{...e,cx:0,cy:0}:e}class Ce extends de{constructor({x:e,y:t,fillColor:l,enableFill:i=!0,...n}){super(n);x(this,"x");x(this,"y");x(this,"fillColor");x(this,"enableFill");this.x=e,this.y=t,this.fillColor=l,this.enableFill=i}getDetails(e=!0){return{...super.getDetails(e),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y}}move(e,t){this.x+=e,this.y+=t}getOperators(e,t,l,i){const{x:n,y:r,width:d,height:c}=l,{id:u,rotation:h}=this;return dl.map(f=>{const y=n-d/2+f.x*d,g=r-c/2+f.y*c,m={id:u,width:0,height:0,x:y,y:g,lineColor:"",lineWidth:0,rotation:h,layer:this.layer,opacity:100};if(f.type==="resize"){const C=pe(y,g,n,r,h);m.id+="resize",m.x=C.x,m.y=C.y,m.width=e.size,m.height=e.size,m.lineWidth=e.lineWidth,m.lineColor=e.lineColor,m.fillColor=e.fillColor}else if(f.type==="rotate"){const C=y+f.offsetX*e.lineWidth,S=g+f.offsetY*e.lineWidth,P=pe(C,S,n,r,h);m.id+="rotate",m.x=P.x,m.y=P.y,m.width=t.size,m.height=t.size,m.lineWidth=t.lineWidth,m.lineColor=t.lineColor,m.fillColor=t.fillColor}return{id:`${u}`,type:f.type,name:f.name,moduleOrigin:i,module:new W(m)}})}isInsideRect(e){const t=this.getBoundingRect();return t.left>=e.left&&t.right<=e.right&&t.top>=e.top&&t.bottom<=e.bottom}}const q=class q extends Ce{constructor({width:e,height:t,radius:l=0,...i}){super({type:"rectangle",...i});x(this,"width");x(this,"height");x(this,"radius");this.width=e,this.height=t,this.radius=l}hitTest(e,t=5){const{x:l,y:i,width:n,height:r,rotation:d=0}=this,c=Math.cos(-d),u=Math.sin(-d),h=e.x-l,p=e.y-i,f=h*c+p*u,y=-h*u+p*c,g=n/2,m=r/2,C=f>=-g&&f<=g,S=y>=-m&&y<=m;if(C&&S){const P=Math.abs(f+g)<=t,w=Math.abs(f-g)<=t,M=Math.abs(y+m)<=t,N=Math.abs(y-m)<=t;return P||w||M||N?"border":"inside"}return null}getDetails(e=!0){return{width:this.width,height:this.height,...super.getDetails(e)}}getRect(){const{x:e,y:t,width:l,height:i}=this;return{x:e,y:t,width:l,height:i}}getBoundingRect(){const{x:e,y:t,width:l,height:i,rotation:n}=this,r=e-l/2,d=t-i/2;return n===0?{x:r,y:d,width:l,height:i,left:r,top:d,right:r+l,bottom:d+i,cx:e,cy:t}:xe({x:r,y:d,width:l,height:i},n)}getSelectedBoxModule(e,t){const{id:l,rotation:i,layer:n}=this,r={...this.getRect(),lineColor:t,lineWidth:e,rotation:i,layer:n,id:l+"-selected-box",opacity:0};return new q(r)}getHighlightModule(e,t){const{x:l,y:i,width:n,height:r,rotation:d,layer:c,id:u}=this;return new q({x:l,y:i,width:n,height:r,lineColor:t,lineWidth:e,rotation:d,layer:c,id:u+"highlight",opacity:0})}getOperators(e,t){return super.getOperators(e,t,this.getRect(),this.getDetails(!0))}getSnapPoints(){const{x:e,y:t,width:l,height:i,id:n}=this,r=l/2,d=i/2;return[{id:n,x:e,y:t,type:"center"},{id:n,x:e-r,y:t-d,type:"corner-tl"},{id:n,x:e+r,y:t-d,type:"corner-tr"},{id:n,x:e+r,y:t+d,type:"corner-br"},{id:n,x:e-r,y:t+d,type:"corner-bl"},{id:n,x:e,y:t-d,type:"edge-top"},{id:n,x:e+r,y:t,type:"edge-right"},{id:n,x:e,y:t+d,type:"edge-bottom"},{id:n,x:e-r,y:t,type:"edge-left"}]}render(e){const{radius:t}=this;let{x:l,y:i,width:n,height:r,rotation:d,opacity:c,fillColor:u,lineWidth:h,lineColor:p,dashLine:f}=this.getDetails();l=Math.round(l),i=Math.round(i),n=Math.round(n),r=Math.round(r);const y=n/2,g=r/2;e.save(),e.translate(l,i),d>0&&e.rotate(d*Math.PI/180),c>0&&(e.fillStyle=u,e.globalAlpha=c/100),h>0&&(e.lineWidth=h,e.strokeStyle=p,e.lineJoin="miter"),e.beginPath(),f&&e.setLineDash([3,5]),t>0?(e.moveTo(-y+t,-g),e.arcTo(y,-g,y,g,t),e.arcTo(y,g,-y,g,t),e.arcTo(-y,g,-y,-g,t),e.arcTo(-y,-g,y,-g,t)):e.rect(-y,-g,n,r),e.closePath(),c>0&&e.fill(),h>0&&e.stroke(),e.restore()}};x(q,"applyResizeTransform",({downPoint:e,movePoint:t,moduleOrigin:l,rotation:i,handleName:n,scale:r,dpr:d,altKey:c=!1,shiftKey:u=!1})=>{const{width:h,height:p,x:f,y}=l,g=t.x-e.x,m=t.y-e.y,C=g/r*d,S=m/r*d,P=-i*(Math.PI/180),w=Math.cos(P),M=Math.sin(P),N=C*w-S*M,j=C*M+S*w,D=ve(n,c);let L=N*D.dx,F=j*D.dy;if(u){const k=h/p,K=Math.abs(L),X=Math.abs(F);D.dx!==0&&D.dy!==0?K>X?F=L/k:L=F*k:D.dx!==0?F=L/k:D.dy!==0&&(L=F*k)}const T=c?2:1,z=Math.abs(h+L*T),R=Math.abs(p+F*T),O=-L*D.cx*T,_=-F*D.cy*T,Y=O*w+_*M,H=-O*M+_*w,v=f+Y,E=y+H;return{x:v,y:E,width:z,height:R}});let W=q;const J=class J extends Ce{constructor({fillColor:e,enableFill:t=!0,r1:l,r2:i,...n}){super({type:"rectangle",...n});x(this,"r1");x(this,"r2");x(this,"fillColor");x(this,"enableFill");this.r1=l,this.r2=i,this.fillColor=e,this.enableFill=t}hitTest(e,t=5){const{x:l,y:i,r1:n,r2:r,rotation:d=0}=this,c=Math.cos(-d),u=Math.sin(-d),h=e.x-l,p=e.y-i,f=h*c-p*u,y=h*u+p*c,g=f*f/(n*n)+y*y/(r*r),m=t/Math.min(n,r);return g<=1+m?g>=1-m?"border":"inside":null}getDetails(e=!0){return{...super.getDetails(e),fillColor:this.fillColor,enableFill:this.enableFill,r1:this.r1,r2:this.r2}}getBoundingRect(){const{x:e,y:t,r1:l,r2:i,rotation:n}=this;return xe({x:e-l,y:t-i,width:l*2,height:i*2},n)}getRect(){const{x:e,y:t,r1:l,r2:i}=this;return{x:e,y:t,width:l*2,height:i*2}}getSelectedBoxModule(e,t){const{id:l,rotation:i,layer:n}=this,r={...this.getRect(),lineColor:t,lineWidth:e,rotation:i,layer:n,id:l+"-selected-box",opacity:0};return new W(r)}getHighlightModule(e,t){const{x:l,y:i,r1:n,r2:r,rotation:d,layer:c,id:u}=this;return new J({x:l,y:i,r1:n,r2:r,lineColor:t,lineWidth:e,rotation:d,layer:c,id:u+"highlight",opacity:0})}getOperators(e,t){return super.getOperators(e,t,this.getRect(),this.getDetails(!0))}getSnapPoints(){const{x:e,y:t,r1:l,r2:i,id:n}=this;return[{id:n,x:e,y:t,type:"center"},{id:n,x:e,y:t-i,type:"edge-top"},{id:n,x:e+l,y:t,type:"edge-right"},{id:n,x:e,y:t+i,type:"edge-bottom"},{id:n,x:e-l,y:t,type:"edge-left"}]}render(e){let{x:t,y:l,r1:i,r2:n,opacity:r,fillColor:d,rotation:c,dashLine:u,gradient:h}=this.getDetails();const{lineWidth:p,lineColor:f}=super.getDetails();t=Math.round(t),l=Math.round(l),i=Math.round(i),n=Math.round(n),e.save(),e.translate(t,l),c!==0&&e.rotate(c*Math.PI/180),r>0&&(e.fillStyle=d,e.globalAlpha=r/100),p>0&&(e.lineWidth=p,e.strokeStyle=f,e.lineJoin="round"),e.beginPath(),e.ellipse(0,0,i,n,0,0,Math.PI*2),u?e.setLineDash([3,5]):e.setLineDash([]),e.closePath(),r>0&&e.fill(),p>0&&e.stroke(),h&&(e.fillStyle=h,r>0&&e.fill()),e.restore()}};x(J,"applyResizeTransform",({downPoint:e,movePoint:t,moduleOrigin:l,rotation:i,handleName:n,scale:r,dpr:d,altKey:c=!1,shiftKey:u=!1})=>{const{r1:h,r2:p,x:f,y}=l,g=h*2,m=p*2,C=t.x-e.x,S=t.y-e.y,P=C/r*d,w=S/r*d,M=-i*(Math.PI/180),N=Math.cos(M),j=Math.sin(M),D=P*N-w*j,L=P*j+w*N,F=ve(n,c);let T=D*F.dx,z=L*F.dy;if(u){const X=g/m,Pe=Math.abs(T),Fe=Math.abs(z);F.dx!==0&&F.dy!==0?Pe>Fe?z=T/X:T=z*X:F.dx!==0?z=T/X:F.dy!==0&&(T=z*X)}const R=c?2:1,O=Math.abs(g+T*R),_=Math.abs(m+z*R),Y=-T*F.cx*R,H=-z*F.cy*R,v=Y*N+H*j,E=-Y*j+H*N,k=f+v,K=y+E;return{x:k,y:K,r1:O/2,r2:_/2}});let ne=J;function yl(o){const s=le(o),e=new Map;let t=0;const l=i=>{if(i.id||(i.id=this.createModuleId),isNaN(i.layer)){const n=this.getMaxLayerIndex;t=Math.max(t,n),t++,i.layer=t}if(i.type==="rectangle")return new W(i);if(i.type==="ellipse")return new ne(i)};return s.forEach(i=>{const n=l.call(this,i);e.set(i.id,n)}),e}function ml(o){return o.forEach(s=>{this.moduleMap.set(s.id,s)}),o}const gl=function(o,s){const e=new Map,t=[];return o.forEach(l=>{const i=this.moduleMap.get(l);i&&(t.push(i),e.set(l,i))}),t.sort((l,i)=>l.layer-i.layer),t.map(l=>l.getDetails(s))};function bl(o){const s=this.batchCopy(o);return s.forEach(e=>{this.moduleMap.delete(e.id)}),s}function xl(o,s){this.getModulesByIdSet(o).forEach(t=>{t.x+=s.x,t.y+=s.y})}function wl(o,s){this.getModulesByIdSet(o).forEach(t=>{Object.keys(s).forEach(l=>{const i=l;t[i]=s[l]})})}function vl(o){return o===null?"null":o===void 0?"undefined":o instanceof Set?"set":o instanceof Map?"map":Array.isArray(o)?"array":o instanceof Date?"date":o instanceof RegExp?"regexp":o instanceof Error?"error":o instanceof Promise?"promise":o instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(o)?"typedarray":o instanceof WeakSet?"weakset":o instanceof WeakMap?"weakmap":typeof o=="function"?"function":typeof o=="symbol"?"symbol":typeof o=="bigint"?"bigint":typeof o=="object"?"object":typeof o}function G(o,s){if(vl(o)!=="set")return;if(o.size===1){const t=[...o.values()][0];this.moduleMap.has(t)&&this.moduleMap.get(t).getDetails()}const e=this.getSelected;this.selectedModules.clear(),s==="replace"&&e.clear(),o.forEach(t=>{switch(s){case"add":e.add(t);break;case"delete":e.delete(t);break;case"toggle":e.has(t)?e.delete(t):e.add(t);break;case"replace":e.add(t);break}}),e.forEach(t=>this.selectedModules.add(t))}function Cl(){this.getSelectedPropsIfUnique}const A=(o,s,e)=>{const t=document.createElement(o);return t.setAttribute(s,""),t.id=s+"-"+e,t};function Ml(o){const s="#1FB3FF",e="rgba(31,180,255,0.1)",t=A("div","editor-wrapper",o),l=A("canvas","editor-main-canvas",o),i=A("canvas","editor-selection-canvas",o),n=A("div","scroll-bar-x",o),r=A("div","scroll-bar-x",o),d=A("div","editor-selection-box",o),c=A("div","editor-cursor",o),u=A("style","editor-style",o);return u.textContent=`
    #${l.id} {
      background-color: #f0f0f0;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${i.id} {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    #${t.id} {
      user-select: none;
      position: relative;
      scrollbar-width: thin;
      scrollbar-color: #787878 transparent;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    #${d.id} {
      display: none;
      pointer-events: none;
      position: absolute;
      border: 1px solid ${s};
      background-color: ${e};
    }
    
    #${n.id},
    #${r.id}{
      background-color: #787878;
      user-select:none;
      translate:none;
    }
    
    #${c.id}{
      display: none;
      pointer-events: none;
      width:20px;
      height:20px;
    }
    
    #${c.id} svg{
      width:18px;
      height:18px;
    }
  `,t.append(l,i,n,r,d,c,u),{wrapper:t,selectionBox:d,selectionCanvas:i,mainCanvas:l,scrollBarX:n,scrollBarY:r,cursor:c}}const Sl=(o,s)=>{o.style.width="50px",o.style.height="6px",o.style.position="absolute",o.style.bottom="0",o.style.left="0",s.style.width="6px",s.style.height="50px",s.style.position="absolute",s.style.right="0",s.style.top="0"},Me=(o,{x:s,y:e,height:t,width:l},i=!0)=>{o.style.transform=`translate(${s}px, ${e}px)`,o.style.width=l+"px",o.style.height=t+"px",o.style.display=i?"block":"none"};function B(o,s,e){const{wrapper:t,cursor:l}=this.viewport;if(o==="default"){t.style.cursor="default",l.style.display="none";return}if(o==="resize"){t.style.cursor=`${s}-resize`,l.style.display="none";return}if(o==="grabbing"){t.style.cursor="grabbing",l.style.display="none";return}if(t.style.cursor="none",o==="rotate"){const{x:r,y:d}=s;l.innerHTML=`
       <?xml version="1.0" encoding="UTF-8"?>
<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.99 18.93">
  <path d="M15.57,16.04c.48-.57,1-1.1,1.5-1.65.35-.38.54-.85,1.15-.82.72.04,1.01.78.55,1.34-1.07,1.3-2.37,2.5-3.44,3.82-.69.48-1.09,0-1.56-.48-.91-.95-1.92-2.07-2.78-3.07-.3-.35-.58-.72-.33-1.19.39-.73,1.08-.39,1.53.07.52.55,1.01,1.17,1.51,1.74.07.08.17.19.26.22,0-.81.02-1.64-.08-2.44-.51-4.07-3.48-7.36-7.47-8.32-1.12-.27-2.22-.25-3.37-.24.15.2.34.39.52.56.51.47,1.2.95,1.66,1.44.69.73-.3,1.84-1.1,1.19-.91-.74-1.83-1.68-2.7-2.48-.38-.35-1.06-.81-1.29-1.26-.21-.4-.1-.54.14-.89C1.59,2.57,2.79,1.18,4.11.18c.76-.58,1.72.38,1.13,1.14l-2.3,2.09c.76.04,1.52-.01,2.28.06,5.2.47,9.42,4.43,10.22,9.59.15.99.1,1.98.14,2.98Z"/>
</svg>
  `,e+=45,l.style.display="block",l.style.transformOrigin="center center",l.style.transform=`translate(${r-12}px, ${d-12}px) rotate(${e}deg)`}}function Nl(){if(this.moduleMap.size===0)return;const{selectionCTX:o}=this.viewport,s="#5491f8",e="#5491f8",t=this.getVisibleSelected,l=2/this.viewport.scale*this.viewport.dpr,i=1/this.viewport.scale*this.viewport.dpr,n=new Set(t);this.hoveredModule&&n.add(this.hoveredModule),t.forEach(r=>{const d=this.moduleMap.get(r);d&&d.getSelectedBoxModule(i,e).render(o)}),n.forEach(r=>{const d=this.moduleMap.get(r),{x:c,y:u,rotation:h,layer:p}=d.getDetails(),f=1/this.viewport.scale*this.viewport.dpr,y=d.getHighlightModule(f,s),g=new W({x:c,y:u,layer:p,id:r+"hover-center",width:l*2,height:l*2,fillColor:s,lineColor:"transparent",lineWidth:f,rotation:h,opacity:100,radius:r===this.hoveredModule?l:0});y.render(o),g.render(o)}),this.operationHandlers.forEach(r=>{r.module.render(o)})}function he(){const{viewport:o}=this,s=this.getWorldPointByViewportPoint(o.mouseMovePoint.x,o.mouseMovePoint.y);let e=null,t=null;const l=[...this.operationHandlers];for(let n=l.length-1;n>=0;n--)if(l[n].module.hitTest(s)){t=l[n];break}if(t)return this.action.dispatch("module-hover-enter",t.id),t;const i=[...this.getVisibleModuleMap.values()];for(let n=i.length-1;n>=0;n--){const r=i[n];if(r.hitTest(s)){e=r.id;break}}this.hoveredModule!==e&&(this.hoveredModule&&this.action.dispatch("module-hover-leave",this.hoveredModule),e&&this.action.dispatch("module-hover-enter",e))}function ee(o,s){const{mouseDownPoint:e,mouseMovePoint:t,scale:l,dpr:i}=this.viewport,{name:n,module:{rotation:r},moduleOrigin:d}=this._resizingOperator,{id:c}=d,u={downPoint:e,movePoint:t,dpr:i,scale:l,rotation:r,handleName:n,altKey:o,shiftKey:s,moduleOrigin:d},h=this.moduleMap.get(c);if(h)return h.constructor.applyResizeTransform(u)}function re(o,s){const e=s.x-o.x,t=s.y-o.y;let n=Math.atan2(t,e)*(180/Math.PI);return n<0&&(n+=360),n}function jl(o,s){const e=re(s,o);return e>=337.5&&e<=360||e>=0&&e<22.5?"e":e>=22.5&&e<67.5?"se":e>=67.5&&e<112.5?"s":e>=112.5&&e<157.5?"sw":e>=157.5&&e<202.5?"w":e>=202.5&&e<247.5?"nw":e>=247.5&&e<292.5?"n":e>=292.5&&e<337.5?"ne":"e"}function El(o){const{shiftKey:s,clientY:e,target:t,button:l,clientX:i,metaKey:n,ctrlKey:r}=o;if(t!==this.viewport.wrapper)return;const d=r||n||s,c=i-this.viewport.rect.x,u=e-this.viewport.rect.y;this.viewport.mouseDownPoint.x=c,this.viewport.mouseDownPoint.y=u,this.viewport.mouseMovePoint.x=c,this.viewport.mouseMovePoint.y=u;const h=he.call(this);if(o.preventDefault(),l!==0)return;if(this.viewport.spaceKeyDown)return this.manipulationStatus="panning";if(h){if(h.type==="resize")return this._resizingOperator=h,this.manipulationStatus="resizing";if(h.type==="rotate")return this._rotatingOperator=h,this.manipulationStatus="rotating"}const p=this.hoveredModule;if(!p)return d||this.action.dispatch("selection-clear"),this.selectedShadow=this.getSelected,this.manipulationStatus="selecting";this.manipulationStatus="dragging";const f=this.getSelected,y=f.has(p);f.size===0||!y&&!d?(this.action.dispatch("selection-modify",{mode:"replace",idSet:new Set([p])}),this.draggingModules=new Set([p])):d?(this.draggingModules=new Set(f),y?(this._deselection=p,this.draggingModules.add(p)):this.action.dispatch("selection-modify",{mode:"add",idSet:new Set([p])}),this.draggingModules.add(p)):this.draggingModules=new Set(f)}function Pl(o){var e,t;if(o.button===0){const{draggingModules:l,manipulationStatus:i,moduleMap:n,_selectingModules:r,selectedShadow:d,viewport:c}=this,u=o.clientX-c.rect.x,h=o.clientY-c.rect.y,p=o.ctrlKey||o.metaKey||o.shiftKey;switch(c.mouseMovePoint.x=u,c.mouseMovePoint.y=h,i){case"selecting":break;case"panning":B.call(this,"grabbing");break;case"dragging":{const f=(c.mouseMovePoint.x-c.mouseDownPoint.x)*c.dpr/c.scale,y=(c.mouseMovePoint.y-c.mouseDownPoint.y)*c.dpr/c.scale;if(!(f===0&&y===0)){const m=[];this.action.dispatch("module-modifying",{type:"move",data:{x:-f,y:-y}}),l.forEach(C=>{const S=n.get(C);if(S){const P={id:C,props:{x:S.x+f,y:S.y+y}};m.push(P)}}),this.action.dispatch("module-modify",m)}else{const m=this.hoveredModule;m&&p&&m===this._deselection&&this.action.dispatch("selection-modify",{mode:"toggle",idSet:new Set([m])})}}break;case"resizing":{const{altKey:f,shiftKey:y}=o,g=ee.call(this,f,y),m=(e=this._resizingOperator)==null?void 0:e.moduleOrigin,C={};Object.keys(g).forEach(S=>{C[S]=m[S]}),this.action.dispatch("module-modifying",{type:"resize",data:C}),this.action.dispatch("module-modify",[{id:this._resizingOperator.id,props:g}])}break;case"rotating":{const{shiftKey:f}=o,y=de.applyRotating.call(this,f),{rotation:g}=(t=this._rotatingOperator)==null?void 0:t.moduleOrigin,m={rotation:g};this.action.dispatch("module-modifying",{type:"resize",data:m}),this.action.dispatch("module-modify",[{id:this._rotatingOperator.id,props:{rotation:y}}])}break;case"waiting":this.action.dispatch("selection-clear");break;case"static":o.ctrlKey||o.metaKey||o.shiftKey?this.toggleSelected(l):this.replaceSelected(l);break}l.clear(),d.clear(),r.clear(),r.clear(),this.manipulationStatus="static",this._deselection=null,this._resizingOperator=null,Me(c.selectionBox,{x:0,y:0,width:0,height:0},!1)}}function Fl(o){if(!(this.manipulationStatus==="panning"||this.manipulationStatus==="selecting")){if(o.code==="Space"){this.viewport.spaceKeyDown=!0,B.call(this,"grabbing"),o.preventDefault();return}if(this.manipulationStatus==="resizing"){const{altKey:s,shiftKey:e}=o,t=ee.call(this,s,e);this.action.dispatch("module-modifying",{type:"resize",data:t})}}}function Dl(o){if(o.code==="Space"&&(this.viewport.spaceKeyDown=!1,this.viewport.wrapper.style.cursor="default"),this.manipulationStatus==="resizing"){const{altKey:s,shiftKey:e}=o,t=ee.call(this,s,e);this.action.dispatch("module-modifying",{type:"resize",data:t})}}function Tl(o){if(o.target!==this.viewport.wrapper||(o.preventDefault(),o.stopPropagation(),this.manipulationStatus!=="static"))return;const{zooming:s,panning:e,scrolling:t,zoomFactor:l,translateX:i,translateY:n}=kl(o);this.viewport.zooming=s,s?this.action.dispatch("world-zoom",{zoomBy:!0,zoomFactor:l,physicalPoint:this.viewport.mouseMovePoint}):(e||t)&&this.action.dispatch("world-shift",{x:i,y:n}),this.updateWorldRect()}const kl=(()=>{let o;const t=[];let l=!1,i=!1,n=!1,r=0,d=0,c=0,u=!1;const h=.01,p=.1;let f=!1;return y=>{const{deltaX:g,deltaY:m,altKey:C}=y;if(o&&clearTimeout(o),u?t.length=0:t.push(y),d=0,c=0,l=!1,n=!1,i=!1,C&&(l=!0),t.length>=3){const S=t.every(M=>se(M.deltaX)),P=t.every(M=>ae(M.deltaY)),w=t.every(M=>Math.abs(M.deltaY)>4);S&&P&&!w&&(u=!0,f=!0)}return u?(r=m>0?-.01:h,l=!0):Math.abs(g)>=40&&se(m)?C?r=g<0?p:-.1:(n=!0,d=-g):se(g)&&ae(m)&&Math.abs(m)>4?C?r=m<0?h:-.01:(n=!0,c=-m):fe(g)&&fe(m)&&(C?r=(Math.abs(g)>Math.abs(m)?g:m)<0?h:-.01:(i=!0,d=-g,c=-m)),l&&C&&(r=r<0?-.1:p),o=setTimeout(()=>{u=!1,l=!1,i=!1,n=!1,r=0,d=0,c=0,t.length=0},200),{trackpad:f,zooming:l,panning:i,scrolling:n,zoomFactor:r,translateX:d,translateY:c}}})();function fe(o){return!ae(o)}function ae(o){return Math.abs(o)%1!==0}function $l(o){const{action:s,draggingModules:e,viewport:t,selectedShadow:l,_selectingModules:i}=this;switch(t.mouseMovePoint.x=o.clientX-t.rect.x,t.mouseMovePoint.y=o.clientY-t.rect.y,t.drawCrossLine=!1,s.dispatch("world-mouse-move"),this.manipulationStatus){case"selecting":{t.wrapper.setPointerCapture(o.pointerId);const n=V(t.mouseDownPoint,t.mouseMovePoint),r=this.getWorldPointByViewportPoint(n.x,n.y),d=this.getWorldPointByViewportPoint(n.right,n.bottom),c=V(r,d),u=new Set,h=o.ctrlKey||o.metaKey||o.shiftKey;this.moduleMap.forEach(y=>{y.isInsideRect(c)&&u.add(y.id)});const p=!pl(i,u);if(Me(t.selectionBox,n),!p)return;this._selectingModules=u;const f=fl(l,u);if(h)s.dispatch("selection-modify",{mode:"replace",idSet:f});else{if(u.size===0&&l.size===0)return s.dispatch("selection-clear");const y=new Set([...l,...u]);s.dispatch("selection-modify",{mode:"replace",idSet:y})}}break;case"panning":t.wrapper.setPointerCapture(o.pointerId),B.call(this,"grabbing"),s.dispatch("world-shift",{x:o.movementX,y:o.movementY});break;case"dragging":{t.wrapper.setPointerCapture(o.pointerId);const n=o.movementX*t.dpr/t.scale,r=o.movementY*t.dpr/t.scale;this.action.dispatch("module-modifying",{type:"move",data:{x:n,y:r}})}break;case"resizing":{t.wrapper.setPointerCapture(o.pointerId);const{altKey:n,shiftKey:r}=o,d=ee.call(this,n,r);this.action.dispatch("module-modifying",{type:"resize",data:d})}break;case"rotating":{t.wrapper.setPointerCapture(o.pointerId);const{shiftKey:n}=o,{x:r,y:d}=this._rotatingOperator.moduleOrigin,c=this.getViewPointByWorldPoint(r,d),u=de.applyRotating.call(this,n),h=re(c,t.mouseMovePoint);B.call(this,"rotate",t.mouseMovePoint,h),this.action.dispatch("module-modifying",{type:"rotate",data:{rotation:u}})}break;case"waiting":(Math.abs(t.mouseMovePoint.x-t.mouseDownPoint.x)>1||Math.abs(t.mouseMovePoint.y-t.mouseDownPoint.y)>1)&&(e.size>0?this.manipulationStatus="dragging":this.manipulationStatus="selecting");break;case"static":{const n=he.call(this),{viewport:r}=this;if(n){if(n.type==="rotate"){const d=this.getViewPointByWorldPoint(n.moduleOrigin.x,n.moduleOrigin.y),c=re(d,r.mouseMovePoint);B.call(this,"rotate",r.mouseMovePoint,c)}else if(n.type==="resize"){const{x:d,y:c}=n.moduleOrigin,u=this.getViewPointByWorldPoint(d,c),h=jl(r.mouseMovePoint,u);B.call(this,"resize",h)}}else B.call(this,"default");r.wrapper.releasePointerCapture(o.pointerId),r.drawCrossLine=r.drawCrossLineDefault}break}}function Ll(o){o.preventDefault(),o.stopPropagation(),he.call(this);const s=this.hoveredModule,e=this.getSelected,t={...this.viewport.mouseMovePoint};let l=new Set;return s&&(e.has(s)?l=e:(l.add(s),this.addSelected(l),this.selectedModules,this.action.dispatch("selection-updated"))),this.action.dispatch("context-menu",{idSet:l,position:t,copiedItems:this.copiedItems.length>0}),!1}function zl(){const{wrapper:o,mainCanvas:s,selectionCanvas:e,selectionBox:t,scrollBarX:l,scrollBarY:i,cursor:n}=Ml(this.id),r=e.getContext("2d"),d=s.getContext("2d"),c=new AbortController,u=new ResizeObserver(cl(()=>{this.action.dispatch("world-resized")},200)),{signal:h}=c,p={x:0,y:0},f={x:0,y:0},y=V(p,f),g=V(p,f),m=V(p,f);return o.addEventListener("mousedown",El.bind(this),{signal:h,passive:!1}),o.addEventListener("mouseup",Pl.bind(this),{signal:h}),window.addEventListener("keydown",Fl.bind(this),{signal:h}),window.addEventListener("keyup",Dl.bind(this),{signal:h}),window.addEventListener("wheel",Tl.bind(this),{signal:h,passive:!1}),o.addEventListener("pointermove",$l.bind(this),{signal:h}),o.addEventListener("contextmenu",Ll.bind(this),{signal:h}),{drawCrossLine:!1,drawCrossLineDefault:!1,enableCrossLine:!1,initialized:!1,scale:1,spaceKeyDown:!1,zooming:!1,dpr:this.config.dpr,frame:new W({...this.config.frame}),offset:{x:0,y:0},viewportRect:g,worldRect:m,mouseDownPoint:p,mouseMovePoint:f,rect:y,wrapper:o,mainCanvas:s,selectionCanvas:e,selectionCTX:r,mainCTX:d,scrollBarX:l,scrollBarY:i,selectionBox:t,cursor:n,resizeObserver:u,eventsController:c}}function Rl(){this.viewport&&(this.viewport.resizeObserver.disconnect(),this.viewport.eventsController.abort(),this.viewport.wrapper.style.width="100%",this.viewport.wrapper.style.height="100%",this.viewport.wrapper.remove(),this.viewport=null)}const ye=(o,s,e)=>{const t=[s,0,0,s,e.x,e.y];o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,o.canvas.width*2,o.canvas.height*2),o.setTransform(...t)},Se=o=>new Set(o.map(s=>s.id));function Ne(o=!1){if(this.history.current===this.history.tail)return!1;this.history.forward();const{type:s,payload:e}=this.history.current.data,{selectedModules:t}=e;switch(s){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchAdd(this.batchCreate(e.modules));break;case"history-modify":e.changes.map(({id:l,props:i})=>{const n={};Object.keys(i).forEach(r=>{n[r]=i[r].to,this.batchModify(new Set([l]),n)})});break;case"history-move":this.batchMove(e.selectedModules,{x:e.delta.x,y:e.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":this.batchDelete(Se(e.modules));break}return o||(this.replaceSelected(t),this.action.dispatch("selection-updated")),this.history.current}function je(o=!1){if(this.history.current===this.history.head)return!1;const{type:s,payload:e}=this.history.current.data;let t=null;switch(s){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchDelete(Se(e.modules));break;case"history-modify":e.changes.map(({id:l,props:i})=>{const n={};Object.keys(i).forEach(r=>{n[r]=i[r].from,this.batchModify(new Set([l]),n)})});break;case"history-move":this.batchMove(e.selectedModules,{x:-e.delta.x,y:-e.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":t=e.modules,this.batchAdd(this.batchCreate(t));break}if(this.history.back(),!o){const l=this.history.current.data.payload.selectedModules;this.replaceSelected(l),this.action.dispatch("selection-updated")}return this.history.current}function Il(o){const s=this.history.compareToCurrentPosition(o);if(!(!s||s==="equal")&&(s==="front"||s==="behind")){let t;for(;s==="front"?t=je.call(this,!0):s==="behind"&&(t=Ne.call(this,!0)),t!==o;);const{selectedModules:l}=o.data.payload;this.replaceSelected(l)}}const Al=(o,s,e=.02)=>{const{width:t,height:l}=s,{width:i,height:n}=o,r=t/i,d=l/n,c=Math.min(r,d)-Math.min(r,d)*e,u=o.width*c,h=o.height*c,p=o.x*c,f=o.y*c,y=(t-u)/2-p,g=(l-h)/2-f;return{scale:c,offsetX:y,offsetY:g}};function Ol(o,s){const{dpr:e,scale:t,rect:l,offset:i,viewportRect:n}=this.viewport,r=(o.x-l.width/2)*e,d=(o.y-l.height/2)*e,c=l.width/8,u=l.height/8,h=s/t,p=s<t?-.2:.2;if(h===0)return i;const f=n.cx,y=n.cy;let g=f-(f-i.x)*h,m=y-(y-i.y)*h;return Math.abs(r)>c&&(g=g-r*h*p),Math.abs(d)>u&&(m=m-d*h*p),{x:g,y:m}}function _l(){const{container:o,viewport:s,action:e}=this,t=e.dispatch.bind(e),l=e.on.bind(e);o.appendChild(s.wrapper),s.resizeObserver.observe(o),l("world-resized",()=>{var i,n,r,d,c,u;this.updateViewport(),this.initialized?t("world-updated"):(this.initialized=!0,t("world-zoom","fit"),t("module-updated"),(n=(i=this.events).onInitialized)==null||n.call(i),(d=(r=this.events).onHistoryUpdated)==null||d.call(r,this.history),(u=(c=this.events).onModulesUpdated)==null||u.call(c,this.moduleMap))}),l("world-updated",()=>{var i,n;this.updateWorldRect(),(n=(i=this.events).onViewportUpdated)==null||n.call(i,{width:this.viewport.viewportRect.width,height:this.viewport.viewportRect.height,scale:this.viewport.scale,offsetX:this.viewport.offset.x,offsetY:this.viewport.offset.y,status:this.manipulationStatus}),t("visible-module-updated")}),l("world-zoom",i=>{if(i==="fit"){const{frame:n,viewportRect:r}=this.viewport,d=n.getBoundingRect(),{scale:c,offsetX:u,offsetY:h}=Al(d,r,.02);this.viewport.scale=c,this.viewport.offset.x=u,this.viewport.offset.y=h,t("world-updated")}else{const{scale:n,dpr:r}=this.viewport;let d=null,c=1;const u=.01*r,h=500*r;let p=i.physicalPoint;i.zoomTo?c=i.zoomFactor:i.zoomBy&&(c=n+i.zoomFactor),c=Math.max(u,Math.min(c,h)),d=this.zoom(c,p),this.viewport.scale=c,this.viewport.offset.x=d.x,this.viewport.offset.y=d.y,t("world-updated")}}),l("world-shift",i=>{const{x:n,y:r}=i,{dpr:d}=this.viewport;this.viewport.offset.x+=n*d,this.viewport.offset.y+=r*d,t("world-updated")}),l("visible-module-updated",()=>{this.updateVisibleModuleMap(),t("render-modules"),t("visible-selection-updated")}),l("visible-selection-updated",()=>{this.updateVisibleSelected(),t("render-selection")}),l("selection-all",()=>{this.selectAll(),t("selection-updated")}),l("selection-clear",()=>{this.selectedModules.clear(),t("selection-updated")}),l("selection-modify",i=>{const{mode:n,idSet:r}=i;this.modifySelected(r,n),t("selection-updated")}),l("module-updated",i=>{var n,r;t("visible-module-updated"),t("selection-updated"),i&&(this.history.add(i),(r=(n=this.events).onHistoryUpdated)==null||r.call(n,this.history))}),l("selection-updated",()=>{var i,n;this.hoveredModule=null,Cl.call(this),(n=(i=this.events).onSelectionUpdated)==null||n.call(i,this.selectedModules,this.getSelectedPropsIfUnique),t("visible-selection-updated")}),l("world-mouse-move",()=>{var n,r;const i=this.getWorldPointByViewportPoint(this.viewport.mouseMovePoint.x,this.viewport.mouseMovePoint.y);(r=(n=this.events).onWorldMouseMove)==null||r.call(n,i)}),l("module-delete",()=>{const i=this.getSelected,n=this.batchDelete(i);this.selectedModules.clear(),t("module-updated",{type:"history-delete",payload:{modules:n,selectedModules:i}})}),l("module-copy",()=>{var i,n;this.copiedItems=this.batchCopy(this.getSelected,!1),this.updateCopiedItemsDelta(),(n=(i=this.events).onModuleCopied)==null||n.call(i,this.copiedItems)}),l("module-paste",i=>{if(this.copiedItems.length===0)return;let n;if(i){const{x:d,y:c}=this.getWorldPointByViewportPoint(i.x,i.y),u=this.copiedItems.reduce((y,g)=>g.x<y.x&&g.y<y.y?g:y),h=d-u.x,p=c-u.y,f=this.copiedItems.map(y=>({...y,x:y.x+h,y:y.y+p}));n=this.batchCreate(f)}else n=this.batchCreate(this.copiedItems);const r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r),this.updateCopiedItemsDelta(),t("module-updated",{type:"history-paste",payload:{modules:[...n.values()].map(d=>d.getDetails()),selectedModules:r}})}),l("module-duplicate",()=>{if(this.selectedModules.size===0)return;const i=this.batchCopy(this.selectedModules,!1);i.forEach(c=>{c.x+=this.CopyDeltaX,c.y+=this.CopyDeltaY});const n=this.batchCreate(i),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const d=[...n.values()].map(c=>c.getDetails());t("module-updated",{type:"history-duplicate",payload:{modules:d,selectedModules:r}})}),l("module-layer",i=>{}),l("module-move",({delta:i={x:0,y:0}})=>{const n=this.getSelected;if(n.size===0)return;const r=[];n.forEach(d=>{const c=this.moduleMap.get(d);c&&r.push({id:d,props:{x:c.x+i.x,y:c.y+i.y}})}),t("module-modify",r)}),l("module-add",i=>{const n=this.batchAdd(this.batchCreate(i)),r=new Set(n.keys());this.batchAdd(n),this.replaceSelected(r);const d=[...n.values()].map(c=>c.getDetails());t("module-updated",{type:"history-add",payload:{modules:d,selectedModules:r}})}),l("module-modifying",({type:i,data:n})=>{const r=this.getSelected;r.size!==0&&(i==="move"?this.batchMove(r,n):(i==="resize"||i==="rotate")&&this.batchModify(r,n),t("module-updated"))}),l("module-modify",i=>{var r,d,c,u;const n=[];i.map(({id:h,props:p})=>{const f={},y={id:h,props:f},g=this.moduleMap.get(h);g&&(Object.keys(p).map(m=>{const C=g[m],S=p[m];return f[m]={from:C,to:S}}),this.batchModify(new Set([h]),p),n.push(y))}),this.history.add({type:"history-modify",payload:{selectedModules:this.getSelected,changes:n}}),(d=(r=this.events).onHistoryUpdated)==null||d.call(r,this.history),(u=(c=this.events).onModulesUpdated)==null||u.call(c,this.moduleMap),t("module-updated")}),l("render-modules",()=>{ye(this.viewport.mainCTX,this.viewport.scale,this.viewport.offset),this.renderModules()}),l("render-selection",()=>{ye(this.viewport.selectionCTX,this.viewport.scale,this.viewport.offset),this.renderSelections()}),l("module-hover-enter",i=>{this.hoveredModule&&i&&this.hoveredModule===i||(this.hoveredModule=i,t("visible-selection-updated"))}),l("module-hover-leave",()=>{this.hoveredModule=null,t("visible-selection-updated")}),l("history-undo",()=>{var i,n;je.call(this),t("module-updated"),(n=(i=this.events).onHistoryUpdated)==null||n.call(i,this.history)}),l("history-redo",()=>{var i,n;Ne.call(this),t("module-updated"),(n=(i=this.events).onHistoryUpdated)==null||n.call(i,this.history)}),l("history-pick",i=>{var n,r;Il.call(this,i),t("module-updated"),(r=(n=this.events).onHistoryUpdated)==null||r.call(n,this.history)}),l("context-menu",({position:i})=>{var n,r;(r=(n=this.events).onContextMenu)==null||r.call(n,i)})}class Bl{constructor({container:s,data:e,events:t={},config:l}){x(this,"id");x(this,"config");x(this,"moduleCounter",0);x(this,"moduleMap");x(this,"visibleModuleMap");x(this,"action");x(this,"container");x(this,"events",{});x(this,"history");x(this,"viewport");x(this,"selectedModules",new Set);x(this,"visibleSelected",new Set);x(this,"operationHandlers",[]);x(this,"copiedItems",[]);x(this,"hoveredModule",null);x(this,"draggingModules",new Set);x(this,"_selectingModules",new Set);x(this,"_deselection",null);x(this,"_resizingOperator",null);x(this,"_rotatingOperator",null);x(this,"selectedShadow",new Set);x(this,"manipulationStatus","static");x(this,"CopyDeltaX",50);x(this,"CopyDeltaY",100);x(this,"initialized",!1);this.visibleModuleMap=new Map,this.id=e.id||be(),this.config=l,this.events=t,this.action=new rl,this.container=s,this.history=new nl(this),this.viewport=zl.call(this),this.moduleMap=new Map,this.moduleCounter=l.moduleIdCounter,this.batchCreate(e.modules).forEach(n=>{this.moduleMap.set(n.id,n)}),this.init()}init(){_l.call(this)}get createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(s){return yl.call(this,s)}batchAdd(s){return ml.call(this,s)}batchCopy(s,e=!0){return gl.call(this,s,e)}batchDelete(s){return bl.call(this,s)}batchMove(s,e){xl.call(this,s,e)}batchModify(s,e){wl.call(this,s,e)}getModulesByIdSet(s){const e=new Map;return s.forEach(t=>{const l=this.moduleMap.get(t);l&&e.set(t,l)}),e}getModuleList(){return[...Object.values(this.moduleMap)]}updateVisibleModuleMap(){this.visibleModuleMap.clear(),[...this.moduleMap.values()].filter(e=>{const t=e.getBoundingRect();return al(t,this.viewport.worldRect)}).sort((e,t)=>e.layer-t.layer).forEach(e=>{this.visibleModuleMap.set(e.id,e)})}updateVisibleSelected(){this.visibleSelected.clear(),this.operationHandlers.length=0,this.getVisibleModuleMap.forEach(e=>{this.selectedModules.has(e.id)&&this.visibleSelected.add(e.id)});const s=this.getSelectedPropsIfUnique;if(s){const e=this.moduleMap.get(s.id),{scale:t,dpr:l}=this.viewport,i=1/t*l,n=10/t*l,r=15/t*l,c=e.getOperators({size:n,lineColor:"#5491f8",lineWidth:i,fillColor:"#fff"},{size:r,lineColor:"transparent",lineWidth:0,fillColor:"transparent"});this.operationHandlers.push(...c)}}get getVisibleModuleMap(){return new Map(this.visibleModuleMap)}get getVisibleSelected(){return new Set(this.visibleSelected)}get getVisibleSelectedModuleMap(){return this.getModulesByIdSet(this.getVisibleSelected)}get getSelected(){return new Set(this.selectedModules)}get getMaxLayerIndex(){let s=0;return this.moduleMap.forEach(e=>{e.layer>s&&(s=e.layer)}),s}modifySelected(s,e){G.call(this,s,e)}addSelected(s){G.call(this,s,"add")}deleteSelected(s){G.call(this,s,"delete")}toggleSelected(s){G.call(this,s,"toggle")}replaceSelected(s){G.call(this,s,"replace")}selectAll(){this.selectedModules.clear(),this.moduleMap.forEach(s=>{this.selectedModules.add(s.id)})}updateCopiedItemsDelta(){this.copiedItems.forEach(s=>{s.x+=this.CopyDeltaX,s.y+=this.CopyDeltaY})}get getSelectedPropsIfUnique(){if(this.selectedModules.size===1){const s=[...this.selectedModules.values()][0],e=this.moduleMap.get(s);return e?e.getDetails():null}return null}execute(s,e=null){this.action.execute(s,e)}renderModules(){requestAnimationFrame(()=>{const{frame:e,mainCTX:t}=this.viewport;e.render(t),this.visibleModuleMap.forEach(l=>{l.render(t)})})}printOut(s){this.moduleMap.forEach(e=>{e.render(s)})}exportToFiles(){const{dpr:s,scale:e,offset:t,frame:l}=this.viewport,i={id:this.id,config:{moduleIdCounter:this.moduleCounter,dpr:s,scale:e,offset:t,frame:l.getDetails()},data:[]};return this.moduleMap.forEach(n=>{i.data.push(n.getDetails())}),i}renderSelections(){requestAnimationFrame(()=>{Nl.call(this)})}updateWorldRect(){const{dpr:s}=this.viewport,{width:e,height:t}=this.viewport.viewportRect,l=this.getWorldPointByViewportPoint(0,0),i=this.getWorldPointByViewportPoint(e/s,t/s);this.viewport.worldRect=V(l,i)}zoom(s,e){const{rect:t}=this.viewport;return e=e||{x:t.width/2,y:t.height/2},Ol.call(this,e,s)}updateScrollBar(){const{scrollBarX:s,scrollBarY:e}=this.viewport;Sl(s,e)}updateViewport(){const{dpr:s,mainCanvas:e,selectionCanvas:t}=this.viewport,l=this.container.getBoundingClientRect().toJSON(),{x:i,y:n,width:r,height:d}=l,c=r*s,u=d*s;this.viewport.rect={...l,cx:i+r/2,cy:n+d/2},this.viewport.viewportRect=V({x:0,y:0},{x:c,y:u}),e.width=t.width=c,e.height=t.height=u}getWorldPointByViewportPoint(s,e){const{dpr:t,offset:l,scale:i}=this.viewport;return hl({x:s,y:e},l,i,t)}getViewPointByWorldPoint(s,e){const{dpr:t,offset:l,scale:i}=this.viewport;return ul({x:s,y:e},l,i,t)}destroy(){Rl.call(this),this.action.destroy(),this.history.destroy(),this.moduleMap.clear()}}const Ee={id:"",focused:!1,selectedProps:null,selectedModules:[],viewport:null,lastSavedHistoryId:-1,needSave:!1,worldPoint:{x:0,y:0},copiedItems:[],historyArray:[],historyStatus:{id:0,hasPrev:!1,hasNext:!1}},Vl=(o,s)=>{switch(s.type){case"SET_ID":return{...o,id:s.payload};case"SET_HISTORY_STATUS":return{...o,historyStatus:{...o.historyStatus,...s.payload}};case"SET_FOCUSED":return{...o,focused:s.payload};case"SET_HISTORY_ARRAY":return{...o,historyArray:s.payload};case"SET_NEED_SAVE":return{...o,needSave:s.payload};case"SET_SELECTED_MODULES":return{...o,selectedModules:s.payload};case"SET_SELECTED_PROPS":return{...o,selectedProps:s.payload};case"SET_LAST_SAVED_HISTORY_ID":return{...o,lastSavedHistoryId:s.payload};case"SET_COPIED_ITEMS":return{...o,copiedItems:s.payload};case"SET_VIEWPORT":return{...o,viewport:s.payload};case"SET_WORLD_POINT":return{...o,worldPoint:s.payload};default:return o}},I=b.createContext({state:Ee,editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{}}),Wl=()=>{const{state:{focused:o},executeAction:s}=b.useContext(I),e=t=>{if(!o)return;let l=null;const{key:i,ctrlKey:n,metaKey:r,shiftKey:d}=t,u={ArrowUp:"module-move-up",ArrowDown:"module-move-down",ArrowLeft:"module-move-left",ArrowRight:"module-move-right"}[i],h={x:0,y:0},p=5,f={zoomBy:!0,zoomFactor:.1};if(i==="="&&r&&(l="world-zoom"),i==="-"&&r&&(l="world-zoom",f.zoomFactor=-.1),i.toLowerCase()==="w"&&(n||r))return l="closeFile",window.confirm("000"),alert(9),t.preventDefault(),t.stopPropagation(),!1;if(i==="s"&&(n||r)&&(l="saveFile"),i==="a"&&(n||r)&&(l="selection-all"),i==="c"&&(n||r)&&!d&&(l="module-copy"),i==="v"&&(n||r)&&(l="module-paste"),i==="d"&&(n||r)&&(l="module-duplicate"),(i==="Delete"||i==="Backspace")&&(l="module-delete"),i==="Escape"&&(l="selection-clear"),i==="z"&&(n||r)&&(l="history-undo"),i==="z"&&d&&(n||r)&&(l="history-redo"),u)switch(l="module-move",u){case"module-move-down":h.y=p;break;case"module-move-up":h.y=-5;break;case"module-move-left":h.x=-5;break;case"module-move-right":h.x=p;break}l&&(u?s(l,{delta:h}):l==="world-zoom"?s(l,f):s(l),t.stopPropagation(),t.preventDefault())};return b.useEffect(()=>(window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}),[o]),null},Yl=[{className:"w-20 h-10",props:{type:"rectangle",x:200,y:200,width:100,height:50}},{className:"w-10 h-10 rounded-3xl",props:{type:"ellipse",x:200,y:200,r1:100,r2:100}}],Hl=()=>{const{executeAction:o}=b.useContext(I);return b.useEffect(()=>{},[]),a.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:Yl.map((s,e)=>a.jsx("div",{className:"shrink-0 select-none cursor-pointer",onClick:()=>{const t=s.props;t.x=U(1e3),t.y=U(2e3),t.lineWidth=1,t.lineColor=me(),t.fillColor=me(),t.type==="rectangle"&&(t.width=U(200),t.height=U(200)),t.type==="ellipse"&&(t.r1=U(200),t.r1=U(200)),o("module-add",[t])},children:a.jsx("div",{style:{border:"1px solid #dfdfdf"},className:s.className})},e))})},me=()=>`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`,U=o=>Math.floor(Math.random()*o),Xl=({className:o=""})=>{const[s,e]=b.useState(300),t=b.useRef(!1),l=b.useRef(null),i=b.useCallback(d=>{d.preventDefault(),t.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),n=b.useCallback(d=>{if(!t.current)return;const c=window.innerWidth*.9,u=Math.min(Math.max(0,d.clientX),c);d.stopPropagation(),e(u)},[]),r=b.useCallback(d=>{t.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",d.stopPropagation()},[]);return b.useEffect(()=>(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}),[n,r]),a.jsxs("div",{ref:l,style:{width:`${s}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[a.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${o}`,children:[a.jsx("span",{children:"Module List"}),a.jsx(Hl,{})]}),a.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:i})]})},ge=o=>(o*100).toFixed(2)+"%",Ul=o=>{const s=o.replace("%","").trim(),e=Number(s);return isNaN(e)?!1:Number(e.toFixed(2))},Kl=({scale:o,onChange:s})=>{const e=[{label:"400%",value:4},{label:"300%",value:3},{label:"200%",value:2},{label:"150%",value:1.5},{label:"125%",value:1.25},{label:"100%",value:1},{label:"75%",value:.75},{label:"50%",value:.5},{label:"25%",value:.25},{label:"Fit window",value:"fit"}],[t,l]=b.useState(ge(1)),[i,n]=b.useState(!1),r=b.useRef(null);b.useEffect(()=>{const c=ge(o);r.current&&(r.current.value=c),l(c)},[o]);const d=c=>{if(c.key==="Enter"){const u=Ul(c.target.value);u!==!1&&s(u),r.current.blur()}c.stopPropagation()};return a.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[a.jsx("input",{type:"text",ref:r,onChange:void 0,defaultValue:t,onKeyDown:d,className:"w-20 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),a.jsx("button",{onClick:()=>n(!i),className:"text-gray-800 flex trasition items-center cursor-pointer",children:i?a.jsx(Le,{className:"w-5 h-5"}):a.jsx(ze,{className:"w-5 h-5"})}),i&&a.jsx("div",{className:"fixed w-full h-full",onClick:()=>{n(!1)}}),i&&a.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:e.map(({label:c,value:u})=>a.jsx("div",{onClick:()=>{n(!1),s(u)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:u==="fit"?c:`${u*100}%`},u))})]})},Gl=({ref:o})=>{const{state:{viewport:s},executeAction:e}=b.useContext(I),[t,l]=b.useState({x:0,y:0});return b.useImperativeHandle(o,()=>({set(i){l(i)}}),[]),s?a.jsx("footer",{className:"w-full h-8 flex justify-between pr-1 items-center border-t border-gray-200",children:s&&a.jsxs(a.Fragment,{children:[a.jsx(Kl,{scale:s.scale,onChange:i=>{i==="fit"?e("world-zoom","fit"):e("world-zoom",{zoomTo:!0,zoomFactor:i})}},s.scale),a.jsx("div",{className:"text-xs line-clamp-1",children:`dx:${t.x.toFixed(2)} dy:${t.y.toFixed(2)}`})]})}):null},ie=28,Zl=({data:o})=>{const s=b.useRef(null),e=b.useRef(null),[t,l]=b.useState(0),[i,n]=b.useState([0,10]),{state:{selectedModules:r},executeAction:d}=b.useContext(I);b.useEffect(()=>{},[]);const c=()=>{if(!s.current)return;const h=s.current.scrollTop,p=h<t,f=Math.round(h/ie),y=f+10;if(p){if(i[0]>=o.length-1)return}else if(i[1]>=o.length-1)return;l(h),n([f,y])},u=[];for(let h=i[0];h<i[1];h++){const p=o[h];p&&u.push(a.jsx("div",{ref:r!=null&&r.includes(p.id)?e:null,style:{height:ie},className:r!=null&&r.includes(p.id)?"bg-gray-400 text-white":"",onClick:()=>{d("selection-modify",{mode:"replace",idSet:new Set([p.id])})},id:`layer-module-${p.id}`,children:p.type},p.id))}return a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Layer"})}),a.jsx("div",{className:"p-2 relative overflow-hidden",children:a.jsxs("div",{ref:s,onScroll:c,className:"relative scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:[a.jsx("div",{className:"absolute z-10 w-full top-0 left-0",style:{height:o.length*ie}}),a.jsx("div",{className:"z-20 w-full sticky top-0 left-0",children:u})]})})]})},te={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},oe="#9b9a9a",ql=({size:o=24,...s})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:o,stroke:"currentColor",viewBox:"0 0 24 24",fill:"none",...te,...s,children:[a.jsx("path",{fill:oe,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),a.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),a.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),Jl=({size:o=24,...s})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",...te,...s,children:[a.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),a.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),a.jsx("path",{fill:oe,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),Ql=({size:o=24,...s})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",...te,...s,children:[a.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:oe,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),en=({size:o=24,...s})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",...te,...s,children:[a.jsx("path",{fill:oe,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),a.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),tn=({iconName:o,size:s})=>{switch(o){case"save":return a.jsx(Ye,{size:s});case"undo":return a.jsx(We,{size:s});case"redo":return a.jsx(Ve,{size:s});case"trash":return a.jsx(Be,{size:s});case"cross":return a.jsx(_e,{size:s});case"group":return a.jsx(Oe,{size:s});case"ungroup":return a.jsx(Ae,{size:s});case"lock":return a.jsx(Ie,{size:s});case"unlock":return a.jsx(Re,{size:s});default:return null}},Z=20,on=()=>{const{state:{needSave:o,historyStatus:s,selectedModules:e},executeAction:t}=b.useContext(I),l=e.length>0,i=[{id:"save",action:"saveFile",icon:"save",disabled:!o,divide:!0},{id:"undo",editorActionCode:"history-undo",icon:"undo",disabled:!s.hasPrev},{id:"redo",editorActionCode:"history-redo",icon:"redo",disabled:!s.hasNext,divide:!0},{id:"delete",editorActionCode:"module-delete",icon:"trash",disabled:!l,divide:!0},{id:"layerUp",editorActionCode:"module-layer",editorActionData:"up",icon:"layers",disabled:!l},{id:"layerDown",editorActionCode:"module-layer",editorActionData:"down",icon:"layers",disabled:!l},{id:"layerTop",editorActionCode:"module-layer",editorActionData:"top",icon:"layers",disabled:!l},{id:"layerBottom",editorActionCode:"module-layer",editorActionData:"bottom",icon:"layers",disabled:!l,divide:!0}];return a.jsx("div",{className:"border-b border-gray-200 box-border",children:a.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(i).map(n=>{const{id:r,icon:d,disabled:c,divide:u}=n;let h;switch(r){case"layerUp":h=a.jsx(ql,{size:Z});break;case"layerDown":h=a.jsx(Jl,{size:Z});break;case"layerTop":h=a.jsx(Ql,{size:Z});break;case"layerBottom":h=a.jsx(en,{size:Z});break;default:h=a.jsx(tn,{size:Z,iconName:d});break}const{tooltip:p}=He(r,{returnObjects:!0});return a.jsxs(b.Fragment,{children:[a.jsx("button",{type:"button",disabled:c,title:p,onClick:()=>{(n.editorActionCode||n.action)&&t(n.editorActionCode||n.action)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6   hover:bg-gray-200  hover:opacity-100  disabled:hover:bg-transparent disabled:text-gray-200 disabled:cursor-default",children:h}),u&&a.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},r)})})})},sn=()=>a.jsx("header",{children:a.jsx(on,{})}),ln=()=>{const{state:{historyArray:o,historyStatus:s},applyHistoryNode:e}=b.useContext(I),{t}=ce(),l=b.useRef(null);return b.useEffect(()=>{if(l.current)return()=>{}},[o,s]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-600 text-white px-2",children:a.jsx("span",{children:"History"})}),a.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:a.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:o.map((i,n)=>{const r=i.id===s.id,d="history."+i.data.type,{label:c,tooltip:u}=t(d,{returnObjects:!0});return a.jsx("div",{title:u,ref:r?l:null,onClick:()=>{r||e(i)},className:` px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${r?"bg-gray-400 text-white":""}`,children:a.jsx("span",{children:c})},n)})})})]})},$=o=>a.jsx("input",{...o,onKeyDown:s=>{s.stopPropagation()},onPaste:s=>{s.stopPropagation()},onKeyUp:s=>{s.stopPropagation()}}),nn=({props:o})=>{const[s,e]=b.useState(o);return b.useEffect(()=>{e(o)},[o]),a.jsxs("div",{className:"p-2",children:[a.jsx("h1",{className:"bg-gray-400 text-white px-2",children:a.jsx("span",{children:"Properties"})}),a.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:s&&a.jsx(rn,{props:s})})]})},rn=({props:o})=>{const{executeAction:s}=b.useContext(I),e=t=>{const l=t.target.name;let i=t.target.value;["x","y","width","height"].includes(l)&&(i=Number(i)),s("module-modify",[{id:o.id,props:{[l]:i}}]),t.preventDefault(),t.stopPropagation()};return a.jsxs("div",{className:"z-30 text-sm",children:[a.jsxs("div",{className:"mb-1 ",children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"X:"}),a.jsx($,{type:"number",name:"x",value:o.x,onChange:e,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Y:"}),a.jsx($,{type:"number",name:"y",value:o.y,onChange:e,className:"w-16  py-1 text-black rounded"})]}),o.type==="ellipse"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"r1:"}),a.jsx($,{type:"number",name:"r1",value:o.r1,onChange:e,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"r2:"}),a.jsx($,{type:"number",name:"r2",value:o.r2,onChange:e,className:"w-16  py-1 text-black rounded"})]})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Width:"}),a.jsx($,{type:"number",name:"width",value:o.width,onChange:e,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Height:"}),a.jsx($,{type:"number",name:"height",value:o.height,onChange:e,className:"w-16  py-1 text-black rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Rotation:"}),a.jsx($,{type:"number",name:"rotation",value:o.rotation,onChange:e,className:"w-16  py-1 text-black rounded"})]})]}),a.jsxs("div",{className:"mb-1",children:[a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Fill"}),a.jsx($,{type:"checkbox",name:"enableFill",value:o.enableFill,onChange:e,className:"ml-2"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Fill Color:"}),a.jsx($,{type:"color",name:"fillColor",value:o.fillColor,onInput:t=>{},onChange:e,className:"w-10 h-10 p-1 rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Enable Line"}),a.jsx($,{type:"checkbox",name:"enableLine",defaultChecked:o.enableLine,onChange:e,className:"ml-2"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Line Color:"}),a.jsx($,{type:"color",name:"lineColor",value:o.lineColor,onChange:e,className:"w-10 h-10 p-1 rounded"})]}),a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{className:"",children:"Line Width:"}),a.jsx($,{type:"number",name:"lineWidth",value:o.lineWidth,onChange:e,className:"w-16  py-1 text-black rounded"})]})]}),a.jsx("div",{className:"mb-1",children:a.jsxs("div",{className:" w-full h-full flex justify-between items-center",children:[a.jsx("span",{children:"Opacity:"}),a.jsx($,{type:"number",name:"opacity",value:o.opacity,onChange:e,className:"w-16  py-1 text-black rounded"})]})})]})},an=({position:o,onClose:s})=>{const{t:e}=ce(),{state:{selectedModules:t,copiedItems:l,historyStatus:i},executeAction:n}=b.useContext(I),[r,d]=b.useState([]),c="absolute bg-white shadow-lg rounded-md border border-gray-200 py-1 z-50";b.useEffect(()=>{const p=t.length===0,f=[{id:"copy",editorActionCode:"module-copy",disabled:p},{id:"paste",editorActionCode:"module-paste",disabled:l.length===0},{id:"duplicate",editorActionCode:"module-duplicate",disabled:p},{id:"delete",editorActionCode:"module-delete",disabled:p,divide:!0},{id:"undo",editorActionCode:"history-undo",disabled:!i.hasPrev},{id:"redo",editorActionCode:"history-redo",disabled:!i.hasNext}];d(f);const y=()=>{s()};return window.addEventListener("click",y),()=>{window.removeEventListener("click",y)}},[t,o,l]);const u=p=>{const{editorActionCode:f}=p;f==="module-paste"?n("module-paste",o):n(f)},h=({item:p,onMouseUp:f})=>{const y=e(p.id,{returnObjects:!0}),g=p.children&&p.children.length>0;return a.jsxs("div",{className:"min-w-40 relative group",title:y.tooltip,children:[a.jsxs("button",{type:"button",disabled:p.disabled,onMouseUp:f,className:"flex justify-between px-4 text-nowrap items-center py-1.5 w-full text-left text-sm  hover:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-transparent disabled:cursor-not-allowed",children:[y.label,g&&a.jsx(Xe,{})]}),g&&a.jsx("div",{className:c+" z-60 group-hover:block hidden left-full top-0 border-l-0 rounded-none ",children:p.children.map((m,C)=>a.jsx(h,{item:m,onMouseUp:()=>u(m)},C))})]})};return a.jsx("div",{className:c,onClick:p=>{p.preventDefault(),p.stopPropagation()},style:{top:o.y,left:o.x},children:r.map((p,f)=>a.jsx(h,{item:p,onMouseUp:()=>{u(p),s()}},f))})},cn=({onClose:o,editorRef:s})=>{const e=b.useRef(null),[t,l]=b.useState(2);b.useEffect(()=>{i()},[s]);const i=()=>{if(!s||!s.current||!e)return;const{frame:n}=s.current.viewport,r=n.getBoundingRect(),d=e.current,c=d.getContext("2d");d.width=r.width*t,d.height=r.height*t,c.setTransform(t,0,0,t,0,0),s.current.printOut(c);const u=h=>{o(),h.preventDefault(),h.stopPropagation(),window.removeEventListener("keydown",u,{capture:!0})};return window.addEventListener("keydown",u,{capture:!0}),()=>{window.removeEventListener("keydown",u,{capture:!0})}};return a.jsxs("div",{className:"fixed top-0 left-0 w-full h-full z-100 flex items-center justify-center",children:[a.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-400 opacity-70",onClick:o}),a.jsxs("div",{className:"flex w-[90%] h-[90%] bg-white rounded z-10 px-2 py-4",children:[a.jsx("div",{className:"w-[50%] flex items-center justify-center overflow-hidden",children:a.jsx("canvas",{ref:e,className:"max-w-full max-h-full border"})}),a.jsxs("div",{className:"w-[50%] flex flex-col justify-between",children:[a.jsx("div",{}),a.jsx("div",{className:"w-full flex items-end",children:a.jsx("button",{type:"button",className:"border cursor-pointer",onClick:()=>{const n=window.open("","","width=600,height=600"),r=document.createElement("canvas"),d=r.getContext("2d");r.style.size="a4",r.width=e.current.width,r.height=e.current.height,d.drawImage(e.current,0,0),n.document.body.append(r),n.document.close(),n.focus(),n.print(),n.close()},children:"Print"})})]})]})]})},dn=({file:o})=>{const[s,e]=b.useReducer(Vl,Ee),t=b.useRef(null),l=b.useRef(null),i=b.useRef(null),[n,r]=b.useState([]),[d,c]=b.useState(!1),[u,h]=b.useState({x:0,y:0}),[p,f]=b.useState(!1),y=b.useRef(null),{currentFileId:g,startCreateFile:m,closeFile:C,saveFileToLocal:S}=b.useContext(Q),P=b.useRef(0),w=b.useRef(0),M=b.useRef(!1),N=v=>{if(e({type:"SET_HISTORY_ARRAY",payload:v.toArray()}),v.current){const E={id:v.current.id,hasPrev:!!v.current.prev,hasNext:!!v.current.next},k=E.id!==P.current;w.current=E.id,e({type:"SET_HISTORY_STATUS",payload:E}),e({type:"SET_NEED_SAVE",payload:k}),M.current=k}},j=v=>{const E=Array.from(v.values()).sort((k,K)=>k.layer-K.layer);r(E)},D=(v,E)=>{e({type:"SET_SELECTED_MODULES",payload:Array.from(v)}),e({type:"SET_SELECTED_PROPS",payload:E})},L=v=>{e({type:"SET_VIEWPORT",payload:v})},F=v=>{i.current&&i.current.set(v)},T=v=>{c(!0),h(v)},z=v=>{e({type:"SET_COPIED_ITEMS",payload:v})},R=v=>{var E;y.current&&e({type:"SET_FOCUSED",payload:(E=y.current)==null?void 0:E.contains(v.target)})},O=()=>{e({type:"SET_FOCUSED",payload:!0})},_=()=>{e({type:"SET_FOCUSED",payload:!1})},Y=v=>{t.current&&t.current.execute("history-pick",v)},H=(v,E)=>{if(v==="print"){f(!0);return}if(v==="newFile"){m();return}if(v==="closeFile"){C(o.id);return}if(v==="saveFile"&&M.current){const k=t.current.exportToFiles();k.name=o.name,S(k),P.current=w.current,e({type:"SET_NEED_SAVE",payload:!1})}t.current.execute(v,E)};return b.useEffect(()=>{let v;l.current&&!t.current&&(v=new Bl({container:l.current,data:{id:o.id,modules:o.data},config:o.config,events:{onHistoryUpdated:N,onModulesUpdated:j,onSelectionUpdated:D,onViewportUpdated:L,onWorldMouseMove:F,onContextMenu:T,onModuleCopied:z}}),t.current=v,e({type:"SET_ID",payload:o.id}));const E=y.current;return E&&(window.addEventListener("mouseup",R),E.addEventListener("focus",O),E.addEventListener("blur",_)),()=>{E&&(window.removeEventListener("mousedown",R),E.removeEventListener("focus",O),E.removeEventListener("blur",_)),v&&v.destroy()}},[]),a.jsx(I.Provider,{value:{state:s,editorRef:t,applyHistoryNode:Y,executeAction:H},children:a.jsxs("div",{ref:y,"data-focused":s.focused,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[g===o.id&&a.jsx(Wl,{}),a.jsx(sn,{}),a.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[a.jsx(Xl,{}),a.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden relative",children:[a.jsx("div",{ref:l,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),a.jsx(Gl,{ref:i}),d&&a.jsx(an,{position:u,onClose:()=>{c(!1)}})]}),a.jsxs("div",{style:{width:200},className:"h-full flex-shrink-0 border-l border-gray-200",children:[a.jsx(nn,{props:s.selectedProps}),a.jsx(Zl,{data:n}),a.jsx(ln,{})]})]}),p&&a.jsx(cn,{editorRef:t,onClose:()=>{f(!1)}})]})})},hn=()=>{const o=' group py-2 px-6 relative transition flex items-center">',s=" bg-gray-200",e=" hover:bg-gray-200",{fileList:t,currentFileId:l,closeFile:i,switchFile:n,handleCreating:r}=b.useContext(Q);return a.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[t.map(d=>{const c=d.id===l,u=o+(c?s:e),h=(c?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return a.jsxs("div",{className:u,onClick:()=>{n(d.id)},children:[a.jsx("span",{children:d.name}),a.jsx("span",{onClick:p=>{i(d.id),p.preventDefault(),p.stopPropagation()},className:h,children:"×"})]},d.id)}),a.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:a.jsx(Ue,{size:18,onClick:()=>{r(!0)}})})]})},un=({children:o,defaultValue:s})=>{const[e,t]=b.useState(!1);return a.jsxs("div",{className:"relative w-20",children:[a.jsxs("div",{className:"flex items-center",onClick:()=>{t(!e)},children:[a.jsx(Ke,{}),s]}),e&&a.jsx("div",{onClick:()=>{t(!1)},className:"absolute top-full right-0 w-full",children:o})]})},pn=()=>{const[o,s]=b.useState("en"),e={en:"English",cn:"中文",jp:"日本語"},{i18n:t}=ce();return a.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:a.jsx(un,{defaultValue:e[o],children:Object.keys(e).map((l,i)=>a.jsx("div",{onClick:()=>{t.changeLanguage(l),s(l)},children:e[l]},i))})})},fn=()=>{const o=b.useRef(new Map),[s,e]=b.useState(!1),[t,l]=b.useState(""),[i,n]=b.useState([]),r=o.current.size,d=r===0||s,c="VISION_FLOW_FILE_MAP";b.useEffect(()=>{P()},[]);const u=w=>{o.current.forEach(M=>{M.id===w&&(M.initialized=!0)}),h()},h=()=>{const w=Array.from(o.current.values());return n(w),t||w[0]&&p(w[0].id),w},p=w=>{l(w),setTimeout(()=>{},1e3)},f=w=>{const M=i.findIndex(j=>j.id===w);let N=i.length;if(M!==-1&&(g(w),o.current.delete(w),h(),i.splice(M,1),N--,t===w&&N>0)){let j=M+1;M===0&&(j=0),j>N&&(j=N-1),l(i[j].id)}},y=w=>{o.current.set(w.id,w),h(),p(w.id)},g=w=>{let M=localStorage.getItem(c),N=JSON.parse(M);const j=w;N&&N[j]&&delete N[j],localStorage.setItem(c,JSON.stringify(N)),localStorage.removeItem(j)},m=()=>{e(!0)},C=w=>{e(w)},S=w=>{let M=localStorage.getItem(c),N=JSON.parse(M);const j=w.id;N||(N={}),N[w.id]=j,localStorage.setItem(c,JSON.stringify(N)),localStorage.setItem(j,JSON.stringify(w))},P=()=>{let w=localStorage.getItem(c),M=JSON.parse(w);M&&Object.values(M).forEach(N=>{const j=localStorage.getItem(N),D=JSON.parse(j);o.current.set(D.id,D)}),h()};return a.jsx(Q.Provider,{value:{fileMap:o.current,fileList:i,creating:s,currentFileId:t,switchFile:p,setFileInitialized:u,closeFile:f,createFile:y,startCreateFile:m,saveFileToLocal:S,handleCreating:C},children:a.jsxs("div",{className:"w-full h-full flex flex-col select-none",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx(hn,{}),a.jsx(pn,{})]}),a.jsx("div",{className:"flex-1 overflow-hidden min-h-[600px] relative",children:i.map(w=>a.jsx("div",{"data-file-id":w.id,className:"flex top-0 bg-white left-0 absolute outline-0 w-full h-full flex-col",style:{zIndex:w.id===t?200:100},children:a.jsx(dn,{file:w})},w.id))}),d&&a.jsx(il,{bg:r?"#00000080":"#fff",onBgClick:()=>{r&&e(!1)}})]})})};function yn(){return a.jsx(fn,{})}Ge.createRoot(document.getElementById("root")).render(a.jsx(yn,{}));
