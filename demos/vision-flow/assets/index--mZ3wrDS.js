var we=Object.defineProperty;var ve=(e,t,o)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var b=(e,t,o)=>ve(e,typeof t!="symbol"?t+"":t,o);import{i as Me,a as Ce,r as f,j as n,L as Se,b as je,u as D,c as Ne,d as ee,e as Fe,f as ke,g as Ee,h as $e,k as Le,l as Te,m as Ae,n as De,o as Pe,t as Re,p as ze,q as Be,s as U,v as Ve,w as Ie,P as Oe}from"./vendor-D6UkCkPc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Ue={label:"File",tooltip:"Open the file menu"},_e={label:"New File",tooltip:"Create a new file",shortcut:"Ctrl+N"},He={label:"Open File",tooltip:"Open an existing file",shortcut:"Ctrl+O"},We={label:"Save File",tooltip:"Save the current file",shortcut:"Ctrl+S"},Xe={label:"Save As",tooltip:"Save the current file with a new name"},Ye={label:"Import File",tooltip:"Import a file into the project"},Ke={label:"Export",tooltip:"Export the current file"},Ge={label:"Export as PNG",tooltip:"Export the file as a PNG image"},Ze={label:"Export as PDF",tooltip:"Export the file as a PDF document"},qe={label:"Export as CSV",tooltip:"Export the file as a CSV file"},Je={label:"Print",tooltip:"Print the current file"},Qe={label:"Close File",tooltip:"Close the current file"},et={label:"Edit",tooltip:"Open the edit menu"},tt={label:"Undo",tooltip:"Undo the last action",shortcut:"Ctrl+Z"},ot={label:"Redo",tooltip:"Redo the last undone action",shortcut:"Ctrl+Y"},st={label:"Cut",tooltip:"Cut the selected content",shortcut:"Ctrl+X"},lt={label:"Copy",tooltip:"Copy the selected content",shortcut:"Ctrl+C"},it={label:"Paste",tooltip:"Paste the copied content",shortcut:"Ctrl+V"},nt={label:"Duplicate",tooltip:"Duplicate the selected content",shortcut:"Ctrl+D"},at={label:"Select All",tooltip:"Select all content",shortcut:"Ctrl+A"},rt={label:"Find & Replace",tooltip:"Find and replace text",shortcut:"Ctrl+F"},ct={label:"View",tooltip:"Open the view menu"},dt={label:"Zoom In",tooltip:"Zoom in on the document",shortcut:"Ctrl++"},ht={label:"Zoom Out",tooltip:"Zoom out of the document",shortcut:"Ctrl+-"},ut={label:"Fit to Screen",tooltip:"Fit the content to the screen"},pt={label:"Toggle Grid",tooltip:"Show or hide the grid"},ft={label:"Toggle Guides",tooltip:"Show or hide the guides"},bt={label:"Fullscreen Mode",tooltip:"Switch to fullscreen mode",shortcut:"F11"},yt={label:"Shape",tooltip:"Open the shape menu"},gt={label:"Add Node",tooltip:"Add a new node to the diagram"},mt={label:"Delete Node",tooltip:"Delete the selected node"},xt={label:"Move Node",tooltip:"Move the selected node"},wt={label:"Resize Node",tooltip:"Resize the selected node"},vt={label:"Rotate Node",tooltip:"Rotate the selected node"},Mt={label:"Change Node Color",tooltip:"Change the color of the selected node"},Ct={label:"Change Node Border",tooltip:"Change the border of the selected node"},St={label:"Change Node Text",tooltip:"Edit the text of the selected node"},jt={label:"Group Nodes",tooltip:"Group selected nodes together"},Nt={label:"Ungroup Nodes",tooltip:"Ungroup the selected nodes"},Ft={label:"Lock Node",tooltip:"Lock the selected node"},kt={label:"Unlock Node",tooltip:"Unlock the selected node"},Et={label:"Connection",tooltip:"Open the connection menu"},$t={label:"Add Edge",tooltip:"Add an edge between nodes"},Lt={label:"Delete Edge",tooltip:"Delete the selected edge"},Tt={label:"Change Edge Style",tooltip:"Change the style of the selected edge"},At={label:"Change Edge Color",tooltip:"Change the color of the selected edge"},Dt={label:"Change Edge Label",tooltip:"Change the label of the selected edge"},Pt={label:"Reverse Edge",tooltip:"Reverse the direction of the selected edge"},Rt={label:"Text",tooltip:"Open the text menu"},zt={label:"Add Text",tooltip:"Add text to the document"},Bt={label:"Edit Text",tooltip:"Edit the selected text"},Vt={label:"Change Font",tooltip:"Change the font of the selected text"},It={label:"Change Font Size",tooltip:"Change the font size of the selected text"},Ot={label:"Change Font Color",tooltip:"Change the font color of the selected text"},Ut={label:"Bold Text",tooltip:"Make the selected text bold",shortcut:"Ctrl+B"},_t={label:"Italic Text",tooltip:"Make the selected text italic",shortcut:"Ctrl+I"},Ht={label:"Underline Text",tooltip:"Underline the selected text",shortcut:"Ctrl+U"},Wt={label:"Align Text",tooltip:"Align the selected text"},Xt={label:"Layer",tooltip:"Open the layer menu"},Yt={label:"Send to Back",tooltip:"Send the selected layer to the back"},Kt={label:"Bring to Front",tooltip:"Bring the selected layer to the front"},Gt={label:"Send Backward",tooltip:"Send the selected layer one step backward"},Zt={label:"Bring Forward",tooltip:"Bring the selected layer one step forward"},qt={label:"Duplicate Layer",tooltip:"Duplicate the selected layer"},Jt={label:"Delete Layer",tooltip:"Delete the selected layer"},Qt={label:"Toggle Layer Visibility",tooltip:"Show or hide the selected layer"},eo={label:"Collaboration",tooltip:"Open the collaboration menu"},to={label:"Add Comment",tooltip:"Add a comment to the document"},oo={label:"Edit Comment",tooltip:"Edit the selected comment"},so={label:"Delete Comment",tooltip:"Delete the selected comment"},lo={label:"Share Document",tooltip:"Share the document with others"},io={file:Ue,newFile:_e,openFile:He,saveFile:We,saveAs:Xe,importFile:Ye,exportFile:Ke,exportFile_png:Ge,exportFile_pdf:Ze,exportFile_csv:qe,print:Je,closeFile:Qe,edit:et,undo:tt,redo:ot,cut:st,copy:lt,paste:it,delete:{label:"Delete",tooltip:"Delete the selected content",shortcut:"Del"},duplicate:nt,selectAll:at,findReplace:rt,view:ct,zoomIn:dt,zoomOut:ht,fitToScreen:ut,toggleGrid:pt,toggleGuides:ft,fullscreenMode:bt,shape:yt,addNode:gt,deleteNode:mt,moveNode:xt,resizeNode:wt,rotateNode:vt,changeNodeColor:Mt,changeNodeBorder:Ct,changeNodeText:St,groupNodes:jt,ungroupNodes:Nt,lockNode:Ft,unlockNode:kt,connection:Et,addEdge:$t,deleteEdge:Lt,changeEdgeStyle:Tt,changeEdgeColor:At,changeEdgeLabel:Dt,reverseEdge:Pt,text:Rt,addText:zt,editText:Bt,changeFont:Vt,changeFontSize:It,changeFontColor:Ot,boldText:Ut,italicText:_t,underlineText:Ht,alignText:Wt,layer:Xt,sendToBack:Yt,bringToFront:Kt,sendBackward:Gt,bringForward:Zt,duplicateLayer:qt,deleteLayer:Jt,toggleLayerVisibility:Qt,collaboration:eo,addComment:to,editComment:oo,deleteComment:so,shareDocument:lo},no={"history-init":{label:"Init",tooltip:"Initialize the file"},"history-add":{label:"Add",tooltip:"Add modules to the file"},"history-delete":{label:"Delete",tooltip:"Delete modules from the file"},"history-paste":{label:"Paste",tooltip:"Paste modules into the file"},"history-duplicate":{label:"Duplicate",tooltip:"Duplicate selected modules"},"history-modify":{label:"Modify",tooltip:"Modify the properties of modules"},"history-move":{label:"Move",tooltip:"Move modules"},"history-reorder":{label:"Reorder",tooltip:"Reorder modules"},"history-select":{label:"Select",tooltip:"Select modules"},"history-group":{label:"Group",tooltip:"Group modules"},"history-ungroup":{label:"Ungroup",tooltip:"Ungroup modules"},"history-composite":{label:"Composite",tooltip:"Composite operation"}},ao={history:no},ro={label:"文件",tooltip:"打开文件菜单"},co={label:"新建文件",tooltip:"创建新文件",shortcut:"Ctrl+N"},ho={label:"打开文件",tooltip:"打开现有文件",shortcut:"Ctrl+O"},uo={label:"保存文件",tooltip:"保存当前文件",shortcut:"Ctrl+S"},po={label:"另存为",tooltip:"以新名称保存当前文件"},fo={label:"导入文件",tooltip:"将文件导入到项目中"},bo={label:"导出",tooltip:"导出当前文件"},yo={label:"导出为PNG",tooltip:"将文件导出为PNG图像"},go={label:"导出为PDF",tooltip:"将文件导出为PDF文档"},mo={label:"导出为CSV",tooltip:"将文件导出为CSV文件"},xo={label:"打印",tooltip:"打印当前文件"},wo={label:"关闭文件",tooltip:"关闭当前文件"},vo={label:"编辑",tooltip:"打开编辑菜单"},Mo={label:"撤销",tooltip:"撤销上一步操作",shortcut:"Ctrl+Z"},Co={label:"重做",tooltip:"重做上一次撤销的操作",shortcut:"Ctrl+Y"},So={label:"剪切",tooltip:"剪切选定的内容",shortcut:"Ctrl+X"},jo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+C"},No={label:"粘贴",tooltip:"粘贴复制的内容",shortcut:"Ctrl+V"},Fo={label:"复制",tooltip:"复制选定的内容",shortcut:"Ctrl+D"},ko={label:"全选",tooltip:"选择所有内容",shortcut:"Ctrl+A"},Eo={label:"查找和替换",tooltip:"查找和替换文本",shortcut:"Ctrl+F"},$o={label:"视图",tooltip:"打开视图菜单"},Lo={label:"放大",tooltip:"放大文档",shortcut:"Ctrl++"},To={label:"缩小",tooltip:"缩小文档",shortcut:"Ctrl+-"},Ao={label:"适应屏幕",tooltip:"使内容适应屏幕"},Do={label:"切换网格",tooltip:"显示或隐藏网格"},Po={label:"切换参考线",tooltip:"显示或隐藏参考线"},Ro={label:"全屏模式",tooltip:"切换到全屏模式",shortcut:"F11"},zo={label:"形状",tooltip:"打开形状菜单"},Bo={label:"添加节点",tooltip:"向图表添加新节点"},Vo={label:"删除节点",tooltip:"删除选定的节点"},Io={label:"移动节点",tooltip:"移动选定的节点"},Oo={label:"调整节点大小",tooltip:"调整选定节点的大小"},Uo={label:"旋转节点",tooltip:"旋转选定的节点"},_o={label:"更改节点颜色",tooltip:"更改选定节点的颜色"},Ho={label:"更改节点边框",tooltip:"更改选定节点的边框"},Wo={label:"更改节点文本",tooltip:"编辑选定节点的文本"},Xo={label:"组合节点",tooltip:"将选定的节点组合在一起"},Yo={label:"取消组合节点",tooltip:"取消组合选定的节点"},Ko={label:"锁定节点",tooltip:"锁定选定的节点"},Go={label:"解锁节点",tooltip:"解锁选定的节点"},Zo={label:"连接",tooltip:"打开连接菜单"},qo={label:"添加边",tooltip:"在节点之间添加边"},Jo={label:"删除边",tooltip:"删除选定的边"},Qo={label:"更改边样式",tooltip:"更改选定边的样式"},es={label:"更改边颜色",tooltip:"更改选定边的颜色"},ts={label:"更改边标签",tooltip:"更改选定边的标签"},os={label:"反转边",tooltip:"反转选定边的方向"},ss={label:"文本",tooltip:"打开文本菜单"},ls={label:"添加文本",tooltip:"向文档添加文本"},is={label:"编辑文本",tooltip:"编辑选定的文本"},ns={label:"更改字体",tooltip:"更改选定文本的字体"},as={label:"更改字体大小",tooltip:"更改选定文本的字体大小"},rs={label:"更改字体颜色",tooltip:"更改选定文本的字体颜色"},cs={label:"粗体文本",tooltip:"将选定的文本设置为粗体",shortcut:"Ctrl+B"},ds={label:"斜体文本",tooltip:"将选定的文本设置为斜体",shortcut:"Ctrl+I"},hs={label:"下划线文本",tooltip:"为选定的文本添加下划线",shortcut:"Ctrl+U"},us={label:"对齐文本",tooltip:"对齐选定的文本"},ps={label:"图层",tooltip:"打开图层菜单"},fs={label:"置于底层",tooltip:"将选定的图层置于底层"},bs={label:"置于顶层",tooltip:"将选定的图层置于顶层"},ys={label:"下移一层",tooltip:"将选定的图层下移一层"},gs={label:"上移一层",tooltip:"将选定的图层上移一层"},ms={label:"复制图层",tooltip:"复制选定的图层"},xs={label:"删除图层",tooltip:"删除选定的图层"},ws={label:"切换图层可见性",tooltip:"显示或隐藏选定的图层"},vs={label:"协作",tooltip:"打开协作菜单"},Ms={label:"添加评论",tooltip:"向文档添加评论"},Cs={label:"编辑评论",tooltip:"编辑选定的评论"},Ss={label:"删除评论",tooltip:"删除选定的评论"},js={label:"分享文档",tooltip:"与他人分享文档"},Ns={file:ro,newFile:co,openFile:ho,saveFile:uo,saveAs:po,importFile:fo,exportFile:bo,exportFile_png:yo,exportFile_pdf:go,exportFile_csv:mo,print:xo,closeFile:wo,edit:vo,undo:Mo,redo:Co,cut:So,copy:jo,paste:No,delete:{label:"删除",tooltip:"删除选定的内容",shortcut:"Del"},duplicate:Fo,selectAll:ko,findReplace:Eo,view:$o,zoomIn:Lo,zoomOut:To,fitToScreen:Ao,toggleGrid:Do,toggleGuides:Po,fullscreenMode:Ro,shape:zo,addNode:Bo,deleteNode:Vo,moveNode:Io,resizeNode:Oo,rotateNode:Uo,changeNodeColor:_o,changeNodeBorder:Ho,changeNodeText:Wo,groupNodes:Xo,ungroupNodes:Yo,lockNode:Ko,unlockNode:Go,connection:Zo,addEdge:qo,deleteEdge:Jo,changeEdgeStyle:Qo,changeEdgeColor:es,changeEdgeLabel:ts,reverseEdge:os,text:ss,addText:ls,editText:is,changeFont:ns,changeFontSize:as,changeFontColor:rs,boldText:cs,italicText:ds,underlineText:hs,alignText:us,layer:ps,sendToBack:fs,bringToFront:bs,sendBackward:ys,bringForward:gs,duplicateLayer:ms,deleteLayer:xs,toggleLayerVisibility:ws,collaboration:vs,addComment:Ms,editComment:Cs,deleteComment:Ss,shareDocument:js},Fs={"history-init":{label:"初始化",tooltip:"初始化文件"},"history-add":{label:"添加",tooltip:"向文件添加模块"},"history-delete":{label:"删除",tooltip:"从文件中删除模块"},"history-paste":{label:"粘贴",tooltip:"将模块粘贴到文件中"},"history-duplicate":{label:"复制",tooltip:"复制选定的模块"},"history-modify":{label:"修改",tooltip:"修改模块的属性"},"history-move":{label:"移动",tooltip:"移动模块"},"history-reorder":{label:"重新排序",tooltip:"重新排序模块"},"history-select":{label:"选择",tooltip:"选择模块"},"history-group":{label:"组合",tooltip:"组合模块"},"history-ungroup":{label:"取消组合",tooltip:"取消模块组合"},"history-composite":{label:"复合操作",tooltip:"复合操作"}},ks={history:Fs},Es={label:"ファイル",tooltip:"ファイルメニューを開く"},$s={label:"新規ファイル",tooltip:"新規ファイルを作成",shortcut:"Ctrl+N"},Ls={label:"ファイルを開く",tooltip:"既存のファイルを開く",shortcut:"Ctrl+O"},Ts={label:"ファイルを保存",tooltip:"現在のファイルを保存",shortcut:"Ctrl+S"},As={label:"名前を付けて保存",tooltip:"現在のファイルに新しい名前を付けて保存"},Ds={label:"ファイルをインポート",tooltip:"プロジェクトにファイルをインポート"},Ps={label:"エクスポート",tooltip:"現在のファイルをエクスポート"},Rs={label:"PNGとしてエクスポート",tooltip:"ファイルをPNG画像としてエクスポート"},zs={label:"PDFとしてエクスポート",tooltip:"ファイルをPDFドキュメントとしてエクスポート"},Bs={label:"CSVとしてエクスポート",tooltip:"ファイルをCSVファイルとしてエクスポート"},Vs={label:"印刷",tooltip:"現在のファイルを印刷"},Is={label:"ファイルを閉じる",tooltip:"現在のファイルを閉じる"},Os={label:"編集",tooltip:"編集メニューを開く"},Us={label:"元に戻す",tooltip:"最後のアクションを元に戻す",shortcut:"Ctrl+Z"},_s={label:"やり直し",tooltip:"最後に元に戻したアクションをやり直す",shortcut:"Ctrl+Y"},Hs={label:"切り取り",tooltip:"選択したコンテンツを切り取り",shortcut:"Ctrl+X"},Ws={label:"コピー",tooltip:"選択したコンテンツをコピー",shortcut:"Ctrl+C"},Xs={label:"貼り付け",tooltip:"コピーしたコンテンツを貼り付け",shortcut:"Ctrl+V"},Ys={label:"複製",tooltip:"選択したコンテンツを複製",shortcut:"Ctrl+D"},Ks={label:"すべて選択",tooltip:"すべてのコンテンツを選択",shortcut:"Ctrl+A"},Gs={label:"検索と置換",tooltip:"テキストを検索して置換",shortcut:"Ctrl+F"},Zs={label:"表示",tooltip:"表示メニューを開く"},qs={label:"拡大",tooltip:"ドキュメントを拡大",shortcut:"Ctrl++"},Js={label:"縮小",tooltip:"ドキュメントを縮小",shortcut:"Ctrl+-"},Qs={label:"画面に合わせる",tooltip:"コンテンツを画面に合わせる"},el={label:"グリッドの切り替え",tooltip:"グリッドを表示または非表示"},tl={label:"ガイドの切り替え",tooltip:"ガイドを表示または非表示"},ol={label:"全画面モード",tooltip:"全画面モードに切り替え",shortcut:"F11"},sl={label:"図形",tooltip:"図形メニューを開く"},ll={label:"ノードを追加",tooltip:"ダイアグラムに新しいノードを追加"},il={label:"ノードを削除",tooltip:"選択したノードを削除"},nl={label:"ノードを移動",tooltip:"選択したノードを移動"},al={label:"ノードのサイズを変更",tooltip:"選択したノードのサイズを変更"},rl={label:"ノードを回転",tooltip:"選択したノードを回転"},cl={label:"ノードの色を変更",tooltip:"選択したノードの色を変更"},dl={label:"ノードの境界線を変更",tooltip:"選択したノードの境界線を変更"},hl={label:"ノードのテキストを変更",tooltip:"選択したノードのテキストを編集"},ul={label:"ノードをグループ化",tooltip:"選択したノードをグループ化"},pl={label:"ノードのグループ化を解除",tooltip:"選択したノードのグループ化を解除"},fl={label:"ノードをロック",tooltip:"選択したノードをロック"},bl={label:"ノードのロックを解除",tooltip:"選択したノードのロックを解除"},yl={label:"接続",tooltip:"接続メニューを開く"},gl={label:"エッジを追加",tooltip:"ノード間にエッジを追加"},ml={label:"エッジを削除",tooltip:"選択したエッジを削除"},xl={label:"エッジのスタイルを変更",tooltip:"選択したエッジのスタイルを変更"},wl={label:"エッジの色を変更",tooltip:"選択したエッジの色を変更"},vl={label:"エッジのラベルを変更",tooltip:"選択したエッジのラベルを変更"},Ml={label:"エッジの方向を反転",tooltip:"選択したエッジの方向を反転"},Cl={label:"テキスト",tooltip:"テキストメニューを開く"},Sl={label:"テキストを追加",tooltip:"ドキュメントにテキストを追加"},jl={label:"テキストを編集",tooltip:"選択したテキストを編集"},Nl={label:"フォントを変更",tooltip:"選択したテキストのフォントを変更"},Fl={label:"フォントサイズを変更",tooltip:"選択したテキストのフォントサイズを変更"},kl={label:"フォントの色を変更",tooltip:"選択したテキストのフォントの色を変更"},El={label:"テキストを太字にする",tooltip:"選択したテキストを太字にする",shortcut:"Ctrl+B"},$l={label:"テキストを斜体にする",tooltip:"選択したテキストを斜体にする",shortcut:"Ctrl+I"},Ll={label:"テキストに下線を引く",tooltip:"選択したテキストに下線を引く",shortcut:"Ctrl+U"},Tl={label:"テキストを配置",tooltip:"選択したテキストを配置"},Al={label:"レイヤー",tooltip:"レイヤーメニューを開く"},Dl={label:"最背面へ移動",tooltip:"選択したレイヤーを最背面へ移動"},Pl={label:"最前面へ移動",tooltip:"選択したレイヤーを最前面へ移動"},Rl={label:"背面へ移動",tooltip:"選択したレイヤーを1つ背面へ移動"},zl={label:"前面へ移動",tooltip:"選択したレイヤーを1つ前面へ移動"},Bl={label:"レイヤーを複製",tooltip:"選択したレイヤーを複製"},Vl={label:"レイヤーを削除",tooltip:"選択したレイヤーを削除"},Il={label:"レイヤーの表示/非表示を切り替え",tooltip:"選択したレイヤーの表示/非表示を切り替え"},Ol={label:"コラボレーション",tooltip:"コラボレーションメニューを開く"},Ul={label:"コメントを追加",tooltip:"ドキュメントにコメントを追加"},_l={label:"コメントを編集",tooltip:"選択したコメントを編集"},Hl={label:"コメントを削除",tooltip:"選択したコメントを削除"},Wl={label:"ドキュメントを共有",tooltip:"ドキュメントを他のユーザーと共有"},Xl={file:Es,newFile:$s,openFile:Ls,saveFile:Ts,saveAs:As,importFile:Ds,exportFile:Ps,exportFile_png:Rs,exportFile_pdf:zs,exportFile_csv:Bs,print:Vs,closeFile:Is,edit:Os,undo:Us,redo:_s,cut:Hs,copy:Ws,paste:Xs,delete:{label:"削除",tooltip:"選択したコンテンツを削除",shortcut:"Del"},duplicate:Ys,selectAll:Ks,findReplace:Gs,view:Zs,zoomIn:qs,zoomOut:Js,fitToScreen:Qs,toggleGrid:el,toggleGuides:tl,fullscreenMode:ol,shape:sl,addNode:ll,deleteNode:il,moveNode:nl,resizeNode:al,rotateNode:rl,changeNodeColor:cl,changeNodeBorder:dl,changeNodeText:hl,groupNodes:ul,ungroupNodes:pl,lockNode:fl,unlockNode:bl,connection:yl,addEdge:gl,deleteEdge:ml,changeEdgeStyle:xl,changeEdgeColor:wl,changeEdgeLabel:vl,reverseEdge:Ml,text:Cl,addText:Sl,editText:jl,changeFont:Nl,changeFontSize:Fl,changeFontColor:kl,boldText:El,italicText:$l,underlineText:Ll,alignText:Tl,layer:Al,sendToBack:Dl,bringToFront:Pl,sendBackward:Rl,bringForward:zl,duplicateLayer:Bl,deleteLayer:Vl,toggleLayerVisibility:Il,collaboration:Ol,addComment:Ul,editComment:_l,deleteComment:Hl,shareDocument:Wl},Yl={"history-init":{label:"初期化",tooltip:"ファイルを初期化する"},"history-add":{label:"追加",tooltip:"ファイルにモジュールを追加する"},"history-delete":{label:"削除",tooltip:"ファイルからモジュールを削除する"},"history-paste":{label:"貼り付け",tooltip:"ファイルにモジュールを貼り付ける"},"history-duplicate":{label:"複製",tooltip:"選択したモジュールを複製する"},"history-modify":{label:"修正",tooltip:"モジュールのプロパティを修正する"},"history-move":{label:"移動",tooltip:"モジュールを移動する"},"history-reorder":{label:"並べ替え",tooltip:"モジュールを並べ替える"},"history-select":{label:"選択",tooltip:"モジュールを選択する"},"history-group":{label:"グループ化",tooltip:"モジュールをグループ化する"},"history-ungroup":{label:"グループ化解除",tooltip:"モジュールのグループ化を解除する"},"history-composite":{label:"複合操作",tooltip:"複合操作"}},Kl={history:Yl},Gl={en:{translation:{...io,...ao}},cn:{translation:{...Ns,...ks}},jp:{translation:{...Xl,...Kl}}};Me.use(Ce).init({resources:Gl,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});const _=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),H=f.createContext({fileMap:new Map([["fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",{id:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",name:"Untitled 1",config:{},data:{}}]]),fileList:[],currentFileId:"fbbeddd8-0996-4ebb-8c1e-9d1ea5312ebb",creating:!1,switchFile:()=>{},closeFile:()=>{},createFile:()=>{},handleCreating:()=>{}}),Zl=({bg:e="#fff",onBgClick:t})=>{const o=f.useRef(null),{createFile:s,handleCreating:l}=f.useContext(H),[i,a]=f.useState(""),r=d=>/^[a-zA-Z0-9-_ ]+$/.test(d),c=d=>{var p;d.preventDefault(),d.stopPropagation();const h=(p=o.current)==null?void 0:p.filename.value.trim();if(!r(h)){a("File name can only including number space and alpha");return}a("");const u={id:_(),name:h,data:{},config:{}};s(u),l(!1)};return n.jsxs("div",{className:"fixed top-0 left-0 z-20 w-full h-full flex flex-row items-center justify-center text-sm select-none",children:[n.jsx("div",{style:{backgroundColor:e},onClick:()=>t&&t(),className:"absolute top-0 left-0 w-full h-full flex flex-row items-center justify-center text-sm select-none"}),n.jsxs("form",{ref:o,className:"relative w-100 min-h-30 z-20 p-4 bg-white rounded-xl shadow-2xl",onSubmit:c,children:[n.jsx("h1",{className:"text-xl text-center",children:"New File"}),n.jsx("label",{htmlFor:"filename",className:"block text-gray-700 font-medium mb-2",children:"File Name"}),n.jsx("input",{type:"text",autoFocus:!0,id:"filename",name:"filename",placeholder:"Enter file name",className:"w-full bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"}),i&&n.jsx("div",{className:"text-red-500 my-2",children:i}),n.jsx("label",{className:"justify-center",children:n.jsx("button",{type:"submit",className:"mt-2 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300",children:"Create File"})})]})]})};class G{constructor(t,o,s,l=-1){b(this,"data");b(this,"prev");b(this,"next");b(this,"id");this.data=s,this.prev=t,this.next=o,this.id=l}}class ql{constructor(){b(this,"head");b(this,"tail");b(this,"current");this.head=null,this.tail=null,this.current=null}detach(){return this.current&&(this.current.next=null,this.tail=this.current),this.current}append(t){let o;const{tail:s}=this;return s?(o=new G(s,null,t,s.id+1),s.next=o,this.tail=o):(o=new G(null,null,t,0),this.head=o,this.tail=o),this.current=o,o}back(){return this.current===this.head?!1:(this.current=this.current.prev,this.current)}forward(){return this.current===this.tail?!1:(this.current=this.current.next,this.current)}compareToCurrentPosition(t){if(t===this.current)return"equal";let o=this.head;for(;o;){if(this.current===o)return"behind";if(t===o)return"front";o=o.next}return!1}destroy(){this.head=null,this.tail=null,this.current=null}}class Jl extends ql{constructor(o){super();b(this,"editor");this.editor=o,this.init()}init(){var o,s;this.append({type:"history-init",payload:{state:null,selectedModules:"all"}}),(s=(o=this.editor.events).onHistoryUpdated)==null||s.call(o,this)}add(o){var s,l;this.detach(),this.append(o),(l=(s=this.editor.events).onHistoryUpdated)==null||l.call(s,this)}toArray(){const o=[];if(this.head){let s=this.head;for(o.push(s);s.next;)o.push(s.next),s=s.next}return o}compareToCurrentPosition(o){return super.compareToCurrentPosition(o)}forward(){return super.forward()}back(){return super.back()}}class Ql{constructor(){b(this,"eventsMap",new Map)}on(t,o){this.eventsMap.has(t)?this.eventsMap.get(t).push(o):this.eventsMap.set(t,[o])}off(t,o){if(this.eventsMap.has(t)){const s=this.eventsMap.get(t);for(let l=s.length-1;l>=0;l--)if(s[l]===o)return s.splice(l,1),"deleted";return"Cannot find event or function"}}dispatch({type:t,data:o}){console.info("action: ",t),this.eventsMap.has(t)&&this.eventsMap.get(t).forEach(s=>{s(o)})}execute({type:t,data:o}){this.dispatch({type:t,data:o})}destroy(){this.eventsMap.clear()}}const ei=({x:e,y:t,width:o,height:s},l)=>{const i=e+o/2,a=t+s/2,r=l*Math.PI/180,c=Math.cos(r),d=Math.sin(r),h=Math.abs(o*c)+Math.abs(s*d),u=Math.abs(o*d)+Math.abs(s*c),p=i-h/2,y=a-u/2;return W({x:p,y,width:h,height:u})},W=e=>{const{x:t,y:o,width:s,height:l}=e;return{x:t,y:o,width:s,height:l,top:o,bottom:o+l,left:t,right:t+s,cx:t+s/2,cy:o+l/2}},k=(e,t)=>{const o=Math.min(e.x,t.x),s=Math.max(e.x,t.x),l=Math.min(e.y,t.y),i=Math.max(e.y,t.y);return W({x:o,y:l,width:s-o,height:i-l})};function ti(e,t){return!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom)}function oi(e,t){return e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom}const si=({x:e,y:t},o,s)=>{const{x:l,y:i,width:a,height:r}=o;if(a<=0||r<=0)return!1;if(s===0){const w=a/2,v=r/2;return e>=l-w&&e<=l+w&&t>=i-v&&t<=i+v}const c=s*(Math.PI/180),d=Math.cos(c),h=Math.sin(c),u=e-l,p=t-i,y=u*d+p*h,m=-u*h+p*d,g=a/2,x=r/2;return y>=-g&&y<=g&&m>=-x&&m<=x},B=e=>e===0&&1/e===-1/0;function li(e,t){let o=0,s;return(...l)=>{const i=Date.now(),a=()=>{o=i,e(...l)};i-o>=t?a():(s!==void 0&&clearTimeout(s),s=setTimeout(a,t-(i-o)))}}function L(e){return e===null?"null":e===void 0?"undefined":e instanceof Set?"set":e instanceof Map?"map":Array.isArray(e)?"array":e instanceof Date?"date":e instanceof RegExp?"regexp":e instanceof Error?"error":e instanceof Promise?"promise":e instanceof ArrayBuffer?"arraybuffer":ArrayBuffer.isView(e)?"typedarray":e instanceof WeakSet?"weakset":e instanceof WeakMap?"weakmap":typeof e=="function"?"function":typeof e=="symbol"?"symbol":typeof e=="bigint"?"bigint":typeof e=="object"?"object":typeof e}function I(e,t={}){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(s=>I(s,t));const o=Object.create(t.clonePrototype?Object.getPrototypeOf(e):null);for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=I(e[s],t));return o}class te{constructor({id:t,type:o,lineColor:s,lineWidth:l=1,opacity:i=100,layer:a=1,rotation:r=0,shadow:c=!1,enableLine:d=!0}){b(this,"id");b(this,"type");b(this,"enableLine");b(this,"lineWidth");b(this,"lineColor");b(this,"opacity");b(this,"rotation");b(this,"shadow");b(this,"layer");this.id=t,this.type=o,this.enableLine=d,this.lineColor=s,this.lineWidth=l,this.opacity=i,this.rotation=r,this.shadow=c,this.layer=a}getDetails(){return{id:this.id,type:this.type,enableLine:this.enableLine,lineColor:this.lineColor,lineWidth:this.lineWidth,opacity:this.opacity,shadow:this.shadow,layer:this.layer,rotation:this.rotation}}getBoundingRect(){return{x:0,y:0,width:0,height:0,top:0,left:0,right:0,bottom:0,cx:0,cy:0}}}class ii extends te{constructor({x:o,y:s,fillColor:l,enableFill:i=!0,width:a,height:r,...c}){super(c);b(this,"x");b(this,"y");b(this,"width");b(this,"height");b(this,"fillColor");b(this,"enableFill");this.x=o,this.y=s,this.width=a,this.height=r,this.fillColor=l,this.enableFill=i}getDetails(){return{...this.getSize(),fillColor:this.fillColor,enableFill:this.enableFill,x:this.x,y:this.y,width:this.width,height:this.height,...super.getDetails()}}getSize(){return{width:0,height:0}}getBoundingRect(){const{x:o,y:s,width:l,height:i,rotation:a}=this,r=o-l/2,c=s-i/2;return a===0?{x:r,y:c,width:l,height:i,left:r,top:c,right:r+l,bottom:c+i,cx:o,cy:s}:ei({x:r,y:c,width:l,height:i},a)}move(o,s){this.x+=o,this.y+=s}}class ni extends ii{constructor({...t}){super(t)}getDetails(){return super.getDetails()}getBoundingRect(){return super.getBoundingRect()}}class ai extends te{constructor({start:o,end:s,...l}){super(l);b(this,"start");b(this,"end");this.start=o,this.end=s}getDetails(){return{...this.getSize(),...super.getDetails()}}getSize(){return{width:100,height:100}}getBoundingRect(){const{x:o,y:s}={x:0,y:1},{width:l,height:i}=this.getSize();return{x:o,y:s,width:l,height:i,top:s,left:o,right:o+l,bottom:s+i}}}function ri(e){const t=I(e),o=new Map,s=l=>{if(l.id||(l.id=this.createModuleId),l.type==="rectangle")return new ni(l);if(l.type==="connector")return new ai(l)};return t.forEach(l=>{const i=s.call(this,l);o.set(l.id,i)}),o}function ci(e){var t,o;e.forEach(s=>{this.moduleMap.set(s.id,s)}),(o=(t=this.events).onModulesUpdated)==null||o.call(t,this.moduleMap)}function di(e,t=!1,o){const s=[];let l=new Map;return e==="all"?l=this.moduleMap:L(e)==="set"&&e.forEach(i=>{const a=this.moduleMap.get(i);a&&l.set(i,a)}),l.forEach(i=>{const a=i.getDetails();t&&delete a.id,L(o)==="object"&&Object.assign(a,o),s.push(a)}),s}function hi(e){let t=[];return e==="all"?(t=this.batchCopy("all"),this.moduleMap.clear()):L(e)==="set"&&(t=this.batchCopy(e),t.forEach(o=>{this.moduleMap.delete(o.id)})),t}function ui(e,t){let o=null;if(e==="all")o=this.moduleMap;else if(L(e)==="set")o=this.getModulesByIdSet(e);else return!1;o.forEach(s=>{s.x+=t.x,s.y+=t.y})}function pi(e,t,o){var l,i,a,r;let s=null;if(e==="all")s=this.moduleMap;else if(L(e)==="set")s=this.getModulesByIdSet(e);else return!1;s.forEach(c=>{Object.keys(t).forEach(d=>{const h=t[d];(typeof h=="string"||typeof h=="number")&&(c[d]=h)})}),(i=(l=this.events).onModulesUpdated)==null||i.call(l,this.moduleMap),(r=(a=this.events).onSelectionUpdated)==null||r.call(a,this.selectedModules,this.getIfUnique())}const oe=(e,t,o,s,l)=>{const i=o/2,a=s/2,r=l*(Math.PI/180),c=Math.cos(r),d=Math.sin(r);return[{x:e-i,y:t-a},{x:e,y:t-a},{x:e+i,y:t-a},{x:e+i,y:t},{x:e+i,y:t+a},{x:e,y:t+a},{x:e-i,y:t+a},{x:e-i,y:t}].map(({x:u,y:p})=>{const y=u-e,m=p-t;return{x:e+y*c-m*d,y:t+y*d+m*c}})};function se(e,t,o,s,l){return{x:(s-t)/e,y:(l-o)/e}}const fi=({ctx:e,mousePoint:t,scale:o,dpr:s,offset:{x:l,y:i},virtualRect:{left:a,top:r,right:c,bottom:d}})=>{const h=10/(s*o),u=10/(s*o),{x:p,y}=se(o,l*s,i*s,t.x*s,t.y*s),m="#ff0000",g="#ff0000",x="#000";e.save(),e.textBaseline="alphabetic",e.font=`${24/o}px sans-serif`,e.fillStyle=g,e.shadowColor=m,e.shadowBlur=1,e.fillText(`${Math.floor(p)}, ${Math.floor(y)}`,p+h,y-u,200/o),e.lineWidth=2/(s*o),e.strokeStyle=m,e.shadowColor=x,e.shadowBlur=0,e.beginPath(),e.moveTo(a,y),e.lineTo(c,y),e.moveTo(p,r),e.lineTo(p,d),e.stroke(),e.restore()},bi=(e,t)=>{if(e.size!==t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0},yi=(e,t)=>{const o=new Set;for(const s of e)t.has(s)||o.add(s);for(const s of t)e.has(s)||o.add(s);return o};function T(e,t){if(L(e)!=="set"||e.size<=0)return;if(e.size===1){const s=[...e.values()][0];this.moduleMap.has(s)&&this.moduleMap.get(s).getDetails()}const o=this.getSelectedIdSet();this.selectedModules.clear(),t==="replace"&&o.clear(),e.forEach(s=>{switch(t){case"add":o.add(s);break;case"delete":o.delete(s);break;case"toggle":o.has(s)?o.delete(s):o.add(s);break;case"replace":o.add(s);break}}),this.isSelectAll=o.size===this.moduleMap.size,this.isSelectAll||o.forEach(s=>this.selectedModules.add(s))}function gi(){const e=this.getVisibleModuleMap();this.visibleSelectedModules.clear(),this.operationHandlers.clear(),e.forEach(t=>{if(t.type==="rectangle"){const{x:o,y:s,id:l,width:i,height:a,rotation:r}=t;oe(o,s,i,a,r).forEach(d=>{this.operationHandlers.add({id:l,type:"resize",data:{...d,r:this.viewport.scale}})})}this.isSelectAll?e.forEach(o=>{this.visibleSelectedModules.add(o.id)}):this.selectedModules.has(t.id)&&this.visibleSelectedModules.add(t.id)})}function mi(){const e="#1FB3FF",t="rgba(31,180,255,0.1)",o=document.createElement("div"),s=document.createElement("div"),l=document.createElement("canvas"),i=document.createElement("canvas"),{scrollBarX:a,scrollBarY:r}=xi();return i.setAttribute("editor-main-canvas",""),i.style.backgroundColor="#f0f0f0",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",l.setAttribute("editor-selection-canvas",""),l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.width="100%",l.style.height="100%",l.style.pointerEvents="none",o.setAttribute("editor-wrapper",""),o.style.userSelect="none",o.style.position="relative",o.style.scrollbarWidth="thin",o.style.scrollbarColor="#787878 transparent",o.style.overflow="hidden",o.style.width="100%",o.style.height="100%",s.setAttribute("editor-selection-box",""),s.style.pointerEvents="none",s.style.position="absolute",s.style.border="1px solid "+e,s.style.backgroundColor=t,o.append(i,l,a,r,s),{wrapper:o,selectionBox:s,selectionCanvas:l,mainCanvas:i,scrollBarX:a,scrollBarY:r}}const xi=()=>{const e=document.createElement("div"),t=document.createElement("div");return e.setAttribute("scroll-bar-x",""),t.setAttribute("scroll-bar-y",""),e.style.backgroundColor="#787878",t.style.backgroundColor="#787878",e.style.userSelect="none",t.style.userSelect="none",t.style.translate="none",t.style.translate="none",{scrollBarX:e,scrollBarY:t}},wi=(e,t)=>{e.style.width="50px",e.style.height="6px",e.style.position="absolute",e.style.bottom="0",e.style.left="0",t.style.width="6px",t.style.height="50px",t.style.position="absolute",t.style.right="0",t.style.top="0"},le=(e,{x:t,y:o,height:s,width:l},i=!0)=>{e.style.transform=`translate(${t}px, ${o}px)`,e.style.width=l+"px",e.style.height=s+"px",e.style.display=i?"block":"none"},ie=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.filter(o=>{const s=Object.keys(o).sort().map(l=>`${l}:${String(o[l])}`).join(";");return t.has(s)?!1:(t.add(s),!0)})},ne=(e,t)=>{let o=t;o.length>1e3&&(o=t.map(l=>({...l,x:Math.floor(l.x),y:Math.floor(l.y)})));const s=ie(o);e.save(),s.forEach(({x:l,y:i,width:a,height:r,fillColor:c="",lineColor:d="",lineWidth:h=1,radius:u=0,opacity:p=100,gradient:y,rotation:m=0,dashLine:g=""})=>{const x=a/2,w=r/2;e.save(),e.translate(l,i),m>0&&e.rotate(m*Math.PI/180),p>0&&(e.fillStyle=c,e.globalAlpha=p/100),h>0&&(e.lineWidth=h,e.strokeStyle=d,e.lineJoin="round"),e.beginPath(),g&&e.setLineDash([3,5]),u>0?(e.moveTo(-x+u,-w),e.arcTo(x,-w,x,w,u),e.arcTo(x,w,-x,w,u),e.arcTo(-x,w,-x,-w,u),e.arcTo(-x,-w,x,-w,u)):e.rect(-x,-w,a,r),e.closePath(),p>0&&e.fill(),h>0&&e.stroke(),e.restore()})},vi=(e,t)=>{const o=new Set,s=",";e.save(),t.forEach(r=>{const c=Object.values(r).join(s);o.add(c)});let l=NaN,i="";const a=new Path2D;o.forEach(r=>{const c=r.split(s),d=parseFloat(c[0]),h=parseFloat(c[1]),u=parseFloat(c[2]),p=parseFloat(c[3]),y=c[4],m=parseFloat(c[5]);m!==l&&(e.lineWidth=m,l=m),y!==i&&(e.fillStyle=y,i=y),a.moveTo(d,h),a.lineTo(u,p)}),e.stroke(a),e.restore()},Mi=({ctx:e,modules:t,frame:o})=>{const l=[{...o,x:o.cx,y:o.cy}],i=[],a=[];t.forEach(r=>{if(r.type==="rectangle"){const{x:c,y:d,width:h,height:u,enableFill:p,enableLine:y,opacity:m,lineWidth:g,fillColor:x,lineColor:w,rotation:v,gradient:F,radius:C,id:E}=r.getDetails();(p&&m>0||y)&&l.push({x:c,y:d,width:h,height:u,fillColor:x,opacity:m,lineWidth:g,lineColor:w,rotation:v,gradient:F,radius:C}),a.push({x:c+10,y:d+10,width:h,height:u,id:E.match(/\d+$/g)[0]})}if(r.type==="connector"){const c=t.get(r.start),d=t.get(r.end),h=c.getBoundingRect(),u=d.getBoundingRect();i.push({startX:h.centerX,startY:h.bottom,endX:u.centerX,endY:u.top,fillStyle:"#5491f8",lineWidth:1})}}),ne(e,l),vi(e,i),Ci(e,a)},Ci=(e,t)=>{e.font="sans-serif",e.textBaseline="top",t.forEach(({id:o,x:s,y:l,width:i,height:a})=>{e.fillText(o,s-i/2+5,l-a/2+5,100)})},Si=(e,t)=>{let o=t;o.length>1e3&&(o=t.map(l=>({...l,x:Math.floor(l.x),y:Math.floor(l.y)})));const s=ie(o);e.save(),s.forEach(({x:l,y:i,r1:a,r2:r,fillColor:c="",lineColor:d="",lineWidth:h=1,opacity:u=100,gradient:p,rotation:y=0,dashLine:m=""})=>{e.save(),e.translate(l,i),y!==0&&e.rotate(y*Math.PI/180),u>0&&(e.fillStyle=c,e.globalAlpha=u/100),h>0&&(e.lineWidth=h,e.strokeStyle=d,e.lineJoin="round"),e.beginPath(),e.ellipse(0,0,a,r,0,0,Math.PI*2),m?e.setLineDash([3,5]):e.setLineDash([]),e.closePath(),u>0&&e.fill(),h>0&&e.stroke(),p&&(e.fillStyle=p,u>0&&e.fill()),e.restore()})};function ji(e){if(!e||e.size===0)return;const{selectionCTX:t,dpr:o,offset:s,worldRect:l,scale:i,mouseMovePoint:a}=this.viewport;this.selectedModules.size;const r=this.getModulesByIdSet(e),c=this.resizeHandleSize/2,d=[],h=[],u="#5491f8",p="#5491f8";r.forEach(y=>{const{x:m,y:g,width:x,height:w,rotation:v,lineWidth:F}=y.getDetails(),C=oe(m,g,x,w,v);h.push(...C.map(E=>({...E,r1:c,r2:c,fillColor:u,lineColor:"#fff"}))),d.push({x:m,y:g,width:x,height:w,fillColor:u,lineColor:p,lineWidth:F,rotation:v,opacity:0,dashLine:"dash"})}),ne(t,d),Si(t,h),this.viewport.enableCrossLine&&this.viewport.drawCrossLine&&fi({ctx:t,mousePoint:a,scale:i,dpr:o,offset:s})}const Ni=(e,t)=>{const{width:o,height:s}=t,{width:l,height:i}=e,a=.98,r=o/l,c=s/i,d=Math.min(r,c)*a,h=((o-l*d)/2-e.x*d)/2,u=((s-i*d)/2-e.y*d)/2;return{scale:d,offsetX:h,offsetY:u}},Fi=(e="A4")=>{let t=0,o=0;const s=0,l=0;if(e==="A4"||e==="A4L"){const a=1.414142857;e==="A4L"?(o=1e3,t=a*o):(t=1e3,o=a*t)}else e==="photo1"&&(t=35,o=55);return{...W({x:s,y:l,width:t,height:o}),opacity:100,lineWidth:1,lineColor:"#000000",fillColor:"#fff"}};function ae(){const{viewport:e,hoveredModules:t}=this,o=this.getWorldPointByViewportPoint(e.mouseMovePoint.x,e.mouseMovePoint.y);t.clear(),this.getVisibleModuleMap().forEach(s=>{if(s.type==="rectangle"){const{x:l,y:i,width:a,height:r,rotation:c}=s;si(o,{x:l,y:i,width:a,height:r},c)&&t.add(s.id)}})}function ki(e){const{shiftKey:t,clientY:o,target:s,clientX:l,metaKey:i,ctrlKey:a}=e;if(s!==this.viewport.wrapper)return;const r=a||i||t,c=l-this.viewport.rect.x,d=o-this.viewport.rect.y;if(this.viewport.mouseDownPoint.x=c,this.viewport.mouseDownPoint.y=d,this.viewport.mouseMovePoint.x=c,this.viewport.mouseMovePoint.y=d,ae.call(this),e.preventDefault(),this.viewport.spaceKeyDown)return this.manipulationStatus="panning";const h=[...this.hoveredModules][this.hoveredModules.size-1];if(!h)return r||this.action.dispatch({type:"selection-clear"}),this.selectedShadow=this.getSelectedIdSet(),console.warn(this.selectedShadow),this.manipulationStatus="selecting";if(this.manipulationStatus="dragging",this.isSelectAll){this.moduleMap.forEach(p=>{this.draggingModules.add(p.id)});return}const u=this.selectedModules.has(h);this.selectedModules.size===0||!u&&!r?(this.action.dispatch({type:"selection-modify",data:{mode:"replace",idSet:new Set([h])}}),this.draggingModules=new Set([h])):r?(u?this._deselection=h:(this.draggingModules=new Set(this.selectedModules),this.action.dispatch({type:"selection-modify",data:{mode:"add",idSet:new Set([h])}})),this.draggingModules.add(h)):this.draggingModules=new Set(this.selectedModules)}function Ei(e){const{draggingModules:t,manipulationStatus:o,moduleMap:s,_selectingModules:l,selectedShadow:i,viewport:a}=this,r=e.clientX-a.rect.x,c=e.clientY-a.rect.y,d=e.ctrlKey||e.metaKey||e.shiftKey;switch(a.mouseMovePoint.x=r,a.mouseMovePoint.y=c,o){case"selecting":break;case"panning":break;case"dragging":{const h=(a.mouseMovePoint.x-a.mouseDownPoint.x)*a.dpr/a.scale,u=(a.mouseMovePoint.y-a.mouseDownPoint.y)*a.dpr/a.scale;if(!(h===0&&u===0))t.forEach(y=>{s.get(y).x-=h,s.get(y).y-=u}),this.action.dispatch({type:"selection-move",data:{direction:"module-move-shift",delta:{x:h,y:u}}});else{const y=[...this.hoveredModules][this.hoveredModules.size-1];console.log(this._deselection),y&&d&&y===this._deselection&&this.action.dispatch({type:"selection-modify",data:{mode:"toggle",idSet:new Set([y])}})}}break;case"resizing":break;case"rotating":break;case"mousedown":console.log(this.draggingModules),this.action.dispatch({type:"selection-clear"});break;case"static":e.ctrlKey||e.metaKey||e.shiftKey?this.toggle(t):this.replace(t);break}t.clear(),i.clear(),l.clear(),this.manipulationStatus="static",this._deselection=null,le(a.selectionBox,{x:0,y:0,width:0,height:0},!1)}function $i(e){if(!(this.manipulationStatus==="panning"||this.manipulationStatus==="selecting")&&e.code==="Space"){this.viewport.spaceKeyDown=!0,this.viewport.wrapper.style.cursor="grabbing",e.preventDefault();return}}function Li(e){e.code==="Space"&&(this.viewport.spaceKeyDown=!1,this.viewport.wrapper.style.cursor="default")}function Ti(e){if(e.target!==this.viewport.wrapper||(e.preventDefault(),e.stopPropagation(),this.manipulationStatus!=="static"))return;const{zooming:t,panning:o,scrolling:s,zoomFactor:l,translateX:i,translateY:a}=Ai(e);this.viewport.zooming=t,t?(console.log(l),this.action.dispatch({type:"world-zoom",data:{zoomFactor:l,physicalPoint:this.viewport.mouseMovePoint}})):(o||s)&&this.action.dispatch({type:"world-shift",data:{x:i,y:a}}),this.updateWorldRect()}const Ai=(()=>{let e;const s=[];let l=!1,i=!1,a=!1,r=0,c=0,d=0,h=!1;const u=.01,p=.1;return y=>{const{deltaX:m,deltaY:g,altKey:x}=y;if(e&&clearTimeout(e),h?s.length=0:s.push(y),c=0,d=0,l=!1,a=!1,i=!1,x&&(l=!0),s.length>=3){const w=s.every(C=>B(C.deltaX)),v=s.every(C=>O(C.deltaY)),F=s.every(C=>Math.abs(C.deltaY)>4);w&&v&&!F&&(h=!0,console.log("touchpadZoomingLock"))}return h?(r=g>0?-.01:u,l=!0):Math.abs(m)>=40&&B(g)?x?r=m<0?p:-.1:(a=!0,c=-m):B(m)&&O(g)&&Math.abs(g)>4?x?r=g<0?u:-.01:(a=!0,d=-g):Z(m)&&Z(g)&&(x?r=(Math.abs(m)>Math.abs(g)?m:g)<0?u:-.01:(i=!0,c=-m,d=-g)),l&&x&&(r=r<0?-.1:p),e=setTimeout(()=>{h=!1,l=!1,i=!1,a=!1,r=0,c=0,d=0,s.length=0},200),{zooming:l,panning:i,scrolling:a,zoomFactor:r,translateX:c,translateY:d}}})();function Z(e){return!O(e)}function O(e){return Math.abs(e)%1!==0}function Di(e){const{action:t,draggingModules:o,moduleMap:s,viewport:l,hoveredModules:i,selectedShadow:a,_selectingModules:r}=this;switch(l.mouseMovePoint.x=e.clientX-l.rect.x,l.mouseMovePoint.y=e.clientY-l.rect.y,l.drawCrossLine=!1,t.dispatch({type:"world-mouse-move"}),this.manipulationStatus){case"selecting":{l.wrapper.setPointerCapture(e.pointerId);const c=k(l.mouseDownPoint,l.mouseMovePoint),d=this.getWorldPointByViewportPoint(c.x,c.y),h=this.getWorldPointByViewportPoint(c.right,c.bottom),u=k(d,h),p=new Set,y=e.ctrlKey||e.metaKey||e.shiftKey;this.getVisibleModuleMap().forEach(x=>{if(x.type==="rectangle"){const w=x.getBoundingRect();oi(w,u)&&p.add(x.id)}});const m=!bi(r,p);if(le(l.selectionBox,c),!m)return;this._selectingModules=p;const g=yi(a,p);if(y)t.dispatch({type:"selection-modify",data:{mode:"replace",idSet:g}});else{if(p.size===0&&a.size===0)return t.dispatch({type:"selection-clear"});const x=new Set([...a,...p]);t.dispatch({type:"selection-modify",data:{mode:"replace",idSet:x}})}}break;case"panning":t.dispatch({type:"world-shift",data:{x:e.movementX,y:e.movementY}});break;case"dragging":{l.wrapper.setPointerCapture(e.pointerId);const c=e.movementX*l.dpr/l.scale,d=e.movementY*l.dpr/l.scale;console.log(o),o.forEach(h=>{s.get(h).move(c,d)}),console.log("temp"),this.action.dispatch({type:"visible-module-update"})}break;case"resizing":break;case"rotating":break;case"mousedown":(Math.abs(l.mouseMovePoint.x-l.mouseDownPoint.x)>1||Math.abs(l.mouseMovePoint.y-l.mouseDownPoint.y)>1)&&(o.size>0?this.manipulationStatus="dragging":this.manipulationStatus="selecting");break;case"static":ae.call(this),l.wrapper.releasePointerCapture(e.pointerId),l.drawCrossLine=l.drawCrossLineDefault;break}}function Pi(e){if(e.preventDefault(),e.stopPropagation(),console.log("mem"),e.ctrlKey)return!1;const t=[...this.hoveredModules][this.hoveredModules.size-1],o=this.getSelectedIdSet(),s={...this.viewport.mouseMovePoint};let l=new Set;t&&(o.has(t)?l=o:l.add(t)),this.action.dispatch({type:"context-menu",data:{idSet:l,position:s}})}function Ri(){const{wrapper:e,mainCanvas:t,selectionCanvas:o,selectionBox:s,scrollBarX:l,scrollBarY:i}=mi(),a=o.getContext("2d"),r=t.getContext("2d"),c=new AbortController,d=new ResizeObserver(li(()=>{this.action.dispatch({type:"viewport-resize",data:null})},200)),{signal:h}=c,u={x:0,y:0},p={x:0,y:0},y=k(u,p),m=k(u,p),g=k(u,p);return window.addEventListener("mousedown",ki.bind(this),{signal:h}),window.addEventListener("mouseup",Ei.bind(this),{signal:h}),window.addEventListener("keydown",$i.bind(this),{signal:h}),window.addEventListener("keyup",Li.bind(this),{signal:h}),window.addEventListener("wheel",Ti.bind(this),{signal:h,passive:!1}),e.addEventListener("pointermove",Di.bind(this),{signal:h}),e.addEventListener("contextmenu",Pi.bind(this),{signal:h}),{drawCrossLine:!1,drawCrossLineDefault:!1,enableCrossLine:!1,initialized:!1,scale:1,spaceKeyDown:!1,zooming:!1,dpr:this.config.dpr,frame:Fi("A4"),offset:{x:0,y:0},viewportRect:m,worldRect:g,mouseDownPoint:u,mouseMovePoint:p,rect:y,wrapper:e,mainCanvas:t,selectionCanvas:o,selectionCTX:a,mainCTX:r,scrollBarX:l,scrollBarY:i,selectionBox:s,resizeObserver:d,eventsController:c}}function zi(){this.viewport&&(this.viewport.resizeObserver.disconnect(),this.viewport.eventsController.abort(),this.viewport.wrapper.style.width="100%",this.viewport.wrapper.style.height="100%",this.viewport.wrapper.remove(),this.viewport=null)}const q=(e,t,o,{x:s,y:l})=>{const i=[o,0,0,o,s*t,l*t];e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width*2,e.canvas.height*2),e.setTransform(...i)},re=e=>new Set(e.map(t=>t.id));function ce(e=!1){if(this.history.current===this.history.tail)return!1;this.history.forward();const{type:t,payload:o}=this.history.current.data,{selectedModules:s}=o;switch(t){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchAdd(this.batchCreate(o.modules));break;case"history-modify":break;case"history-move":this.batchMove(o.selectedModules,{x:o.delta.x,y:o.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":this.batchDelete(re(o.modules));break}return e||(s==="all"?this.selectAll():this.replace(s)),this.history.current}function de(e=!1){if(this.history.current===this.history.head)return!1;const{type:t,payload:o}=this.history.current.data,{selectedModules:s}=o;let l=null;switch(t){case"history-init":break;case"history-add":case"history-paste":case"history-duplicate":this.batchDelete(re(o.modules));break;case"history-modify":break;case"history-move":this.batchMove(o.selectedModules,{x:-o.delta.x,y:-o.delta.y});break;case"history-reorder":break;case"history-group":break;case"history-ungroup":break;case"history-composite":break;case"history-delete":l=o.modules,this.batchAdd(this.batchCreate(l));break}return this.history.back(),e||(s==="all"?this.selectAll():this.replace(s)),this.history.current}function Bi(e){var o,s;const t=this.history.compareToCurrentPosition(e);if(!(!t||t==="equal")&&(t==="front"||t==="behind")){let i;for(;t==="front"?i=de.call(this,!0):t==="behind"&&(i=ce.call(this,!0)),i!==e;);const{selectedModules:a}=e.data.payload;a==="all"?this.selectAll():this.replace(a),(s=(o=this.events).onHistoryUpdated)==null||s.call(o,this.history)}}function Vi(){const{container:e,viewport:t,action:o}=this;e.appendChild(t.wrapper),t.resizeObserver.observe(e),o.on("viewport-resize",()=>{if(this.updateViewport(),!this.viewport.initialized){const{frame:s,viewportRect:l}=this.viewport,{scale:i,offsetX:a,offsetY:r}=Ni(s,l);this.viewport.scale=i,this.viewport.offset.x=a,this.viewport.offset.y=r,this.viewport.initialized=!0}this.updateWorldRect(),this.action.dispatch({type:"world-update"})}),this.action.on("world-mouse-move",()=>{var l,i;const s=this.getWorldPointByViewportPoint(this.viewport.mouseMovePoint.x,this.viewport.mouseMovePoint.y);(i=(l=this.events).onWorldMouseMove)==null||i.call(l,s)}),this.action.on("world-update",()=>{var s,l;this.updateWorldRect(),this.updateVisibleModuleMap(),(l=(s=this.events).onViewportUpdated)==null||l.call(s,this.viewport.worldRect),this.action.dispatch({type:"visible-module-update",data:this.getVisibleModuleMap()})}),this.action.on("world-zoom",s=>{console.log(s);const{zoomFactor:l,physicalPoint:i}=s,{scale:a,offset:r}=this.zoomAtPoint(i,l);this.viewport.scale=a,this.viewport.offset.x=r.x,this.viewport.offset.y=r.y,this.action.dispatch({type:"world-update"})}),this.action.on("world-shift",s=>{const{x:l,y:i}=s;this.viewport.offset.x+=l,this.viewport.offset.y+=i,this.action.dispatch({type:"world-update"})}),this.action.on("visible-module-update",()=>{this.dispatchVisibleSelectedModules(),q(this.viewport.mainCTX,this.viewport.dpr,this.viewport.scale,this.viewport.offset),this.renderModules()}),this.action.on("visible-selected-update",s=>{q(this.viewport.selectionCTX,this.viewport.dpr,this.viewport.scale,this.viewport.offset),this.renderSelections(s.idSet)}),this.action.on("select-all",()=>{this.selectedModules.clear(),this.isSelectAll=!0,this.dispatchVisibleSelectedModules()}),this.action.on("selection-clear",()=>{this.selectedModules.clear(),this.isSelectAll=!1,this.dispatchVisibleSelectedModules(),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"})}),this.action.on("selection-modify",s=>{const{mode:l,idSet:i}=s;this.modifySelection(i,l),this.dispatchVisibleSelectedModules()}),this.action.on("selection-delete",()=>{const s=this.batchDelete(this.isSelectAll?"all":this.selectedModules);this.selectedModules.clear(),this.isSelectAll=!1,this.dispatchVisibleSelectedModules(),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),this.history.add({type:"history-delete",payload:{modules:s,selectedModules:this.getSelected()}})}),this.action.on("selection-copy",()=>{this.copiedItems=this.batchCopy(this.isSelectAll?"all":this.selectedModules,!0),this.updateCopiedItemsDelta()}),this.action.on("selection-paste",()=>{if(this.copiedItems.length===0)return;const s=this.batchCreate(this.copiedItems),l=new Set(s.keys());this.batchAdd(s),this.replace(l),this.updateCopiedItemsDelta(),this.dispatchVisibleSelectedModules(),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),this.history.add({type:"history-paste",payload:{modules:[...s.values()].map(i=>i.getDetails()),selectedModules:this.getSelected()}})}),this.action.on("selection-duplicate",()=>{let s;this.isSelectAll?s=this.batchCopy("all",!0):s=this.batchCopy(this.selectedModules,!0),s.forEach(a=>{a.x+=this.CopyDeltaX,a.y+=this.CopyDeltaY});const l=this.batchCreate(s);this.batchAdd(l),this.isSelectAll=!1,this.replace(new Set(l.keys())),this.dispatchVisibleSelectedModules(),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"});const i=[...l.values()].map(a=>a.getDetails());this.history.add({type:"history-duplicate",payload:{modules:i,selectedModules:this.getSelected()}})}),this.action.on("selection-move",({direction:s,delta:l={x:0,y:0}})=>{if(!this.isSelectAll&&this.selectedModules.size===0)return;const i=5;console.log(s,l);let a;switch(s){case"module-move-down":l.y=i;break;case"module-move-up":l.y=-5;break;case"module-move-left":l.x=-5;break;case"module-move-right":l.x=i;break}this.isSelectAll?(this.batchMove("all",l),a="all"):(a=new Set(this.selectedModules),this.batchMove(this.selectedModules,l)),this.dispatchVisibleSelectedModules(),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),this.history.add({type:"history-move",payload:{delta:l,selectedModules:a}})}),this.action.on("history-undo",()=>{var s,l;de.call(this,!0),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),(l=(s=this.events).onHistoryUpdated)==null||l.call(s,this.history)}),this.action.on("history-redo",()=>{var s,l;ce.call(this,!0),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),(l=(s=this.events).onHistoryUpdated)==null||l.call(s,this.history)}),this.action.on("history-pick",s=>{var l,i;Bi.call(this,s),this.updateVisibleModuleMap(),this.action.dispatch({type:"visible-module-update"}),(i=(l=this.events).onHistoryUpdated)==null||i.call(l,this.history)}),this.action.on("context-menu",({idSet:s,position:l})=>{var i,a;(a=(i=this.events).onContextMenu)==null||a.call(i,s,l)})}class Ii{constructor({container:t,data:o,events:s={},config:l={dpr:2}}){b(this,"id");b(this,"config");b(this,"moduleCounter",0);b(this,"moduleMap");b(this,"visibleModuleMap");b(this,"action");b(this,"container");b(this,"events",{});b(this,"history");b(this,"viewport");b(this,"selectedModules",new Set);b(this,"visibleSelectedModules",new Set);b(this,"operationHandlers",new Set);b(this,"isSelectAll",!1);b(this,"resizeHandleSize",10);b(this,"copiedItems",[]);b(this,"hoveredModules",new Set);b(this,"draggingModules",new Set);b(this,"_selectingModules",new Set);b(this,"_deselection",null);b(this,"selectedShadow",new Set);b(this,"manipulationStatus","static");b(this,"CopyDeltaX",50);b(this,"CopyDeltaY",100);this.visibleModuleMap=new Map,this.id=o.id,this.config=l,this.events=s,this.action=new Ql,this.container=t,this.history=new Jl(this),this.viewport=Ri.call(this),this.moduleMap=o.modules.reduce((i,a)=>(i.set(a.id,a),i),new Map),this.init()}init(){Vi.call(this)}get createModuleId(){return this.id+"-"+ ++this.moduleCounter}batchCreate(t){return ri.call(this,t)}batchAdd(t){return ci.call(this,t)}batchCopy(t,o=!1,s){return di.call(this,t,o,s)}batchDelete(t){return hi.call(this,t)}batchMove(t,o){ui.call(this,t,o)}batchModify(t,o,s){pi.call(this,t,o,s)}getModulesByLayerIndex(){}getModulesByIdSet(t){const o=new Map;return t.forEach(s=>{const l=this.moduleMap.get(s);l&&o.set(s,l)}),o}getModuleList(){return[...Object.values(this.moduleMap)]}updateVisibleModuleMap(){this.visibleModuleMap.clear(),this.moduleMap.forEach(t=>{const o=t.getBoundingRect();ti(o,this.viewport.worldRect)&&this.visibleModuleMap.set(t.id,t)})}getVisibleModuleMap(){return new Map(this.visibleModuleMap)}execute(t,o=null){this.action.execute({type:t,data:o})}dispatchVisibleSelectedModules(){this.updateVisibleSelectedModules(),this.action.dispatch({type:"visible-selected-update",data:{idSet:this.getVisibleSelectedModules(),operators:this.operationHandlers}})}updateVisibleSelectedModules(){gi.call(this)}getVisibleSelectedModules(){return new Set(this.visibleSelectedModules)}getSelected(){return this.isSelectAll?"all":new Set(this.selectedModules.keys())}getSelectedIdSet(){if(this.isSelectAll){const t=new Set;return this.moduleMap.forEach(o=>{t.add(o.id)}),t}return new Set(this.selectedModules)}modifySelection(t,o){T.call(this,t,o)}add(t){T.call(this,t,"add")}delete(t){T.call(this,t,"delete")}toggle(t){T.call(this,t,"toggle")}replace(t){T.call(this,t,"replace")}selectAll(){var t,o;this.selectedModules.clear(),this.isSelectAll=!0,(o=(t=this.events).onSelectionUpdated)==null||o.call(t,"all",null)}updateCopiedItemsDelta(){this.copiedItems.forEach(t=>{t.x+=this.CopyDeltaX,t.y+=this.CopyDeltaY})}getIfUnique(){return this.selectedModules.size===1?[...this.selectedModules.values()][0]:null}renderModules(){requestAnimationFrame(()=>{Mi({ctx:this.viewport.mainCTX,frame:this.viewport.frame,modules:this.visibleModuleMap})})}renderSelections(t){requestAnimationFrame(()=>{ji.call(this,t)})}updateWorldRect(){const{width:t,height:o}=this.viewport.viewportRect,s=this.getWorldPointByViewportPoint(0,0),l=this.getWorldPointByViewportPoint(t,o);this.viewport.worldRect=k(s,l)}zoomAtPoint(t,o,s=!1){const{offset:l,scale:i,dpr:a}=this.viewport,r=.1,c=5;let d=i+o;if(t.x*i,t.y*i,this.viewport.rect.width*a,this.viewport.rect.height*a,s&&(d=o),d<r||d>c)return;const h=Math.max(r,Math.min(c,d)),u=h/i,p=this.getWorldPointByViewportPoint(t.x,t.y),y=p.x-(p.x-l.x)*u,m=p.y-(p.y-l.y)*u;return{scale:h,offset:{x:y,y:m}}}zoomTo(t){console.log(t),t==="fit"||this.zoomAtPoint({x:this.viewport.rect.width/2,y:this.viewport.viewportRect.height/2},t,!0)}setTranslateViewport(t,o){this.viewport.offset.x=0,this.viewport.offset.y=0,this.translateViewport(t,o)}translateViewport(t,o){this.viewport.offset.x+=t,this.viewport.offset.y+=o}updateScrollBar(){const{scrollBarX:t,scrollBarY:o}=this.viewport;wi(t,o)}updateViewport(){const{dpr:t,mainCanvas:o,selectionCanvas:s}=this.viewport,l=this.container.getBoundingClientRect().toJSON(),{x:i,y:a,width:r,height:c}=l,d=r*t,h=c*t;this.viewport.rect={...l,cx:i+r/2,cy:a+c/2},this.viewport.viewportRect=k({x:0,y:0},{x:d,y:h}),o.width=s.width=d,o.height=s.height=h}getWorldPointByViewportPoint(t,o){const{dpr:s,offset:l,scale:i}=this.viewport;return se(i,l.x*s,l.y*s,t*s,o*s)}fitFrame(){console.log("fit")}destroy(){zi.call(this),this.action.destroy(),this.history.destroy(),this.moduleMap.clear()}}const N=f.createContext({focused:!1,historyArray:[],historyCurrent:0,selectedModules:[],selectedProps:{},editorRef:{},applyHistoryNode:()=>{},executeAction:()=>{},viewport:{width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}}),Oi=()=>{const{executeAction:e,focused:t}=f.useContext(N),o=s=>{let l=null;const{key:i,ctrlKey:a,metaKey:r,shiftKey:c}=s,h={ArrowUp:"module-move-up",ArrowDown:"module-move-down",ArrowLeft:"module-move-left",ArrowRight:"module-move-right"}[i];i==="a"&&(a||r)&&(l="select-all"),i==="c"&&(a||r)&&!c&&(l="selection-copy"),i==="v"&&(a||r)&&(l="selection-paste"),i==="d"&&(a||r)&&(l="selection-duplicate"),(i==="Delete"||i==="Backspace")&&(l="selection-delete"),i==="Escape"&&(l="selection-clear"),i==="z"&&(a||r)&&(l="history-undo"),i==="z"&&c&&(a||r)&&(l="history-redo"),h&&(l="selection-move"),l&&(h?e(l,{direction:h}):e(l),s.stopPropagation(),s.preventDefault())};return f.useEffect(()=>(window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}),[t]),null},Ui=[{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50},{type:"rectangle",width:100,height:50}],_i=()=>{const{editorRef:e}=f.useContext(N);return f.useEffect(()=>{e.current&&console.log("editorRef.current updated:",e.current)},[e]),n.jsx("div",{className:"flex flex-wrap space-x-2 space-y-2",children:Ui.map((t,o)=>n.jsx("div",{className:"shrink-0 select-none cursor-move",style:{width:t.width,height:t.height,border:"1px solid #dfdfdf"},onMouseEnter:()=>{}},o))})},Hi=({className:e=""})=>{const[t,o]=f.useState(300),s=f.useRef(!1),l=f.useRef(null),i=f.useCallback(c=>{c.preventDefault(),s.current=!0,document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]),a=f.useCallback(c=>{if(!s.current)return;const d=window.innerWidth*.9,h=Math.min(Math.max(0,c.clientX),d);c.stopPropagation(),o(h)},[]),r=f.useCallback(c=>{s.current=!1,document.body.style.cursor="default",document.body.style.userSelect="",c.stopPropagation()},[]);return f.useEffect(()=>(window.addEventListener("mousemove",a),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",r)}),[a,r]),n.jsxs("div",{ref:l,style:{width:`${t}px`},className:"relative h-full flex-shrink-0 border-r border-gray-200",children:[n.jsxs("div",{className:`h-auto p-6 bg-white overflow-hidden ${e}`,children:[n.jsx("span",{children:"Module List"}),n.jsx(_i,{})]}),n.jsx("div",{className:"absolute z-10 top-0 -right-1 w-2 h-full bg-transparent hover:bg-gray-200 cursor-col-resize transition-colors",onMouseDown:i})]})},J=e=>(e*100).toFixed(2)+"%",Wi=e=>{const t=e.replace("%","").trim(),o=Number(t);return isNaN(o)?!1:Number(o.toFixed(2))},Xi=({scale:e,onChange:t})=>{const o=[{label:"400%",value:4},{label:"300%",value:3},{label:"200%",value:2},{label:"150%",value:1.5},{label:"125%",value:1.25},{label:"100%",value:1},{label:"75%",value:.75},{label:"50%",value:.5},{label:"25%",value:.25},{label:"Fit window",value:"fit"}],[s,l]=f.useState(J(1)),[i,a]=f.useState(!1),r=f.useRef(null);f.useEffect(()=>{const d=J(e);r.current&&(r.current.value=d),l(d)},[e]);const c=d=>{if(d.key==="Enter"){const h=Wi(d.target.value);h!==!1&&t(h),r.current.blur()}d.stopPropagation()};return n.jsxs("div",{className:"w-17 h-5 ml-2 flex justify-start items-center relative  focus:ring-blue-500 focus:ring-1",children:[n.jsx("input",{type:"text",ref:r,onChange:void 0,defaultValue:s,onKeyDown:c,className:"w-20 h-5 text-sm bg-gray-100 text-center overflow-hidden ",placeholder:"Enter zoom %"}),n.jsx("button",{onClick:()=>a(!i),className:"text-gray-800 flex trasition items-center cursor-pointer",children:i?n.jsx(Se,{className:"w-5 h-5"}):n.jsx(je,{className:"w-5 h-5"})}),i&&n.jsx("div",{className:"fixed w-full h-full",onClick:()=>{a(!1)}}),i&&n.jsx("div",{className:"absolute w-20 cursor-pointer py-2 left-0 bottom-5 bg-white shadow-lg max-h-40v overflow-y-auto z-10",children:o.map(({label:d,value:h})=>n.jsx("div",{onClick:()=>{a(!1),t(h)},className:"text-sm align-middle p-1 text-center hover:bg-blue-500 hover:text-white transition",children:h==="fit"?d:`${h*100}%`},h))})]})},Yi=({className:e="",worldPoint:t})=>{const{viewport:o,executeAction:s}=f.useContext(N);return o?n.jsx("footer",{className:e+"w-full h-8 flex justify-between pr-1 items-center border-t border-gray-200",children:o&&n.jsxs(n.Fragment,{children:[n.jsx(Xi,{scale:o.scale,onChange:l=>{s("zoom",l)}},o.scale),n.jsx("div",{className:"text-xs line-clamp-1",children:`dx:${t.x.toFixed(2)} dx:${t.y.toFixed(2)}`})]})}):null},V=28,Ki=({data:e,selected:t,handleSelectModule:o})=>{const s=f.useRef(null),l=f.useRef(null),[i,a]=f.useState(0),[r,c]=f.useState([0,10]);f.useEffect(()=>{},[t,e]);const d=()=>{if(!s.current)return;const u=s.current.scrollTop,p=u<i,y=Math.round(u/V),m=y+10;if(console.log(u),p){if(r[0]>=e.length-1)return}else if(r[1]>=e.length-1)return;a(u),c([y,m])},h=[];for(let u=r[0];u<r[1];u++){const p=e[u];p&&h.push(n.jsx("div",{ref:t!=null&&t.includes(p.id)?l:null,style:{height:V},className:t!=null&&t.includes(p.id)?"bg-gray-400 text-white":"",onClick:()=>o(p.id),id:`layer-module-${p.id}`,children:p.type},p.id))}return n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Layer"})}),n.jsx("div",{className:"p-2 relative overflow-hidden",children:n.jsxs("div",{ref:s,onScroll:d,className:"relative scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:[n.jsx("div",{className:"absolute w-full top-0 left-0",style:{height:e.length*V}}),n.jsx("div",{className:"w-full sticky top-0 left-0",children:h})]})})]})},he=({menu:e})=>{const{t}=D(),[o,s]=f.useState(!1),{executeAction:l}=f.useContext(N),i=()=>{console.log(e.id),!(e.children||o)&&(l(e.id),s(!1))},a=e.children&&e.children.length>0;return n.jsxs("div",{className:"relative h-8 hover:bg-gray-200 min-w-50",onClick:()=>i(),onMouseOver:r=>{s(!0),r.preventDefault()},onMouseLeave:()=>{s(!1)},children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center whitespace-nowrap",children:[n.jsx("span",{children:t(e.id+".label")}),a&&n.jsx(Ne,{size:18})]}),a&&o&&n.jsx("div",{className:"absolute bg-white z-30 left-full top-0 w-auto border border-gray-200 box-border",children:e.children.map(r=>n.jsx(he,{menu:r},r.id))})]})},Gi=()=>{const[e,t]=f.useState(!1),[o,s]=f.useState(null),{t:l}=D(),i=f.useRef(null),a=ee(c=>c.menu.actions),r=f.useMemo(()=>Zi(a),[a]);return f.useEffect(()=>{const c=d=>{i.current.contains(d.target)||(t(!1),s(null))};return window.addEventListener("click",c),()=>{window.removeEventListener("click",c)}}),n.jsx("div",{className:"h-8 text-sm select-none border-gray-200 box-border",children:n.jsx("div",{ref:i,className:"pl-2 h-full inline-flex",children:r.map(c=>{var d;return n.jsxs("div",{className:"relative h-full",children:[n.jsx("div",{className:`h-full inline-flex items-center px-4 ${c.id===o?"bg-gray-200":""}`,onMouseEnter:()=>e&&s(c.id),onClick:()=>{o!==c.id?(t(!0),s(c.id)):(s(null),t(!1))},title:l(c.id+".tooltip"),children:n.jsx("span",{children:l(c.id+".label")})}),e&&c.id===o&&c.children.length>0&&n.jsx("div",{className:"absolute z-20 bg-white border border-gray-200",children:(d=c.children)==null?void 0:d.map(h=>n.jsx(he,{menu:h},h.id))})]},c.id)})})})};function Zi(e){const t=new Map;Object.values(e).forEach(s=>{t.set(s.id,{...s,children:[]})});const o=[];return t.forEach(s=>{const l=t.get(s.parent);l?l.children.push(s):o.push(s)}),o}const R={strokeWidth:"2",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},z="#9b9a9a",qi=({size:e=24,...t})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...R,...t,children:[n.jsx("path",{fill:z,d:"M12,10.87l-9.06,5.67,9.06,5.67,9.06-5.67-9.06-5.67Z"}),n.jsx("path",{fill:"#fff",d:"M9.57,7.84c-2.21,1.38-4.42,2.76-6.64,4.15,3.02,1.89,6.04,3.78,9.06,5.67l9.06-5.67c-2.24-1.4-4.48-2.8-6.72-4.2"}),n.jsx("path",{d:"M11.96,1.8c.01,2.22.04,6.67.04,6.67M11.96,1.8c-1.87,1.12-3.75,2.25-5.62,3.37M12,1.8c2.09,1.3,3.4,2.13,5.55,3.47"})]}),Ji=({size:e=24,...t})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...R,...t,children:[n.jsx("path",{fill:"#fff",d:"M14.43,16.16c2.21-1.38,4.42-2.76,6.64-4.15-3.02-1.89-6.04-3.78-9.06-5.67L2.94,12.02c2.24,1.4,4.48,2.8,6.72,4.2"}),n.jsx("path",{fill:"#fff",d:"M12.04,22.2c0-2.26-.02-4.52-.03-6.77M12.04,22.2c1.87-1.12,3.75-2.25,5.62-3.37M12,22.2c-2.09-1.3-3.4-2.13-5.55-3.47"}),n.jsx("path",{fill:z,d:"M12,13.13l9.06-5.67L12,1.8,2.94,7.46l9.06,5.67Z"})]}),Qi=({size:e=24,...t})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...R,...t,children:[n.jsx("path",{d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:z,d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),en=({size:e=24,...t})=>n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:e,viewBox:"0 0 24 24",fill:"none",...R,...t,children:[n.jsx("path",{fill:z,d:"M12,10.8l-9.65,6.03,9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,5.99L2.35,12.02l9.65,6.03,9.65-6.03-9.65-6.03Z"}),n.jsx("path",{fill:"#fff",d:"M12,1.14L2.35,7.17l9.65,6.03,9.65-6.03L12,1.14Z"})]}),tn=({iconName:e,size:t})=>{switch(e){case"save":return n.jsx(Pe,{size:t});case"undo":return n.jsx(De,{size:t});case"redo":return n.jsx(Ae,{size:t});case"trash":return n.jsx(Te,{size:t});case"cross":return n.jsx(Le,{size:t});case"group":return n.jsx($e,{size:t});case"ungroup":return n.jsx(Ee,{size:t});case"lock":return n.jsx(ke,{size:t});case"unlock":return n.jsx(Fe,{size:t});default:return null}},A=20,P="text-black",on=()=>{const e=ee(o=>o.toolbar.actions),{executeAction:t}=f.useContext(N);return n.jsx("div",{className:"border-b border-gray-200 box-border",children:n.jsx("div",{className:"h-10 inline-flex pl-4 items-center",children:Object.values(e).map(o=>{const{id:s,icon:l,disabled:i,divide:a}=o;let r;switch(s){case"layerUp":r=n.jsx(qi,{size:A,className:P});break;case"layerDown":r=n.jsx(Ji,{size:A,className:P});break;case"layerTop":r=n.jsx(Qi,{size:A,className:P});break;case"layerBottom":r=n.jsx(en,{size:A,className:P});break;default:r=n.jsx(tn,{size:A,iconName:l});break}const{tooltip:c}=Re(s,{returnObjects:!0});return n.jsxs(f.Fragment,{children:[n.jsx("button",{type:"button",disabled:i,title:c,onClick:()=>{s==="undo"||s==="redo"?t("history-"+s):s==="delete"&&t("selection-"+s)},className:"relative ml-1 rounded-sm mr-1 flex items-center cursor-pointer justify-center w-6 h-6 opacity-50   hover:bg-gray-200  hover:opacity-100 disabled:text-gray-200 disabled:cursor-default",children:r}),a&&n.jsx("div",{className:"w-[1px] h-4 bg-gray-400 mx-2"})]},s)})})})},sn=()=>n.jsxs("header",{children:[n.jsx(Gi,{}),n.jsx(on,{})]}),ln=()=>{const{historyArray:e,historyCurrent:t,applyHistoryNode:o}=f.useContext(N),{t:s}=D(),l=f.useRef(null);return f.useEffect(()=>{if(l.current)return()=>{}},[e,t]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-600 text-white px-2",children:n.jsx("span",{children:"History"})}),n.jsx("div",{className:"border h-50 border-gray-200 overflow-x-auto scrollbar-custom overflow-y-auto",children:n.jsx("div",{className:"flex flex-col m-2 border border-gray-200 min-h-40 bg-gray-100",children:e.map((i,a)=>{const r=i.id===t,c="history."+i.data.type,{label:d,tooltip:h}=s(c,{returnObjects:!0});return n.jsx("div",{title:h,ref:r?l:null,onClick:()=>{r||o(i)},className:` px-2 py-1 cursor-pointer text-xs hover:bg-gray-400 hover:text-white ${r?"bg-gray-400 text-white":""}`,children:n.jsx("span",{children:d})},a)})})})]})},nn=()=>{const{selectedProps:e}=f.useContext(N);return f.useEffect(()=>{},[e]),n.jsxs("div",{className:"p-2",children:[n.jsx("h1",{className:"bg-gray-400 text-white px-2",children:n.jsx("span",{children:"Properties"})}),n.jsx("div",{className:"scrollbar-custom overflow-x-hidden overflow-y-auto p-2 border h-30 border-gray-200 select-none",children:e&&n.jsx(an,{props:e})})]})},an=({props:e})=>{const t=o=>{console.log(o)};return n.jsxs("div",{className:"z-30 text-sm",children:[n.jsxs("div",{className:"mb-4 ",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"X:"}),n.jsx("input",{type:"number",name:"x",defaultValue:e.x,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Y:"}),n.jsx("input",{type:"number",name:"y",defaultValue:e.y,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{className:"",children:"Width:"}),n.jsx("input",{type:"number",name:"width",defaultValue:e.width,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Height:"}),n.jsx("input",{type:"number",name:"height",defaultValue:e.height,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Radius:"}),n.jsx("input",{type:"number",name:"radius",defaultValue:e.radius,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Fill"}),n.jsx("input",{type:"checkbox",name:"enableFill",defaultChecked:e.enableFill,onChange:t,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Fill Color:"}),n.jsx("input",{type:"color",name:"fillColor",defaultValue:e.fillColor,onChange:t,className:"w-10 h-10 p-1 rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Enable Line"}),n.jsx("input",{type:"checkbox",name:"enableLine",defaultChecked:e.enableLine,onChange:t,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Line Color:"}),n.jsx("input",{type:"color",name:"lineColor",defaultValue:e.lineColor,onChange:t,className:"w-10 h-10 p-1 rounded"})]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Shadow"}),n.jsx("input",{type:"checkbox",name:"shadow",defaultChecked:e.shadow,onChange:t,className:"ml-2"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Opacity:"}),n.jsx("input",{type:"number",name:"opacity",defaultValue:e.opacity,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]}),n.jsxs("div",{className:"px-4 w-full h-full flex justify-between items-center",children:[n.jsx("span",{children:"Layer:"}),n.jsx("input",{type:"number",name:"layer",defaultValue:e.layer,onChange:t,className:"w-16 px-2 py-1 text-black rounded"})]})]})]})},rn=e=>{const s={type:"rectangle",x:100,y:100,width:100,height:100,enableLine:!0,lineColor:"#000000",lineWidth:1,enableFill:!0,fillColor:"#fff",opacity:100,shadow:!1,radius:0,rotation:0},l=10,i=100,a=[];for(let c=0;c<l;c++){const d=100+c*i,h=100+c*i;a.push({...s,fillColor:"#ededed",x:d,y:h,layer:c+1,rotation:c+10})}const r=e.batchCreate(a);e.batchAdd(r),e.history.add({type:"history-add",payload:{modules:[...r.values()].map(c=>c.getDetails()),selectedModules:e.getSelected()}})},cn=({data:{idSet:e,position:t},onClose:o})=>{const{t:s}=D(),{executeAction:l}=f.useContext(N);f.useEffect(()=>{const r=()=>{o()};return window.addEventListener("click",r),()=>{window.removeEventListener("click",r)}},[]);const i=[{id:"copy",disabled:e.size===0},{id:"paste",disabled:!0},{id:"delete",disabled:e.size===0},{id:"duplicate",disabled:e.size===0},{id:"bringToFront",disabled:e.size===0},{id:"sendToBack",disabled:e.size===0}],a=r=>{switch(r){case"copy":l("selection-copy");break;case"paste":l("selection-paste");break;case"delete":l("selection-delete");break;case"duplicate":l("selection-duplicate");break}};return n.jsx("div",{className:"absolute bg-white shadow-lg rounded-md border border-gray-200 py-1 z-50",style:{top:t.y,left:t.x},children:i.map((r,c)=>{const d=s(r.id,{returnObjects:!0}),h=c===2||c===4||c===7;return n.jsxs("div",{children:[h&&n.jsx("div",{className:"border-t border-gray-200 my-1"}),n.jsx("button",{className:"w-full px-4 py-1.5 text-left text-sm hover:bg-gray-100 disabled:text-gray-400 disabled:hover:bg-transparent disabled:cursor-not-allowed",disabled:r.disabled,onClick:()=>a(r.id),title:d.tooltip,children:d.label})]},r.id)})})},dn=({file:e})=>{const t=f.useRef(null),o=f.useRef(null),[s,l]=f.useState([]),[i,a]=f.useState({x:0,y:0}),[r,c]=f.useState([]),[d,h]=f.useState(null),[u,p]=f.useState([]),[y,m]=f.useState(null),[g,x]=f.useState(0),[w,v]=f.useState({width:0,height:0,offsetX:0,offsetY:0,scale:1,dx:0,dy:0,status:""}),F=f.useRef(null),[C,E]=f.useState(!0);f.useEffect(()=>{let S;if(o.current){const ge=_();S=new Ii({container:o.current,data:{id:ge,modules:[]},events:{onHistoryUpdated:M=>{l(M.toArray()),M.current&&x(M.current.id)},onModulesUpdated:M=>{const $=Array.from(M.values()).sort((me,xe)=>me.layer-xe.layer);c($)},onSelectionUpdated:(M,$)=>{p(Array.from(M)),h($)},onViewportUpdated:M=>{v(M)},onWorldMouseMove:M=>{a(M)},onContextMenu:(M,$)=>{console.log(M,$),m({idSet:M,position:$})}}}),rn(S),t.current=S}const j=F.current;return j&&(j.addEventListener("focus",X),j.addEventListener("blur",Y)),()=>{j&&(j.removeEventListener("focus",X),j.removeEventListener("blur",Y)),S&&S.destroy()}},[e]);const X=()=>E(!0),Y=()=>E(!1),be=S=>{t.current&&t.current.execute("history-pick",S)},ye=(S,j=null)=>{},K=(S,j=null)=>{t.current.execute(S,j)};return n.jsx(N.Provider,{value:{focused:C,historyArray:s,selectedModules:u,selectedProps:d,historyCurrent:g,viewport:w,editorRef:t,applyHistoryNode:be,executeAction:K},children:n.jsxs("div",{ref:F,"data-focused":C,autoFocus:!0,tabIndex:0,className:"outline-0 w-full h-full flex flex-col",children:[n.jsx(Oi,{}),n.jsx(sn,{}),n.jsxs("main",{className:"flex flex-row overflow-hidden h-full",children:[n.jsx(Hi,{}),n.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden relative",children:[n.jsx("div",{ref:o,"editor-container":"true",className:"relative overflow-hidden flex w-full h-full"}),n.jsx(Yi,{worldPoint:i}),y&&n.jsx(cn,{data:y,onClose:()=>{m(null)},onAction:ye})]}),n.jsxs("div",{style:{width:200},className:"h-full flex-shrink-0 border-l border-gray-200",children:[n.jsx(nn,{}),n.jsx(Ki,{data:r,selected:u,handleSelectModule:S=>{K("selection-modify",new Set([S]))}}),n.jsx(ln,{})]})]})]})})},hn=e=>[],un=()=>{const e="Untitled 1",t={},o={modules:hn()};return{id:_(),name:e,config:t,data:o}},pn=e=>new Map(e.reduce((t,o)=>(t.push([o.id,o]),t),[])),fn=un(),Q=pn([fn]),bn=()=>{const e=' group py-2 px-6 relative transition flex items-center">',t=" bg-gray-200",o=" hover:bg-gray-200",{fileList:s,currentFileId:l,closeFile:i,switchFile:a,handleCreating:r}=f.useContext(H);return n.jsxs("div",{className:"flex flex-row items-center text-sm select-none",children:[s.map(c=>{const d=c.id===l,h=e+(d?t:o),u=(d?"visible":"invisible")+" w-2 h-2 ml-4 opacity-50 hover:opacity-100 group-hover:visible w-2 h-2 cursor-pointer";return n.jsxs("div",{className:h,onClick:()=>{a(c.id)},children:[n.jsx("span",{children:c.name}),n.jsx("span",{onClick:p=>{i(c.id),p.preventDefault(),p.stopPropagation()},className:u,children:"×"})]},c.id)}),n.jsx("button",{className:"hover:cursor-pointer hover:opacity-100 cursor-pointer opacity-50",children:n.jsx(ze,{size:18,onClick:()=>{r(!0)}})})]})},yn=({children:e,defaultValue:t})=>{const[o,s]=f.useState(!1);return n.jsxs("div",{className:"relative w-20",children:[n.jsxs("div",{className:"flex items-center",onClick:()=>{s(!o)},children:[n.jsx(Be,{}),t]}),o&&n.jsx("div",{onClick:()=>{s(!1)},className:"absolute top-full right-0 w-full",children:e})]})},gn=()=>{const[e,t]=f.useState("en"),o={en:"English",cn:"中文",jp:"日本語"},{i18n:s}=D();return n.jsx("div",{className:"flex flex-row items-center text-sm select-none",children:n.jsx(yn,{defaultValue:o[e],children:Object.keys(o).map((l,i)=>n.jsx("div",{onClick:()=>{s.changeLanguage(l),t(l)},children:o[l]},i))})})},mn=()=>{const e=f.useRef(new Map),[t,o]=f.useState(!1),[s,l]=f.useState(""),[i,a]=f.useState([]),r=e.current.size,c=r===0||t;console.log(s),f.useEffect(()=>{Q.size>0&&(e.current=Q,d(),l(h()[0].id))},[]);const d=()=>{const g=h();return a(g),g},h=()=>Array.from(e.current.values()),u=g=>{console.log(i),l(g)},p=g=>{const x=i.findIndex(v=>v.id===g);let w=i.length;if(x!==-1&&(e.current.delete(g),d(),i.splice(x,1),w--,s===g&&w>0)){let v=x+1;x===0&&(v=0),v>w&&(v=w-1),l(i[v].id)}},y=g=>{e.current.set(g.id,g),d(),l(g.id)},m=g=>{o(g)};return n.jsx(H.Provider,{value:{fileMap:e.current,fileList:i,creating:t,currentFileId:s,switchFile:u,closeFile:p,createFile:y,handleCreating:m},children:n.jsxs("div",{className:"w-full h-full flex flex-col select-none",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx(bn,{}),n.jsx(gn,{})]}),n.jsx("div",{className:"flex-1 overflow-hidden min-h-[600px]",children:i.map(g=>g.id===s?n.jsx(dn,{file:g},g.id):void 0)}),c&&n.jsx(Zl,{bg:r?"#00000080":"#fff",onBgClick:()=>{r&&o(!1)}})]})})};function xn(){return n.jsx(mn,{})}const wn=[{id:"file",parent:null},{id:"newFile",parent:"file",shortcut:"Ctrl+N"},{id:"openFile",parent:"file",shortcut:"Ctrl+O"},{id:"saveFile",parent:"file",shortcut:"Ctrl+S"},{id:"saveAs",parent:"file"},{id:"importFile",parent:"file"},{id:"exportFile",parent:"file"},{id:"print",parent:"file"},{id:"closeFile",parent:"file"},{id:"exportFile_png",parent:"exportFile"},{id:"exportFile_pdf",parent:"exportFile"},{id:"exportFile_csv",parent:"exportFile"},{id:"edit",parent:null},{id:"undo",parent:"edit",shortcut:"Ctrl+Z"},{id:"redo",parent:"edit",shortcut:"Ctrl+Y"},{id:"cut",parent:"edit",shortcut:"Ctrl+X"},{id:"copy",parent:"edit",shortcut:"Ctrl+C"},{id:"paste",parent:"edit",shortcut:"Ctrl+V"},{id:"delete",parent:"edit",shortcut:"Del"},{id:"duplicate",parent:"edit",shortcut:"Ctrl+D"},{id:"selectAll",parent:"edit",shortcut:"Ctrl+A"},{id:"findReplace",parent:"edit",shortcut:"Ctrl+F"},{id:"view",parent:null},{id:"zoomIn",parent:"view",shortcut:"Ctrl++"},{id:"zoomOut",parent:"view",shortcut:"Ctrl+-"},{id:"fitToScreen",parent:"view"},{id:"toggleGrid",parent:"view"},{id:"toggleGuides",parent:"view"},{id:"fullscreenMode",parent:"view",shortcut:"F11"},{id:"shape",parent:null},{id:"addNode",parent:"shape"},{id:"deleteNode",parent:"shape"},{id:"moveNode",parent:"shape"},{id:"resizeNode",parent:"shape"},{id:"rotateNode",parent:"shape"},{id:"changeNodeColor",parent:"shape"},{id:"changeNodeBorder",parent:"shape"},{id:"changeNodeText",parent:"shape"},{id:"groupNodes",parent:"shape"},{id:"ungroupNodes",parent:"shape"},{id:"lockNode",parent:"shape"},{id:"unlockNode",parent:"shape"},{id:"connection",parent:null},{id:"addEdge",parent:"connection"},{id:"deleteEdge",parent:"connection"},{id:"changeEdgeStyle",parent:"connection"},{id:"changeEdgeColor",parent:"connection"},{id:"changeEdgeLabel",parent:"connection"},{id:"reverseEdge",parent:"connection"},{id:"text",parent:null},{id:"addText",parent:"text"},{id:"editText",parent:"text"},{id:"changeFont",parent:"text"},{id:"changeFontSize",parent:"text"},{id:"changeFontColor",parent:"text"},{id:"boldText",parent:"text",shortcut:"Ctrl+B"},{id:"italicText",parent:"text",shortcut:"Ctrl+I"},{id:"underlineText",parent:"text",shortcut:"Ctrl+U"},{id:"alignText",parent:"text"},{id:"layer",parent:null},{id:"sendToBack",parent:"layer"},{id:"bringToFront",parent:"layer"},{id:"sendBackward",parent:"layer"},{id:"bringForward",parent:"layer"},{id:"duplicateLayer",parent:"layer"},{id:"deleteLayer",parent:"layer"},{id:"toggleLayerVisibility",parent:"layer"}],vn={actions:Object.fromEntries(wn.map(e=>[e.id,{...e,disabled:!1}]))},ue=U({name:"menu",initialState:vn,reducers:{setDisabled:(e,t)=>{e.actions[t.payload.id]&&(e.actions[t.payload.id].disabled=t.payload.disabled)},triggerAction:(e,t)=>{const o=e.actions[t.payload];o&&o.disabled}}}),{setDisabled:Ln,triggerAction:Tn}=ue.actions,Mn=ue.reducer,Cn=[{id:"save",icon:"save",disabled:!0,divide:!0},{id:"undo",icon:"undo",disabled:!0},{id:"redo",icon:"redo",disabled:!0,divide:!0},{id:"delete",icon:"trash",disabled:!1},{id:"add",icon:"cross",disabled:!1,divide:!0},{id:"layerUp",icon:"layers",disabled:!1},{id:"layerDown",icon:"layers",disabled:!1},{id:"layerTop",icon:"layers",disabled:!1},{id:"layerBottom",icon:"layers",disabled:!1,divide:!0},{id:"group",icon:"group",disabled:!0},{id:"ungroup",icon:"ungroup",disabled:!0,divide:!0},{id:"lock",icon:"lock",disabled:!1},{id:"unlock",icon:"unlock",disabled:!0}],Sn={actions:Object.fromEntries(Cn.map(e=>[e.id,{...e,disabled:!1}]))},pe=U({name:"menu",initialState:Sn,reducers:{setDisabled:(e,t)=>{e.actions[t.payload.id]&&(e.actions[t.payload.id].disabled=t.payload.disabled)},triggerAction:(e,t)=>{const o=e.actions[t.payload];o&&o.disabled}}}),{setDisabled:An,triggerAction:Dn}=pe.actions,jn=pe.reducer,Nn={zoom:1},fe=U({name:"statusBar",initialState:Nn,reducers:{setZoom:(e,t)=>{e.zoom=t.payload}}}),{setZoom:Pn}=fe.actions,Fn=fe.reducer,kn=Ve({reducer:{menu:Mn,toolbar:jn,statusBar:Fn}});Ie.createRoot(document.getElementById("root")).render(n.jsx(Oe,{store:kn,children:n.jsx(xn,{})}));
